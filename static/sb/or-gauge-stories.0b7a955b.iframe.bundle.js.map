{"version":3,"file":"or-gauge-stories.0b7a955b.iframe.bundle.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEA;;AAEA;AACA;;;;AAIA;;AAEA;AACA;AACA;;AAEA;;;;AAIA;AACA;AACA;AACA","sources":["webpack://@openremote/workshop/../../component/or-gauge/lib/index.js"],"sourcesContent":["var __decorate=this&&this.__decorate||function(t,e,i,s){var a,o=arguments.length,r=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var n=t.length-1;n>=0;n--)(a=t[n])&&(r=(o<3?a(r):o>3?a(e,i,r):a(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(a,o){function r(t){try{l(s.next(t))}catch(t){o(t)}}function n(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,n)}l((s=s.apply(t,e||[])).next())}))};import{css,html,LitElement}from\"lit\";import{customElement,property,query,state}from\"lit/decorators.js\";import{AssetModelUtil}from\"@openremote/model\";import{Gauge}from\"gaugeJS\";import manager,{Util}from\"@openremote/core\";import{i18next}from\"@openremote/or-translate\";import{debounce}from\"lodash\";import{getAssetDescriptorIconTemplate}from\"@openremote/or-icon\";const styling=css`\n    :host {\n        display: flex;\n        align-items: center;\n        flex-direction: column;\n    }\n\n    #chart-wrapper {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n    }\n    #chart-container {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n\n    #chart {\n        width: 100%;\n    }\n\n    .chart-description {\n        margin: 0 20px;\n        font-size: 16px;\n        z-index: 3;\n    }\n    .mainvalue-wrapper {\n        width: 100%;\n        display: flex;\n        flex: 0 0 60px;\n        align-items: center;\n        justify-content: center;\n    }\n    .main-number {\n        color: var(--internal-or-asset-viewer-title-text-color);\n        font-size: 42px;\n    }\n\n    .main-number-icon {\n        font-size: 24px;\n        margin-right: 10px;\n        display: flex;\n    }\n\n    .main-number-unit {\n        font-size: 42px;\n        color: var(--internal-or-asset-viewer-title-text-color);\n        font-weight: 200;\n        margin-left: 5px;\n    }\n\n    .main-number.xs, .main-number-unit.xs {\n        font-size: 18px;\n    }\n    .main-number.s, .main-number-unit.s {\n        font-size: 24px;\n    }\n    .main-number.m, .main-number-unit.m {\n        font-size: 30px;\n    }\n    .main-number.l, .main-number-unit.l {\n        font-size: 36px;\n    }\n    .main-number.xl, .main-number-unit.xl {\n        font-size: 42px;\n    }\n    .main-number.unknown, .main-number-unit.unknown {\n        font-size: unset;\n    }\n`;let OrGauge=class extends LitElement{static get styles(){return[styling]}constructor(){super(),this.decimals=0,this.loading=!1,this.config||(this.config=this.getDefaultConfig()),this.updateComplete.then((()=>{this.resizeObserver=new ResizeObserver(debounce((t=>{const e=t[0].contentRect;this.gaugeSize={width:e.width,height:e.height},this.updateComplete.then((()=>{this.setupGauge()}))}),200)),this.resizeObserver.observe(this._wrapperElem)}))}willUpdate(t){if(t.has(\"assetAttribute\")&&this.assetAttribute){const t=this.assetAttribute[1],e=AssetModelUtil.getAttributeDescriptor(t.name,this.asset.type);this.unit=Util.resolveUnits(Util.getAttributeUnits(t,e,this.asset.type)),this.value=null!=t.value?t.value:NaN}}updated(t){var e,i,s,a;t.has(\"value\")&&(null===(e=this.gauge)||void 0===e||e.set(null!=this.value?this.value:NaN)),t.has(\"attrRef\")&&(this.attrRef?this.loadData(this.attrRef):t.get(\"attrRef\")&&(this.assetAttribute=void 0,this.value=void 0)),t.has(\"min\")&&this.gauge&&(console.log(\"Setting min value\"),this.gauge.setMinValue(this.min||0),this.gauge.set(null!=this.value?this.value:NaN)),t.has(\"max\")&&this.gauge&&(this.gauge.maxValue=this.max||0,this.gauge.set(null!=this.value?this.value:NaN)),t.has(\"thresholds\")&&this.thresholds&&(this.config.options.staticZones=[],console.log(typeof this.thresholds),this.thresholds.sort(((t,e)=>t[0]<e[0]?-1:1)).forEach(((t,e)=>{var i,s,a;const o=t[0],r=this.thresholds[e+1]?this.thresholds[e+1][0]:this.max,n={strokeStyle:t[1],min:this.min&&o&&this.min>o?this.min:this.max&&o&&this.max<o?this.max:o,max:this.max&&r&&this.max<r?this.max:this.min&&r&&this.min>r?this.min:r};null===(a=null===(s=null===(i=this.config)||void 0===i?void 0:i.options)||void 0===s?void 0:s.staticZones)||void 0===a||a.push(n)})),this.min&&(null===(s=null===(i=this.config)||void 0===i?void 0:i.options)||void 0===s?void 0:s.staticZones)&&(this.config.options.staticZones[0].min=this.min),this.gauge&&this.gauge.setOptions(null===(a=this.config)||void 0===a?void 0:a.options))}setupGauge(){var t;console.log(\"setupGauge()\",this.config,this.value),this.gauge=new Gauge(this._gaugeElem),this.gauge.setOptions(null===(t=this.config)||void 0===t?void 0:t.options),this.gauge.maxValue=this.max?this.max:100,this.gauge.setMinValue(this.min?this.min:0),this.gauge.animationSpeed=1,this.gauge.set(null!=this.value?this.value:NaN),null==this.value&&this.attrRef&&this.loadData(this.attrRef)}getGaugeWidth(t,e=!0){if(!t)return\"unset\";const i=t.width,s=1.5*(e?t.height-this._detailsElem.clientHeight:t.height);return Math.min(i,s)+\"px\"}shouldShowLabel(t){return t.width>70&&t.height>100}getLabelSize(t){return t<120?\"s\":t<240?\"m\":t<320?\"l\":\"xl\"}render(){const t=!this.gaugeSize||this.shouldShowLabel(this.gaugeSize),e=t&&this.gaugeSize?this.getLabelSize(this.gaugeSize.width):\"unknown\",i=this.getGaugeWidth(this.gaugeSize,t);return html`\n            <div style=\"position: relative; height: 100%; width: 100%;\">\n                <div id=\"chart-wrapper\" style=\"display: ${this.loading?\"none\":\"flex\"};\">\n                    <div id=\"chart-container\" style=\"flex: 0 0 0; width: ${i};\">\n                        <canvas id=\"chart\"></canvas>\n                    </div>\n                    <div id=\"details-container\">\n                        ${t?html`\n                            <div class=\"mainvalue-wrapper\">\n                                <span class=\"main-number-icon\">${this.asset?getAssetDescriptorIconTemplate(AssetModelUtil.getAssetDescriptor(this.asset.type)):\"\"}</span>\n                                <span class=\"main-number ${e}\">${this.value}</span>\n                                <span class=\"main-number-unit ${e}\">${this.unit?this.unit:\"\"}</span>\n                            </div>\n                        `:void 0}\n                    </div>\n                </div>\n            </div>\n            ${this.loading?html`\n                <span>${i18next.t(\"loading\")}</span>\n            `:void 0}\n        `}loadData(t){return __awaiter(this,void 0,void 0,(function*(){const e=(yield manager.rest.api.AssetResource.queryAssets({ids:[t.id]})).data,i=[t].map((t=>{const i=e.findIndex((e=>e.id===t.id)),s=i>=0?e[i]:void 0;return s&&s.attributes?[i,s.attributes[t.name]]:void 0})).filter((t=>!!t));this.asset=e[0],this.assetAttribute=i[0]}))}getDefaultConfig(){return{attributeRef:void 0,options:{angle:0,lineWidth:.4,radiusScale:1,pointer:{length:.5,strokeWidth:.035,color:\"#000000\"},staticZones:[],limitMax:!0,limitMin:!0,colorStart:\"#000000\",colorStop:\"#707070\",strokeColor:\"#ABCDEF\",generateGradient:!1,highDpiSupport:!0}}}};__decorate([property({type:Object})],OrGauge.prototype,\"attrRef\",void 0),__decorate([property({type:Object})],OrGauge.prototype,\"asset\",void 0),__decorate([property({type:Object})],OrGauge.prototype,\"assetAttribute\",void 0),__decorate([property({type:Number})],OrGauge.prototype,\"value\",void 0),__decorate([property()],OrGauge.prototype,\"decimals\",void 0),__decorate([property()],OrGauge.prototype,\"unit\",void 0),__decorate([property()],OrGauge.prototype,\"min\",void 0),__decorate([property()],OrGauge.prototype,\"max\",void 0),__decorate([property({type:Array})],OrGauge.prototype,\"thresholds\",void 0),__decorate([property()],OrGauge.prototype,\"config\",void 0),__decorate([property({type:String})],OrGauge.prototype,\"realm\",void 0),__decorate([state()],OrGauge.prototype,\"loading\",void 0),__decorate([query(\"#chart\")],OrGauge.prototype,\"_gaugeElem\",void 0),__decorate([query(\"#chart-wrapper\")],OrGauge.prototype,\"_wrapperElem\",void 0),__decorate([query(\"#details-container\")],OrGauge.prototype,\"_detailsElem\",void 0),OrGauge=__decorate([customElement(\"or-gauge\")],OrGauge);export{OrGauge};"],"names":[],"sourceRoot":""}