{"version":3,"file":"2810.811717bb.iframe.bundle.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkKA;;AAuLA;;AAEA;AAEA;AAgBA;;;AAMA;;;;;;;;;;;;;;;;;;;;AClPA;;;;;;;;;;;;;AAcA;AA4DA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAGA;;;AClNA;;;AAGA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACNA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwIA;;;AAGA;;;;AAIA;AACA;AACA;AACA;;;;AAIA;;;;AAIA;AACA;;AAEA;;;;AAIA;AACA;AACA;;;;;;;;AAQA;;AAEA;;AAEA;;AAEA;AACA;;;;;;;AAOA;;;;AAIA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AC3MA;;AAEA;;AAEA;;AAEA;;;AAGA;;;;AAIA;AACA;AACA;;AAEA;;AAEA;AACA;;;AAGA;;;ACrBA;AACA;;;;AAIA;;;;AAIA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;;;;;;;;;;;;;;;;;;;;;;;;AC1EA;;;;;;;;;;;ACWA;;;;;;;AAOA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;;AAIA;;;;;;AAMA;;;AAGA;;;;AAIA;AACA;;AAEA;;;AAGA;;;;AAIA;;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChCA;;;;;AAKA;;;;AC9BA;;;AAGA;;;AAGA;;;AAGA;AACA;AACA;AACA;;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC0CA;;;;;;;AAOA;;;;;;;;;;;;AAYA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;;;;AAIA;;AAEA;;;;AAIA;AACA;;;;AAIA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;;;;;;;AAOA;;AAEA;;AAEA;AACA;;AAEA;;;ACvJA;AACA;;;;;AAKA;AACA;;;AAGA;AACA;AACA;;;;ACXA;;;AAGA;AACA;;;;AAIA;;AAEA;AACA;AACA;AACA;;;;;AAKA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;AAQA;;;;;;AAMA;;;;AAIA;AACA;AACA;;;AAGA;AACA;AACA;;;;;;AAMA;AACA;;;;;;;;AAQA;AACA;;;;;;;AAOA;;;;;AAKA;AACA;AACA;;;;;AAKA;;;;;AAKA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;;;;AAMA;;ACtHA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;ACdA;;;AAGA;;;AAGA;;;AAGA;;;AAGA;;;;;;;;;;;;AAYA;AACA;;;;AAIA;;AAEA;AACA;;AAEA;AACA;;;;;;;AAOA;;;;;;;;AAQA;;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACIA;AACA;;;;;;;;;;;;;;;;;;;AAmBA;;AAEA;;;AAGA;AACA;;;AAGA;;;AAGA;AACA;AACA;;;;;;AAMA;AACA;AACA;;;;AAIA;;;;;AAKA;;;;AAIA;;;;;AAKA;;AAEA;;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1FA;;AAEA;AACA;;;;;;AAMA;AACA;;AAEA;;AAEA;;AAEA;;;;AAIA;;;;;;ACjDA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;;;;AAKA;;;;AAIA;AACA;AACA;;;;;;;AAOA;AACA;;;;;AAKA;AACA;;;;;;;;AAQA;;;;;AAKA;;;;;;AAMA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;;AAIA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;AAMA;;;;;;AAMA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;;;;AAIA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;;;;AAIA;;;;;AAKA;;;AAGA;AACA;;;;AAIA;;;;;AAKA;AACA;AACA;;AAEA;AC9IA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;;;;AAKA;;;ACXA;AACA;AACA;;;;;AAKA;;;AAGA;AACA;;AAEA;AACA;;;;AAIA;AACA;;;;;;;AAOA;AACA;AACA;AACA;;;;AAIA;ACnCA;AACA;AACA;;;AAGA;;;;;AAKA;;;;;;ACLA;;;AAGA;AACA;AACA;;;;;AAKA;;AAEA;;;;;AAKA;;AAEA;AACA;;;;;AAKA;;;AAGA;AACA;AACA;;;;AAIA;AACA;AACA;;;AAGA;AACA;AACA;;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvBA;AACA;;;;;;;AAOA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;;AAGA;;;;AAIA;;;;;;AC/CA;;;AAGA;AACA;AACA;;;;;AAKA;;AAEA;AACA;AACA;AACA;;;;AAIA;AACA;;;;;;AAMA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;AAOA;;AC5CA;AACA;AACA;;;AAGA;;;;;;ACDA;;;;;AAKA;;;;AAIA;;AAEA;AACA;;;AAGA;;;AAGA;;AAEA;AACA;AACA;;;AAGA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;ACxBA;AACA;;;;;;;;;;;AAWA;;;;AAIA;AACA;;;AAGA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;;;AAGA;;;;;;AAMA;AACA;;AAEA;;;AAGA;;;AAGA;AACA;;;AAGA;;;;;AAKA;AACA;;;AAGA;;;AAGA;;;AAGA;AACA;;;AAGA;AACA;;;AAGA;AACA;;;AAGA;;;AAGA;;AAEA;;;AAGA;;;;;;AAMA;AACA;;AAEA;;AAEA;;;;;;AC1HA;;;;AAIA;;;AAGA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;;;;;;;AAOA;AACA;AACA;AACA;;;;;;;AAOA;AACA;AACA;;;;;AAKA;AACA;AACA;;;;;;;AAOA;AACA;AACA;AACA;AACA;;;;;AAKA;;ACrEA;AACA;;;AAGA;AACA;AACA;;;;;;ACFA;;;AAGA;AACA;AACA;;;;;AAKA;;;;;AAKA;AACA;;;;;;AAMA;AACA;;;;;;AAMA;;;;;;;;;;;;;ACtBA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;;;;AAKA;;;;;;ACxBA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;;;;;;AAMA;;;;AAIA;AACA;;;;;;AAMA;;;;;AC3BA;;AAEA;AACA;;;AAGA;;ACTA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;;;;;AAMA;;;;;;;;;;;;;;;;;;AC3BA;;;AAGA;;AAEA;;AAEA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;;;AAIA;AACA;AACA;;;;;AAKA;;;;;;;;;;;;;;;;;;;;;;;;;ACrBA;;;;;;;AAOA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;;AAEA;;;;AAIA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;AAOA;;;;AAIA;AACA;AACA;;;;AAIA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;AAUA;;AAEA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;AAIA;;AAEA;;;;AAIA;;;AAGA;AACA;;;;;AAKA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;;;;;AAMA;;;;;AAKA;;AAEA;AACA;AACA;AACA;;;AAGA;;;;;;;;;;AC1OA;;AA6DA;AACA;AACA;AACA;AACA;;;AAIA;;;ACpHA;AACA;AACA;;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACmDA;AACA;AACA;;AAEA;;;AAGA;;;AAGA;;AAEA;;;;;;;;AAQA;AACA;AACA;AACA;;AAEA;;;;AAIA;AACA;;;AAGA;;;;;;;;;AASA;AACA;;AAEA;AACA;AACA;;;AAGA;;;;AC9GA;;;AAOA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACRA;;;AAGA;;;;AAIA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;ACdA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0DA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AC/FA;;;;;;;;;;;;;;;;;;;;;;;AAuBA;;;AAGA;AACA;AACA;;;AAGA;AACA;;;AAGA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;;;;;;;;;;;;;;ACzCA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;ACtBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6EA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;;AAEA;;;AAGA;AACA;;;;;;;;;;;;;;;ACxHA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AC/BA;AACA;;AAEA;;;;;;ACEA;;AAEA;AACA;;AAEA;;;;;;ACLA;;AAEA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;;;;;;;;;;;;;ACjCA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AC1CA;AACA;AACA;AACA;AACA;;AAEA;;;;ACHA;AACA;AACA;;;;AAIA;AACA;AACA;;AAEA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;AAKA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;;ACxFA;;AAEA;AACA;;;AAGA;;;;;;;;ACXA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;;AAGA;;;;;;;;;;;;;;;;;;;;;AC3FA;;AAEA;AACA;;;;;AAKA;AACA;;;AAGA;;;;;;;;;;;;;;;;;;;;;;ACXA;AACA;AACA;ACvBA;AACA;;;;;;;;;;;;;;;;;;;;;;AAsBA;;;AAGA;;;AAGA;;;;AAIA;AACA;;;AAGA;AACA;;;;;AAKA;;;;AAIA;;;AAGA;AACA;AACA;AACA;AACA;;;;;AAKA;;;AAGA;;AAEA;AACA;;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChCA;;AAEA;;AAEA;;AAEA;AACA;;;AAGA;;AAEA;;AAEA;;;AAGA;AACA;;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3DA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6CA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChDA;ACCA;AACA;AACA;AACA;AACA;AACA;;ACJA;;AAEA;ACHA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpBA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AClCA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;;;;;;;;AAkBA;;;;;;;;;;;;;;;ACdA;;;;;;;;;;;;;;;;;;;;;;;;ACfA;;;;;;;AAOA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACCA;AACA;AACA;AACA;AACA;;AAEA;ACrDA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AAyBA;;AAEA;AACA;AC9BA;AACA;;AAEA;;;;;;;;;;;;ACQA;AACA;;AAEA;AACA;;;AAGA;AACA;;;AAGA;;;;;;;;;;;;;;;ACRA;AACA;;AAEA;AACA;;;AAGA;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC+BA;AACA;AACA;AACA;;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACwBA;;;AAGA;AACA;AACA;AACA;;;;AAIA;;;AAGA;;;;AAIA;;AAEA;ACtFA;AACA;AACA;AACA;;;;;;;AAOA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;;AAIA;AACA;;;;AAIA;;;;;;;;;;;;;;AAcA;;;;;;AAMA;AACA;AACA;AACA;;;;;;;;;ACwBA;AA6BA;AAEA;;;;;;;;;;;;;;;;;;ACjDA;;;;;;;;;;;;;;;;;;;;;;;AAuBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsEA;;AAiGA;;AAMA;;;AAWA;;;AAGA;;;;;;;;;;;;;;;;;AAiBA;AAEA;;AAEA;AACA;;;AAGA;;;AAGA;;;AAGA;;;;;;AAMA;;;AAGA;;;;;;AAMA;AAEA;;;;;AAKA;AAEA;;;;;;;AAOA;AAEA;;;;;AAKA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAOA;;;AAGA;AACA;;;AAGA;;;;;;AAOA;;;;;;;;;;;;;;;;;ACxWA;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCA;;AAgQA;;;;AAkDA;;;AAGA;;AAEA;;AAEA;;;;AAIA;;;;AAIA;AACA;;;AAKA;AACA;AACA;;;AAGA;AACA;;;AAIA;;;AAGA;;AAEA;;AAEA;;AAEA;AACA;;;;AAIA;;;;;AAOA;;AAEA;AACA;;AAEA;AACA;;;;AAIA;;;;AAOA;AAOA;AACA;AACA;AACA;AACA;AACA;;AAGA;;AA4GA;AACA;AACA;AAKA;AAKA;AAuFA;AASA;AACA;AAGA;;AAUA;AACA;;AAGA;;;AA2BA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;;;AAMA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAKA;AACA;AACA;AACA;AACA;;;;;;AASA;;AAEA;;AAEA;AACA;AACA;AACA;;;;;;AASA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;AAYA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;AAWA;AACA;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;;;;;;AAcA;AACA;AACA;AACA;AACA;;;;;AAKA;;;AAGA;AACA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;;;;;AAmCA;;;;;;;;;;;;;;;;;;ACr/BA;;;;;;;;;;;;;;;;;;;;;;;;AAwBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEA;;AAuCA;;AAMA;;;AAIA;;;AAKA;;;;;;;;;;;AAWA;AAIA;;;AAGA;AACA;;;AAGA;;;AAGA;;;;AAIA;;;;;;AAMA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAQA;;;AAGA;;;AAGA;;;;;;;;AASA;AAyDA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;AAoCA;;;AC3bA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiMA;;;;AAIA;;;;;AAKA;AACA;AACA;;;;AAIA;AACA;;AAnQA;;;AAwQA;AACA;;;;AAIA;;;;AAIA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/PA;;;;;;;;;;;AAWA;;AClDA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyCA;AACA;AACA;AACA;AACA;AACA;;;;;;AAMA;;;;;;;;;;AAUA;;AAEA;AACA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACDA;;AAEA;AACA;;;;AAIA;;AAEA;AACA;AACA;;AAEA;;;;AAIA;AACA;AACA;AACA;;;;AC/DA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACNA","sources":["webpack://@openremote/workshop/../../src/pages/page-map.ts","webpack://@openremote/workshop/../../src/pages/page-assets.ts","webpack://@openremote/workshop/../../component/or-data-viewer/lib/style.js","webpack://@openremote/workshop/../../component/or-attribute-card/lib/index.js","webpack://@openremote/workshop/../../component/or-data-viewer/lib/index.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/style.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/service/dashboard-service.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/or-dashboard-tree.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/or-dashboard-browser.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/or-dashboard-widgetcontainer.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/or-dashboard-preview.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/or-dashboard-widgetsettings.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/or-dashboard-boardsettings.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/controls/dashboard-refresh-controls.js","webpack://@openremote/workshop/../../component/or-mwc-components/lib/or-mwc-tabs.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/panels/attributes-panel.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/util/settings-panel.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/settings/chart-settings.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/widgets/chart-widget.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/settings/gauge-settings.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/widgets/gauge-widget.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/settings/image-settings.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/widgets/image-widget.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/settings/kpi-settings.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/widgets/kpi-widget.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/panels/assettypes-panel.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/panels/thresholds-panel.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/settings/map-settings.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/widgets/map-widget.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/settings/attribute-input-settings.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/widgets/attribute-input-widget.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/settings/table-settings.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/widgets/table-widget.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/settings/gateway-settings.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/widgets/gateway-widget.js","webpack://@openremote/workshop/../../component/or-dashboard-builder/lib/index.js","webpack://@openremote/workshop/../../src/pages/page-insights.ts","webpack://@openremote/workshop/../../component/or-mwc-components/lib/or-mwc-drawer.js","webpack://@openremote/workshop/../../component/or-rules/lib/or-rule-list.js","webpack://@openremote/workshop/../../component/or-rules/lib/style.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/modals/or-rule-radial-modal.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/or-rule-asset-query.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/or-rule-trigger-query.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/or-rule-condition.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/or-rule-when.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/or-rule-action-attribute.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/modals/or-rule-notification-modal.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/forms/or-rule-form-email-message.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/forms/or-rule-form-push-notification.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/or-rule-action-notification.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/modals/or-rule-webhook-modal.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/forms/or-rule-form-webhook.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/or-rule-action-webhook.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/or-rule-then-otherwise.js","webpack://@openremote/workshop/../../component/or-rules/lib/json-viewer/or-rule-json-viewer.js","webpack://@openremote/workshop/../../component/or-rules/lib/or-rule-text-viewer.js","webpack://@openremote/workshop/../../component/or-rules/lib/or-rule-validity.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/node-panel.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/context-menu.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/converters/node-converter.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/flow-node.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/workspace-contextmenu-options.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/editor-workspace.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/top-bar.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/node-menu-item.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/flow-node-socket.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/connection-line.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/selection-box.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/internal-picker.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/popup-modal.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/rule-browser.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/writable-dropdown.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/confirmation-dialog.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/notification-dialog.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/services/modal.js","webpack://@openremote/workshop/../../component/or-rules/lib/flow-viewer/components/flow-editor.js","webpack://@openremote/workshop/../../component/or-rules/lib/or-rule-viewer.js","webpack://@openremote/workshop/../../component/or-rules/lib/index.js","webpack://@openremote/workshop/../../src/pages/page-rules.ts","webpack://@openremote/workshop/../../src/pages/page-roles.ts","webpack://@openremote/workshop/../../src/pages/page-users.ts","webpack://@openremote/workshop/../../src/pages/page-realms.ts","webpack://@openremote/workshop/../../component/or-app/lib/or-header.js","webpack://@openremote/workshop/../../component/or-app/lib/page-offline.js","webpack://@openremote/workshop/../../component/or-app/lib/index.js","webpack://@openremote/workshop/../../component/or-gauge/lib/index.js","webpack://@openremote/workshop/../src/loading-page.ts","webpack://@openremote/workshop/../src/index.ts"],"sourcesContent":[null,null,"import{css,unsafeCSS}from\"lit\";import{DefaultColor1,DefaultColor2,DefaultColor3,DefaultColor5}from\"@openremote/core\";export const style=css`\n\n    :host {\n        --internal-or-asset-viewer-background-color: var(--or-asset-viewer-background-color, var(--or-app-color2, ${unsafeCSS(DefaultColor2)}));\n        --internal-or-asset-viewer-panel-margin: var(--or-asset-viewer-panel-margin, 20px);\n        --internal-or-asset-viewer-panel-padding: var(--or-asset-viewer-panel-padding, 24px);\n        --internal-or-asset-viewer-text-color: var(--or-asset-viewer-text-color, var(--or-app-color3, ${unsafeCSS(DefaultColor3)}));\n        --internal-or-asset-viewer-title-text-color: var(--or-asset-viewer-title-text-color, var(--or-app-color3, ${unsafeCSS(DefaultColor3)}));       \n        --internal-or-asset-viewer-panel-color: var(--or-asset-viewer-panel-color, var(--or-app-color1, ${unsafeCSS(DefaultColor1)}));\n        --internal-or-asset-viewer-line-color: var(--or-asset-viewer-line-color, var(--or-app-color5, ${unsafeCSS(DefaultColor5)}));\n        \n        height: 100%;\n        width: 100%;\n        background-color: var(--internal-or-asset-viewer-background-color);\n    }\n   \n    *[hidden] {\n        display: none;\n    }\n    \n    #container {\n        width: 100%;\n        box-sizing: border-box;\n        display: grid;\n        margin: auto;\n        padding: 20px 20px;\n        grid-gap: 10px;\n        grid-template-columns: repeat(auto-fill, minmax(calc(25% - 8px), 1fr));\n        grid-auto-rows: 5px;\n\n        -webkit-animation: fadein 0.3s; /* Safari, Chrome and Opera > 12.1 */\n        -moz-animation: fadein 0.3s; /* Firefox < 16 */\n        -ms-animation: fadein 0.3s; /* Internet Explorer */\n        -o-animation: fadein 0.3s; /* Opera < 12.1 */\n        animation: fadein 0.3s;\n    }\n\n    @keyframes fadein {\n        from { opacity: 0; }\n        to   { opacity: 1; }\n    }\n\n    /* Firefox < 16 */\n    @-moz-keyframes fadein {\n        from { opacity: 0; }\n        to   { opacity: 1; }\n    }\n\n    /* Safari, Chrome and Opera > 12.1 */\n    @-webkit-keyframes fadein {\n        from { opacity: 0; }\n        to   { opacity: 1; }\n    }\n\n    /* Internet Explorer */\n    @-ms-keyframes fadein {\n        from { opacity: 0; }\n        to   { opacity: 1; }\n    }\n\n    /* Opera < 12.1 */\n    @-o-keyframes fadein {\n        from { opacity: 0; }\n        to   { opacity: 1; }\n    }\n\n    .panel {\n        background-color: var(--internal-or-asset-viewer-panel-color);     \n        border: 1px solid #e5e5e5;\n        border-radius: 5px;\n        max-width: 100%;\n    }\n    \n    .panel-content-wrapper {\n        padding: var(--internal-or-asset-viewer-panel-padding);\n    }\n  \n    .panel-content {\n        display: flex;\n        flex-wrap: wrap;\n    }\n        \n    .panel-title {\n        text-transform: uppercase;\n        font-weight: bolder;\n        line-height: 1em;\n        color: var(--internal-or-asset-viewer-title-text-color);\n        margin-bottom: 25px;\n        flex: 0 0 auto;\n    }\n   \n    .field {\n        margin: 10px 0;\n        width: 100%;\n        flex: 0 0 auto;\n        min-height: 50px;\n    }\n    \n    .field > * {\n        width: 100%;\n        box-sizing: border-box;\n    }\n    \n    .msg {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        text-align: center;\n        height: 100%;\n    }\n    \n    .back-navigation {\n        display: none;\n        cursor: pointer;\n    }\n\n    @media screen and (max-width: 1024px) {\n        #container {\n            grid-template-columns: repeat(auto-fill, minmax(calc(50% - 8px), 1fr));\n        }\n    }\n\n    @media screen and (max-width: 769px) {\n        .back-navigation {\n            display: block;\n        }\n        \n        .mobileHidden {\n            display: none;\n        }\n      \n        #container {\n            grid-auto-rows: auto;\n        }\n\n        .panel {\n            border-radius: 0;\n            border-right: none;\n            border-left: none;\n        }\n\n        #chart-panel {\n            grid-row-start: 1;\n        }\n\n        \n        #container { \n            grid-template-columns: 100% !important;\n            padding: 20px 0;\n        }\n        \n        \n    }\n`;","var __decorate=this&&this.__decorate||function(t,e,i,a){var s,r=arguments.length,o=r<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,a);else for(var n=t.length-1;n>=0;n--)(s=t[n])&&(o=(r<3?s(o):r>3?s(e,i,o):s(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o},__awaiter=this&&this.__awaiter||function(t,e,i,a){return new(i||(i=Promise))((function(s,r){function o(t){try{l(a.next(t))}catch(t){r(t)}}function n(t){try{l(a.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,n)}l((a=a.apply(t,e||[])).next())}))};import{css,html,LitElement,unsafeCSS}from\"lit\";import{customElement,property,query}from\"lit/decorators.js\";import i18next from\"i18next\";import{AssetModelUtil}from\"@openremote/model\";import{DefaultColor3,DefaultColor4,manager,Util}from\"@openremote/core\";import{Chart,LineController,LineElement,PointElement,LinearScale,TimeSeriesScale,Title}from\"chart.js\";import\"chartjs-adapter-moment\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{getAssetDescriptorIconTemplate}from\"@openremote/or-icon\";import\"@openremote/or-mwc-components/or-mwc-dialog\";import\"@openremote/or-attribute-picker\";import moment from\"moment\";import{OrAssetTreeSelectionEvent}from\"@openremote/or-asset-tree\";import{OrMwcDialog,showDialog}from\"@openremote/or-mwc-components/or-mwc-dialog\";import{OrAttributePicker,OrAttributePickerPickedEvent}from\"@openremote/or-attribute-picker\";import{getContentWithMenuTemplate}from\"@openremote/or-mwc-components/or-mwc-menu\";import{debounce}from\"lodash\";Chart.register(LineController,LineElement,PointElement,LinearScale,Title,TimeSeriesScale);const style=css`\n    \n    :host {\n        --internal-or-attribute-history-graph-line-color: var(--or-attribute-history-graph-line-color, var(--or-app-color4, ${unsafeCSS(DefaultColor4)}));       \n        width: 100%;\n    }\n    \n    :host([hidden]) {\n        display: none;\n    }\n    \n    .panel {\n        position: relative;\n        height: 100%;\n    }\n    .panel.panel-empty {\n        display: flex;\n    }\n    .panel.panel-empty .panel-content-wrapper {\n        align-items: center;\n        width: 100%;\n    }\n    .panel.panel-empty .panel-content {\n        align-items: center;\n        justify-content: center;\n        flex-direction: column;\n    }\n    \n    .panel-content-wrapper {\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n    }\n        \n    .panel-title {\n        display: flex;\n        align-items: center;\n        /*margin: -15px -15px 0 0;*/ /* compensate for the click-space of the plusminus button */\n        font-weight: bolder;\n        line-height: 1em;\n        color: var(--internal-or-asset-viewer-title-text-color);\n        flex: 0 0 auto;\n    }\n    \n    .panel-title-text {\n        flex: 1;\n        text-transform: uppercase;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        overflow: hidden;\n    }\n    \n    .panel-content {\n        display: flex;\n        flex-direction: column;\n        width: 100%;\n        flex: 1;\n    }\n    \n    .mainvalue-wrapper {\n        width: 100%;\n        display: flex;\n        flex: 0 0 60px;\n        align-items: center;\n        justify-content: center;\n    }\n    \n    .graph-wrapper {\n        width: 100%;\n        display: flex;\n        flex: 1;\n        align-items: center;\n    }\n    \n    .main-number {   \n        color: var(--internal-or-asset-viewer-title-text-color);\n        font-size: 42px;\n    }\n    \n    .main-number-icon {   \n        font-size: 24px;\n        margin-right: 10px;\n        display: flex;\n    }\n    \n    .main-number-unit {\n        font-size: 42px;\n        color: var(--internal-or-asset-viewer-title-text-color);\n        font-weight: 200;\n        margin-left: 5px;\n    }\n    \n    .main-number.xs, .main-number-unit.xs {\n        font-size: 18px;\n    }\n    .main-number.s, .main-number-unit.s {\n        font-size: 24px;\n    }\n    .main-number.m, .main-number-unit.m {\n        font-size: 30px;\n    }\n    .main-number.l, .main-number-unit.l {\n        font-size: 36px;\n    }\n    .main-number.xl, .main-number-unit.xl {\n        font-size: 42px;\n    }\n    \n    .chart-wrapper {\n        flex: 1 1 auto;\n        width: 65%;\n        height: 75%;\n    }\n    .controls-wrapper {\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n        place-content: space-between;\n    }\n    \n    .delta-wrapper {\n        /*flex: 0 0 50px;*/\n        text-align: right;\n        \n        /*position: absolute;*/\n        /*right: var(--internal-or-asset-viewer-panel-padding);*/\n    }\n    \n    .date-range-wrapper {\n        flex: 1;\n        display: flex;\n        justify-content: space-between;\n    }\n    \n    .period-selector {\n        \n    }\n    \n    .delta {\n        color: var(--or-app-color3, ${unsafeCSS(DefaultColor3)});\n        font-weight: bold;\n    }\n`;let OrAttributeCard=class extends LitElement{static get styles(){return[style]}constructor(){super(),this.assets=[],this.assetAttributes=[],this.data=void 0,this.mainValueDecimals=2,this.mainValueSize=\"m\",this.delta=void 0,this.deltaPlus=\"\",this.deltaFormat=\"absolute\",this.showControls=!0,this.showTitle=!0,this._loading=!1,this.error=!1,this.period=\"day\"}connectedCallback(){super.connectedCallback(),this._style=window.getComputedStyle(this)}disconnectedCallback(){super.disconnectedCallback(),this._cleanup()}firstUpdated(){this.loadSettings()}updated(t){t.has(\"realm\")&&null!=t.get(\"realm\")&&(this.assets=[],this.loadSettings()),(t.has(\"period\")||t.has(\"compareTimestamp\")||t.has(\"timestamp\")||t.has(\"assetAttributes\")||t.has(\"realm\"))&&(this.data=void 0,this._chart&&(this._chart.destroy(),this._chart=void 0),this.loadData()),this.data&&0!==this.data.length&&(this._chart?t.has(\"data\")&&(this._chart.data.datasets[0].data=this.data.filter((t=>null!=t.y)),this._chart.update(),this.delta=this.getFormattedDelta(this.getFirstKnownMeasurement(this.data),this.getLastKnownMeasurement(this.data))):this._chart=new Chart(this._chartElem.getContext(\"2d\"),{type:\"line\",data:{datasets:[{data:this.data.filter((t=>null!=t.y)),tension:.1,spanGaps:!0,backgroundColor:\"transparent\",borderColor:this._style.getPropertyValue(\"--internal-or-attribute-history-graph-line-color\"),pointBorderColor:\"transparent\"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{displayColors:!1,callbacks:{title:t=>\"\",footer:()=>\"\"}}},scales:{y:{display:!1},x:{type:\"time\",min:this._startOfPeriod,max:this._endOfPeriod,display:!1}}}}),(t.has(\"mainValue\")||t.has(\"mainValueDecimals\"))&&(this.formattedMainValue=this.getFormattedValue(this.mainValue)),t.has(\"delta\")&&(this.deltaPlus=this.delta&&this.delta.val>0?\"+\":\"\"))}shouldShowControls(){return this.showControls&&\"true\"==this.showControls.toString()}shouldShowTitle(){return this.showTitle&&\"true\"==this.showTitle.toString()}render(){return this.assets&&this.assetAttributes&&0!==this.assetAttributes.length?this.error?html`\n                <div class=\"panel panel-empty\">\n                    <div class=\"panel-content-wrapper\">\n                        <div class=\"panel-content\">\n                            <span>${i18next.t(\"couldNotRetrieveAttribute\")}</span>\n                            ${this.shouldShowControls()?html`\n                                <or-mwc-input class=\"button\" .type=\"${InputType.BUTTON}\" label=\"selectAttribute\" icon=\"plus\" @or-mwc-input-changed=\"${()=>this._openDialog(\"editAttribute\")}\"></or-mwc-input>\n                            `:void 0}\n                        </div>\n                    </div>\n                </div>\n            `:(this.updateComplete.then((()=>{this.resizeObserver=new ResizeObserver(debounce((t=>{const e=t[0].devicePixelContentBoxSize[0].blockSize;this.setLabelSizeByWidth(e)}),200)),this.resizeObserver.observe(this.shadowRoot.querySelector(\".graph-wrapper\"))})),html`\n            <div class=\"panel\" id=\"attribute-card\">\n                <div class=\"panel-content-wrapper\">\n                    <div class=\"panel-title\">\n                        ${this.shouldShowTitle()?html`<span class=\"panel-title-text\">${this.assets[0].name+\" - \"+i18next.t(this.assetAttributes[0][1].name)}</span>`:void 0}\n                        ${this.shouldShowTitle()?getContentWithMenuTemplate(html`\n                            <or-mwc-input icon=\"dots-vertical\" type=\"button\"></or-mwc-input>\n                        `,[{text:i18next.t(\"editAttribute\"),value:\"editAttribute\"},{text:i18next.t(\"editDelta\"),value:\"editDelta\"},{text:i18next.t(\"editCurrentValue\"),value:\"editCurrentValue\"},{text:i18next.t(\"delete\"),value:\"delete\"}],void 0,(t=>this.handleMenuSelect(t))):void 0}\n                    </div>\n                    <div class=\"panel-content\">\n                        <div class=\"mainvalue-wrapper\">\n                            <span class=\"main-number-icon\">${this.assets&&1===this.assets.length?getAssetDescriptorIconTemplate(AssetModelUtil.getAssetDescriptor(this.assets[0].type)):\"\"}</span>\n                            <span class=\"main-number ${this.mainValueSize}\">${this.formattedMainValue?this.formattedMainValue.value:\"\"}</span>\n                            <span class=\"main-number-unit ${this.mainValueSize}\">${this.formattedMainValue?this.formattedMainValue.unit:\"\"}</span>      \n                        </div>\n                        <div class=\"graph-wrapper\">\n                            <div class=\"chart-wrapper\">\n                                <canvas id=\"chart\"></canvas>\n                            </div>\n                            <div class=\"controls-wrapper\">\n                                <div class=\"delta-wrapper\">\n                                    <span class=\"delta\">${this.delta?this.deltaPlus+(void 0!==this.delta.val&&null!==this.delta.val?this.delta.val:\"\")+(this.delta.unit||\"\"):\"\"}</span>\n                                </div>\n                                ${this.shouldShowControls()?html`\n                                    <div class=\"period-selector-wrapper\">\n                                        ${getContentWithMenuTemplate(html`<or-mwc-input class=\"period-selector\" .type=\"${InputType.BUTTON}\" label=\"${this.period?this.period:\"-\"}\"></or-mwc-input>`,[{value:\"hour\",text:\"hour\"},{value:\"day\",text:\"day\"},{value:\"week\",text:\"week\"},{value:\"month\",text:\"month\"},{value:\"year\",text:\"year\"}].map((t=>(t.text=i18next.t(t.value),t))),this.period,(t=>this._setPeriodOption(t)))}\n                                    </div>\n                                `:html`\n                                    <or-mwc-input class=\"period-selector\" .type=\"${InputType.BUTTON}\" disabled .label=\"${i18next.t(this.period?this.period:\"-\")}\"></or-mwc-input>\n                                `}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `):html`\n                <div class=\"panel panel-empty\">\n                    <div class=\"panel-content-wrapper\">\n                        <div class=\"panel-content\">\n                            ${this.shouldShowControls()?html`\n                                <or-mwc-input class=\"button\" .type=\"${InputType.BUTTON}\" label=\"selectAttribute\" icon=\"plus\" @or-mwc-input-changed=\"${()=>this._openDialog(\"editAttribute\")}\"></or-mwc-input>\n                            `:html`\n                                <span>${i18next.t(\"noAttributeConnected\")}</span>\n                            `}\n                        </div>\n                    </div>\n                </div>\n            `}_openDialog(t){let e;switch(t){case\"editDelta\":case\"editCurrentValue\":e=(new OrMwcDialog).setHeading(i18next.t(t)).setDismissAction(null).setContent(\"editDelta\"===t?html`\n                                <or-mwc-input id=\"delta-mode-picker\" value=\"${this.deltaFormat}\" @or-mwc-input-changed=\"${t=>{this.deltaFormat=t.detail.value,this.saveSettings()}}\" .type=\"${InputType.LIST}\" .options=\"${[[\"percentage\",\"Percentage\"],[\"absolute\",\"Absolute\"]]}\"></or-mwc-input>                \n                            `:html`\n                                <or-mwc-input id=\"current-value-decimals\" .label=\"${i18next.t(\"decimals\")}\" value=\"${this.mainValueDecimals}\" .type=\"${InputType.TEXT}\"></or-mwc-input>\n                            `).setActions([{actionName:\"cancel\",content:html`<or-mwc-input class=\"button\" .type=\"${InputType.BUTTON}\" label=\"cancel\"></or-mwc-input>`,action:()=>{}},{actionName:\"yes\",default:!0,content:html`<or-mwc-input class=\"button\" .type=\"${InputType.BUTTON}\" label=\"ok\" data-mdc-dialog-action=\"yes\"></or-mwc-input>`,action:()=>{if(\"editDelta\"===t)this.delta=this.data?this.getFormattedDelta(this.getFirstKnownMeasurement(this.data),this.getLastKnownMeasurement(this.data)):void 0;else if(e&&e.shadowRoot&&e.shadowRoot.getElementById(\"current-value-decimals\")){const t=e.shadowRoot.getElementById(\"current-value-decimals\"),i=parseInt(t.value,10);this.mainValueDecimals=i<0?0:i>10?10:i,this.formattedMainValue=this.getFormattedValue(this.mainValue),this.saveSettings()}}}]),e.addEventListener(OrAssetTreeSelectionEvent.NAME,(t=>__awaiter(this,void 0,void 0,(function*(){const e=t.detail&&t.detail.newNodes.length>0?t.detail.newNodes[0]:void 0;if(e){const t=yield manager.events.sendEventWithReply({event:{eventType:\"read-asset\",assetId:e.asset.id}});this.asset=t.asset}else this.asset=void 0}))));break;default:e=(new OrAttributePicker).setHeading(i18next.t(\"selectAttribute\")),e.addEventListener(OrAttributePickerPickedEvent.NAME,(t=>__awaiter(this,void 0,void 0,(function*(){const e=t.detail[0];try{const t=yield manager.rest.api.AssetResource.get(e.id);this.asset=t.data,this._setAttribute(e.name)}catch(t){console.error(\"Failed to get assets requested in settings\",t)}}))))}e&&showDialog(e)}_setAttribute(t){if(this.asset&&t){const e=this.asset.attributes?this.asset.attributes[t]:void 0;this.assets=[this.asset],this.assetAttributes=e?[[0,e]]:[],this.saveSettings()}}_cleanup(){this._chart&&(this._chart.destroy(),this._chart=void 0)}loadSettings(t=!1){return __awaiter(this,void 0,void 0,(function*(){this.assetAttributes=[],this.period&&!t||(this.period=\"day\"),this.deltaFormat&&!t||(this.deltaFormat=\"absolute\"),this.mainValueDecimals&&!t||(this.mainValueDecimals=0),this.realm||(this.realm=manager.getRealm());let e=(yield manager.console.retrieveData(\"OrChartConfig\"))||[];if(Array.isArray(e)||(e=[e]),0===e.length||!this.panelName)return;const i=window.location.hash;let a=e.find((t=>t.realm===this.realm));const s=a&&a.views&&a.views[i]?a.views[i][this.panelName]:void 0;if(!s)return;if(!s.attributeRefs){delete a.views[i][this.panelName];const t=[...e.filter((t=>t.realm!==this.realm)),a];return void manager.console.storeData(\"OrChartConfig\",t)}const r=s.attributeRefs.map((t=>t.id));if(0!==r.length&&(this._loading=!0,!r.every((t=>!!this.assets.find((e=>e.id===t)))))){const t={ids:r};try{const i=(yield manager.rest.api.AssetResource.queryAssets(t)).data||[];s.attributeRefs=s.attributeRefs.filter((t=>!!i.find((e=>e.id===t.id&&e.attributes&&e.attributes.hasOwnProperty(t.name))))),e=[...e.filter((t=>t.realm!==this.realm)),a],manager.console.storeData(\"OrChartConfig\",e),this.assets=i.filter((t=>s.attributeRefs.find((e=>e.id===t.id))))}catch(t){console.error(\"Failed to get assets requested in settings\",t)}this._loading=!1,this.assets&&this.assets.length>0&&(this.assetAttributes=s.attributeRefs.map((t=>{const e=this.assets.findIndex((e=>e.id===t.id)),i=e>=0?this.assets[e]:void 0;return i&&i.attributes?[e,i.attributes[t.name]]:void 0})).filter((t=>!!t)),this.period=s.period||\"day\",this.mainValueDecimals=s.decimals||0,this.deltaFormat=s.deltaFormat||\"absolute\")}}))}saveSettings(){return __awaiter(this,void 0,void 0,(function*(){if(!this.panelName)return;const t=window.location.hash;let e=(yield manager.console.retrieveData(\"OrChartConfig\"))||[],i=e.find((t=>t.realm===this.realm));i||(i={realm:this.realm,views:{}}),i.views[t]||(i.views[t]={}),this.assets&&this.assetAttributes&&0!==this.assets.length&&0!==this.assetAttributes.length?(i.realm=this.realm,i.views[t][this.panelName]={attributeRefs:this.assetAttributes.map((([t,e])=>{const i=this.assets[t];return i?{id:i.id,name:e.name}:void 0})).filter((t=>!!t)),period:this.period,deltaFormat:this.deltaFormat,decimals:this.mainValueDecimals}):delete i.views[t][this.panelName],e=[...e.filter((t=>t.realm!==this.realm)),i],manager.console.storeData(\"OrChartConfig\",e)}))}loadData(){return __awaiter(this,void 0,void 0,(function*(){if(this._loading||this.data||!this.assetAttributes||!this.assets||0===this.assets.length||0===this.assetAttributes.length||!this.period)return;this._loading=!0;let t=\"HOUR\",e=1;switch(this.period){case\"hour\":t=\"MINUTE\",e=5;break;case\"day\":t=\"HOUR\",e=1;break;case\"week\":t=\"HOUR\",e=6;break;case\"month\":t=\"DAY\",e=1;break;case\"year\":t=\"MONTH\",e=1}t.toLowerCase(),this._startOfPeriod=moment().subtract(1,this.period).toDate().getTime(),this._endOfPeriod=moment().toDate().getTime(),this.mainValue=void 0,this.formattedMainValue=void 0;const i=this.assets[0].id,a=this.assetAttributes[0][1].name,s=yield manager.events.sendEventWithReply({event:{eventType:\"read-asset-attribute\",ref:{id:i,name:a}}});this.mainValue=s.value,this.formattedMainValue=this.getFormattedValue(this.mainValue);const r=yield manager.rest.api.AssetDatapointResource.getDatapoints(i,a,{type:\"lttb\",fromTimestamp:this._startOfPeriod,toTimestamp:this._endOfPeriod,amountOfPoints:20});this._loading=!1,200===r.status&&(this.data=r.data,this.delta=this.getFormattedDelta(this.getFirstKnownMeasurement(this.data),this.getLastKnownMeasurement(this.data)),this.deltaPlus=this.delta&&this.delta.val>0?\"+\":\"\",this.error=!1)}))}getTotalValue(t){return t.reduce(((t,e)=>e.y?t+Math.round(e.y):t),0)}getHighestValue(t){return Math.max.apply(Math,t.map((t=>t.y||!1)))}getFormattedValue(t){if(void 0===t||!this.assets||!this.assetAttributes||0===this.assets.length||0===this.assetAttributes.length)return;const e=this.assetAttributes[0][1],i=+(null==t?void 0:t.toFixed(this.mainValueDecimals)),a=AssetModelUtil.getAttributeDescriptor(e.name,this.assets[0].type),s=Util.resolveUnits(Util.getAttributeUnits(e,a,this.assets[0].type));return this.setLabelSizeByLength(i.toString()),s?{value:i,unit:s}:{value:i,unit:\"\"}}getFirstKnownMeasurement(t){for(let e=0;e<=t.length;e++)if(t[e]&&void 0!==t[e].y)return t[e].y;return 0}getLastKnownMeasurement(t){for(let e=t.length-1;e>=0;e--)if(t[e]&&void 0!==t[e].y)return t[e].y;return 0}getFormattedDelta(t,e){return\"percentage\"===this.deltaFormat?t&&e?0===e&&0===t?{val:0,unit:\"%\"}:0===e&&0!==t?{val:100,unit:\"%\"}:{val:Math.round((e-t)/t*100),unit:\"%\"}:{val:0,unit:\"%\"}:{val:Math.round(e-t),unit:\"\"}}handleMenuSelect(t){\"delete\"===t?(this.assets=[],this.assetAttributes=[],this.saveSettings()):this._openDialog(t)}setLabelSizeByLength(t){t.length>=20&&(this.mainValueSize=\"xs\"),t.length<20&&(this.mainValueSize=\"s\"),t.length<15&&(this.mainValueSize=\"m\"),t.length<10&&(this.mainValueSize=\"l\"),t.length<5&&(this.mainValueSize=\"xl\")}setLabelSizeByWidth(t){this.mainValueSize=t<60?\"s\":t<100?\"m\":t<200?\"l\":\"xl\"}_setPeriodOption(t){this.period=t,this.saveSettings()}};__decorate([property()],OrAttributeCard.prototype,\"panelName\",void 0),__decorate([property({type:Object})],OrAttributeCard.prototype,\"assets\",void 0),__decorate([property({type:Object})],OrAttributeCard.prototype,\"assetAttributes\",void 0),__decorate([property()],OrAttributeCard.prototype,\"data\",void 0),__decorate([property({type:String})],OrAttributeCard.prototype,\"realm\",void 0),__decorate([property()],OrAttributeCard.prototype,\"mainValue\",void 0),__decorate([property()],OrAttributeCard.prototype,\"mainValueDecimals\",void 0),__decorate([property()],OrAttributeCard.prototype,\"mainValueSize\",void 0),__decorate([property()],OrAttributeCard.prototype,\"delta\",void 0),__decorate([property()],OrAttributeCard.prototype,\"deltaPlus\",void 0),__decorate([property()],OrAttributeCard.prototype,\"deltaFormat\",void 0),__decorate([property()],OrAttributeCard.prototype,\"showControls\",void 0),__decorate([property()],OrAttributeCard.prototype,\"showTitle\",void 0),__decorate([property()],OrAttributeCard.prototype,\"_loading\",void 0),__decorate([property()],OrAttributeCard.prototype,\"period\",void 0),__decorate([query(\"#chart\")],OrAttributeCard.prototype,\"_chartElem\",void 0),OrAttributeCard=__decorate([customElement(\"or-attribute-card\")],OrAttributeCard);export{OrAttributeCard};","var OrDataViewer_1,__decorate=this&&this.__decorate||function(e,t,r,i){var a,o=arguments.length,n=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(n=(o<3?a(n):o>3?a(t,r,n):a(t,r))||n);return o>3&&n&&Object.defineProperty(t,r,n),n};import{html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import\"@openremote/or-chart\";import\"@openremote/or-translate\";import{translate}from\"@openremote/or-translate\";import\"@openremote/or-components/or-panel\";import{OrChartEvent}from\"@openremote/or-chart\";import{style}from\"./style\";import i18next from\"i18next\";import{styleMap}from\"lit/directives/style-map.js\";import{classMap}from\"lit/directives/class-map.js\";import\"@openremote/or-attribute-card\";import manager from\"@openremote/core\";export class OrDataViewerRenderCompleteEvent extends CustomEvent{constructor(){super(OrDataViewerRenderCompleteEvent.NAME,{bubbles:!0,composed:!0})}}OrDataViewerRenderCompleteEvent.NAME=\"or-data-viewer-render-complete-event\";export class OrDataViewerConfigInvalidEvent extends CustomEvent{constructor(){super(OrDataViewerConfigInvalidEvent.NAME,{bubbles:!0,composed:!0})}}OrDataViewerConfigInvalidEvent.NAME=\"or-data-viewer-config-invalid-event\";let OrDataViewer=OrDataViewer_1=class extends(translate(i18next)(LitElement)){static get styles(){return[style]}static generateGrid(e){if(e){const t=e.querySelector(\"#container\");if(t){const r=parseInt(window.getComputedStyle(t).getPropertyValue(\"grid-auto-rows\"),10),i=parseInt(window.getComputedStyle(t).getPropertyValue(\"grid-row-gap\"),10),a=e.querySelectorAll(\".panel\");a&&a.forEach((e=>{const t=e.querySelector(\".panel-content-wrapper\");if(t){const a=Math.ceil((t.getBoundingClientRect().height+i)/(r+i));e.style.gridRowEnd=\"span \"+a}}))}}}constructor(){super(),this._loading=!1,this._resizeHandler=()=>{OrDataViewer_1.generateGrid(this.shadowRoot)},this.addEventListener(OrChartEvent.NAME,(()=>OrDataViewer_1.generateGrid(this.shadowRoot)))}connectedCallback(){super.connectedCallback(),window.addEventListener(\"resize\",this._resizeHandler)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener(\"resize\",this._resizeHandler)}refresh(){this.realm=manager.displayRealm}getPanel(e,t){const r=this.getPanelContent(e,t);return r?html`\n            <div class=${classMap({panel:!0,mobileHidden:!0===t.hideOnMobile})} id=\"${e}-panel\" style=\"${t&&t.panelStyles?styleMap(t.panelStyles):\"\"}\">\n                <div class=\"panel-content-wrapper\">\n                    ${t&&\"chart\"===t.type?html`\n                        <div class=\"panel-title\">\n                            <or-translate value=\"${e}\"></or-translate>\n                        </div>\n                    `:\"\"}\n                   \n                    <div class=\"panel-content\">\n                        ${r}\n                    </div>\n                </div>\n            </div>\n        `:html``}getPanelContent(e,t){if(t.hide||!this.config)return;let r;return this.realm=manager.displayRealm,t&&\"chart\"===t.type&&(r=html`<or-chart id=\"chart\" panelName=\"${e}\" .config=\"${this.config.chartConfig}\" .realm=\"${this.realm}\"></or-chart>`),t&&\"kpi\"===t.type&&(r=html`\n                <or-attribute-card panelName=\"${e}\" .config=\"${this.config.chartConfig}\" .realm=\"${this.realm}\"></or-attribute-card>\n            `),r}render(){return this._loading?html`\n                <div class=\"msg\"><or-translate value=\"loading\"></or-translate></div>\n            `:(this.config||(this.config=Object.assign({},OrDataViewer_1.DEFAULT_CONFIG)),html`\n            <div id=\"wrapper\">\n                <div id=\"container\" style=\"${this.config.viewerStyles?styleMap(this.config.viewerStyles):\"\"}\">\n                    ${this.renderConfig()}\n                </div>\n            </div>\n        `)}renderConfig(){let e=this.config?this.config:OrDataViewer_1.DEFAULT_CONFIG;try{return Object.entries(e.panels).map((([e,t])=>this.getPanel(e,t)))}catch(t){return console.warn(\"OR data viewer config is invalid\"),this.config=void 0,this.dispatchEvent(new OrDataViewerConfigInvalidEvent),e=OrDataViewer_1.DEFAULT_CONFIG,Object.entries(e.panels).map((([e,t])=>this.getPanel(e,t)))}}updated(e){super.updated(e),e.has(\"realm\")&&this.refresh(),this.updateComplete.then((()=>{this.dispatchEvent(new OrDataViewerRenderCompleteEvent),OrDataViewer_1.generateGrid(this.shadowRoot)}))}};OrDataViewer.DEFAULT_PANEL_TYPE=\"chart\",OrDataViewer.DEFAULT_CONFIG={viewerStyles:{},panels:{chart:{type:\"chart\",hideOnMobile:!0,panelStyles:{gridColumn:\"1 / -1\"}},kpi1:{type:\"kpi\",hideOnMobile:!1},kpi2:{type:\"kpi\",hideOnMobile:!1},kpi3:{type:\"kpi\",hideOnMobile:!1},kpi4:{type:\"kpi\",hideOnMobile:!1},kpi5:{type:\"kpi\",hideOnMobile:!1},kpi6:{type:\"kpi\",hideOnMobile:!1},kpi7:{type:\"kpi\",hideOnMobile:!1},kpi8:{type:\"kpi\",hideOnMobile:!1},chart2:{type:\"chart\",hideOnMobile:!0,panelStyles:{gridColumn:\"1 / -1\"}},chart3:{type:\"chart\",hideOnMobile:!0,panelStyles:{gridColumn:\"1 / -1\"}}}},__decorate([property()],OrDataViewer.prototype,\"config\",void 0),__decorate([property({type:Array,attribute:!1})],OrDataViewer.prototype,\"_assets\",void 0),__decorate([property()],OrDataViewer.prototype,\"_loading\",void 0),__decorate([property()],OrDataViewer.prototype,\"realm\",void 0),OrDataViewer=OrDataViewer_1=__decorate([customElement(\"or-data-viewer\")],OrDataViewer);export{OrDataViewer};","import{css,unsafeCSS}from\"lit\";import{DefaultColor1,DefaultColor2,DefaultColor4,DefaultColor5}from\"@openremote/core\";export const style=css`\n\n    :host {       \n        --internal-or-asset-tree-header-color: var(--or-asset-tree-header-color, var(--or-app-color4, ${unsafeCSS(DefaultColor4)}));     \n        --internal-or-asset-tree-header-text-color: var(--or-asset-tree-header-text-color, var(--or-app-color7, ${unsafeCSS(DefaultColor1)}));\n        --internal-or-asset-tree-header-menu-background-color: var(--or-asset-tree-header-menu-background-color, var(--internal-or-asset-tree-header-text-color));\n        --internal-or-asset-tree-header-menu-text-color: var(--or-asset-tree-header-menu-text-color, inherit);\n        --internal-or-asset-tree-header-height: var(--or-asset-tree-header-height, 48px);\n        --internal-or-asset-tree-background-color: var(--or-asset-tree-background-color, var(--or-app-color1, ${unsafeCSS(DefaultColor1)}));\n        --internal-or-asset-tree-text-color: var(--or-asset-tree-text-color, inherit);\n        --internal-or-asset-tree-item-height: var(--or-asset-tree-item-height, 24px);\n        --internal-or-asset-tree-item-padding: var(--or-asset-tree-item-padding, 10px);\n        --internal-or-asset-tree-selected-background-color: var(--or-asset-tree-selected-background-color, var(--or-app-color2, ${unsafeCSS(DefaultColor2)}));\n        --internal-or-asset-tree-selected-color: var(--or-asset-tree-selected-color, var(--or-app-color4, ${unsafeCSS(DefaultColor4)}));\n        --internal-or-asset-tree-button-color: var(--or-asset-tree-button-color, var(--or-app-color4, ${unsafeCSS(DefaultColor4)}));\n        --internal-or-asset-tree-line-color: var(--or-asset-tree-line-color, var(--or-app-color5, ${unsafeCSS(DefaultColor5)}));\n            \n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        width: 100%;\n        background-color: var(--internal-or-asset-tree-background-color);\n    }\n\n    @media only screen and (max-width: 640px){\n        .hideMobile {\n            display: none !important;\n        }\n    }\n    @media only screen and (min-width: 641px){\n        .showMobile {\n            display: none !important;\n        }\n    }\n    \n    #container {\n        display: flex;\n        width: 100%;\n        height: 100%;\n    }\n        \n    #menu-header {\n        background-color: var(--internal-or-asset-tree-header-color);\n        display: flex;\n        align-items: center;\n        width: 100%;\n        height: var(--internal-or-asset-tree-header-height);\n        border-bottom: 1px solid var(--or-app-color5, ${unsafeCSS(DefaultColor5)});\n        z-index: 3;\n        line-height: var(--internal-or-asset-tree-header-height);\n        color: var(--internal-or-asset-tree-header-text-color);\n        --or-icon-fill: var(--internal-or-asset-tree-header-text-color);\n    }\n\n    #title-container {\n        flex: 1;\n        flex-direction: row;\n        text-transform: capitalize;\n        padding-left: 14px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n    }\n    \n    #title {\n        font-weight: 500;\n        font-size: 16px;\n    }\n\n    .expandableHeader {\n        display: flex;\n        align-items: center;\n        padding: 12px;\n        background: none;\n        border-top: 1px solid var(--or-app-color5, ${unsafeCSS(DefaultColor5)});\n        border-right: none;\n        border-bottom: none;\n        border-left: none;\n        border-radius: 0;\n        width: 100%;\n        cursor: pointer;\n        font-weight: 700;\n        line-height: 1em;\n        color: var(--internal-or-asset-viewer-title-text-color);\n        flex: 0 0 auto;\n    }\n    .expandableHeader > or-icon {\n        --or-icon-height: 20px;\n        --or-icon-width: 20px;\n    }\n    .panel-title {\n        text-transform: uppercase;\n        font-weight: bolder;\n        line-height: 1em;\n        color: var(--internal-or-asset-viewer-title-text-color);\n        /*margin-bottom: 20px;*/\n        flex: 0 0 auto;\n    }\n`;","var __awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(r,n){function s(e){try{d(i.next(e))}catch(e){n(e)}}function o(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}d((i=i.apply(e,t||[])).next())}))};import manager from\"@openremote/core\";import{i18next}from\"@openremote/or-translate\";export var DashboardSizeOption;!function(e){e[e.DESKTOP=0]=\"DESKTOP\",e[e.MOBILE=1]=\"MOBILE\"}(DashboardSizeOption||(DashboardSizeOption={}));export class DashboardService{static create(e,t=DashboardSizeOption.DESKTOP,a=manager.displayRealm,i=!0){var r;return __awaiter(this,void 0,void 0,(function*(){const n=()=>(Math.random()+1).toString(36).substring(2);return e?(e.id=n(),e.template&&(e.template.id=n(),null===(r=e.template.widgets)||void 0===r||r.forEach((e=>e.id=n())))):e={realm:a,displayName:this.getDefaultDisplayName(t),template:{id:n(),columns:this.getDefaultColumns(t),maxScreenWidth:this.getDefaultMaxScreenWidth(t),refreshInterval:\"OFF\",screenPresets:this.getDefaultScreenPresets(t)}},i?(yield manager.rest.api.DashboardResource.create(e)).data:e}))}static delete(e,t=manager.displayRealm){return __awaiter(this,void 0,void 0,(function*(){return(yield manager.rest.api.DashboardResource.delete(t,e)).data}))}static getDefaultColumns(e){switch(e){case DashboardSizeOption.MOBILE:return 4;case DashboardSizeOption.DESKTOP:default:return 12}}static getDefaultDisplayName(e){switch(e){case DashboardSizeOption.DESKTOP:return i18next.t(\"dashboard.initialName\");case DashboardSizeOption.MOBILE:return i18next.t(\"dashboard.initialName\")+\" (\"+i18next.t(\"dashboard.size.mobile\")+\")\"}}static getDefaultScreenPresets(e){return e===DashboardSizeOption.MOBILE?[{id:\"mobile\",displayName:\"dashboard.size.mobile\",breakpoint:640,scalingPreset:\"KEEP_LAYOUT\"}]:[{id:\"mobile\",displayName:\"dashboard.size.mobile\",breakpoint:640,scalingPreset:\"WRAP_TO_SINGLE_COLUMN\"}]}static getDefaultMaxScreenWidth(e){switch(e){case DashboardSizeOption.DESKTOP:return 4e3;case DashboardSizeOption.MOBILE:return 640}}}","var __decorate=this&&this.__decorate||function(e,t,r,o){var a,s=arguments.length,d=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)d=Reflect.decorate(e,t,r,o);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(d=(s<3?a(d):s>3?a(t,r,d):a(t,r))||d);return s>3&&d&&Object.defineProperty(t,r,d),d},__awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,s){function d(e){try{n(o.next(e))}catch(e){s(e)}}function i(e){try{n(o.throw(e))}catch(e){s(e)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(d,i)}n((o=o.apply(e,t||[])).next())}))};import{css,html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import\"@openremote/or-icon\";import{style}from\"./style\";import manager from\"@openremote/core\";import\"@openremote/or-mwc-components/or-mwc-menu\";import{showOkCancelDialog}from\"@openremote/or-mwc-components/or-mwc-dialog\";import{i18next}from\"@openremote/or-translate\";import{showSnackbar}from\"@openremote/or-mwc-components/or-mwc-snackbar\";import{style as OrAssetTreeStyle}from\"@openremote/or-asset-tree\";import{DashboardService,DashboardSizeOption}from\"./service/dashboard-service\";import{isAxiosError}from\"@openremote/rest\";const treeStyling=css`\n    #header-btns {\n        display: flex;\n        flex-direction: row;\n        padding-right: 5px;\n    }\n\n    .node-container {\n        align-items: center;\n        padding-left: 10px;\n    }\n`;let OrDashboardTree=class extends LitElement{constructor(){super(...arguments),this.realm=manager.displayRealm,this.readonly=!0,this.hasChanged=!1,this.showControls=!0}static get styles(){return[style,treeStyling,OrAssetTreeStyle]}shouldUpdate(e){return(1!==e.size||!e.has(\"hasChanged\")||!this.hasChanged)&&super.shouldUpdate(e)}updated(e){this.dashboards||this.getAllDashboards(),e.has(\"dashboards\")&&null!=e.get(\"dashboards\")&&this.dispatchEvent(new CustomEvent(\"updated\",{detail:this.dashboards})),e.has(\"selected\")&&this.dispatchEvent(new CustomEvent(\"select\",{detail:this.selected}))}getAllDashboards(){return __awaiter(this,void 0,void 0,(function*(){return manager.rest.api.DashboardResource.getAllRealmDashboards(this.realm).then((e=>{this.dashboards=e.data})).catch((e=>{console.error(e),showSnackbar(void 0,\"errorOccurred\")}))}))}selectDashboard(e){var t;this.selected=\"string\"==typeof e?null===(t=this.dashboards)||void 0===t?void 0:t.find((t=>t.id===e)):e}createDashboard(e){DashboardService.create(void 0,e,this.realm).then((e=>{this.dashboards?(this.dashboards.push(e),this.requestUpdate(\"dashboards\")):this.dashboards=[e],this.dispatchEvent(new CustomEvent(\"created\",{detail:{d:e}})),this.selectDashboard(e)})).catch((e=>{var t;console.error(e),isAxiosError(e)&&404===(null===(t=e.response)||void 0===t?void 0:t.status)?showSnackbar(void 0,\"noDashboardFound\"):showSnackbar(void 0,\"errorOccurred\")}))}duplicateDashboard(e){null!==(null==e?void 0:e.id)?this.hasChanged?this.showDiscardChangesModal().then((t=>{t&&this._doDuplicateDashboard(e)})):this._doDuplicateDashboard(e):console.warn(\"Tried duplicating a NULL dashboard!\")}_doDuplicateDashboard(e){const t=JSON.parse(JSON.stringify(e));t.displayName=t.displayName+\" copy\",DashboardService.create(t,void 0,this.realm).then((e=>{this.dashboards?(this.dashboards.push(e),this.requestUpdate(\"dashboards\")):this.dashboards=[e],this.dispatchEvent(new CustomEvent(\"created\",{detail:{d:e}})),this.selectDashboard(e.id)})).catch((e=>{var t;console.error(e),isAxiosError(e)&&404===(null===(t=e.response)||void 0===t?void 0:t.status)?showSnackbar(void 0,\"noDashboardFound\"):showSnackbar(void 0,\"errorOccurred\")}))}deleteDashboard(e){null!=e.id&&DashboardService.delete(e.id,this.realm).then((()=>{this.getAllDashboards()})).catch((e=>{console.error(e),showSnackbar(void 0,\"errorOccurred\")}))}onDashboardClick(e){var t;e!==(null===(t=this.selected)||void 0===t?void 0:t.id)&&(this.hasChanged?this.showDiscardChangesModal().then((t=>{t&&this.selectDashboard(e)})):this.selectDashboard(e))}showDiscardChangesModal(){return showOkCancelDialog(i18next.t(\"areYouSure\"),i18next.t(\"confirmContinueDashboardModified\"),i18next.t(\"discard\"))}render(){var e;const t=[];if(this.dashboards&&this.dashboards.length>0&&this.userId){const r=[],o=[];if(null===(e=this.dashboards)||void 0===e||e.forEach((e=>{e.ownerId===this.userId?r.push(e):o.push(e)})),r.length>0){const e=[];r.sort(((e,t)=>e.displayName?e.displayName.localeCompare(t.displayName):0)).forEach((t=>{e.push({icon:\"view-dashboard\",text:t.displayName,value:t.id})})),t.push(e)}if(o.length>0){const e=[];o.sort(((e,t)=>e.displayName?e.displayName.localeCompare(t.displayName):0)).forEach((t=>{e.push({icon:\"view-dashboard\",text:t.displayName,value:t.id})})),t.push(e)}}return html`\n            <div id=\"menu-header\">\n                <div id=\"title-container\">\n                    <span id=\"title\"><or-translate value=\"insights\"></or-translate></span>\n                </div>\n                \n                <!-- Controls header -->\n                ${this.showControls?html`\n                    <div id=\"header-btns\">\n                        ${null!=this.selected?html`\n                            <or-mwc-input type=\"${InputType.BUTTON}\" icon=\"close\" @or-mwc-input-changed=\"${()=>{this.selectDashboard(void 0)}}\"></or-mwc-input>\n                            ${this.readonly?void 0:html`\n                                <or-mwc-input type=\"${InputType.BUTTON}\" class=\"hideMobile\" icon=\"content-copy\"\n                                              @or-mwc-input-changed=\"${()=>{this.duplicateDashboard(this.selected)}}\"\n                                ></or-mwc-input>\n                                <or-mwc-input type=\"${InputType.BUTTON}\" icon=\"delete\" @or-mwc-input-changed=\"${()=>{null!=this.selected&&showOkCancelDialog(i18next.t(\"areYouSure\"),i18next.t(\"dashboard.deletePermanentWarning\",{dashboard:this.selected.displayName}),i18next.t(\"delete\")).then((e=>{e&&this.deleteDashboard(this.selected)}))}}\"></or-mwc-input>\n                            `}\n                        `:void 0}\n                        ${this.readonly?void 0:html`\n                            <or-mwc-input type=\"${InputType.BUTTON}\" class=\"hideMobile\" icon=\"plus\"\n                                          @or-mwc-input-changed=\"${()=>{this.createDashboard(DashboardSizeOption.DESKTOP)}}\"\n                            ></or-mwc-input>\n                        `}\n                    </div>\n                `:void 0}\n            </div>\n            \n            <!-- List of dashboards -->\n            <div id=\"content\">\n                <div style=\"padding-top: 8px;\">\n                    ${t.map(((e,t)=>null!=e&&e.length>0?html`\n                            <div style=\"padding: 8px 0;\">\n                                <span style=\"font-weight: 500; padding-left: 14px; color: #000000;\">\n                                    <or-translate value=\"${0===t?\"dashboard.myDashboards\":\"dashboard.createdByOthers\"}\"></or-translate>\n                                 </span>\n                                <div id=\"list-container\" style=\"overflow: hidden;\">\n                                    <ol id=\"list\">\n                                        ${e.map((e=>{var t;return html`\n                                                <li ?data-selected=\"${e.value===(null===(t=this.selected)||void 0===t?void 0:t.id)}\" @click=\"${t=>{this.onDashboardClick(e.value)}}\">\n                                                    <div class=\"node-container\">\n                                                        <span class=\"node-name\">${e.text} </span>\n                                                    </div>\n                                                </li>\n                                            `}))}\n                                    </ol>\n                                </div>\n                            </div>\n                        `:void 0))}\n                </div>\n            </div>\n        `}};__decorate([property()],OrDashboardTree.prototype,\"dashboards\",void 0),__decorate([property()],OrDashboardTree.prototype,\"selected\",void 0),__decorate([property()],OrDashboardTree.prototype,\"realm\",void 0),__decorate([property()],OrDashboardTree.prototype,\"userId\",void 0),__decorate([property()],OrDashboardTree.prototype,\"readonly\",void 0),__decorate([property()],OrDashboardTree.prototype,\"hasChanged\",void 0),__decorate([property()],OrDashboardTree.prototype,\"showControls\",void 0),OrDashboardTree=__decorate([customElement(\"or-dashboard-tree\")],OrDashboardTree);export{OrDashboardTree};","var __decorate=this&&this.__decorate||function(e,r,t,i){var d,s=arguments.length,o=s<3?r:null===i?i=Object.getOwnPropertyDescriptor(r,t):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(e,r,t,i);else for(var a=e.length-1;a>=0;a--)(d=e[a])&&(o=(s<3?d(o):s>3?d(r,t,o):d(r,t))||o);return s>3&&o&&Object.defineProperty(r,t,o),o};import{GridStack}from\"gridstack\";import{css,html,LitElement,unsafeCSS}from\"lit\";import{customElement,state}from\"lit/decorators.js\";import{style}from\"./style\";import{widgetTypes}from\"./index\";const gridcss=require(\"gridstack/dist/gridstack.min.css\"),extracss=require(\"gridstack/dist/gridstack-extra.css\"),browserStyling=css`\n    #sidebar {\n        display: grid;\n        padding: 16px;\n    }\n    #sidebarElement, #sidebarBgElement {\n        grid-column: 1;\n        grid-row: 1;\n    }\n    .grid-stack-item {\n        cursor: grab;\n    }\n    .sidebarItem {\n        height: 100%;\n        background: white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        overflow: hidden;\n        border: 1px solid #E0E0E0;\n        border-radius: 8px;\n        box-sizing: border-box;\n        flex-direction: column;\n        font-size: 14px;\n        --or-icon-width: 36px;\n    }\n    .itemText {\n        margin-top: 10px;\n    }\n`;let OrDashboardBrowser=class extends LitElement{static get styles(){return[unsafeCSS(gridcss),unsafeCSS(extracss),browserStyling,style]}constructor(){super(),this.updateComplete.then((()=>{this.renderGrid()}))}renderGrid(){var e,r;const t=null===(e=this.shadowRoot)||void 0===e?void 0:e.getElementById(\"sidebarElement\"),i=new Array([0,0],[2,0],[0,2],[2,2],[0,4],[2,4],[0,6],[2,6],[0,8],[2,8]),d=Array.from(widgetTypes).sort(((e,r)=>e[1].displayName.localeCompare(r[1].displayName))).map(((e,r)=>({x:i[r][0],y:i[r][1],w:2,h:2,widgetTypeId:e[0],locked:!0,content:`<div class=\"sidebarItem\"><or-icon icon=\"${e[1].displayIcon}\"></or-icon><span class=\"itemText\">${e[1].displayName}</span>`})));let s=0;d.forEach((e=>{e.y+e.h>s&&(s=e.y+e.h)}));let o=0;o=d.length%2!=0?d.length+1:d.length,void 0!==this.sidebarGrid?(this.sidebarGrid.removeAll(),this.sidebarGrid.load(d)):(this.sidebarGrid=GridStack.init({acceptWidgets:!1,column:4,cellHeight:67,disableOneColumnMode:!0,disableResize:!0,draggable:{appendTo:\"parent\"},margin:8,row:o},t),this.sidebarGrid.load(d),this.sidebarGrid.on(\"removed\",((e,r)=>{var t;if(1===r.length){const e=d.filter((e=>e.content===r[0].content));null===(t=this.sidebarGrid)||void 0===t||t.load([e[0]])}})),this.sidebarGrid.on(\"change\",((e,r)=>{this.renderGrid()})));const a=null===(r=this.shadowRoot)||void 0===r?void 0:r.getElementById(\"sidebarBgElement\");null!=this.backgroundGrid?(this.backgroundGrid.removeAll(),this.backgroundGrid.load(d)):(this.backgroundGrid=GridStack.init({staticGrid:!0,column:4,cellHeight:67,disableOneColumnMode:!0,margin:8},a),this.backgroundGrid.load(d))}render(){return html`\n            <div id=\"sidebar\">\n                <div id=\"sidebarElement\" class=\"grid-stack\" style=\"width: 100%; z-index: 3;\"></div>\n                <div id=\"sidebarBgElement\" class=\"grid-stack\" style=\"width: 100%; z-index: 2\"></div>\n            </div>\n        `}};__decorate([state()],OrDashboardBrowser.prototype,\"sidebarGrid\",void 0),__decorate([state()],OrDashboardBrowser.prototype,\"backgroundGrid\",void 0),OrDashboardBrowser=__decorate([customElement(\"or-dashboard-browser\")],OrDashboardBrowser);export{OrDashboardBrowser};","var __decorate=this&&this.__decorate||function(e,t,i,r){var o,d=arguments.length,s=d<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(s=(d<3?o(s):d>3?o(t,i,s):o(t,i))||s);return d>3&&s&&Object.defineProperty(t,i,s),s};import{html,LitElement}from\"lit\";import{customElement,property,query,state}from\"lit/decorators.js\";import{when}from\"lit/directives/when.js\";import{throttle}from\"lodash\";import{style}from\"./style\";import{WidgetService}from\"./service/widget-service\";const elemTagName=\"or-dashboard-widget-container\";let OrDashboardWidgetContainer=class extends LitElement{constructor(){super(...arguments),this.loading=!1}static get styles(){return[style]}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this.resizeObserver)||void 0===e||e.disconnect()}shouldUpdate(e){var t,i,r;const o=e;if(this.widget){const e=WidgetService.getManifest(this.widget.widgetTypeId);e&&(this.widget.widgetConfig=WidgetService.correctToConfigSpec(e,this.widget.widgetConfig))}if(e.has(\"widget\")&&this.widget){const d=e.get(\"widget\"),s=(null==d?void 0:d.id)!==(null===(t=this.widget)||void 0===t?void 0:t.id),n=(null==d?void 0:d.displayName)!==(null===(i=this.widget)||void 0===i?void 0:i.displayName),a=JSON.stringify(null==d?void 0:d.widgetConfig)!==JSON.stringify(null===(r=this.widget)||void 0===r?void 0:r.widgetConfig);s||n||a||o.delete(\"widget\")}return 0!==o.size&&super.shouldUpdate(e)}willUpdate(e){super.willUpdate(e),!this.manifest&&this.widget&&(this.manifest=WidgetService.getManifest(this.widget.widgetTypeId)),e.has(\"widget\")&&this.widget&&this.initializeWidgetElem(this.manifest,this.widget.widgetConfig)}firstUpdated(e){var t;if(super.firstUpdated(e),this.orWidget){const e=this.containerElem;e?(null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.resizeObserver=new ResizeObserver(throttle((()=>{const t=this.manifest.minPixelWidth||0,i=this.manifest.minPixelHeight||0,r=t<e.clientWidth&&i<e.clientHeight;this.error=r?void 0:\"dashboard.widgetTooSmall\"}),200)),this.resizeObserver.observe(e)):console.error(\"gridItemElement could not be found!\")}}initializeWidgetElem(e,t){console.debug(`Initialising ${e.displayName} widget..`),this.orWidget&&this.orWidget.remove(),this.orWidget=e.getContentHtml(t),this.orWidget.getDisplayName=()=>this.widget.displayName,this.orWidget.getEditMode=()=>this.editMode,this.orWidget.getWidgetLocation=()=>{var e,t,i,r;return{x:null===(e=this.widget.gridItem)||void 0===e?void 0:e.x,y:null===(t=this.widget.gridItem)||void 0===t?void 0:t.y,w:null===(i=this.widget.gridItem)||void 0===i?void 0:i.w,h:null===(r=this.widget.gridItem)||void 0===r?void 0:r.h}}}render(){const e=!!this.widget.displayName;return html`\n            <div id=\"widget-container\" style=\"height: calc(100% - 16px); padding: 8px 16px 8px 16px; display: flex; flex-direction: column;\">\n\n                <!-- Container title -->\n                ${when(e,(()=>{var e;return html`\n                    <div style=\"flex: 0 0 36px; display: flex; justify-content: space-between; align-items: center;\">\n                        <span class=\"panel-title\" style=\"width: 100%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">\n                            ${null===(e=this.widget.displayName)||void 0===e?void 0:e.toUpperCase()}\n                        </span>\n                    </div>\n                `}))}\n\n                <!-- Content -->\n                <div style=\"flex: 1; max-height: ${e?\"calc(100% - 36px)\":\"100%\"};\">\n                    ${when(!this.error&&!this.loading,(()=>html`\n                        ${this.orWidget}\n                    `),(()=>html`<or-translate value=\"${this.error?this.error:\"loading\"}\"></or-translate>`))}\n                </div>\n            </div>\n        `}refreshContent(e){var t;null===(t=this.orWidget)||void 0===t||t.refreshContent(e)}};OrDashboardWidgetContainer.tagName=elemTagName,__decorate([property()],OrDashboardWidgetContainer.prototype,\"widget\",void 0),__decorate([property()],OrDashboardWidgetContainer.prototype,\"editMode\",void 0),__decorate([property()],OrDashboardWidgetContainer.prototype,\"loading\",void 0),__decorate([state()],OrDashboardWidgetContainer.prototype,\"orWidget\",void 0),__decorate([state()],OrDashboardWidgetContainer.prototype,\"error\",void 0),__decorate([query(\"#widget-container\")],OrDashboardWidgetContainer.prototype,\"containerElem\",void 0),OrDashboardWidgetContainer=__decorate([customElement(elemTagName)],OrDashboardWidgetContainer);export{OrDashboardWidgetContainer};","var __decorate=this&&this.__decorate||function(e,i,t,r){var s,d=arguments.length,o=d<3?i:null===r?r=Object.getOwnPropertyDescriptor(i,t):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(e,i,t,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(d<3?s(o):d>3?s(i,t,o):s(i,t))||o);return d>3&&o&&Object.defineProperty(i,t,o),o},__awaiter=this&&this.__awaiter||function(e,i,t,r){return new(t||(t=Promise))((function(s,d){function o(e){try{n(r.next(e))}catch(e){d(e)}}function a(e){try{n(r.throw(e))}catch(e){d(e)}}function n(e){var i;e.done?s(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(o,a)}n((r=r.apply(e,i||[])).next())}))};import manager,{DefaultColor4,DefaultColor5}from\"@openremote/core\";import{css,html,LitElement,unsafeCSS}from\"lit\";import{customElement,property,state}from\"lit/decorators.js\";import{style}from\"./style\";import\"./or-dashboard-widgetcontainer\";import{debounce}from\"lodash\";import{getActivePreset}from\"./index\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import\"@openremote/or-components/or-loading-indicator\";import{repeat}from\"lit/directives/repeat.js\";import{GridStack}from\"gridstack\";import{showSnackbar}from\"@openremote/or-mwc-components/or-mwc-snackbar\";import{i18next}from\"@openremote/or-translate\";import{when}from\"lit/directives/when.js\";import{cache}from\"lit/directives/cache.js\";import{guard}from\"lit/directives/guard.js\";import{OrDashboardEngine}from\"./or-dashboard-engine\";import{WidgetService}from\"./service/widget-service\";import{OrDashboardWidgetContainer}from\"./or-dashboard-widgetcontainer\";const gridcss=require(\"gridstack/dist/gridstack.min.css\"),extracss=require(\"gridstack/dist/gridstack-extra.css\"),editorStyling=css`\n    \n    #loadingContainer {\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n    \n    #view-options {\n        padding: 24px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n    /* Margins on view options */\n    #fit-btn { margin-right: 10px; }\n    #view-preset-select { margin-left: 20px; }\n    #width-input { margin-left: 20px; }\n    #height-input { margin-left: 10px; }\n    #rotate-btn { margin-left: 10px; }\n    \n    .maingridContainer {\n        position: absolute;\n        padding-bottom: 32px;\n    }\n    .maingridContainer__fullscreen {\n        width: 100%;\n    }\n    \n    .maingrid {\n        border: 3px solid #909090;\n        background: #FFFFFF;\n        border-radius: 8px;\n        overflow-x: hidden;\n        overflow-y: scroll;\n        padding: 4px;\n        z-index: 0;\n    }\n    .maingrid__fullscreen {\n        border: none;\n        background: transparent;\n        border-radius: 0;\n        overflow-x: hidden;\n        overflow-y: scroll;\n        height: 100% !important; /* To override .maingrid */\n        width: 100% !important; /* To override .maingrid */\n        padding: 0;\n        /*pointer-events: none;*/\n        position: relative;\n        z-index: 0;\n    }\n    .maingrid__disabled {\n        pointer-events: none;\n        opacity: 40%;\n    }\n    .grid-stack-item-content {\n        background: white;\n        box-sizing: border-box;\n        border: 1px solid var(--or-app-color5, ${unsafeCSS(DefaultColor5)});\n        border-radius: 4px;\n    }\n    .grid-stack > .grid-stack-item > .grid-stack-item-content {\n        overflow: visible;\n    }\n    .grid-stack-item-content__active {\n        border: 2px solid var(--or-app-color4, ${unsafeCSS(DefaultColor4)});\n        margin: -1px !important; /* to compromise with the extra pixel of border. */\n    }\n    \n    /* Grid lines on the background of the grid */\n    .grid-element {\n        background-image:\n                linear-gradient(90deg, #E0E0E0, transparent 1px),\n                linear-gradient(90deg, transparent calc(100% - 1px), #E0E0E0),\n                linear-gradient(#E0E0E0, transparent 1px),\n                linear-gradient(transparent calc(100% - 1px), #E0E0E0 100%);\n    }\n`;let OrDashboardPreview=class extends LitElement{set template(e){const i=this._template;if(null!=i){const t={changedKeys:Object.keys(e).filter((t=>JSON.stringify(e[t])!==JSON.stringify(i[t]))),oldValue:i,newValue:e};this._template=JSON.parse(JSON.stringify(e)),this.latestChanges=t,this.requestUpdate(\"template\",i)}else null!=e&&(this._template=e,this.setupGrid(!1,!1))}get template(){return this._template}constructor(){super(),this.editMode=!1,this.readonly=!0,this.previewZoom=1,this.fullscreen=!0,this.rerenderActive=!1,this.isLoading=!1,this.cachedGridstackCSS=new Map,this.resizeObserverCallback=e=>{var i;(null===(i=this.previousObserverEntry)||void 0===i?void 0:i.contentRect.width)+\"px\"!=e[0].contentRect.width+\"px\"&&this._onGridResize(),this.previousObserverEntry=e[0]},this.realm||(this.realm=manager.displayRealm),this.availablePreviewSizes||(this.availablePreviewSizes=[{displayName:\"4k Television\",width:3840,height:2160},{displayName:\"Desktop\",width:1920,height:1080},{displayName:\"Small desktop\",width:1280,height:720},{displayName:\"Phone\",width:360,height:800},{displayName:\"Custom\"}]),this.previewSize||(this.previewSize=this.availablePreviewSizes[3]),GridStack.registerEngine(OrDashboardEngine)}static get styles(){return[unsafeCSS(gridcss),unsafeCSS(extracss),editorStyling,style]}shouldUpdate(e){var i,t,r;const s=e;return e.has(\"latestChanges\")&&0==(null===(i=this.latestChanges)||void 0===i?void 0:i.changedKeys.length)&&JSON.stringify(null===(t=e.get(\"latestChanges\"))||void 0===t?void 0:t.oldValue)==JSON.stringify(null===(r=e.get(\"latestChanges\"))||void 0===r?void 0:r.newValue)&&s.delete(\"latestChanges\"),this.fullscreen&&e.has(\"previewWidth\")&&s.delete(\"previewWidth\"),this.fullscreen&&e.has(\"previewHeight\")&&s.delete(\"previewHeight\"),0!==s.size&&super.shouldUpdate(e)}updated(e){var i,t,r,s,d,o;if(super.updated(e),null==this.realm&&(this.realm=manager.displayRealm),!this.template&&this.dashboardId?manager.rest.api.DashboardResource.get(this.realm,this.dashboardId).then((e=>{this.template=e.data.template})).catch((e=>{console.error(e),showSnackbar(void 0,\"errorOccurred\")})):null==this.template&&null==this.dashboardId&&console.warn(\"Neither the template nor dashboardId attributes have been specified!\"),e.has(\"latestChanges\")&&this.latestChanges&&(this.processTemplateChanges(this.latestChanges),this.latestChanges=void 0),e.has(\"selectedWidget\"))if(this.selectedWidget){if(null!=e.get(\"selectedWidget\")&&this.dispatchEvent(new CustomEvent(\"deselected\",{detail:e.get(\"selectedWidget\")})),null!=(null===(i=this.grid)||void 0===i?void 0:i.el)){const e=null===(t=this.grid)||void 0===t?void 0:t.getGridItems().find((e=>{var i,t,r;return(null===(i=e.gridstackNode)||void 0===i?void 0:i.id)==(null===(r=null===(t=this.selectedWidget)||void 0===t?void 0:t.gridItem)||void 0===r?void 0:r.id)}));null!=e&&this.selectGridItem(e),this.dispatchEvent(new CustomEvent(\"selected\",{detail:this.selectedWidget}))}}else null!=(null===(r=this.grid)||void 0===r?void 0:r.el)&&null!=(null===(s=this.grid)||void 0===s?void 0:s.getGridItems())&&this.deselectGridItems(this.grid.getGridItems()),this.dispatchEvent(new CustomEvent(\"deselected\",{detail:e.get(\"selectedWidget\")}));e.has(\"editMode\")&&null!=e.get(\"editMode\")&&this.setupGrid(!0,!0),(e.has(\"previewWidth\")||e.has(\"previewHeight\"))&&(null===(d=this.template)||void 0===d?void 0:d.screenPresets)&&(this.previewSize=null===(o=this.availablePreviewSizes)||void 0===o?void 0:o.find((e=>e.width+\"px\"==this.previewWidth&&e.height+\"px\"==this.previewHeight))),e.has(\"previewSize\")&&this.previewSize&&(this.previewWidth=this.previewSize.width+\"px\",this.previewHeight=this.previewSize.height+\"px\"),e.has(\"rerenderActive\")&&this.rerenderActive&&(this.rerenderActive=!1)}setupGrid(e,i=!1){var t,r,s,d,o,a,n,l,h,c,p,v;return __awaiter(this,void 0,void 0,(function*(){this.isLoading=!0,yield this.updateComplete;let g=null===(t=this.shadowRoot)||void 0===t?void 0:t.getElementById(\"gridElement\");if(null!=g){e&&null!=this.grid&&(this.grid.destroy(!1),i&&(this.rerenderActive=!0,yield this.updateComplete,yield this.waitUntil((e=>!this.rerenderActive)),g=null===(r=this.shadowRoot)||void 0===r?void 0:r.getElementById(\"gridElement\"),this.grid=void 0));const t=this.fullscreen?this.clientWidth:+(null===(s=this.previewWidth)||void 0===s?void 0:s.replace(/\\D/g,\"\")),m=getActivePreset(t,this.template.screenPresets);if((null==m?void 0:m.scalingPreset)!=(null===(d=this.activePreset)||void 0===d?void 0:d.scalingPreset)&&(e&&i||(e||null===(o=this.grid)||void 0===o||o.destroy(!1),this.rerenderActive=!0,yield this.updateComplete,yield this.waitUntil((e=>!this.rerenderActive)),g=null===(a=this.shadowRoot)||void 0===a?void 0:a.getElementById(\"gridElement\"),this.grid=void 0)),this.activePreset=m,null==this.grid){const e=null===(n=this.shadowRoot)||void 0===n?void 0:n.querySelector(\".maingrid\");this.setupResizeObserver(e)}g.style.maxWidth=this.template.maxScreenWidth+\"px\",this.grid=GridStack.init({acceptWidgets:this.editMode,animate:!0,cellHeight:\"WRAP_TO_SINGLE_COLUMN\"===(null===(l=this.activePreset)||void 0===l?void 0:l.scalingPreset)?t/((null===(h=this.template)||void 0===h?void 0:h.columns)?this.template.columns/4:2):\"initial\",column:null===(c=this.template)||void 0===c?void 0:c.columns,disableOneColumnMode:\"WRAP_TO_SINGLE_COLUMN\"!==(null===(p=this.activePreset)||void 0===p?void 0:p.scalingPreset),oneColumnModeDomSort:!0,draggable:{appendTo:\"parent\"},float:!0,margin:5,resizable:{handles:\"all\"},staticGrid:\"WRAP_TO_SINGLE_COLUMN\"===(null===(v=this.activePreset)||void 0===v?void 0:v.scalingPreset)||!this.editMode,styleInHead:!1},g),g.style.backgroundSize=this.grid.cellWidth()+\"px \"+this.grid.getCellHeight()+\"px\",g.style.height=\"100%\",g.style.minHeight=\"100%\",this.grid.on(\"dropped\",((e,i,t)=>this.onWidgetDrop(e,i,t))),this.grid.on(\"change\",((e,i)=>{null!=this.template&&null!=this.template.widgets&&(i.forEach((e=>{var i,t;const r=null===(t=null===(i=this.template)||void 0===i?void 0:i.widgets)||void 0===t?void 0:t.find((i=>{var t;return(null===(t=i.gridItem)||void 0===t?void 0:t.id)==e.id}));r.gridItem.x=e.x,r.gridItem.y=e.y,r.gridItem.w=e.w,r.gridItem.h=e.h})),this.dispatchEvent(new CustomEvent(\"changed\",{detail:{template:this.template}})))})),this.grid.on(\"resizestart\",(e=>{this.latestDragWidgetStart=new Date})),this.grid.on(\"resizestop\",(e=>{setTimeout((()=>{this.latestDragWidgetStart=void 0}),200)}))}this.isLoading=!1}))}refreshPreview(){this.setupGrid(!0,!0)}refreshWidgets(){var e;null===(e=this.grid)||void 0===e||e.getGridItems().forEach((e=>{const i=e.querySelector(OrDashboardWidgetContainer.tagName);i&&i.refreshContent(!1)}))}selectGridItem(e){null!=this.grid&&(this.deselectGridItems(this.grid.getGridItems()),e.querySelectorAll(\".grid-stack-item-content\").forEach((e=>{e.classList.add(\"grid-stack-item-content__active\")})))}deselectGridItem(e){e.querySelectorAll(\".grid-stack-item-content\").forEach((e=>{e.classList.remove(\"grid-stack-item-content__active\")}))}deselectGridItems(e){e.forEach((e=>{this.deselectGridItem(e)}))}onGridItemClick(e){var i,t,r,s,d;this.latestDragWidgetStart||(null===(i=this.grid)||void 0===i?void 0:i.opts.staticGrid)||(e?(null===(r=null===(t=this.selectedWidget)||void 0===t?void 0:t.gridItem)||void 0===r?void 0:r.id)!=e.id&&(this.selectedWidget=null===(d=null===(s=this.template)||void 0===s?void 0:s.widgets)||void 0===d?void 0:d.find((i=>{var t;return(null===(t=i.gridItem)||void 0===t?void 0:t.id)==e.id}))):this.selectedWidget=void 0)}onFitToScreenClick(){var e;const i=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(\"#container\");if(i){const e=+(.95*i.clientWidth/+this.previewWidth.replace(\"px\",\"\")).toFixed(2);this.previewZoom=e>1?1:e}}isPreviewVisible(){var e;return!this.isLoading&&\"BLOCK_DEVICE\"!=(null===(e=this.activePreset)||void 0===e?void 0:e.scalingPreset)}render(){var e,i,t,r,s,d,o,a;try{(null===(e=this.grid)||void 0===e?void 0:e.el)&&(null===(i=this.grid)||void 0===i?void 0:i.getGridItems())&&(null===(t=this.grid)||void 0===t||t.getGridItems().forEach((e=>{var i,t,r;null==(null===(t=null===(i=this.template)||void 0===i?void 0:i.widgets)||void 0===t?void 0:t.find((i=>i.id==e.id)))&&(null===(r=this.grid)||void 0===r||r.removeWidget(e))})))}catch(e){console.error(e)}const n=\"Custom\";let l=null===(s=null===(r=this.template)||void 0===r?void 0:r.screenPresets)||void 0===s?void 0:s.map((e=>e.displayName));return null==l||l.push(n),html`\n            <div id=\"buildingArea\" style=\"display: flex; flex-direction: column; height: 100%; position: relative;\" @click=\"${e=>{\"buildingArea\"===e.composedPath()[1].id&&this.onGridItemClick(void 0)}}\">\n                ${this.editMode&&!this.fullscreen?html`\n                    <div id=\"view-options\">\n                        <or-mwc-input id=\"fit-btn\" type=\"${InputType.BUTTON}\" icon=\"fit-to-screen\"\n                                      @or-mwc-input-changed=\"${()=>this.onFitToScreenClick()}\">\n                        </or-mwc-input>\n                        <or-mwc-input id=\"zoom-input\" type=\"${InputType.NUMBER}\" outlined label=\"${i18next.t(\"dashboard.zoomPercent\")}\" min=\"25\" .value=\"${100*this.previewZoom}\" style=\"width: 90px\"\n                                      @or-mwc-input-changed=\"${debounce((e=>{this.previewZoom=e.detail.value/100}),50)}\"\n                        ></or-mwc-input>\n                        <or-mwc-input id=\"view-preset-select\" type=\"${InputType.SELECT}\" outlined label=\"${i18next.t(\"dashboard.presetSize\")}\" style=\"min-width: 220px;\"\n                                      .value=\"${null==this.previewSize?n:this.previewSize.displayName}\" .options=\"${null===(d=this.availablePreviewSizes)||void 0===d?void 0:d.map((e=>e.displayName))}\"\n                                      @or-mwc-input-changed=\"${e=>{var i;this.previewSize=null===(i=this.availablePreviewSizes)||void 0===i?void 0:i.find((i=>i.displayName==e.detail.value))}}\"\n                        ></or-mwc-input>\n                        <or-mwc-input id=\"width-input\" type=\"${InputType.NUMBER}\" outlined label=\"${i18next.t(\"width\")}\" min=\"100\" .value=\"${null===(o=this.previewWidth)||void 0===o?void 0:o.replace(\"px\",\"\")}\" style=\"width: 90px\"\n                                      @or-mwc-input-changed=\"${debounce((e=>{this.previewWidth=e.detail.value+\"px\"}),550)}\"\n                        ></or-mwc-input>\n                        <or-mwc-input id=\"height-input\" type=\"${InputType.NUMBER}\" outlined label=\"${i18next.t(\"height\")}\" min=\"100\" .value=\"${null===(a=this.previewHeight)||void 0===a?void 0:a.replace(\"px\",\"\")}\" style=\"width: 90px;\"\n                                      @or-mwc-input-changed=\"${e=>{this.previewHeight=e.detail.value+\"px\"}}\"\n                        ></or-mwc-input>\n                        <or-mwc-input id=\"rotate-btn\" type=\"${InputType.BUTTON}\" icon=\"screen-rotation\"\n                                      @or-mwc-input-changed=\"${()=>{const e=this.previewHeight,i=this.previewWidth;this.previewWidth=e,this.previewHeight=i}}\">\n                        </or-mwc-input>\n                    </div>\n                `:void 0}\n                ${this.rerenderActive?html`\n                    <div id=\"container\" style=\"justify-content: center; align-items: center;\">\n                        <span><or-translate value=\"dashboard.renderingGrid\"></or-translate></span>\n                    </div>\n                `:html`\n                    <div id=\"container\" style=\"justify-content: center; position: relative;\">\n                        ${when(this.isLoading,(()=>html`\n                            <div style=\"position: absolute; z-index: 3; height: 100%; display: flex; align-items: center;\">\n                                <or-loading-indicator></or-loading-indicator>\n                            </div>\n                        `),(()=>{var e;return html`\n                            ${\"BLOCK_DEVICE\"==(null===(e=this.activePreset)||void 0===e?void 0:e.scalingPreset)?html`\n                                <div style=\"position: absolute; z-index: 3; height: 100%; display: flex; align-items: center;\">\n                                    <span><or-translate value=\"dashboard.deviceNotSupported\"></or-translate></span>\n                                </div>\n                            `:void 0}\n                        `}))}\n                        <!-- The grid itself. Will also show during isLoading, but will be invisible through CSS -->\n                        <div class=\"${this.fullscreen?\"maingridContainer__fullscreen\":\"maingridContainer\"}\" style=\"${this.isLoading?\"visibility: hidden;\":\"\"}\">\n                            <div class=\"maingrid ${this.fullscreen?\"maingrid__fullscreen\":void 0}\"\n                                 style=\"width: ${this.previewWidth}; height: ${this.previewHeight}; visibility: ${this.isPreviewVisible()?\"visible\":\"hidden\"}; zoom: ${this.editMode&&!this.fullscreen?this.previewZoom:\"normal\"}; ${this.editMode&&!this.fullscreen?\"-moz-transform: scale(\"+this.previewZoom+\")\":void 0}; transform-origin: top;\"\n                                 @click=\"${e=>{\"gridElement\"==e.composedPath()[0].id&&this.onGridItemClick(void 0)}}\">\n                                ${guard([this.editMode,this.template],(()=>{var e;return html`\n                                    <!-- Gridstack element on which the Grid will be rendered -->\n                                    <div id=\"gridElement\" class=\"grid-stack ${this.editMode?\"grid-element\":void 0}\" style=\"margin: auto;\">\n                                        ${(null===(e=this.template)||void 0===e?void 0:e.widgets)?repeat(this.template.widgets,(e=>e.id),(e=>{var i,t,r,s,d,o,a;return html`\n                                                    <div class=\"grid-stack-item\" id=\"${e.id}\" gs-id=\"${null===(i=e.gridItem)||void 0===i?void 0:i.id}\" gs-x=\"${null===(t=e.gridItem)||void 0===t?void 0:t.x}\" gs-y=\"${null===(r=e.gridItem)||void 0===r?void 0:r.y}\"\n                                                         gs-w=\"${null===(s=e.gridItem)||void 0===s?void 0:s.w}\" gs-h=\"${null===(d=e.gridItem)||void 0===d?void 0:d.h}\" gs-min-w=\"${null===(o=e.gridItem)||void 0===o?void 0:o.minW}\" gs-min-h=\"${null===(a=e.gridItem)||void 0===a?void 0:a.minH}\"\n                                                         @click=\"${()=>{this.onGridItemClick(e.gridItem)}}\">\n                                                        <div class=\"grid-stack-item-content\" style=\"display: flex;\">\n                                                            <or-dashboard-widget-container .widget=\"${e}\" .editMode=\"${this.editMode}\" style=\"width: 100%; height: auto; border-radius: 4px;\"></or-dashboard-widget-container>\n                                                        </div>\n                                                    </div>\n                                                `})):void 0}\n                                    </div>\n                                `}))}\n                            </div>\n                        </div>\n                    </div>\n                `}\n            </div>\n            <style>\n                ${cache(when(this.isExtraLargeGrid(),(()=>this.applyCustomGridstackGridCSS(this.getGridstackColumns(this.grid)?this.getGridstackColumns(this.grid):this.template.columns))))}\n            </style>\n        `}getGridstackColumns(e){try{return null==e?void 0:e.getColumn()}catch(e){return}}isExtraLargeGrid(){var e;return!!this.grid&&(this.getGridstackColumns(this.grid)&&this.getGridstackColumns(this.grid)>12||!!((null===(e=this.template)||void 0===e?void 0:e.columns)&&this.template.columns>12))}applyCustomGridstackGridCSS(e){if(this.cachedGridstackCSS.has(e))return html`${this.cachedGridstackCSS.get(e).map((e=>e))}`;{const i=[];for(let t=0;t<e+1;t++)i.push(html`\n                    <style>\n                        .grid-stack > .grid-stack-item[gs-w=\"${t}\"]:not(.ui-draggable-dragging):not(.ui-resizable-resizing) { width: ${100-100/e*(e-t)}% !important; }\n                        .grid-stack > .grid-stack-item[gs-x=\"${t}\"]:not(.ui-draggable-dragging):not(.ui-resizable-resizing) { left: ${100-100/e*(e-t)}% !important; }                    \n                    </style>\n                `);return this.cachedGridstackCSS.set(e,i),html`${i.map((e=>e))}`}}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this.resizeObserver)||void 0===e||e.disconnect()}setupResizeObserver(e){var i;return null===(i=this.resizeObserver)||void 0===i||i.disconnect(),this.fullscreen?this.resizeObserver=new ResizeObserver(debounce(this.resizeObserverCallback,200)):this.resizeObserver=new ResizeObserver(this.resizeObserverCallback),this.resizeObserver.observe(e),this.resizeObserver}_onGridResize(){this.setupGrid(!0,!1)}processTemplateChanges(e){var i,t,r;if(1==e.changedKeys.length&&e.changedKeys.includes(\"columns\")&&this.grid){this.grid.column(e.newValue.columns);let r=null===(i=this.shadowRoot)||void 0===i?void 0:i.querySelector(\".maingrid\"),s=null===(t=this.shadowRoot)||void 0===t?void 0:t.getElementById(\"gridElement\");s.style.backgroundSize=this.grid.cellWidth()+\"px \"+this.grid.getCellHeight()+\"px\",s.style.height=r.scrollHeight+\"px\",this.setupGrid(!0,!1)}else e.changedKeys.length>1?this.setupGrid(!0,!0):e.changedKeys.includes(\"widgets\")?null!=(null===(r=this.grid)||void 0===r?void 0:r.el)&&this.grid.getGridItems().forEach((e=>{var i;e.classList.contains(\"ui-draggable\")||null===(i=this.grid)||void 0===i||i.makeWidget(e)})):e.changedKeys.includes(\"screenPresets\")&&this.setupGrid(!0,!0)}waitUntil(e){const i=t=>{e()?t():setTimeout((e=>i(t)),400)};return new Promise(i)}onWidgetDrop(e,i,t){this.grid&&t&&(this.grid.removeWidget(t.el,!0,!1),WidgetService.placeNew(t.widgetTypeId,t.x,t.y).then((e=>{this.dispatchEvent(new CustomEvent(\"created\",{detail:e}))})))}};__decorate([property({hasChanged:(e,i)=>JSON.stringify(e)!=JSON.stringify(i)})],OrDashboardPreview.prototype,\"template\",null),__decorate([property()],OrDashboardPreview.prototype,\"dashboardId\",void 0),__decorate([property()],OrDashboardPreview.prototype,\"realm\",void 0),__decorate([property({type:Object})],OrDashboardPreview.prototype,\"selectedWidget\",void 0),__decorate([property()],OrDashboardPreview.prototype,\"editMode\",void 0),__decorate([property()],OrDashboardPreview.prototype,\"readonly\",void 0),__decorate([property()],OrDashboardPreview.prototype,\"previewWidth\",void 0),__decorate([property()],OrDashboardPreview.prototype,\"previewHeight\",void 0),__decorate([property()],OrDashboardPreview.prototype,\"previewZoom\",void 0),__decorate([property()],OrDashboardPreview.prototype,\"previewSize\",void 0),__decorate([property()],OrDashboardPreview.prototype,\"availablePreviewSizes\",void 0),__decorate([property()],OrDashboardPreview.prototype,\"fullscreen\",void 0),__decorate([state()],OrDashboardPreview.prototype,\"latestChanges\",void 0),__decorate([state()],OrDashboardPreview.prototype,\"activePreset\",void 0),__decorate([state()],OrDashboardPreview.prototype,\"rerenderActive\",void 0),__decorate([state()],OrDashboardPreview.prototype,\"isLoading\",void 0),OrDashboardPreview=__decorate([customElement(\"or-dashboard-preview\")],OrDashboardPreview);export{OrDashboardPreview};","var __decorate=this&&this.__decorate||function(t,e,i,s){var d,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(d=t[o])&&(r=(n<3?d(r):n>3?d(e,i,r):d(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(d,n){function r(t){try{a(s.next(t))}catch(t){n(t)}}function o(t){try{a(s.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?d(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,o)}a((s=s.apply(t,e||[])).next())}))};import{html,LitElement,unsafeCSS}from\"lit\";import{customElement,property,state}from\"lit/decorators.js\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{style}from\"./style\";import{i18next}from\"@openremote/or-translate\";import{until}from\"lit/directives/until.js\";import{WidgetService}from\"./service/widget-service\";import{WidgetSettingsChangedEvent}from\"./util/widget-settings\";import{guard}from\"lit/directives/guard.js\";const tableStyle=require(\"@material/data-table/dist/mdc.data-table.css\");let OrDashboardWidgetsettings=class extends LitElement{static get styles(){return[unsafeCSS(tableStyle),style]}forceParentUpdate(t,e=!1){this.requestUpdate(),this.dispatchEvent(new CustomEvent(\"update\",{detail:{changes:t,force:e}}))}render(){var t;return html`\n            <div style=\"padding: 12px;\">\n                <div>\n                    <or-mwc-input .type=\"${InputType.TEXT}\" style=\"width: 100%;\" .value=\"${null===(t=this.selectedWidget)||void 0===t?void 0:t.displayName}\" label=\"${i18next.t(\"name\")}\"\n                                  @or-mwc-input-changed=\"${t=>this.setDisplayName(t.detail.value)}\"\n                    ></or-mwc-input>\n                </div>\n            </div>\n            <div>\n                ${guard([this.selectedWidget],(()=>html`\n                    ${until(this.generateContent(this.selectedWidget.widgetTypeId),html`Loading...`)}\n                `))}\n            </div>\n        `}setDisplayName(t){this.selectedWidget.displayName=t,this.forceParentUpdate(new Map([[\"widget\",this.selectedWidget]]))}generateContent(t){return __awaiter(this,void 0,void 0,(function*(){if(!this.settingsElem||this.settingsElem.id!==this.selectedWidget.id){const e=WidgetService.getManifest(t);this.settingsElem=this.initSettings(e)}return html`\n            ${this.settingsElem}\n        `}))}initSettings(t){const e=t.getSettingsHtml(this.selectedWidget.widgetConfig);return e.id=this.selectedWidget.id,e.getDisplayName=()=>this.selectedWidget.displayName,e.setDisplayName=t=>this.setDisplayName(t),e.getEditMode=()=>!0,e.getWidgetLocation=()=>{var t,e,i,s;return{x:null===(t=this.selectedWidget.gridItem)||void 0===t?void 0:t.x,y:null===(e=this.selectedWidget.gridItem)||void 0===e?void 0:e.y,w:null===(i=this.selectedWidget.gridItem)||void 0===i?void 0:i.w,h:null===(s=this.selectedWidget.gridItem)||void 0===s?void 0:s.h}},e.addEventListener(WidgetSettingsChangedEvent.NAME,(t=>this.onWidgetConfigChange(t))),e}onWidgetConfigChange(t){this.selectedWidget.widgetConfig=t.detail,this.forceParentUpdate(new Map([[\"widget\",this.selectedWidget]]))}};__decorate([property({type:Object})],OrDashboardWidgetsettings.prototype,\"selectedWidget\",void 0),__decorate([state()],OrDashboardWidgetsettings.prototype,\"settingsElem\",void 0),OrDashboardWidgetsettings=__decorate([customElement(\"or-dashboard-widgetsettings\")],OrDashboardWidgetsettings);export{OrDashboardWidgetsettings};","var __decorate=this&&this.__decorate||function(e,t,a,s){var r,i=arguments.length,n=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,a):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)n=Reflect.decorate(e,t,a,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(n=(i<3?r(n):i>3?r(t,a,n):r(t,a))||n);return i>3&&n&&Object.defineProperty(t,a,n),n};import{css,html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{style}from\"./style\";import{i18next}from\"@openremote/or-translate\";import{unsafeHTML}from\"lit/directives/unsafe-html.js\";import{when}from\"lit/directives/when.js\";import{dashboardAccessToString,scalingPresetToString,sortScreenPresets}from\".\";const boardSettingsStyling=css`\n    .label {\n        margin-bottom: 4px;\n    }\n`;let OrDashboardBoardsettings=class extends LitElement{static get styles(){return[boardSettingsStyling,style]}forceParentUpdate(e=!1){this.dispatchEvent(new CustomEvent(\"update\",{detail:{force:e}}))}setViewAccess(e){this.dashboard.viewAccess=e,\"PRIVATE\"===e&&(this.dashboard.editAccess=\"PRIVATE\"),this.requestUpdate(),this.forceParentUpdate(!1)}setEditAccess(e){this.dashboard.editAccess=e,this.requestUpdate(),this.forceParentUpdate(!1)}setBreakpoint(e,t){this.dashboard.template.screenPresets[e].breakpoint=t,this.requestUpdate(),this.forceParentUpdate(!0)}setRefreshInterval(e){this.dashboard.template.refreshInterval=e,this.requestUpdate(),this.forceParentUpdate(!1)}render(){var e,t;if(null!=(null===(e=this.dashboard.template)||void 0===e?void 0:e.screenPresets)){const e=sortScreenPresets(this.dashboard.template.screenPresets,!0),a=[\"PRIVATE\",\"SHARED\",\"PUBLIC\"].map((e=>({key:e,value:dashboardAccessToString(e)}))),s=[\"PRIVATE\",\"SHARED\"].map((e=>({key:e,value:dashboardAccessToString(e)}))),r=[\"OFF\",\"ONE_MIN\",\"FIVE_MIN\",\"QUARTER\",\"ONE_HOUR\"].map((e=>({key:e,value:`dashboard.interval.${e.toLowerCase()}`}))),i=[];return[\"KEEP_LAYOUT\",\"WRAP_TO_SINGLE_COLUMN\",\"BLOCK_DEVICE\"].forEach((e=>{i.push({key:e,value:scalingPresetToString(e)})})),html`\n\n                <!-- Permissions panel, to set who can view/edit the selected dashboard -->\n                ${when(this.showPerms,(()=>html`\n                    <settings-panel displayName=\"permissions\" expanded=\"${!0}\">\n                        <div>\n                            <div style=\"margin-bottom: 24px;\">\n                                <div class=\"label\">\n                                    ${html`<span>${unsafeHTML(i18next.t(\"dashboard.whoCanView\").toString())}</span>`}\n                                </div>\n                                <or-mwc-input class=\"permissionInput\" comfortable type=\"${InputType.SELECT}\" style=\"width: 100%;\"\n                                              .options=\"${a.map((e=>e.value))}\"\n                                              .value=\"${dashboardAccessToString(this.dashboard.viewAccess)}\"\n                                              @or-mwc-input-changed=\"${e=>{var t;this.setViewAccess(null===(t=a.find((t=>t.value==e.detail.value)))||void 0===t?void 0:t.key)}}\"\n                                ></or-mwc-input>\n                            </div>\n                            <div style=\"margin-bottom: 24px;\">\n                                <div class=\"label\">\n                                    ${html`<span>${unsafeHTML(i18next.t(\"dashboard.whoCanEdit\").toString())}</span>`}\n                                </div>\n                                <or-mwc-input class=\"permissionInput\" comfortable type=\"${InputType.SELECT}\" style=\"width: 100%;\"\n                                              .disabled=\"${\"PRIVATE\"==this.dashboard.viewAccess}\"\n                                              .options=\"${s.map((e=>e.value))}\"\n                                              .value=\"${dashboardAccessToString(this.dashboard.editAccess)}\"\n                                              @or-mwc-input-changed=\"${e=>{var t;this.setEditAccess(null===(t=s.find((t=>t.value==e.detail.value)))||void 0===t?void 0:t.key)}}\"\n                                ></or-mwc-input>\n                            </div>\n                        </div>\n                    </settings-panel>\n                `))}\n\n                <!-- Layout panel, with options such as 'amount of columns' -->\n                <settings-panel displayName=\"layout\" expanded=\"${!0}\">\n                    <div>\n                        \n                        <!-- Number of Columns control -->\n                        <div style=\"margin-bottom: 24px; display: flex; align-items: center;\">\n                            <span style=\"min-width: 180px;\"><or-translate value=\"dashboard.numberOfColumns\"></or-translate></span>\n                            <or-mwc-input type=\"${InputType.NUMBER}\" comfortable .value=\"${this.dashboard.template.columns}\" min=\"1\" max=\"24\" @or-mwc-input-changed=\"${e=>{null!=this.dashboard.template&&e.detail.value<=24&&e.detail.value>=1&&(this.dashboard.template.columns=e.detail.value,this.forceParentUpdate(!0))}}\"></or-mwc-input>\n                        </div>\n                        \n                        <!-- Scaling preset -->\n                        ${1===e.length?html`\n                            ${this.scalingPresetTemplate(e,i)}\n                        `:void 0}\n                        \n                        <!-- Screen preset -->\n                        ${1===e.length?html`\n                            ${this.screenPresetTemplate(e,[\"Mobile breakpoint\"])}\n                        `:void 0}\n                        \n                        <!-- Max Screen Width control-->\n                        <div style=\"margin-bottom: 24px; display: flex; align-items: center; justify-content: space-between;\">\n                            <span style=\"min-width: 150px;\"><or-translate value=\"dashboard.maxScreenWidth\"></or-translate></span>\n                            <div>\n                                <or-mwc-input type=\"${InputType.NUMBER}\" comfortable .value=\"${this.dashboard.template.maxScreenWidth}\" style=\"width: 70px;\"\n                                              @or-mwc-input-changed=\"${e=>{null!=this.dashboard.template&&(this.dashboard.template.maxScreenWidth=e.detail.value,this.forceParentUpdate(!0))}}\">\n                                </or-mwc-input>\n                                <span style=\"margin-left: 2px;\">px</span>\n                            </div>\n                        </div>\n                        \n                        <!-- \"Set to mobile\" preset button, for ease of use -->\n                        <div>\n                            <or-mwc-input type=\"${InputType.BUTTON}\" comfortable label=\"dashboard.setToMobilePreset\"\n                                          @or-mwc-input-changed=\"${()=>{this.setToMobilePreset()}}\">\n                            </or-mwc-input>\n                        </div>\n                    </div>\n                </settings-panel>\n\n                <!-- Data management options -->\n                <settings-panel displayName=\"dashboard.dataManagement\" expanded=\"${!0}\">\n                    <div>\n                        <div class=\"label\">\n                            <span><or-translate value=\"dashboard.defaultRefreshInterval\"></or-translate></span>\n                        </div>\n                        <or-mwc-input type=\"${InputType.SELECT}\" comfortable .options=\"${r.map((e=>e.value))}\" style=\"width: 100%;\"\n                                      .value=\"${`dashboard.interval.${(null===(t=this.dashboard.template.refreshInterval)||void 0===t?void 0:t.toLowerCase())||\"off\"}`}\"\n                                      @or-mwc-input-changed=\"${e=>{const t=r.find((t=>t.value===e.detail.value));t&&this.setRefreshInterval(t.key)}}\">\n                        </or-mwc-input>\n                    </div>\n                </settings-panel>\n                \n            `}return html`\n                <div style=\"padding: 24px;\">\n                    <span><or-translate value=\"errorOccurred\"></or-translate></span><br/>\n                    <span><or-translate value=\"noDashboardFound\"></or-translate></span>\n                </div>\n            `}setToMobilePreset(){this.dashboard.template.columns=4,this.dashboard.template.screenPresets[0].scalingPreset=\"KEEP_LAYOUT\",this.dashboard.template.maxScreenWidth=700,this.requestUpdate(),this.forceParentUpdate(!0)}scalingPresetTemplate(e,t){return html`\n            ${e.map((a=>{var s;return html`\n                    <div style=\"margin-bottom: ${e.length>1?\"24px\":\"16px\"}\">\n                        <div class=\"label\">\n                            ${html`<span>${unsafeHTML(i18next.t(\"dashboard.onScreenMyBoardShould\").replace(\"{{size}}\",\"<b>\"+i18next.t(a.displayName)+\"</b>\"))}</span>`}\n                        </div>\n                        <or-mwc-input class=\"displayInput\" type=\"${InputType.SELECT}\" comfortable style=\"width: 100%;\"\n                                      .options=\"${t.map((e=>e.value))}\"\n                                      .value=\"${null===(s=t.find((e=>e.key==a.scalingPreset)))||void 0===s?void 0:s.value}\"\n                                      @or-mwc-input-changed=\"${e=>{var s;a.scalingPreset=null===(s=t.find((t=>t.value==e.detail.value)))||void 0===s?void 0:s.key,this.forceParentUpdate(!0),this.requestUpdate()}}\"\n                        ></or-mwc-input>\n                    </div>\n                `}))}\n        `}screenPresetTemplate(e,t){return html`\n            ${e.map(((a,s)=>html`\n                    <div style=\"margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between;\">\n                        <span style=\"min-width: 140px;\">${t?t[s]:a.displayName+\" \"+i18next.t(\"screen\")}</span>\n                        <div>\n                            <span style=\"margin-right: 4px;\">${0==e.indexOf(a)?\">\":\"<\"}</span>\n                            <or-mwc-input type=\"${InputType.NUMBER}\" comfortable .disabled=\"${e.length>1&&0==e.indexOf(a)}\" style=\"width: 70px;\"\n                                          .value=\"${e.length>1&&0==e.indexOf(a)?e[1].breakpoint:a.breakpoint}\"\n                                          @or-mwc-input-changed=\"${t=>{this.setBreakpoint(e.indexOf(a),t.detail.value)}}\"\n                            ></or-mwc-input>\n                            <span style=\"margin-left: 2px;\">px</span>\n                        </div>\n                    </div>\n                `))}\n        `}};__decorate([property()],OrDashboardBoardsettings.prototype,\"dashboard\",void 0),__decorate([property()],OrDashboardBoardsettings.prototype,\"showPerms\",void 0),OrDashboardBoardsettings=__decorate([customElement(\"or-dashboard-boardsettings\")],OrDashboardBoardsettings);export{OrDashboardBoardsettings};","var __decorate=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{getContentWithMenuTemplate}from\"@openremote/or-mwc-components/or-mwc-menu\";import{html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{when}from\"lit/directives/when.js\";export function intervalToMillis(e){switch(e){case\"OFF\":default:return;case\"ONE_MIN\":return 6e4;case\"FIVE_MIN\":return 3e5;case\"QUARTER\":return 9e5;case\"ONE_HOUR\":return 36e5}}export class IntervalSelectEvent extends CustomEvent{constructor(e){super(IntervalSelectEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}IntervalSelectEvent.NAME=\"interval-select\";let DashboardRefreshControls=class extends LitElement{constructor(){super(...arguments),this.interval=\"OFF\",this.readonly=!0,this.intervalOptions=[\"OFF\",\"ONE_MIN\",\"FIVE_MIN\",\"QUARTER\",\"ONE_HOUR\"]}willUpdate(e){super.willUpdate(e),e.has(\"interval\")&&void 0!==this.interval&&this.dispatchEvent(new IntervalSelectEvent(this.interval))}render(){const e=this.getRefreshOptions(),t=this.getIntervalString(this.interval);return html`\n            <div style=\"height: 100%; display: flex; align-items: center;\">\n                ${when(this.readonly,(()=>html`\n                    ${when(\"OFF\"===this.interval,(()=>html`\n                        <or-mwc-input .type=\"${InputType.BUTTON}\" icon=\"pause\" disabled=\"true\" style=\"height: 36px; margin-top: -12px;\"></or-mwc-input>\n                    `),(()=>html`\n                        <or-mwc-input .type=\"${InputType.BUTTON}\" label=\"${t}\" disabled=\"true\"></or-mwc-input>\n                    `))}\n                `),(()=>html`\n                    ${getContentWithMenuTemplate(\"OFF\"===this.interval?html`\n                                <or-mwc-input .type=\"${InputType.BUTTON}\" icon=\"pause\" style=\"height: 36px; margin-top: -12px;\"></or-mwc-input>\n                            `:html`\n                                <or-mwc-input .type=\"${InputType.BUTTON}\" label=\"${t}\"></or-mwc-input>\n                            `,e.map((e=>({value:e}))),t,(t=>this.onIntervalSelect(e,t)),void 0,!1,!0,!0)}\n                `))}\n            </div>\n        `}onIntervalSelect(e,t){this.interval=this.intervalOptions[e.indexOf(t)]}getIntervalString(e){return`dashboard.interval.${e.toLowerCase()}`}getRefreshOptions(){return this.intervalOptions.map((e=>this.getIntervalString(e)))}};__decorate([property()],DashboardRefreshControls.prototype,\"interval\",void 0),__decorate([property()],DashboardRefreshControls.prototype,\"readonly\",void 0),DashboardRefreshControls=__decorate([customElement(\"dashboard-refresh-controls\")],DashboardRefreshControls);export{DashboardRefreshControls};","var __decorate=this&&this.__decorate||function(t,e,r,o){var a,l=arguments.length,i=l<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(i=(l<3?a(i):l>3?a(e,r,i):a(e,r))||i);return l>3&&i&&Object.defineProperty(e,r,i),i};import{MDCTabBar}from\"@material/tab-bar\";import{css,html,LitElement,unsafeCSS}from\"lit\";import{customElement,property,state}from\"lit/decorators.js\";import{DefaultColor4,DefaultColor8}from\"@openremote/core\";import{unsafeHTML}from\"lit/directives/unsafe-html.js\";const tabStyle=require(\"@material/tab/dist/mdc.tab.css\"),tabBarStyle=require(\"@material/tab-bar/dist/mdc.tab-bar.css\"),tabIndicatorStyle=require(\"@material/tab-indicator/dist/mdc.tab-indicator.css\"),tabScrollerStyle=require(\"@material/tab-scroller/dist/mdc.tab-scroller.css\"),tabStyling=css`\n    .mdc-tab {\n        background: var(--or-app-color4, ${unsafeCSS(DefaultColor4)});\n    }\n    .mdc-tab .mdc-tab__text-label {\n        color: var(--or-app-color8, ${unsafeCSS(DefaultColor8)});\n    }\n    .mdc-tab .mdc-tab__icon {\n        color: var(--or-app-color8, ${unsafeCSS(DefaultColor8)})\n    }\n    .mdc-tab-indicator .mdc-tab-indicator__content--underline {\n        border-color: var(--or-app-color8, ${unsafeCSS(DefaultColor8)})\n    }\n    .mdc-tab__ripple::before, .mdc-tab__ripple::after {\n        background-color: var(--ripplecolor, ${unsafeCSS(DefaultColor8)});\n    }\n    .mdc-tab-vertical {\n        height: 72px !important; /* 72px is original Material spec */\n    }\n    .mdc-tab-vertical__content {\n        flex-direction: column;\n        gap: 6px; /* 6px is original Material spec */\n    }\n    .mdc-tab-vertical__text-label {\n        padding-left: 0 !important;\n    }\n`;let OrMwcTabs=class extends LitElement{static get styles(){return[unsafeCSS(tabStyle),unsafeCSS(tabBarStyle),unsafeCSS(tabIndicatorStyle),unsafeCSS(tabScrollerStyle),tabStyling]}constructor(){super(),null==this.index&&(this.index=0),null==this.items&&(this.items=[]),null==this.iconPosition&&(this.iconPosition=\"left\"),null==this.noScroll&&(this.noScroll=!1),this.updateComplete.then((()=>{var t,e;const r=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(\".mdc-tab-bar\");null!=r&&(this.mdcTabBar=new MDCTabBar(r),this.mdcTabBar.listen(\"MDCTabBar:activated\",(t=>{this.index=t.detail.index}))),null!=r&&(\"top\"===this.iconPosition&&null!=(null===(e=this.items)||void 0===e?void 0:e.find((t=>null!=t.name&&null!=t.icon)))&&(r.querySelectorAll(\".mdc-tab\").forEach((t=>{t.classList.add(\"mdc-tab-vertical\")})),r.querySelectorAll(\".mdc-tab__content\").forEach((t=>{t.classList.add(\"mdc-tab-vertical__content\")})),r.querySelectorAll(\".mdc-tab__text-label\").forEach((t=>{t.classList.add(\"mdc-tab-vertical__text-label\")}))),null!=this.bgColor&&r.querySelectorAll(\".mdc-tab\").forEach((t=>{t.style.background=this.bgColor})),null!=this.color&&(r.querySelectorAll(\".mdc-tab__text-label\").forEach((t=>{t.style.color=this.color})),r.querySelectorAll(\".mdc-tab__icon\").forEach((t=>{t.style.color=this.color})),r.querySelectorAll(\".mdc-tab-indicator__content--underline\").forEach((t=>{t.style.borderColor=this.color})),r.querySelectorAll(\".mdc-tab__ripple\").forEach((t=>{t.style.setProperty(\"--ripplecolor\",this.color)}))))}))}updated(t){(t.has(\"index\")||t.has(\"mdcTabBar\"))&&null!=this.mdcTabBar&&null!=this.index&&(this.mdcTabBar.activateTab(this.index),this.dispatchEvent(new CustomEvent(\"activated\",{detail:{index:this.index}})))}render(){var t;let e;return null!=this.items&&null!=this.index&&(e=this.items[this.index]),html`\n            ${\"string\"==typeof this.styles?html`<style>${this.styles}</style>`:this.styles||\"\"}\n            <div>\n                <div class=\"mdc-tab-bar\" role=\"tablist\" id=\"tab-bar\">\n                    <div class=\"mdc-tab-scroller\">\n                        <div class=\"mdc-tab-scroller__scroll-area\" style=\"overflow-x: ${this.noScroll?\"hidden\":void 0}\">\n                            <div class=\"mdc-tab-scroller__scroll-content\">\n                                ${null===(t=this.items)||void 0===t?void 0:t.map((t=>{var e;return html`\n                                    <button class=\"mdc-tab\" role=\"tab\" aria-selected=\"false\" tabindex=\"${null===(e=this.items)||void 0===e?void 0:e.indexOf(t)}\">\n                                    <span class=\"mdc-tab__content\">\n                                        ${null!=t.icon?html`<or-icon icon=\"${t.icon}\" class=\"mdc-tab__icon\"></or-icon>`:null}\n                                        ${null!=t.name?html`<span class=\"mdc-tab__text-label\">${t.name}</span>`:null}\n                                    </span>\n                                        <span class=\"mdc-tab-indicator\">\n                                        <span class=\"mdc-tab-indicator__content mdc-tab-indicator__content--underline\"></span>\n                                    </span>\n                                        <span class=\"mdc-tab__ripple\"></span>\n                                    </button>\n                                `}))}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div>\n                    <div>\n                        <!-- Content of menu Item. Using either unsafeHTML or HTML depending on input type -->\n                        ${null!=e&&null!=e.content?\"string\"==typeof e.content?unsafeHTML(e.content):html`${e.content}`:void 0}\n                    </div>\n                </div>\n            </div>\n        `}};__decorate([property({type:Number})],OrMwcTabs.prototype,\"index\",void 0),__decorate([property({type:Array})],OrMwcTabs.prototype,\"items\",void 0),__decorate([property({type:String})],OrMwcTabs.prototype,\"iconPosition\",void 0),__decorate([property({type:Boolean})],OrMwcTabs.prototype,\"noScroll\",void 0),__decorate([property({type:String})],OrMwcTabs.prototype,\"bgColor\",void 0),__decorate([property({type:String})],OrMwcTabs.prototype,\"color\",void 0),__decorate([property()],OrMwcTabs.prototype,\"styles\",void 0),__decorate([state()],OrMwcTabs.prototype,\"mdcTabBar\",void 0),OrMwcTabs=__decorate([customElement(\"or-mwc-tabs\")],OrMwcTabs);export{OrMwcTabs};","var __decorate=this&&this.__decorate||function(t,e,i,r){var o,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(a=(s<3?o(a):s>3?o(e,i,a):o(e,i))||a);return s>3&&a&&Object.defineProperty(e,i,a),a},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,s){function a(t){try{l(r.next(t))}catch(t){s(t)}}function n(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,n)}l((r=r.apply(t,e||[])).next())}))};import{css,html,LitElement,unsafeCSS}from\"lit\";import{customElement,property,state}from\"lit/decorators.js\";import{AssetModelUtil}from\"@openremote/model\";import{style}from\"../style\";import{when}from\"lit/directives/when.js\";import{map}from\"lit/directives/map.js\";import{guard}from\"lit/directives/guard.js\";import{i18next}from\"@openremote/or-translate\";import\"@openremote/or-translate\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import manager,{DefaultColor5,Util}from\"@openremote/core\";import{getAssetDescriptorIconTemplate}from\"@openremote/or-icon\";import{OrAttributePicker,OrAttributePickerPickedEvent}from\"@openremote/or-attribute-picker\";import{showDialog}from\"@openremote/or-mwc-components/or-mwc-dialog\";import{showSnackbar}from\"@openremote/or-mwc-components/or-mwc-snackbar\";export class AttributeActionEvent extends CustomEvent{constructor(t,e,i){super(AttributeActionEvent.NAME,{bubbles:!0,composed:!0,detail:{asset:t,attributeRef:e,action:i}})}}AttributeActionEvent.NAME=\"attribute-action\";export class AttributesSelectEvent extends CustomEvent{constructor(t,e){super(AttributesSelectEvent.NAME,{bubbles:!0,composed:!0,detail:{assets:t,attributeRefs:e}})}}AttributesSelectEvent.NAME=\"attribute-select\";const styling=css`\n  #attribute-list {\n    overflow: auto;\n    flex: 1 1 0;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .attribute-list-item {\n    position: relative;\n    cursor: pointer;\n    display: flex;\n    flex-direction: row;\n    align-items: stretch;\n    gap: 10px;\n    padding: 0;\n    min-height: 50px;\n  }\n  \n  .attribute-list-item-icon {\n    display: flex;\n    align-items: center;\n    --or-icon-width: 20px;\n  }\n\n  .attribute-list-item-label {\n    display: flex;\n    justify-content: center;\n    flex: 1 1 0;\n    line-height: 16px;\n    flex-direction: column;\n  }\n  \n  .attribute-list-item-actions {\n    flex: 1;\n    justify-content: end;\n    align-items: center;\n    display: flex;\n    gap: 8px;\n  }\n\n  .attribute-list-item-bullet {\n    width: 14px;\n    height: 14px;\n    border-radius: 7px;\n    margin-right: 10px;\n  }\n\n  .attribute-list-item .button.delete {\n    display: none;\n  }\n\n  .attribute-list-item:hover .button.delete {\n    display: block;\n  }\n\n  .button-action {\n    background: none;\n    visibility: hidden;\n    color: var(--or-app-color5, ${unsafeCSS(DefaultColor5)});\n    --or-icon-fill: var(--or-app-color5, ${unsafeCSS(DefaultColor5)});\n    display: inline-block;\n    border: none;\n    padding: 0;\n    cursor: pointer;\n  }\n\n  .attribute-list-item:hover .attribute-list-item-actions {\n    background: white;\n    z-index: 1;\n  }\n  \n  .attribute-list-item:hover .button-action {\n    visibility: visible;\n  }\n\n  .button-action:hover {\n    --or-icon-fill: var(--or-app-color4);\n  }\n`;let AttributesPanel=class extends LitElement{constructor(){super(...arguments),this.attributeRefs=[],this.multi=!1,this.onlyDataAttrs=!1,this.loadedAssets=[]}static get styles(){return[styling,style]}willUpdate(t){super.willUpdate(t),this.attributeRefs||(this.attributeRefs=[]),t.has(\"attributeRefs\")&&this.attributeRefs&&this.loadAssets().then((e=>{t.get(\"attributeRefs\")&&this.dispatchEvent(new AttributesSelectEvent(e,this.attributeRefs))}))}getLoadedAsset(t){var e;return null===(e=this.loadedAssets)||void 0===e?void 0:e.find((e=>e.id===t.id))}removeWidgetAttribute(t){null!=this.attributeRefs&&(this.attributeRefs=this.attributeRefs.filter((e=>e!==t)))}loadAssets(){return __awaiter(this,void 0,void 0,(function*(){if(this.attributeRefs.filter((t=>!this.getLoadedAsset(t))).length>0){const t=yield this.fetchAssets(this.attributeRefs);return this.loadedAssets=t,t}return this.loadedAssets}))}fetchAssets(t=[]){return __awaiter(this,void 0,void 0,(function*(){let e=[];return yield manager.rest.api.AssetResource.queryAssets({ids:t.map((t=>t.id)),realm:{name:manager.displayRealm},select:{attributes:t.map((t=>t.name))}}).then((t=>{e=t.data})).catch((t=>{console.error(t),showSnackbar(void 0,\"errorOccurred\")})),e}))}onAttributeActionClick(t,e,i){this.dispatchEvent(new AttributeActionEvent(t,e,i))}openAttributeSelector(t,e,i=!0,r){let o;o=showDialog(null!=t?(new OrAttributePicker).setMultiSelect(e).setSelectedAttributes(t).setShowOnlyDatapointAttrs(i).setAttributeFilter(r):(new OrAttributePicker).setMultiSelect(e).setShowOnlyDatapointAttrs(i)),o.addEventListener(OrAttributePickerPickedEvent.NAME,(t=>{this.attributeRefs=t.detail}))}render(){return html`\n            <div>\n                ${when(this.attributeRefs.length>0,(()=>html`\n\n                    <div id=\"attribute-list\">\n                        ${guard([this.attributeRefs,this.loadedAssets,this.attributeActionCallback,this.attributeLabelCallback],(()=>html`\n                            ${map(this.attributeRefs,(t=>{const e=this.getLoadedAsset(t);if(e){const i=e.attributes[t.name],r=AssetModelUtil.getAttributeAndValueDescriptors(e.type,t.name,i),o=Util.getAttributeLabel(i,r[0],e.type,!0);return html`\n                                        <div class=\"attribute-list-item\">\n                                            <div class=\"attribute-list-item-icon\">\n                                                <span>${getAssetDescriptorIconTemplate(AssetModelUtil.getAssetDescriptor(e.type))}</span>\n                                            </div>\n                                            <div class=\"attribute-list-item-label\">\n                                                ${when(!!this.attributeLabelCallback,(()=>this.attributeLabelCallback(e,i,o)),(()=>html`\n                                                            <span>${e.name}</span>\n                                                            <span style=\"font-size:14px; color:grey;\">${o}</span>\n                                                        `))}\n                                            </div>\n                                            <div class=\"attribute-list-item-actions\">\n                                                \n                                                <!-- Custom actions defined by callback -->\n                                                ${when(!!this.attributeActionCallback,(()=>this.attributeActionCallback(t).map((i=>html`\n                                                        <button class=\"button-action\" .disabled=\"${i.disabled}\" title=\"${i.tooltip}\" @click=\"${()=>this.onAttributeActionClick(e,t,i)}\">\n                                                            <or-icon icon=\"${i.icon}\"></or-icon>\n                                                        </button>\n                                                    `))))}\n                                                <!-- Remove attribute button -->\n                                                <button class=\"button-action\" title=\"${i18next.t(\"delete\")}\" @click=\"${()=>this.removeWidgetAttribute(t)}\">\n                                                    <or-icon icon=\"close-circle\"></or-icon>\n                                                </button>\n                                            </div>\n                                        </div>\n                                    `}}))}\n                        `))}\n                    </div>\n\n                `),(()=>html`\n                    <span style=\"padding: 14px 0; display: block;\"><or-translate value=\"noAttributesConnected\"></or-translate></span>\n                `))}\n\n                <!-- Button that opens attribute selection -->\n                <or-mwc-input .type=\"${InputType.BUTTON}\" label=\"attribute\" icon=\"${this.multi||0===this.attributeRefs.length?\"plus\":\"swap-horizontal\"}\"\n                              style=\"margin-top: 8px;\"\n                              @or-mwc-input-changed=\"${()=>this.openAttributeSelector(this.attributeRefs,this.multi,this.onlyDataAttrs,this.attributeFilter)}\">\n                </or-mwc-input>\n            </div>\n        `}};__decorate([property()],AttributesPanel.prototype,\"attributeRefs\",void 0),__decorate([property()],AttributesPanel.prototype,\"multi\",void 0),__decorate([property()],AttributesPanel.prototype,\"onlyDataAttrs\",void 0),__decorate([property()],AttributesPanel.prototype,\"attributeFilter\",void 0),__decorate([property()],AttributesPanel.prototype,\"attributeLabelCallback\",void 0),__decorate([property()],AttributesPanel.prototype,\"attributeActionCallback\",void 0),__decorate([state()],AttributesPanel.prototype,\"loadedAssets\",void 0),AttributesPanel=__decorate([customElement(\"attributes-panel\")],AttributesPanel);export{AttributesPanel};","var __decorate=this&&this.__decorate||function(e,t,i,n){var r,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,i,a):r(t,i))||a);return o>3&&a&&Object.defineProperty(t,i,a),a},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};import{css,html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{until}from\"lit/directives/until.js\";import{when}from\"lit/directives/when.js\";import{classMap}from\"lit/directives/class-map.js\";import{style}from\"../style\";const styling=css`\n  :host {\n    height: auto !important;\n  }\n  \n  #panel-wrapper {\n    border-top: 1px solid #E0E0E0;\n    border-bottom: 1px solid #E0E0E0;\n  }\n\n  #panel-header {\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n    padding: 12px;\n    gap: 8px;\n  }\n\n  #panel-title {\n    line-height: 100%;\n    font-weight: 700;\n  }\n\n  .panel-content {\n    padding: 0 16px;\n    max-height: 0;\n    overflow: hidden;\n    transition: max-height 0.2s cubic-bezier(0.4, 0.0, 0.2, 1) 0s, visibility 0s 0.2s; /* expanded -> collapsed */\n  }\n\n  .panel-content--expanded {\n    max-height: 100vh;\n    overflow: visible;\n    transition: max-height 0.25s cubic-bezier(0.4, 0.0, 0.2, 1) 0s; /* collapsed -> expanded */\n  }\n`;let SettingsPanel=class extends LitElement{constructor(){super(...arguments),this.expanded=!1}static get styles(){return[styling,style]}render(){const e={\"panel-content\":!0,\"panel-content--expanded\":this.expanded};return html`\n            <div id=\"panel-wrapper\">\n                ${until(this.generateHeader(this.expanded,this.displayName),html``)}\n                <div class=\"${classMap(e)}\">\n                    <div style=\"padding-bottom: 16px;\">\n                        <slot></slot>\n                    </div>\n                </div>\n            </div>\n        `}toggle(e){this.expanded=e||!this.expanded}generateHeader(e,t){return __awaiter(this,void 0,void 0,(function*(){return html`\n            <div id=\"panel-header\" @click=\"${()=>this.toggle()}\">\n                <div id=\"panel-chevron\">\n                    <or-icon icon=\"${e?\"chevron-down\":\"chevron-right\"}\"></or-icon>\n                </div>\n                ${when(t,(()=>html`\n                    <div id=\"panel-title\">\n                        <span><or-translate value=\"${this.displayName}\"></or-translate></span>\n                    </div>\n                `))}\n            </div>\n        `}))}};__decorate([property()],SettingsPanel.prototype,\"expanded\",void 0),__decorate([property()],SettingsPanel.prototype,\"displayName\",void 0),SettingsPanel=__decorate([customElement(\"settings-panel\")],SettingsPanel);export{SettingsPanel};","var __decorate=this&&this.__decorate||function(t,i,e,n){var o,s=arguments.length,a=s<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,i,e,n);else for(var l=t.length-1;l>=0;l--)(o=t[l])&&(a=(s<3?o(a):s>3?o(i,e,a):o(i,e))||a);return s>3&&a&&Object.defineProperty(i,e,a),a};import{css,html}from\"lit\";import{customElement}from\"lit/decorators.js\";import{WidgetSettings}from\"../util/widget-settings\";import\"../panels/attributes-panel\";import\"../util/settings-panel\";import{i18next}from\"@openremote/or-translate\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{when}from\"lit/directives/when.js\";const styling=css`\n  .switch-container {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n`;let ChartSettings=class extends WidgetSettings{constructor(){super(...arguments),this.timePresetOptions=new Map,this.samplingOptions=new Map}setTimePresetOptions(t){this.timePresetOptions=t}setSamplingOptions(t){this.samplingOptions=t}static get styles(){return[...super.styles,styling]}render(){var t,i,e,n,o,s;const a=null===(e=null===(i=null===(t=this.widgetConfig.chartOptions.options)||void 0===t?void 0:t.scales)||void 0===i?void 0:i.y)||void 0===e?void 0:e.min,l=null===(s=null===(o=null===(n=this.widgetConfig.chartOptions.options)||void 0===n?void 0:n.scales)||void 0===o?void 0:o.y)||void 0===s?void 0:s.max,r=this.widgetConfig.rightAxisAttributes.length>0,p=Array.from(this.samplingOptions.entries()).find((t=>t[1]===this.widgetConfig.datapointQuery.type))[0];return html`\n            <div>\n                <!-- Attribute selection -->\n                <settings-panel displayName=\"attributes\" expanded=\"${!0}\">\n                    <attributes-panel .attributeRefs=\"${this.widgetConfig.attributeRefs}\" multi=\"${!0}\" onlyDataAttrs=\"${!0}\" .attributeFilter=\"${t=>[\"boolean\",\"positiveInteger\",\"positiveNumber\",\"number\",\"long\",\"integer\",\"bigInteger\",\"negativeInteger\",\"negativeNumber\",\"bigNumber\",\"integerByte\",\"direction\"].includes(t.type)}\" style=\"padding-bottom: 12px;\"\n                                      .attributeLabelCallback=\"${(t,i,e)=>{const n=r&&void 0!==this.widgetConfig.rightAxisAttributes.find((e=>e.id===t.id&&e.name===i.name));return html`\n                <span>${t.name}</span>\n                <span style=\"font-size:14px; color:grey;\">${e}</span>\n                ${when(n,(()=>html`\n                    <span style=\"position: absolute; right: 0; margin-bottom: 16px; font-size:14px; color:grey;\"><or-translate value=\"right\"></or-translate></span>\n                `))}\n            `}}\" .attributeActionCallback=\"${t=>[{icon:this.widgetConfig.rightAxisAttributes.includes(t)?\"arrow-right-bold\":\"arrow-left-bold\",tooltip:i18next.t(\"dashboard.toggleAxis\"),disabled:!1}]}\"\n                                      @attribute-action=\"${t=>this.onAttributeAction(t)}\"\n                                      @attribute-select=\"${t=>this.onAttributesSelect(t)}\"\n                    ></attributes-panel>\n                </settings-panel>\n\n                <!-- Display options -->\n                <settings-panel displayName=\"display\" expanded=\"${!0}\">\n                    <div style=\"padding-bottom: 12px; display: flex; flex-direction: column; gap: 6px;\">\n                        <!-- Timeframe -->\n                        <div>\n                            <or-mwc-input .type=\"${InputType.SELECT}\" label=\"${i18next.t(\"timeframeDefault\")}\" style=\"width: 100%;\"\n                                          .options=\"${Array.from(this.timePresetOptions.keys())}\" value=\"${this.widgetConfig.defaultTimePresetKey}\"\n                                          @or-mwc-input-changed=\"${t=>this.onTimePresetSelect(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                        <!-- Y Min/max options -->\n                        <div>\n                            <div class=\"switch-container\">\n                                <span><or-translate value=\"dashboard.allowTimerangeSelect\"></or-translate></span>\n                                <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"margin: 0 -10px;\" .value=\"${!this.widgetConfig.showTimestampControls}\"\n                                              @or-mwc-input-changed=\"${t=>this.onTimestampControlsToggle(t)}\"\n                                ></or-mwc-input>\n                            </div>\n                            <div class=\"switch-container\">\n                                <span><or-translate value=\"dashboard.showLegend\"></or-translate></span>\n                                <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"margin: 0 -10px;\" .value=\"${this.widgetConfig.showLegend}\"\n                                              @or-mwc-input-changed=\"${t=>this.onShowLegendToggle(t)}\"\n                                ></or-mwc-input>\n                            </div>\n                        </div>\n                    </div>\n                </settings-panel>\n\n                <!-- Axis configuration -->\n                <settings-panel displayName=\"dashboard.axisConfig\" expanded=\"${!0}\">\n                    <div style=\"padding-bottom: 12px; display: flex; flex-direction: column; gap: 16px;\">\n\n                        <!-- Left axis configuration -->\n                        <div>\n                            ${when(r,(()=>html`\n                                <div style=\"margin-bottom: 8px;\">\n                                    <span><or-translate value=\"dashboard.leftAxis\"></or-translate></span>\n                                </div>\n                            `))}\n                            <div style=\"display: flex;\">\n                                ${void 0!==l?html`\n                                    <or-mwc-input .type=\"${InputType.NUMBER}\" label=\"${i18next.t(\"yAxis\")+\" \"+i18next.t(\"max\")}\" .value=\"${l}\" style=\"width: 100%;\"\n                                                  @or-mwc-input-changed=\"${t=>this.onMinMaxValueChange(\"left\",\"max\",t)}\"\n                                    ></or-mwc-input>\n                                `:html`\n                                    <or-mwc-input .type=\"${InputType.TEXT}\" label=\"${i18next.t(\"yAxis\")+\" \"+i18next.t(\"max\")}\" disabled=\"true\" value=\"auto\" style=\"width: 100%;\"></or-mwc-input>\n                                `}\n                                <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"margin: 0 -10px 0 0;\" .value=\"${void 0!==l}\"\n                                              @or-mwc-input-changed=\"${t=>this.onMinMaxValueToggle(\"left\",\"max\",t)}\"\n                                ></or-mwc-input>\n                            </div>\n                            <div style=\"display: flex; margin-top: 12px;\">\n                                ${void 0!==a?html`\n                                    <or-mwc-input .type=\"${InputType.NUMBER}\" label=\"${i18next.t(\"yAxis\")+\" \"+i18next.t(\"min\")}\" .value=\"${a}\" style=\"width: 100%;\"\n                                                  @or-mwc-input-changed=\"${t=>this.onMinMaxValueChange(\"left\",\"min\",t)}\"\n                                    ></or-mwc-input>\n                                `:html`\n                                    <or-mwc-input .type=\"${InputType.TEXT}\" label=\"${i18next.t(\"yAxis\")+\" \"+i18next.t(\"min\")}\" disabled=\"true\" value=\"auto\" style=\"width: 100%;\"></or-mwc-input>\n                                `}\n                                <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"margin: 0 -10px 0 0;\" .value=\"${void 0!==a}\"\n                                              @or-mwc-input-changed=\"${t=>this.onMinMaxValueToggle(\"left\",\"min\",t)}\"\n                                ></or-mwc-input>\n                            </div>\n                        </div>\n\n                        <!-- Right axis configuration -->\n                        ${when(r,(()=>{var t,i,e,n,o,s;const a=null===(e=null===(i=null===(t=this.widgetConfig.chartOptions.options)||void 0===t?void 0:t.scales)||void 0===i?void 0:i.y1)||void 0===e?void 0:e.min,l=null===(s=null===(o=null===(n=this.widgetConfig.chartOptions.options)||void 0===n?void 0:n.scales)||void 0===o?void 0:o.y1)||void 0===s?void 0:s.max;return html`\n                                <div>\n                                    <div style=\"margin-bottom: 8px;\">\n                                        <span><or-translate value=\"dashboard.rightAxis\"></or-translate></span>\n                                    </div>\n                                    <div style=\"display: flex;\">\n                                        ${void 0!==l?html`\n                                            <or-mwc-input .type=\"${InputType.NUMBER}\" label=\"${i18next.t(\"yAxis\")+\" \"+i18next.t(\"max\")}\" .value=\"${l}\" style=\"width: 100%;\"\n                                                          @or-mwc-input-changed=\"${t=>this.onMinMaxValueChange(\"right\",\"max\",t)}\"\n                                            ></or-mwc-input>\n                                        `:html`\n                                            <or-mwc-input .type=\"${InputType.TEXT}\" label=\"${i18next.t(\"yAxis\")+\" \"+i18next.t(\"max\")}\" disabled=\"true\" value=\"auto\"\n                                                          style=\"width: 100%;\"></or-mwc-input>\n                                        `}\n                                        <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"margin: 0 -10px 0 0;\" .value=\"${void 0!==l}\"\n                                                      @or-mwc-input-changed=\"${t=>this.onMinMaxValueToggle(\"right\",\"max\",t)}\"\n                                        ></or-mwc-input>\n                                    </div>\n                                    <div style=\"display: flex; margin-top: 12px;\">\n                                        ${void 0!==a?html`\n                                            <or-mwc-input .type=\"${InputType.NUMBER}\" label=\"${i18next.t(\"yAxis\")+\" \"+i18next.t(\"min\")}\" .value=\"${a}\" style=\"width: 100%;\"\n                                                          @or-mwc-input-changed=\"${t=>this.onMinMaxValueChange(\"right\",\"min\",t)}\"\n                                            ></or-mwc-input>\n                                        `:html`\n                                            <or-mwc-input .type=\"${InputType.TEXT}\" label=\"${i18next.t(\"yAxis\")+\" \"+i18next.t(\"min\")}\" disabled=\"true\" value=\"auto\"\n                                                          style=\"width: 100%;\"></or-mwc-input>\n                                        `}\n                                        <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"margin: 0 -10px 0 0;\" .value=\"${void 0!==a}\"\n                                                      @or-mwc-input-changed=\"${t=>this.onMinMaxValueToggle(\"right\",\"min\",t)}\"\n                                        ></or-mwc-input>\n                                    </div>\n                                </div>\n                            `}))}\n                    </div>\n                </settings-panel>\n\n                <!-- Data sampling options -->\n                <settings-panel displayName=\"dataSampling\" expanded=\"${!0}\">\n                    <div style=\"padding-bottom: 12px; display: flex; flex-direction: column; gap: 12px;\">\n                        <div>\n                            <or-mwc-input .type=\"${InputType.SELECT}\" style=\"width: 100%\" .options=\"${Array.from(this.samplingOptions.keys())}\" .value=\"${p}\"\n                                          label=\"${i18next.t(\"algorithm\")}\" @or-mwc-input-changed=\"${t=>this.onSamplingQueryChange(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                        <div>\n                            ${this.getSamplingOptionsTemplate(this.widgetConfig.datapointQuery.type)}\n                        </div>\n                    </div>\n                </settings-panel>\n            </div>\n        `}getSamplingOptionsTemplate(t){if(\"interval\"===t){const t=this.widgetConfig.datapointQuery,i=[\"AVG\",\"MIN\",\"MAX\"];return html`\n                    <or-mwc-input .type=\"${InputType.SELECT}\" style=\"width: 100%;\" .options=\"${i}\"\n                                  .value=\"${t.formula}\" label=\"${i18next.t(\"algorithmMethod\")}\" @or-mwc-input-changed=\"${i=>{t.formula=i.detail.value,this.notifyConfigUpdate()}}\"\n                    ></or-mwc-input>\n                `}return html``}onAttributeAction(t){this.widgetConfig.attributeRefs.indexOf(t.detail.attributeRef)>=0&&(this.widgetConfig.rightAxisAttributes.includes(t.detail.attributeRef)?this.removeFromRightAxis(t.detail.attributeRef):this.addToRightAxis(t.detail.attributeRef),this.notifyConfigUpdate())}onAttributesSelect(t){this.widgetConfig.attributeRefs.filter((i=>!t.detail.attributeRefs.includes(i))).forEach((t=>this.removeFromRightAxis(t))),this.widgetConfig.attributeRefs=t.detail.attributeRefs,this.notifyConfigUpdate()}addToRightAxis(t,i=!1){this.widgetConfig.rightAxisAttributes.includes(t)||(this.widgetConfig.rightAxisAttributes.push(t),i&&this.notifyConfigUpdate())}removeFromRightAxis(t,i=!1){this.widgetConfig.rightAxisAttributes.includes(t)&&(this.widgetConfig.rightAxisAttributes.splice(this.widgetConfig.rightAxisAttributes.indexOf(t),1),i&&this.notifyConfigUpdate())}onTimePresetSelect(t){this.widgetConfig.defaultTimePresetKey=t.detail.value.toString(),this.notifyConfigUpdate()}onTimestampControlsToggle(t){this.widgetConfig.showTimestampControls=!t.detail.value,this.notifyConfigUpdate()}onShowLegendToggle(t){this.widgetConfig.showLegend=t.detail.value,this.notifyConfigUpdate()}setAxisMinMaxValue(t,i,e){\"left\"===t?\"min\"===i?this.widgetConfig.chartOptions.options.scales.y.min=e:this.widgetConfig.chartOptions.options.scales.y.max=e:\"min\"===i?this.widgetConfig.chartOptions.options.scales.y1.min=e:this.widgetConfig.chartOptions.options.scales.y1.max=e,this.notifyConfigUpdate()}onMinMaxValueChange(t,i,e){this.setAxisMinMaxValue(t,i,e.detail.value)}onMinMaxValueToggle(t,i,e){this.setAxisMinMaxValue(t,i,e.detail.value?\"min\"===i?0:100:void 0)}onSamplingQueryChange(t){this.widgetConfig.datapointQuery.type=this.samplingOptions.get(t.detail.value),this.notifyConfigUpdate()}};ChartSettings=__decorate([customElement(\"chart-settings\")],ChartSettings);export{ChartSettings};","var ChartWidget_1,__decorate=this&&this.__decorate||function(t,e,i,s){var o,a=arguments.length,n=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(a<3?o(n):a>3?o(e,i,n):o(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};import{html}from\"lit\";import{when}from\"lit/directives/when.js\";import moment from\"moment\";import{OrAssetWidget}from\"../util/or-asset-widget\";import{customElement,state}from\"lit/decorators.js\";import{ChartSettings}from\"../settings/chart-settings\";import\"@openremote/or-chart\";function getDefaultTimePresetOptions(){return new Map([[\"lastHour\",t=>[moment(t).subtract(1,\"hour\").toDate(),t]],[\"last24Hours\",t=>[moment(t).subtract(24,\"hours\").toDate(),t]],[\"last7Days\",t=>[moment(t).subtract(7,\"days\").toDate(),t]],[\"last30Days\",t=>[moment(t).subtract(30,\"days\").toDate(),t]],[\"last90Days\",t=>[moment(t).subtract(90,\"days\").toDate(),t]],[\"last6Months\",t=>[moment(t).subtract(6,\"months\").toDate(),t]],[\"lastYear\",t=>[moment(t).subtract(1,\"year\").toDate(),t]],[\"thisHour\",t=>[moment(t).startOf(\"hour\").toDate(),moment(t).endOf(\"hour\").toDate()]],[\"thisDay\",t=>[moment(t).startOf(\"day\").toDate(),moment(t).endOf(\"day\").toDate()]],[\"thisWeek\",t=>[moment(t).startOf(\"isoWeek\").toDate(),moment(t).endOf(\"isoWeek\").toDate()]],[\"thisMonth\",t=>[moment(t).startOf(\"month\").toDate(),moment(t).endOf(\"month\").toDate()]],[\"thisYear\",t=>[moment(t).startOf(\"year\").toDate(),moment(t).endOf(\"year\").toDate()]],[\"yesterday\",t=>[moment(t).subtract(24,\"hours\").startOf(\"day\").toDate(),moment(t).subtract(24,\"hours\").endOf(\"day\").toDate()]],[\"thisDayLastWeek\",t=>[moment(t).subtract(1,\"week\").startOf(\"day\").toDate(),moment(t).subtract(1,\"week\").endOf(\"day\").toDate()]],[\"previousWeek\",t=>[moment(t).subtract(1,\"week\").startOf(\"isoWeek\").toDate(),moment(t).subtract(1,\"week\").endOf(\"isoWeek\").toDate()]],[\"previousMonth\",t=>[moment(t).subtract(1,\"month\").startOf(\"month\").toDate(),moment(t).subtract(1,\"month\").endOf(\"month\").toDate()]],[\"previousYear\",t=>[moment(t).subtract(1,\"year\").startOf(\"year\").toDate(),moment(t).subtract(1,\"year\").endOf(\"year\").toDate()]]])}function getDefaultSamplingOptions(){return new Map([[\"lttb\",\"lttb\"],[\"withInterval\",\"interval\"]])}function getDefaultWidgetConfig(){const t=\"last24Hours\",e=getDefaultTimePresetOptions().get(t)(new Date);return{attributeRefs:[],rightAxisAttributes:[],datapointQuery:{type:\"lttb\",fromTimestamp:e[0].getTime(),toTimestamp:e[1].getTime()},chartOptions:{options:{scales:{y:{min:void 0,max:void 0},y1:{min:void 0,max:void 0}}}},showTimestampControls:!1,defaultTimePresetKey:t,showLegend:!0}}let ChartWidget=ChartWidget_1=class extends OrAssetWidget{static getManifest(){return{displayName:\"Line Chart\",displayIcon:\"chart-line\",minColumnWidth:2,minColumnHeight:2,getContentHtml:t=>new ChartWidget_1(t),getSettingsHtml(t){const e=new ChartSettings(t);return e.setTimePresetOptions(getDefaultTimePresetOptions()),e.setSamplingOptions(getDefaultSamplingOptions()),e},getDefaultConfig:()=>getDefaultWidgetConfig()}}refreshContent(t){if(t)this.widgetConfig=JSON.parse(JSON.stringify(this.widgetConfig));else{const t=JSON.parse(JSON.stringify(this.widgetConfig.datapointQuery));t.fromTimestamp=void 0,t.toTimestamp=void 0,this.datapointQuery=t}}willUpdate(t){return this.widgetConfig.datapointQuery||(this.widgetConfig.datapointQuery=this.getDefaultQuery(),t.has(\"widgetConfig\")||t.set(\"widgetConfig\",this.widgetConfig)),t.has(\"widgetConfig\")&&this.widgetConfig&&(this.datapointQuery=this.widgetConfig.datapointQuery),super.willUpdate(t)}updated(t){if(super.updated(t),t.has(\"widgetConfig\")&&this.widgetConfig){const t=this.widgetConfig.attributeRefs;(null==t?void 0:t.filter((t=>!this.isAttributeRefLoaded(t)))).length>0&&this.fetchAssets(t).then((e=>{this.loadedAssets=e,this.assetAttributes=null==t?void 0:t.map((t=>{const i=e.findIndex((e=>e.id===t.id)),s=i>=0?e[i]:void 0;return s&&s.attributes?[i,s.attributes[t.name]]:void 0})).filter((t=>!!t))}))}return super.updated(t)}render(){return html`\n            ${when(this.loadedAssets&&this.assetAttributes&&this.loadedAssets.length>0&&this.assetAttributes.length>0,(()=>{var t,e,i,s,o;return html`\n                    <or-chart .assets=\"${this.loadedAssets}\" .assetAttributes=\"${this.assetAttributes}\" .rightAxisAttributes=\"${this.widgetConfig.rightAxisAttributes}\"\n                              .showLegend=\"${null==(null===(t=this.widgetConfig)||void 0===t?void 0:t.showLegend)||(null===(e=this.widgetConfig)||void 0===e?void 0:e.showLegend)}\"\n                              .attributeControls=\"${!1}\" .timestampControls=\"${!(null===(i=this.widgetConfig)||void 0===i?void 0:i.showTimestampControls)}\"\n                              .timePresetOptions=\"${getDefaultTimePresetOptions()}\" .timePresetKey=\"${null===(s=this.widgetConfig)||void 0===s?void 0:s.defaultTimePresetKey}\"\n                              .datapointQuery=\"${this.datapointQuery}\" .chartOptions=\"${null===(o=this.widgetConfig)||void 0===o?void 0:o.chartOptions}\"\n                              style=\"height: 100%\"\n                    ></or-chart>\n                `}),(()=>html`\n                    <div style=\"height: 100%; display: flex; justify-content: center; align-items: center;\">\n                        <span><or-translate value=\"noAttributesConnected\"></or-translate></span>\n                    </div>\n                `))}\n        `}getDefaultQuery(){return{type:\"lttb\",fromTimestamp:moment().set(\"minute\",-60).toDate().getTime(),toTimestamp:moment().set(\"minute\",60).toDate().getTime()}}};__decorate([state()],ChartWidget.prototype,\"datapointQuery\",void 0),ChartWidget=ChartWidget_1=__decorate([customElement(\"chart-widget\")],ChartWidget);export{ChartWidget};","var __decorate=this&&this.__decorate||function(t,e,i,n){var a,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var l=t.length-1;l>=0;l--)(a=t[l])&&(o=(s<3?a(o):s>3?a(e,i,o):a(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o};import{html}from\"lit\";import{customElement}from\"lit/decorators.js\";import{WidgetSettings}from\"../util/widget-settings\";import{i18next}from\"@openremote/or-translate\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";let GaugeSettings=class extends WidgetSettings{render(){return html`\n            <div>\n                <!-- Attribute selection -->\n                <settings-panel displayName=\"attributes\" expanded=\"${!0}\">\n                    <attributes-panel .attributeRefs=\"${this.widgetConfig.attributeRefs}\" .attributeFilter=\"${t=>[\"positiveInteger\",\"positiveNumber\",\"number\",\"long\",\"integer\",\"bigInteger\",\"negativeInteger\",\"negativeNumber\",\"bigNumber\",\"integerByte\",\"direction\"].includes(t.type)}\" style=\"padding-bottom: 12px;\"\n                                      @attribute-select=\"${t=>this.onAttributesSelect(t)}\"\n                    ></attributes-panel>\n                </settings-panel>\n                \n                <!-- Min/max and decimals options-->\n                <settings-panel displayName=\"values\" expanded=\"${!0}\">\n                    <div style=\"padding-bottom: 12px; display: flex; flex-direction: column; gap: 12px;\">\n                        <div style=\"display: flex; gap: 8px;\">\n                            <or-mwc-input .type=\"${InputType.NUMBER}\" label=\"${i18next.t(\"min\")}\" .max=\"${this.widgetConfig.max}\" .value=\"${this.widgetConfig.min}\"\n                                          @or-mwc-input-changed=\"${t=>this.onMinMaxValueChange(\"min\",t)}\"\n                            ></or-mwc-input>\n                            <or-mwc-input .type=\"${InputType.NUMBER}\" label=\"${i18next.t(\"max\")}\" .min=\"${this.widgetConfig.min}\" .value=\"${this.widgetConfig.max}\"\n                                          @or-mwc-input-changed=\"${t=>this.onMinMaxValueChange(\"max\",t)}\"\n                            ></or-mwc-input>\n                        </div>\n                        <div>\n                            <or-mwc-input .type=\"${InputType.NUMBER}\" style=\"width: 100%;\" .value=\"${this.widgetConfig.decimals}\" label=\"${i18next.t(\"decimals\")}\" .min=\"${0}\"\n                                          @or-mwc-input-changed=\"${t=>this.onDecimalsChange(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                    </div>\n                </settings-panel>\n                \n                <!-- Thresholds panel -->\n                <settings-panel displayName=\"thresholds\" expanded=\"${!0}\">\n                    <thresholds-panel .thresholds=\"${this.widgetConfig.thresholds}\" .valueType=\"${\"number\"}\" style=\"padding-bottom: 12px;\"\n                                      .min=\"${this.widgetConfig.min}\" .max=\"${this.widgetConfig.max}\"\n                                      @threshold-change=\"${t=>this.onThresholdChange(t)}\">\n                    </thresholds-panel>\n                </settings-panel>\n            </div>\n        `}onAttributesSelect(t){if(this.widgetConfig.attributeRefs=t.detail.attributeRefs,1===t.detail.attributeRefs.length){const e=t.detail.attributeRefs[0],i=t.detail.assets.find((t=>t.id===e.id));this.setDisplayName(i?`${i.name} - ${e.name}`:`${e.name}`)}this.notifyConfigUpdate()}onMinMaxValueChange(t,e){switch(t){case\"max\":this.widgetConfig.max=e.detail.value,this.widgetConfig.thresholds.sort(((t,e)=>e[0]-t[0])).forEach(((t,i)=>{t[0]=Math.max(Math.min(t[0],e.detail.value-i-1),this.widgetConfig.min)}));break;case\"min\":{this.widgetConfig.min=e.detail.value;const t=this.widgetConfig.thresholds.sort(((t,e)=>t[0]<e[0]?-1:1));t[0][0]=e.detail.value,t.forEach(((t,i)=>{t[0]=Math.min(Math.max(t[0],e.detail.value+i),this.widgetConfig.max)}));break}}this.notifyConfigUpdate()}onDecimalsChange(t){this.widgetConfig.decimals=t.detail.value,this.notifyConfigUpdate()}onThresholdChange(t){this.widgetConfig.thresholds=t.detail,this.notifyConfigUpdate()}};GaugeSettings=__decorate([customElement(\"gauge-settings\")],GaugeSettings);export{GaugeSettings};","var GaugeWidget_1,__decorate=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,a=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var g=t.length-1;g>=0;g--)(n=t[g])&&(a=(r<3?n(a):r>3?n(e,i,a):n(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a};import{html}from\"lit\";import{customElement}from\"lit/decorators.js\";import{OrAssetWidget}from\"../util/or-asset-widget\";import{GaugeSettings}from\"../settings/gauge-settings\";import{when}from\"lit/directives/when.js\";import\"@openremote/or-gauge\";function getDefaultWidgetConfig(){return{attributeRefs:[],thresholds:[[0,\"#4caf50\"],[75,\"#ff9800\"],[90,\"#ef5350\"]],decimals:0,min:0,max:100,valueType:\"number\"}}let GaugeWidget=GaugeWidget_1=class extends OrAssetWidget{static getManifest(){return{displayName:\"Gauge\",displayIcon:\"gauge\",minColumnWidth:1,minColumnHeight:1,getContentHtml:t=>new GaugeWidget_1(t),getSettingsHtml:t=>new GaugeSettings(t),getDefaultConfig:()=>getDefaultWidgetConfig()}}refreshContent(t){this.loadAssets(this.widgetConfig.attributeRefs)}updated(t){if(super.updated(t),t.has(\"widgetConfig\")&&this.widgetConfig){const t=this.widgetConfig.attributeRefs,e=null==t?void 0:t.filter((t=>this.isAttributeRefLoaded(t)));(null==e?void 0:e.length)!==(t?t.length:0)&&this.loadAssets(t)}return super.updated(t)}loadAssets(t){this.fetchAssets(t).then((e=>{this.loadedAssets=e,this.assetAttributes=null==t?void 0:t.map((t=>{const i=e.findIndex((e=>e.id===t.id)),s=i>=0?e[i]:void 0;return s&&s.attributes?[i,s.attributes[t.name]]:void 0})).filter((t=>!!t))}))}render(){return html`\n            ${when(this.loadedAssets&&this.assetAttributes&&this.loadedAssets.length>0&&this.assetAttributes.length>0,(()=>html`\n                    <or-gauge .asset=\"${this.loadedAssets[0]}\" .assetAttribute=\"${this.assetAttributes[0]}\" .thresholds=\"${this.widgetConfig.thresholds}\"\n                              .decimals=\"${this.widgetConfig.decimals}\" .min=\"${this.widgetConfig.min}\" .max=\"${this.widgetConfig.max}\"\n                              style=\"height: 100%; overflow: hidden;\">\n                    </or-gauge>\n                `),(()=>html`\n                    <div style=\"height: 100%; display: flex; justify-content: center; align-items: center;\">\n                        <span><or-translate value=\"noAttributeConnected\"></or-translate></span>\n                    </div>\n                `))}\n        `}};GaugeWidget=GaugeWidget_1=__decorate([customElement(\"gauge-widget\")],GaugeWidget);export{GaugeWidget};","var __decorate=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,a=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(a=(r<3?n(a):r>3?n(e,i,a):n(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a};import{css,html}from\"lit\";import{customElement}from\"lit/decorators.js\";import{i18next}from\"@openremote/or-translate\";import{AssetModelUtil}from\"@openremote/model\";import{map}from\"lit/directives/map.js\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{Util}from\"@openremote/core\";import{when}from\"lit/directives/when.js\";import{AssetWidgetSettings}from\"../util/or-asset-widget\";const styling=css`\n  #marker-container {\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n  }\n`;let ImageSettings=class extends AssetWidgetSettings{static get styles(){return[...super.styles,styling]}willUpdate(t){super.willUpdate(t),t.has(\"widgetConfig\")&&this.widgetConfig&&(this.updateCoordinateMap(this.widgetConfig),this.loadAssets())}loadAssets(){this.widgetConfig.attributeRefs.filter((t=>!this.isAttributeRefLoaded(t))).length>0&&this.fetchAssets(this.widgetConfig.attributeRefs).then((t=>{this.loadedAssets=void 0===t?[]:t}))}render(){return html`\n            <div>\n                <!-- Attributes selector -->\n                <settings-panel displayName=\"attributes\" expanded=\"${!0}\">\n                    <attributes-panel .attributeRefs=\"${this.widgetConfig.attributeRefs}\" onlyDataAttrs=\"${!1}\" multi=\"${!0}\"\n                                      @attribute-select=\"${t=>this.onAttributesSelect(t)}\"\n                    ></attributes-panel>\n                </settings-panel>\n                \n                <!-- Marker coordinates -->\n                <settings-panel displayName=\"dashboard.markerCoordinates\" expanded=\"${!0}\">\n                    <div style=\"display: flex; flex-direction: column; gap: 8px;\">\n                        ${map(this.draftCoordinateEntries(this.widgetConfig),(t=>t))}\n                    </div>\n                </settings-panel>\n                \n                <!-- Image settings -->\n                <settings-panel displayName=\"dashboard.imageSettings\" expanded=\"${!0}\">\n                    <div>\n                        <or-mwc-input style=\"width: 100%;\" type=\"${InputType.TEXT}\" label=\"${i18next.t(\"dashboard.imageUrl\")}\" .value=\"${this.widgetConfig.imagePath}\"\n                                      @or-mwc-input-changed=\"${t=>this.onImageUrlUpdate(t)}\"\n                        ></or-mwc-input>\n                    </div>\n                </settings-panel>\n            </div>\n        `}onAttributesSelect(t){this.widgetConfig.attributeRefs=t.detail.attributeRefs,this.notifyConfigUpdate()}onImageUrlUpdate(t){this.widgetConfig.imagePath=t.detail.value,this.notifyConfigUpdate()}updateCoordinateMap(t){for(let e=0;e<t.attributeRefs.length;e++){const i=t.attributeRefs[e];if(void 0===i)return void console.error(\"attributeRef is undefined\");-1===t.markers.findIndex((t=>t.attributeRef.id===i.id&&t.attributeRef.name===i.name))&&t.markers.push({attributeRef:i,coordinates:[50,50]})}}draftCoordinateEntries(t){return t.markers.length>0?t.attributeRefs.map((e=>{var i,s,n;const r=t.markers.find((t=>t.attributeRef.id===e.id&&t.attributeRef.name===e.name));if(void 0===r)return console.error(\"A marker could not be found during drafting coordinate entries.\"),html``;const a=t.markers.indexOf(r),o=r.coordinates,d=null===(i=this.loadedAssets)||void 0===i?void 0:i.find((t=>t.id===e.id));let l;if(d){const t=d.attributes[e.name],i=AssetModelUtil.getAttributeAndValueDescriptors(d.type,e.name,t);l=Util.getAttributeLabel(t,i[0],d.type,!1)}return html`\n                    <div id=\"marker-container\">\n                        <div style=\"flex: 1; display: flex; flex-direction: column;\">\n                            <span>${null===(n=null===(s=this.loadedAssets)||void 0===s?void 0:s.find((t=>t.id===e.id)))||void 0===n?void 0:n.name}</span>\n                            ${when(l,(()=>html`\n                                <span style=\"color: gray;\">${l}</span>\n                            `))}\n                        </div>\n                        <div style=\"display: flex; gap: 8px;\">\n                            <or-mwc-input .disableSliderNumberInput=\"${!0}\" compact style=\"max-width: 64px;\"\n                                          .type=\"${InputType.NUMBER}\" .min=\"${0}\" .max=\"${100}\" .value=\"${o[0]}\"\n                                          @or-mwc-input-changed=\"${t=>this.onCoordinateUpdate(a,\"x\",t.detail.value)}\"\n                            ></or-mwc-input>\n\n                            <or-mwc-input .disableSliderNumberInput=\"${!0}\" compact style=\"max-width: 64px;\"\n                                          .type=\"${InputType.NUMBER}\" .min=\"${0}\" .max=\"${100}\" .value=\"${o[1]}\"\n                                          @or-mwc-input-changed=\"${t=>this.onCoordinateUpdate(a,\"y\",t.detail.value)}\"\n                            ></or-mwc-input>\n                        </div>\n                    </div>\n                `})):[html`<span><or-translate value=\"noAttributeConnected\"></or-translate></span>`]}onCoordinateUpdate(t,e,i){let s=this.widgetConfig.markers[t].coordinates;s||(s=[0,0]),\"x\"===e?s[0]=i:\"y\"===e&&(s[1]=i),this.widgetConfig.markers[t].coordinates=s,this.notifyConfigUpdate()}};ImageSettings=__decorate([customElement(\"image-settings\")],ImageSettings);export{ImageSettings};","var ImageWidget_1,__decorate=this&&this.__decorate||function(t,e,i,r){var s,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var n=t.length-1;n>=0;n--)(s=t[n])&&(a=(o<3?s(a):o>3?s(e,i,a):s(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a};import{AssetModelUtil}from\"@openremote/model\";import{customElement}from\"lit/decorators.js\";import{css,html,unsafeCSS}from\"lit\";import{OrAssetWidget}from\"../util/or-asset-widget\";import{ImageSettings}from\"../settings/image-settings\";import{when}from\"lit/directives/when.js\";import{DefaultColor2,DefaultColor3,Util}from\"@openremote/core\";import{styleMap}from\"lit/directives/style-map.js\";const styling=css`\n  #img-wrapper {\n    height: 100%;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    overflow: hidden;\n    z-index: 1;\n  }\n\n  #img-container {\n    position: relative;\n    max-height: 100%;\n  }\n\n  #img-content {\n    height: 100%;\n    max-height: 100%;\n    max-width: 100%;\n  }\n\n  #overlay {\n    position: absolute;\n    z-index: 3;\n\n    /* additional marker styling */\n    color: var(--or-app-color2, ${unsafeCSS(DefaultColor2)});\n    background-color: var(--or-app-color3, ${unsafeCSS(DefaultColor3)});\n    border-radius: 15px;\n    padding: 3px 8px 5px 8px;\n    object-fit: contain;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n`;function getDefaultWidgetConfig(){return{attributeRefs:[],showTimestampControls:!1,imagePath:\"\",markers:[]}}let ImageWidget=ImageWidget_1=class extends OrAssetWidget{static getManifest(){return{displayName:\"Image\",displayIcon:\"file-image-marker\",minColumnWidth:1,minColumnHeight:1,getContentHtml:t=>new ImageWidget_1(t),getSettingsHtml:t=>new ImageSettings(t),getDefaultConfig:()=>getDefaultWidgetConfig()}}refreshContent(t){this.loadAssets()}static get styles(){return[...super.styles,styling]}updated(t){if(t.has(\"widgetConfig\")&&this.widgetConfig){const t=this.widgetConfig.attributeRefs;(null==t?void 0:t.filter((t=>!this.isAttributeRefLoaded(t)))).length>0&&this.loadAssets()}}loadAssets(){this.fetchAssets(this.widgetConfig.attributeRefs).then((t=>{this.loadedAssets=t,this.assetAttributes=this.widgetConfig.attributeRefs.map((e=>{const i=t.findIndex((t=>t.id===e.id)),r=i>=0?t[i]:void 0;return r&&r.attributes?[i,r.attributes[e.name]]:void 0})).filter((t=>!!t))}))}handleMarkerPlacement(t){if(this.assetAttributes.length&&t.attributeRefs.length>0)return 0===t.markers.length?(console.error(\"No markers found!\"),[]):t.attributeRefs.map(((e,i)=>{const r=t.markers.find((t=>t.attributeRef.id===e.id&&t.attributeRef.name===e.name)),s=this.loadedAssets.find((t=>t.id===e.id));let o;const a={left:`${r.coordinates[0]}%`,top:`${r.coordinates[1]}%`};if(s){const t=s.attributes[e.name],i=AssetModelUtil.getAttributeAndValueDescriptors(s.type,e.name,t);o=Util.getAttributeValueAsString(t,i[0],s.type,!0,\"-\"),\"colourRGB\"===(null==t?void 0:t.type)&&\"-\"!==o&&(a.backgroundColor=o,a.minHeight=\"21px\",a.minWidth=\"13px\",o=void 0)}return html`\n                    <span id=\"overlay\" style=\"${styleMap(a)}\">\n                        ${o}\n                    </span>\n                `}))}render(){const t=this.widgetConfig.imagePath;return html`\n            <div id=\"img-wrapper\">\n                ${when(t,(()=>html`\n                    <div id=\"img-container\">\n                        <img id=\"img-content\" src=\"${t}\" alt=\"\"/>\n                        <div>\n                            ${this.handleMarkerPlacement(this.widgetConfig)}\n                        </div>\n                    </div>\n                `),(()=>html`\n                    <span><or-translate value=\"dashboard.noImageSelected\"></or-translate></span>\n                `))}\n            </div>\n        `}};ImageWidget=ImageWidget_1=__decorate([customElement(\"image-widget\")],ImageWidget);export{ImageWidget};","var __decorate=this&&this.__decorate||function(t,e,i,n){var s,a=arguments.length,o=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(o=(a<3?s(o):a>3?s(e,i,o):s(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o};import{css,html}from\"lit\";import{customElement}from\"lit/decorators.js\";import{AssetWidgetSettings}from\"../util/or-asset-widget\";import{i18next}from\"@openremote/or-translate\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";const styling=css`\n  .switchMwcInputContainer {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n`;let KpiSettings=class extends AssetWidgetSettings{static get styles(){return[...super.styles,styling]}render(){return html`\n            <div>\n                <!-- Attribute selector -->\n                <settings-panel displayName=\"attributes\" expanded=\"${!0}\">\n                    <attributes-panel .attributeRefs=\"${this.widgetConfig.attributeRefs}\" onlyDataAttrs=\"${!1}\" .attributeFilter=\"${t=>[\"positiveInteger\",\"positiveNumber\",\"number\",\"long\",\"integer\",\"bigInteger\",\"negativeInteger\",\"negativeNumber\",\"bigNumber\",\"integerByte\",\"direction\"].includes(t.type)}\" style=\"padding-bottom: 12px;\"\n                                      @attribute-select=\"${t=>this.onAttributesSelect(t)}\"\n                    ></attributes-panel>\n                </settings-panel>\n\n                <!-- Display settings -->\n                <settings-panel displayName=\"display\" expanded=\"${!0}\">\n                    <div style=\"display: flex; flex-direction: column; gap: 8px;\">\n                        <or-mwc-input .type=\"${InputType.SELECT}\" style=\"width: 100%;\"\n                                      .options=\"${[\"year\",\"month\",\"week\",\"day\",\"hour\"]}\"\n                                      .value=\"${this.widgetConfig.period}\" label=\"${i18next.t(\"timeframe\")}\"\n                                      @or-mwc-input-changed=\"${t=>this.onTimeframeSelect(t)}\"\n                        ></or-mwc-input>\n                        <div class=\"switchMwcInputContainer\">\n                            <span><or-translate value=\"dashboard.allowTimerangeSelect\"></or-translate></span>\n                            <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"margin: 0 -10px;\" .value=\"${this.widgetConfig.showTimestampControls}\"\n                                          @or-mwc-input-changed=\"${t=>this.onTimeframeToggle(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                    </div>\n                </settings-panel>\n\n                <settings-panel displayName=\"values\" expanded=\"${!0}\">\n                    <div style=\"display: flex; flex-direction: column; gap: 8px;\">\n                        <or-mwc-input .type=\"${InputType.SELECT}\" style=\"width: 100%;\" .options=\"${[\"absolute\",\"percentage\"]}\" .value=\"${this.widgetConfig.deltaFormat}\"\n                                      label=\"${i18next.t(\"dashboard.showValueAs\")}\"\n                                      @or-mwc-input-changed=\"${t=>this.onDeltaFormatSelect(t)}\"\n                        ></or-mwc-input>\n                        <or-mwc-input .type=\"${InputType.NUMBER}\" style=\"width: 100%;\" .value=\"${this.widgetConfig.decimals}\" label=\"${i18next.t(\"decimals\")}\"\n                                      @or-mwc-input-changed=\"${t=>this.onDecimalsChange(t)}\"\n                        ></or-mwc-input>\n                    </div>\n                </settings-panel>\n\n                <!-- -->\n            </div>\n        `}onAttributesSelect(t){if(this.widgetConfig.attributeRefs=t.detail.attributeRefs,1===t.detail.attributeRefs.length){const e=t.detail.attributeRefs[0],i=t.detail.assets.find((t=>t.id===e.id));this.setDisplayName(i?`${i.name} - ${e.name}`:`${e.name}`)}this.notifyConfigUpdate()}onTimeframeSelect(t){this.widgetConfig.period=t.detail.value,this.notifyConfigUpdate()}onTimeframeToggle(t){this.widgetConfig.showTimestampControls=t.detail.value,this.notifyConfigUpdate()}onDeltaFormatSelect(t){this.widgetConfig.deltaFormat=t.detail.value,this.notifyConfigUpdate()}onDecimalsChange(t){this.widgetConfig.decimals=t.detail.value,this.notifyConfigUpdate()}};KpiSettings=__decorate([customElement(\"kpi-settings\")],KpiSettings);export{KpiSettings};","var KpiWidget_1,__decorate=this&&this.__decorate||function(t,e,i,s){var o,r=arguments.length,d=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)d=Reflect.decorate(t,e,i,s);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(d=(r<3?o(d):r>3?o(e,i,d):o(e,i))||d);return r>3&&d&&Object.defineProperty(e,i,d),d};import{customElement}from\"lit/decorators.js\";import{OrAssetWidget}from\"../util/or-asset-widget\";import{html}from\"lit\";import{KpiSettings}from\"../settings/kpi-settings\";import\"@openremote/or-attribute-card\";function getDefaultWidgetConfig(){return{attributeRefs:[],period:\"day\",decimals:0,deltaFormat:\"absolute\",showTimestampControls:!1}}let KpiWidget=KpiWidget_1=class extends OrAssetWidget{static getManifest(){return{displayName:\"KPI\",displayIcon:\"label\",minColumnWidth:1,minColumnHeight:1,getContentHtml:t=>new KpiWidget_1(t),getSettingsHtml:t=>new KpiSettings(t),getDefaultConfig:()=>getDefaultWidgetConfig()}}refreshContent(t){this.loadAssets(this.widgetConfig.attributeRefs)}updated(t){if(super.updated(t),t.has(\"widgetConfig\")&&this.widgetConfig){const t=this.widgetConfig.attributeRefs,e=null==t?void 0:t.filter((t=>this.isAttributeRefLoaded(t)));(null==e?void 0:e.length)!==(t?t.length:0)&&this.loadAssets(t)}return super.updated(t)}loadAssets(t){this.fetchAssets(t).then((e=>{this.loadedAssets=e,this.assetAttributes=null==t?void 0:t.map((t=>{const i=e.findIndex((e=>e.id===t.id)),s=i>=0?e[i]:void 0;return s&&s.attributes?[i,s.attributes[t.name]]:void 0})).filter((t=>!!t))}))}render(){var t;return html`\n            <div style=\"height: 100%; overflow: hidden;\">\n                <or-attribute-card .assets=\"${this.loadedAssets}\" .assetAttributes=\"${this.assetAttributes}\" .period=\"${this.widgetConfig.period}\"\n                                   .deltaFormat=\"${this.widgetConfig.deltaFormat}\" .mainValueDecimals=\"${this.widgetConfig.decimals}\"\n                                   showControls=\"${null===(t=this.widgetConfig)||void 0===t?void 0:t.showTimestampControls}\" showTitle=\"${!1}\" style=\"height: 100%;\">\n                </or-attribute-card>\n            </div>\n        `}};KpiWidget=KpiWidget_1=__decorate([customElement(\"kpi-widget\")],KpiWidget);export{KpiWidget};","var __decorate=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n},__awaiter=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(o,r){function n(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};import{css,html,LitElement}from\"lit\";import{customElement,property,state}from\"lit/decorators.js\";import{AssetModelUtil}from\"@openremote/model\";import{getContentWithMenuTemplate}from\"@openremote/or-mwc-components/or-mwc-menu\";import{i18next}from\"@openremote/or-translate\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import manager,{Util}from\"@openremote/core\";import{when}from\"lit/directives/when.js\";import{createRef,ref}from\"lit/directives/ref.js\";import{OrMwcDialog,showDialog}from\"@openremote/or-mwc-components/or-mwc-dialog\";export class AssetTypeSelectEvent extends CustomEvent{constructor(e){super(AssetTypeSelectEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}AssetTypeSelectEvent.NAME=\"assettype-select\";export class AssetIdsSelectEvent extends CustomEvent{constructor(e){super(AssetIdsSelectEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}AssetIdsSelectEvent.NAME=\"assetids-select\";export class AttributeNamesSelectEvent extends CustomEvent{constructor(e){super(AttributeNamesSelectEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}AttributeNamesSelectEvent.NAME=\"attributenames-select\";const styling=css`\n  .switchMwcInputContainer {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n`;let AssettypesPanel=class extends LitElement{constructor(){super(...arguments),this.config={attributes:{enabled:!0}},this._attributeSelectList=[],this._loadedAssetTypes=AssetModelUtil.getAssetDescriptors().filter((e=>\"asset\"===e.descriptorType)),this.assetTreeDataProvider=()=>__awaiter(this,void 0,void 0,(function*(){const e={realm:{name:manager.displayRealm},select:{attributes:[]}},t=(yield manager.rest.api.AssetResource.queryAssets(e)).data,s=t.filter((e=>e.type===this.assetType)).map((e=>e.path)),i=[...new Set([].concat(...s))];return t.filter((e=>i.includes(e.id)))}))}static get styles(){return[styling]}willUpdate(e){super.willUpdate(e),e.has(\"assetType\")&&this.assetType&&(this._attributeSelectList=this.getAttributesByType(this.assetType),this.dispatchEvent(new AssetTypeSelectEvent(this.assetType))),e.has(\"assetIds\")&&this.assetIds&&this.dispatchEvent(new AssetIdsSelectEvent(this.assetIds)),e.has(\"attributeNames\")&&this.attributeNames&&this.dispatchEvent(new AttributeNamesSelectEvent(this.attributeNames))}render(){var e,t;return html`\n            <div style=\"display: flex; flex-direction: column; gap: 8px;\">\n\n                <!-- Select asset type -->\n                <div>\n                    ${this._loadedAssetTypes.length>0?getContentWithMenuTemplate(this.getAssetTypeTemplate(),this.mapDescriptors(this._loadedAssetTypes,{text:i18next.t(\"filter.assetTypeMenuNone\"),value:\"\",icon:\"selection-ellipse\"}),void 0,(e=>{this.assetType=e}),void 0,!1,!0,!0,!0):html``}\n                </div>\n\n                <!-- Select one or more assets -->\n                ${when(null===(e=this.config.assets)||void 0===e?void 0:e.enabled,(()=>{var e;const t=\"string\"==typeof this.assetIds?[this.assetIds]:this.assetIds;return html`\n                        <div>\n                            <or-mwc-input .type=\"${InputType.BUTTON}\" .label=\"${((null===(e=this.assetIds)||void 0===e?void 0:e.length)||0)+\" \"+i18next.t(\"assets\")}\" .disabled=\"${!this.assetType}\" fullWidth outlined comfortable style=\"width: 100%;\"\n                                          @or-mwc-input-changed=\"${e=>{var s;return this._openAssetSelector(this.assetType,t,null===(s=this.config.assets)||void 0===s?void 0:s.multi)}}\"\n                            ></or-mwc-input>\n                        </div>\n                    `}))}\n\n                <!-- Select one or more attributes -->\n                ${when(null===(t=this.config.attributes)||void 0===t?void 0:t.enabled,(()=>{var e;const t=this._attributeSelectList.map((e=>[e[0],e[1]]));return html`\n                        <div>\n                            <or-mwc-input .type=\"${InputType.SELECT}\" label=\"${i18next.t(\"filter.attributeLabel\")}\" .disabled=\"${!this.assetType}\" style=\"width: 100%;\"\n                                          .options=\"${t}\" .searchProvider=\"${e=>__awaiter(this,void 0,void 0,(function*(){return e?t.filter((t=>t[1].toLowerCase().includes(e.toLowerCase()))):t}))}\" .multiple=\"${null===(e=this.config.attributes)||void 0===e?void 0:e.multi}\" .value=\"${this.attributeNames}\"\n                                          @or-mwc-input-changed=\"${e=>{this.attributeNames=e.detail.value}}\"\n                            ></or-mwc-input>\n                        </div>\n                    `}))}\n            </div>\n        `}getAssetTypeTemplate(){if(this.assetType){const e=this._loadedAssetTypes.find((e=>e.name===this.assetType));return e?this.getSelectedHeader(e):this.getSelectHeader()}return this.getSelectHeader()}getSelectHeader(){return html`\n            <or-mwc-input style=\"width:100%;\" type=\"${InputType.TEXT}\" readonly .label=\"${i18next.t(\"filter.assetTypeLabel\")}\"\n                          iconTrailing=\"menu-down\" iconColor=\"rgba(0, 0, 0, 0.87)\" icon=\"selection-ellipse\"\n                          value=\"${i18next.t(\"filter.assetTypeNone\")}\">\n            </or-mwc-input>\n        `}getSelectedHeader(e){return html`\n            <or-mwc-input style=\"width:100%;\" type=\"${InputType.TEXT}\" readonly .label=\"${i18next.t(\"filter.assetTypeLabel\")}\"\n                          .iconColor=\"${e.colour}\" iconTrailing=\"menu-down\" icon=\"${e.icon}\"\n                          value=\"${Util.getAssetTypeLabel(e)}\">\n            </or-mwc-input>\n        `}mapDescriptors(e,t){const s=e.map((e=>({styleMap:{\"--or-icon-fill\":e.colour?\"#\"+e.colour:\"unset\"},icon:e.icon,text:Util.getAssetTypeLabel(e),value:e.name,data:e}))).sort(Util.sortByString((e=>e.text)));return t&&s.splice(0,0,t),s}getAttributesByType(e){var t;const s=AssetModelUtil.getAssetDescriptor(e);if(s){const i=AssetModelUtil.getAssetTypeInfo(s);if(null==i?void 0:i.attributeDescriptors){const s=null===(t=this.config.attributes)||void 0===t?void 0:t.valueTypes;return(s?i.attributeDescriptors.filter((e=>s.indexOf(e.type)>-1)):i.attributeDescriptors).map((t=>{const s=Util.getAttributeLabel(t,void 0,e,!1);return[t.name,s]})).sort(Util.sortByString((e=>e[1])))}}}_openAssetSelector(e,t,s=!1){const i=createRef(),o={select:{types:[e],multiSelect:s}};showDialog((new OrMwcDialog).setHeading(i18next.t(\"linkedAssets\")).setContent(html`\n                <div style=\"width: 400px;\">\n                    <or-asset-tree ${ref(i)} .dataProvider=\"${this.assetTreeDataProvider}\" expandAllNodes\n                                   id=\"chart-asset-tree\" readonly .config=\"${o}\" .selectedIds=\"${t}\"\n                                   .showSortBtn=\"${!1}\" .showFilter=\"${!1}\" .checkboxes=\"${s}\"\n                    ></or-asset-tree>\n                </div>\n            `).setActions([{default:!0,actionName:\"cancel\",content:\"cancel\"},{actionName:\"ok\",content:\"ok\",action:()=>{const e=i.value;(null==e?void 0:e.selectedIds)&&(this.assetIds=s?e.selectedIds:e.selectedIds[0])}}]).setDismissAction({actionName:\"cancel\"}))}};__decorate([property()],AssettypesPanel.prototype,\"assetType\",void 0),__decorate([property()],AssettypesPanel.prototype,\"config\",void 0),__decorate([property()],AssettypesPanel.prototype,\"assetIds\",void 0),__decorate([property()],AssettypesPanel.prototype,\"attributeNames\",void 0),__decorate([state()],AssettypesPanel.prototype,\"_attributeSelectList\",void 0),__decorate([state()],AssettypesPanel.prototype,\"_loadedAssetTypes\",void 0),AssettypesPanel=__decorate([customElement(\"assettypes-panel\")],AssettypesPanel);export{AssettypesPanel};","var __decorate=this&&this.__decorate||function(e,t,o,s){var l,r=arguments.length,i=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,s);else for(var h=e.length-1;h>=0;h--)(l=e[h])&&(i=(r<3?l(i):r>3?l(t,o,i):l(t,o))||i);return r>3&&i&&Object.defineProperty(t,o,i),i};import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{css,html,LitElement,unsafeCSS}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{ifDefined}from\"lit/directives/if-defined.js\";import{DefaultColor5}from\"@openremote/core\";import{style}from\"../style\";export class ThresholdChangeEvent extends CustomEvent{constructor(e){super(ThresholdChangeEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}ThresholdChangeEvent.NAME=\"threshold-change\";export class TextColorsChangeEvent extends CustomEvent{constructor(e){super(TextColorsChangeEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}TextColorsChangeEvent.NAME=\"text-colors-change\";export class BoolColorsChangeEvent extends CustomEvent{constructor(e){super(BoolColorsChangeEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}BoolColorsChangeEvent.NAME=\"bool-colors-change\";const styling=css`\n\n  #thresholds-list {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n  }\n\n  .threshold-list-item {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n  }\n\n  .threshold-list-item-colour {\n    height: 100%;\n    padding: 0 4px 0 0;\n  }\n\n  .threshold-list-item:hover .button-clear {\n    visibility: visible;\n  }\n\n  .button-clear {\n    background: none;\n    visibility: hidden;\n    color: var(--or-app-color5, ${unsafeCSS(DefaultColor5)});\n    --or-icon-fill: var(--or-app-color5, ${unsafeCSS(DefaultColor5)});\n    display: inline-block;\n    border: none;\n    padding: 0;\n    cursor: pointer;\n  }\n\n  .button-clear:hover {\n    --or-icon-fill: var(--or-app-color4);\n  }\n\n`;let ThresholdsPanel=class extends LitElement{constructor(){super(...arguments),this.thresholds=[],this.textColors=[]}static get styles(){return[styling,style]}updated(e){e.has(\"thresholds\")&&this.thresholds&&this.dispatchEvent(new ThresholdChangeEvent(this.thresholds)),e.has(\"textColors\")&&this.textColors&&this.dispatchEvent(new TextColorsChangeEvent(this.textColors)),e.has(\"boolColors\")&&this.boolColors&&this.dispatchEvent(new BoolColorsChangeEvent(this.boolColors))}render(){return html`\n            <div id=\"thresholds-list\" class=\"expanded-panel\">\n\n                <!-- Thresholds by number -->\n                ${\"number\"===this.valueType||\"positiveInteger\"===this.valueType||\"positiveNumber\"===this.valueType||\"negativeInteger\"===this.valueType||\"negativeNumber\"===this.valueType?html`\n                    ${this.thresholds.sort(((e,t)=>e[0]<t[0]?-1:1)).map(((e,t)=>html`\n                            <div class=\"threshold-list-item\">\n                                <div class=\"threshold-list-item-colour\">\n                                    <or-mwc-input type=\"${InputType.COLOUR}\" value=\"${e[1]}\"\n                                                  @or-mwc-input-changed=\"${e=>{this.thresholds[t][1]=e.detail.value,this.requestUpdate(\"thresholds\")}}\"\n                                    ></or-mwc-input>\n                                </div>\n                                <or-mwc-input type=\"${InputType.NUMBER}\" comfortable .value=\"${e[0]}\"\n                                              ?disabled=\"${0===t&&this.max}\"\n                                              .min=\"${ifDefined(this.min)}\" .max=\"${ifDefined(this.max)}\"\n                                              @or-mwc-input-changed=\"${e=>{(!this.min||e.detail.value>=this.min)&&(!this.max||e.detail.value<=this.max)&&(this.thresholds[t][0]=e.detail.value,this.requestUpdate(\"thresholds\"))}}\"\n                                ></or-mwc-input>\n                                ${0===t?html`\n                                    <button class=\"button-clear\"\n                                            style=\"margin-left: 8px;\">\n                                        <or-icon icon=\"lock\" style=\"--or-icon-fill: var(--or-app-color5, ${unsafeCSS(DefaultColor5)});\"></or-icon>\n                                    </button>\n                                `:html`\n                                    <button class=\"button-clear\"\n                                            style=\"margin-left: 8px;\"\n                                            @click=\"${()=>{this.removeThreshold(e)}}\">\n                                        <or-icon icon=\"close-circle\"></or-icon>\n                                    </button>\n                                `}\n                            </div>\n                        `))}\n                    <or-mwc-input .type=\"${InputType.BUTTON}\" label=\"threshold\" icon=\"plus\"\n                                  @or-mwc-input-changed=\"${()=>this.addNewThreshold()}\">\n                    </or-mwc-input>\n                `:null}\n\n                <!-- Thresholds by boolean -->\n                ${\"boolean\"===this.valueType?html`\n                    <div class=\"threshold-list-item\">\n                        <div class=\"threshold-list-item-colour\">\n                            <or-mwc-input type=\"${InputType.COLOUR}\" value=\"${this.boolColors.true}\"\n                                          @or-mwc-input-changed=\"${e=>{this.boolColors.true=e.detail.value,this.requestUpdate(\"boolColors\")}}\"\n                            ></or-mwc-input>\n                        </div>\n                        <or-mwc-input type=\"${InputType.TEXT}\" comfortable .value=\"${\"True\"}\" .readonly=\"${!0}\"\n                        ></or-mwc-input>\n                    </div>\n                    <div class=\"threshold-list-item\">\n                        <div class=\"threshold-list-item-colour\">\n                            <or-mwc-input type=\"${InputType.COLOUR}\" value=\"${this.boolColors.false}\"\n                                          @or-mwc-input-changed=\"${e=>{this.boolColors.false=e.detail.value,this.requestUpdate(\"boolColors\")}}\"\n                            ></or-mwc-input>\n                        </div>\n                        <or-mwc-input type=\"${InputType.TEXT}\" comfortable .value=\"${\"False\"}\" .readonly=\"${!0}\"\n                        ></or-mwc-input>\n                    </div>\n                `:null}\n\n                <!-- Thresholds by string -->\n                ${\"text\"===this.valueType&&this.textColors?html`\n                    ${this.textColors.map(((e,t)=>html`\n                            <div class=\"threshold-list-item\">\n                                <div class=\"threshold-list-item-colour\">\n                                    <or-mwc-input type=\"${InputType.COLOUR}\" value=\"${e[1]}\"\n                                                  @or-mwc-input-changed=\"${e=>{this.textColors[t][1]=e.detail.value,this.requestUpdate(\"textColors\")}}\"\n                                    ></or-mwc-input>\n                                </div>\n                                <or-mwc-input type=\"${InputType.TEXT}\" comfortable .value=\"${e[0]}\"\n                                              @or-mwc-input-changed=\"${e=>{this.textColors[t][0]=e.detail.value,this.requestUpdate(\"textColors\")}}\"\n\n                                ></or-mwc-input>\n                                ${0===t?html`\n                                    <button class=\"button-clear\"\n                                            style=\"margin-left: 8px;\">\n                                        <or-icon icon=\"lock\" style=\"--or-icon-fill: var(--or-app-color5, ${unsafeCSS(DefaultColor5)});\"></or-icon>\n                                    </button>\n                                `:html`\n                                    <button class=\"button-clear\"\n                                            style=\"margin-left: 8px;\"\n                                            @click=\"${()=>{this.removeThreshold(e)}}\">\n                                        <or-icon icon=\"close-circle\"></or-icon>\n                                    </button>\n                                `}\n                            </div>\n                        `))}\n                    <or-mwc-input .type=\"${InputType.BUTTON}\" label=\"threshold\" icon=\"plus\"\n                                  @or-mwc-input-changed=\"${()=>this.addNewThreshold()}\">\n                    </or-mwc-input>\n                `:null}\n            </div>\n        `}removeThreshold(e){\"number\"==typeof e[0]?this.thresholds=this.thresholds.filter((t=>t!==e)):this.textColors=this.textColors.filter((t=>t!==e))}addThreshold(e){\"number\"==typeof e[0]?(this.thresholds.push(e),this.requestUpdate(\"thresholds\")):(this.textColors.push(e),this.requestUpdate(\"textColors\"))}addNewThreshold(){if(\"text\"===this.valueType)this.addThreshold([\"new\",\"#000000\"]);else{const e=this.thresholds[this.thresholds.length-1][0]+10;this.addThreshold([!this.max||e<=this.max?e:this.max,\"#000000\"])}this.updateComplete.then((()=>{var e;const t=null===(e=this.shadowRoot)||void 0===e?void 0:e.getElementById(\"thresholds-list\");Array.from(t.children)[t.children.length-2].children[1].setAttribute(\"focused\",\"true\")}))}};__decorate([property()],ThresholdsPanel.prototype,\"thresholds\",void 0),__decorate([property()],ThresholdsPanel.prototype,\"textColors\",void 0),__decorate([property()],ThresholdsPanel.prototype,\"boolColors\",void 0),__decorate([property()],ThresholdsPanel.prototype,\"min\",void 0),__decorate([property()],ThresholdsPanel.prototype,\"max\",void 0),__decorate([property()],ThresholdsPanel.prototype,\"valueType\",void 0),ThresholdsPanel=__decorate([customElement(\"thresholds-panel\")],ThresholdsPanel);export{ThresholdsPanel};","var __decorate=this&&this.__decorate||function(t,e,i,s){var n,o=arguments.length,a=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{l(s.next(t))}catch(t){o(t)}}function r(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))};import{css,html}from\"lit\";import{customElement}from\"lit/decorators.js\";import{AssetWidgetSettings}from\"../util/or-asset-widget\";import{i18next}from\"@openremote/or-translate\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import\"../panels/assettypes-panel\";import\"../panels/thresholds-panel\";import{LngLat}from\"maplibre-gl\";import{when}from\"lit/directives/when.js\";import manager from\"@openremote/core\";import{showSnackbar}from\"@openremote/or-mwc-components/or-mwc-snackbar\";const styling=css`\n  .switchMwcInputContainer {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n`;let MapSettings=class extends AssetWidgetSettings{static get styles(){return[...super.styles,styling]}render(){return html`\n            <div>\n\n                <!-- Map settings -->\n                <settings-panel displayName=\"configuration.mapSettings\" expanded=\"${!0}\">\n                    <div style=\"display: flex; flex-direction: column; gap: 8px;\">\n                        <div>\n                            <or-mwc-input .type=\"${InputType.NUMBER}\" style=\"width: 100%;\"\n                                          .value=\"${this.widgetConfig.zoom}\" label=\"${i18next.t(\"dashboard.zoom\")}\"\n                                          @or-mwc-input-changed=\"${t=>this.onZoomUpdate(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                        <div style=\"display: flex; gap: 8px;\">\n                            <or-mwc-input .type=\"${InputType.TEXT}\" style=\"width: 100%;\"\n                                          .value=\"${this.widgetConfig.center?Object.values(this.widgetConfig.center)[0]+\", \"+Object.values(this.widgetConfig.center)[1]:void 0}\"\n                                          label=\"${i18next.t(\"dashboard.center\")}\"\n                                          @or-mwc-input-changed=\"${t=>this.onCenterUpdate(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                        <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                            <span><or-translate value=\"dashboard.showGeoJson\"></or-translate></span>\n                            <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"width: 70px;\"\n                                          .value=\"${this.widgetConfig.showGeoJson}\"\n                                          @or-mwc-input-changed=\"${t=>this.onGeoJsonToggle(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                    </div>\n                </settings-panel>\n\n                <!-- Panel where Asset type and the selected attribute can be customized -->\n                <settings-panel displayName=\"attributes\" expanded=\"${!0}\">\n                    <assettypes-panel .assetType=\"${this.widgetConfig.assetType}\" .attributeNames=\"${this.widgetConfig.attributeName}\" .config=\"${{attributes:{enabled:!0,valueTypes:[\"boolean\",\"number\",\"positiveInteger\",\"positiveNumber\",\"negativeInteger\",\"negativeNumber\",\"text\"]}}}\"\n                                      @assettype-select=\"${t=>this.onAssetTypeSelect(t)}\"\n                                      @attributenames-select=\"${t=>this.onAttributeNameSelect(t)}\"\n                    ></assettypes-panel>\n\n                    <!-- Other settings like labels and units-->\n                    <div>\n                        <div class=\"switchMwcInputContainer\">\n                            <span><or-translate value=\"dashboard.showLabels\"></or-translate></span>\n                            <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"width: 70px;\"\n                                          .value=\"${this.widgetConfig.showLabels}\" .disabled=\"${!this.widgetConfig.assetType}\"\n                                          @or-mwc-input-changed=\"${t=>this.onShowLabelsToggle(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                        <div class=\"switchMwcInputContainer\">\n                            <span><or-translate value=\"dashboard.showUnits\"></or-translate></span>\n                            <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"width: 70px;\"\n                                          .value=\"${this.widgetConfig.showUnits}\" .disabled=\"${!this.widgetConfig.showLabels||!this.widgetConfig.assetType}\"\n                                          @or-mwc-input-changed=\"${t=>this.onShowUnitsToggle(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                    </div>\n                </settings-panel>\n\n                <!-- List of customizable thresholds -->\n                ${when(this.widgetConfig.assetIds.length>0,(()=>html`\n                    <settings-panel displayName=\"thresholds\" expanded=\"${!0}\">\n                        <thresholds-panel .thresholds=\"${this.widgetConfig.thresholds}\" .valueType=\"${this.widgetConfig.valueType}\" style=\"padding-bottom: 12px;\"\n                                          .min=\"${this.widgetConfig.min}\" .max=\"${this.widgetConfig.max}\"\n                                          @threshold-change=\"${t=>this.onThresholdsChange(t)}\">\n                        </thresholds-panel>\n                    </settings-panel>\n                `))}\n            </div>\n        `}onZoomUpdate(t){this.widgetConfig.zoom=t.detail.value,this.notifyConfigUpdate()}onCenterUpdate(t){if(t.detail.value){const e=t.detail.value.split(/[, ]/).filter((t=>!!t));if(2===e.length){const t=new LngLat(Number.parseFloat(e[0]),Number.parseFloat(e[1]));this.widgetConfig.center=t,this.notifyConfigUpdate()}}}onGeoJsonToggle(t){this.widgetConfig.showGeoJson=t.detail.value,this.notifyConfigUpdate()}onAssetTypeSelect(t){this.widgetConfig.assetType!==t.detail&&(this.widgetConfig.attributeName=void 0,this.widgetConfig.assetIds=[],this.widgetConfig.showLabels=!1,this.widgetConfig.showUnits=!1,this.widgetConfig.boolColors={type:\"boolean\",false:\"#ef5350\",true:\"#4caf50\"},this.widgetConfig.textColors=[[\"example\",\"#4caf50\"],[\"example2\",\"#ff9800\"]],this.widgetConfig.thresholds=[[0,\"#4caf50\"],[75,\"#ff9800\"],[90,\"#ef5350\"]],this.widgetConfig.assetType=t.detail,this.notifyConfigUpdate())}onAttributeNameSelect(t){return __awaiter(this,void 0,void 0,(function*(){const e=t.detail;this.widgetConfig.attributeName=e,yield manager.rest.api.AssetResource.queryAssets({realm:{name:manager.displayRealm},select:{attributes:[e,\"location\"]},types:[this.widgetConfig.assetType]}).then((t=>{this.widgetConfig.assetIds=t.data.map((t=>t.id)),this.widgetConfig.valueType=t.data.length>0?t.data[0].attributes[e].type:\"text\"})).catch((t=>{console.error(t),showSnackbar(void 0,\"errorOccurred\")})),this.notifyConfigUpdate()}))}onShowLabelsToggle(t){this.widgetConfig.showLabels=t.detail.value,this.notifyConfigUpdate()}onShowUnitsToggle(t){this.widgetConfig.showUnits=t.detail.value,this.notifyConfigUpdate()}onThresholdsChange(t){this.widgetConfig.thresholds=t.detail,this.notifyConfigUpdate()}};MapSettings=__decorate([customElement(\"map-settings\")],MapSettings);export{MapSettings};","var MapWidget_1,__decorate=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},__awaiter=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function n(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,n)}l((i=i.apply(e,t||[])).next())}))};import{html}from\"lit\";import{customElement}from\"lit/decorators.js\";import{OrAssetWidget}from\"../util/or-asset-widget\";import{MapSettings}from\"../settings/map-settings\";import{when}from\"lit/directives/when.js\";import manager,{Util}from\"@openremote/core\";import{showSnackbar}from\"@openremote/or-mwc-components/or-mwc-snackbar\";import\"@openremote/or-map\";function getDefaultWidgetConfig(){return{attributeRefs:[],showLabels:!1,showUnits:!1,showGeoJson:!0,boolColors:{type:\"boolean\",false:\"#ef5350\",true:\"#4caf50\"},textColors:[[\"example\",\"4caf50\"],[\"example2\",\"ef5350\"]],thresholds:[[0,\"#4caf50\"],[75,\"#ff9800\"],[90,\"#ef5350\"]],assetTypes:[],assetType:void 0,assetIds:[],attributes:[]}}let MapWidget=MapWidget_1=class extends OrAssetWidget{constructor(){super(...arguments),this.markers={}}static getManifest(){return{displayName:\"Map\",displayIcon:\"map\",minColumnWidth:2,minColumnHeight:2,getContentHtml:e=>new MapWidget_1(e),getSettingsHtml:e=>new MapSettings(e),getDefaultConfig:()=>getDefaultWidgetConfig()}}refreshContent(e){this.loadAssets()}updated(e){e.has(\"widgetConfig\")&&this.widgetConfig&&this.loadAssets()}loadAssets(){return __awaiter(this,void 0,void 0,(function*(){this.widgetConfig.assetType&&this.widgetConfig.attributeName&&this.fetchAssetsByType([this.widgetConfig.assetType],this.widgetConfig.attributeName).then((e=>{this.loadedAssets=e}))}))}fetchAssetsByType(e,t){return __awaiter(this,void 0,void 0,(function*(){let s=[];return yield manager.rest.api.AssetResource.queryAssets({realm:{name:manager.displayRealm},select:{attributes:[t,\"location\"]},types:e}).then((e=>{s=e.data,this.markers={}})).catch((e=>{console.error(e),showSnackbar(void 0,\"errorOccurred\")})),s}))}render(){return html`\n            <div style=\"height: 100%; display: flex; flex-direction: column; overflow: hidden;\">\n                <or-map id=\"miniMap\" class=\"or-map\" .zoom=\"${this.widgetConfig.zoom}\" .center=\"${this.widgetConfig.center}\" .showGeoJson=\"${this.widgetConfig.showGeoJson}\" style=\"flex: 1;\">\n                    ${when(this.loadedAssets,(()=>this.getMarkerTemplates()))}\n                </or-map>\n            </div>\n        `}getMarkerTemplates(){return this.loadedAssets.filter((e=>{if(!e.attributes)return!1;const t=e.attributes.location;return!(t&&t.meta&&t.meta.hasOwnProperty(\"showOnDashboard\")&&!Util.getMetaValue(\"showOnDashboard\",t))})).map((e=>{if(this.markers)if(this.markers[e.type]={attributeName:this.widgetConfig.attributeName},this.markers[e.type].showUnits=this.widgetConfig.showUnits,this.markers[e.type].showLabel=this.widgetConfig.showLabels,\"boolean\"==this.widgetConfig.valueType)this.widgetConfig.boolColors.true=this.widgetConfig.boolColors.true.replace(\"#\",\"\"),this.widgetConfig.boolColors.false=this.widgetConfig.boolColors.false.replace(\"#\",\"\"),this.markers[e.type].colours=this.widgetConfig.boolColors;else if(\"text\"==this.widgetConfig.valueType){var t={type:\"string\"};this.widgetConfig.textColors.map((e=>{t[e[0]]=e[1].replace(\"#\",\"\")})),this.markers[e.type].colours=t}else{var s=[];this.widgetConfig.thresholds.sort(((e,t)=>e[0]>t[0]?-1:1)).map(((e,t)=>{var i={min:e[0],colour:e[1].replace(\"#\",\"\")};s.push(i)}));var i={type:\"range\",ranges:s};this.markers[e.type].colours=i}return html`\n                <or-map-marker-asset .asset=\"${e}\" .config=\"${this.markers}\"></or-map-marker-asset>\n            `}))}};MapWidget=MapWidget_1=__decorate([customElement(\"map-widget\")],MapWidget);export{MapWidget};","var __decorate=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,a=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(a=(r<3?n(a):r>3?n(e,i,a):n(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a};import{css,html}from\"lit\";import{customElement}from\"lit/decorators.js\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{AssetWidgetSettings}from\"../util/or-asset-widget\";const styling=css`\n  .switch-container {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n`;let AttributeInputSettings=class extends AssetWidgetSettings{static get styles(){return[...super.styles,styling]}render(){return html`\n            <div>\n                <!-- Attribute selection -->\n                <settings-panel displayName=\"attributes\" expanded=\"${!0}\">\n                    <attributes-panel .attributeRefs=\"${this.widgetConfig.attributeRefs}\" style=\"padding-bottom: 12px;\"\n                                      @attribute-select=\"${t=>this.onAttributesSelect(t)}\"\n                    ></attributes-panel>\n                </settings-panel>\n\n                <!-- Other settings -->\n                <settings-panel displayName=\"settings\" expanded=\"${!0}\">\n                    <div>\n                        <!-- Toggle readonly -->\n                        <div class=\"switch-container\">\n                            <span><or-translate value=\"dashboard.userCanEdit\"></or-translate></span>\n                            <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"margin: 0 -10px;\" .value=\"${!this.widgetConfig.readonly}\"\n                                          @or-mwc-input-changed=\"${t=>this.onReadonlyToggle(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                        <!-- Toggle helper text -->\n                        <div class=\"switch-container\">\n                            <span><or-translate value=\"dashboard.showHelperText\"></or-translate></span>\n                            <or-mwc-input .type=\"${InputType.SWITCH}\" style=\"margin: 0 -10px;\" .value=\"${this.widgetConfig.showHelperText}\"\n                                          @or-mwc-input-changed=\"${t=>this.onHelperTextToggle(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                    </div>\n                </settings-panel>\n            </div>\n        `}onAttributesSelect(t){if(this.widgetConfig.attributeRefs=t.detail.attributeRefs,1===t.detail.attributeRefs.length){const e=t.detail.assets.find((e=>e.id===t.detail.attributeRefs[0].id));e&&this.setDisplayName(e.name)}this.notifyConfigUpdate()}onReadonlyToggle(t){this.widgetConfig.readonly=!t.detail.value,this.notifyConfigUpdate()}onHelperTextToggle(t){this.widgetConfig.showHelperText=t.detail.value,this.notifyConfigUpdate()}};AttributeInputSettings=__decorate([customElement(\"attribute-input-settings\")],AttributeInputSettings);export{AttributeInputSettings};","var AttributeInputWidget_1,__decorate=this&&this.__decorate||function(t,e,i,r){var s,n=arguments.length,o=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var d=t.length-1;d>=0;d--)(s=t[d])&&(o=(n<3?s(o):n>3?s(e,i,o):s(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o};import{css,html}from\"lit\";import{OrAssetWidget}from\"../util/or-asset-widget\";import{customElement,query,queryAll}from\"lit/decorators.js\";import{AttributeInputSettings}from\"../settings/attribute-input-settings\";import{when}from\"lit/directives/when.js\";import{throttle}from\"lodash\";import{Util}from\"@openremote/core\";import\"@openremote/or-attribute-input\";function getDefaultWidgetConfig(){return{attributeRefs:[],readonly:!1,showHelperText:!0}}const styling=css`\n  #widget-wrapper {\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    overflow: hidden;\n  }\n\n  .attr-input {\n    width: 100%;\n    box-sizing: border-box;\n  }\n`;let AttributeInputWidget=AttributeInputWidget_1=class extends OrAssetWidget{static getManifest(){return{displayName:\"Attribute\",displayIcon:\"form-textbox\",getContentHtml:t=>new AttributeInputWidget_1(t),getDefaultConfig:()=>getDefaultWidgetConfig(),getSettingsHtml:t=>new AttributeInputSettings(t)}}refreshContent(t){this.widgetConfig=JSON.parse(JSON.stringify(this.widgetConfig))}static get styles(){return[...super.styles,styling]}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),delete this.resizeObserver}updated(t){if(t.has(\"widgetConfig\")&&this.widgetConfig){const t=this.widgetConfig.attributeRefs;t.length>0&&!this.isAttributeRefLoaded(t[0])&&this.loadAssets(t)}return!this.resizeObserver&&this.widgetWrapperElem&&(this.resizeObserver=new ResizeObserver(throttle((()=>{window.dispatchEvent(new Event(\"resize\"))}),200)),this.resizeObserver.observe(this.widgetWrapperElem)),super.updated(t)}loadAssets(t){this.fetchAssets(t).then((t=>{this.loadedAssets=t}))}render(){var t;const e=this.widgetConfig,i=e.attributeRefs.length>0&&(null===(t=this.loadedAssets[0])||void 0===t?void 0:t.attributes)?this.loadedAssets[0].attributes[e.attributeRefs[0].name]:void 0,r=Util.getMetaValue(\"readOnly\",i);return html`\n            ${when(e.attributeRefs.length>0&&i&&this.loadedAssets&&this.loadedAssets.length>0,(()=>{var t,s;return html`\n                    <div id=\"widget-wrapper\">\n                        <or-attribute-input class=\"attr-input\" fullWidth\n                                            .assetType=\"${null===(t=this.loadedAssets[0])||void 0===t?void 0:t.type}\"\n                                            .attribute=\"${i}\"\n                                            .assetId=\"${null===(s=this.loadedAssets[0])||void 0===s?void 0:s.id}\"\n                                            .disabled=\"${!this.loadedAssets}\"\n                                            .readonly=\"${e.readonly||r||this.getEditMode()}\"\n                                            .hasHelperText=\"${e.showHelperText}\"\n                        ></or-attribute-input>\n                    </div>\n                `}),(()=>html`\n                <div style=\"height: 100%; display: flex; justify-content: center; align-items: center;\">\n                    <span><or-translate value=\"noAttributesConnected\"></or-translate></span>\n                </div>\n            `))}\n        `}};__decorate([query(\"#widget-wrapper\")],AttributeInputWidget.prototype,\"widgetWrapperElem\",void 0),__decorate([queryAll(\".attr-input\")],AttributeInputWidget.prototype,\"attributeInputElems\",void 0),AttributeInputWidget=AttributeInputWidget_1=__decorate([customElement(\"attribute-input-widget\")],AttributeInputWidget);export{AttributeInputWidget};","var __decorate=this&&this.__decorate||function(t,e,s,i){var n,a=arguments.length,o=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(t,e,s,i);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(o=(a<3?n(o):a>3?n(e,s,o):n(e,s))||o);return a>3&&o&&Object.defineProperty(e,s,o),o};import{css,html}from\"lit\";import{customElement}from\"lit/decorators.js\";import{AssetWidgetSettings}from\"../util/or-asset-widget\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";const styling=css`\n  .customMwcInputContainer {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n`;let TableSettings=class extends AssetWidgetSettings{static get styles(){return[...super.styles,styling]}render(){return html`\n            <div>\n                <!-- Asset type, assets, and attribute picker -->\n                <settings-panel displayName=\"attributes\" expanded=\"${!0}\">\n                    <div style=\"padding-bottom: 12px;\">\n                        <assettypes-panel .assetType=\"${this.widgetConfig.assetType}\" .config=\"${{assets:{enabled:!0,multi:!0},attributes:{enabled:!0,multi:!0}}}\"\n                                          .assetIds=\"${this.widgetConfig.assetIds}\" .attributeNames=\"${this.widgetConfig.attributeNames}\"\n                                          @assettype-select=\"${t=>this.onAssetTypeSelect(t)}\"\n                                          @assetids-select=\"${t=>this.onAssetIdsSelect(t)}\"\n                                          @attributenames-select=\"${t=>this.onAttributesSelect(t)}\"\n                        ></assettypes-panel>\n                    </div>\n                </settings-panel>\n                \n                <!-- Table settings like amount of rows -->\n                <settings-panel displayName=\"dashboard.tableSettings\" expanded=\"${!0}\">\n                    <div style=\"padding-bottom: 12px;\">\n                        <div class=\"customMwcInputContainer\">\n                            <span style=\"min-width: 180px\"><or-translate value=\"dashboard.numberOfRows\"></or-translate></span>\n                            <or-mwc-input type=\"${InputType.SELECT}\" .options=\"${[10,25,100]}\" .value=\"${this.widgetConfig.tableSize}\"\n                                          @or-mwc-input-changed=\"${t=>this.onTableSizeSelect(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                    </div>\n                </settings-panel>\n            </div>\n        `}onAssetTypeSelect(t){this.widgetConfig.assetType=t.detail,this.widgetConfig.assetIds=[],this.widgetConfig.attributeNames=[],this.notifyConfigUpdate()}onAssetIdsSelect(t){this.widgetConfig.assetIds=t.detail,this.notifyConfigUpdate()}onAttributesSelect(t){this.widgetConfig.attributeNames=t.detail,this.notifyConfigUpdate()}onTableSizeSelect(t){const e=t.detail.value||10;this.widgetConfig.tableSize=e,this.widgetConfig.tableOptions=10!==e?[e]:[10,25,100],this.notifyConfigUpdate()}};TableSettings=__decorate([customElement(\"table-settings\")],TableSettings);export{TableSettings};","var TableWidget_1,__decorate=this&&this.__decorate||function(t,e,i,s){var o,r=arguments.length,a=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var l=t.length-1;l>=0;l--)(o=t[l])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a};import{css,html}from\"lit\";import{customElement}from\"lit/decorators.js\";import{OrAssetWidget}from\"../util/or-asset-widget\";import{TableSettings}from\"../settings/table-settings\";import{i18next}from\"@openremote/or-translate\";import{Util}from\"@openremote/core\";import{AssetModelUtil}from\"@openremote/model\";import\"@openremote/or-mwc-components/or-mwc-table\";function getDefaultConfig(){return{assetType:void 0,assetIds:[],attributeNames:[],tableSize:10,tableOptions:[10,25,100]}}const styling=css`\n    #widget-wrapper {\n      height: 100%;\n      overflow: hidden;\n    }\n`;let TableWidget=TableWidget_1=class extends OrAssetWidget{static getManifest(){return{displayName:\"Table\",displayIcon:\"table\",getContentHtml:t=>new TableWidget_1(t),getDefaultConfig:()=>getDefaultConfig(),getSettingsHtml:t=>new TableSettings(t)}}static get styles(){return[...super.styles,styling]}refreshContent(t){this.widgetConfig=JSON.parse(JSON.stringify(this.widgetConfig))}willUpdate(t){return t.has(\"widgetConfig\")&&this.widgetConfig&&this.loadAssets(),super.willUpdate(t)}loadAssets(){this.widgetConfig.assetIds.find((t=>!this.isAssetLoaded(t)))&&this.queryAssets({ids:this.widgetConfig.assetIds,select:{attributes:this.widgetConfig.attributeNames}}).then((t=>{this.loadedAssets=t}))}getColumns(t){const e=this.loadedAssets[0],i=t.map((t=>{var i,s;let o=t,r=!1;if(this.widgetConfig.assetType&&e&&e.attributes&&e.attributes[t]){const a=AssetModelUtil.getAttributeDescriptor(t,this.widgetConfig.assetType);o=Util.getAttributeLabel(e.attributes[t],a,this.widgetConfig.assetType,!0),r=(null===(i=null==a?void 0:a.format)||void 0===i?void 0:i.asNumber)||(null===(s=null==a?void 0:a.format)||void 0===s?void 0:s.asSlider)||!1}return{title:o,isSortable:!0,isNumeric:r}}));return Array.of({title:i18next.t(\"assetName\"),isSortable:!0},...i)}getRows(t){return this.loadedAssets.map((e=>{const i=t.map((t=>{if(e.attributes&&e.attributes[t]){const i=AssetModelUtil.getAttributeDescriptor(t,e.type),s=Util.getAttributeValueAsString(e.attributes[t],i,e.type,!1),o=parseFloat(s);return isNaN(o)?s:o}return\"N.A.\"}));return{content:Array.of(e.name,...i)}}))}render(){const t={fullHeight:!0,pagination:{enable:!0,options:this.widgetConfig.tableOptions}},e=this.getColumns(this.widgetConfig.attributeNames),i=this.getRows(this.widgetConfig.attributeNames);return html`\n            <div id=\"widget-wrapper\">\n                <or-mwc-table .columns=\"${e}\" .rows=\"${i}\" .config=\"${t}\" .paginationSize=\"${this.widgetConfig.tableSize}\"\n                              @or-mwc-table-row-click=\"${t=>this.onTableRowClick(t)}\"\n                ></or-mwc-table>\n            </div>\n        `}onTableRowClick(t){}};TableWidget=TableWidget_1=__decorate([customElement(\"table-widget\")],TableWidget);export{TableWidget};","var __decorate=this&&this.__decorate||function(t,e,i,n){var a,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var r=t.length-1;r>=0;r--)(a=t[r])&&(o=(s<3?a(o):s>3?a(e,i,o):a(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(a,s){function o(t){try{l(n.next(t))}catch(t){s(t)}}function r(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((n=n.apply(t,e||[])).next())}))};import{customElement}from\"lit/decorators.js\";import{WidgetSettings}from\"../util/widget-settings\";import{html}from\"lit\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{i18next}from\"@openremote/or-translate\";import{Task}from\"@lit/task\";import manager from\"@openremote/core\";let GatewaySettings=class extends WidgetSettings{constructor(){super(...arguments),this.GATEWAY_ASSET_TYPES=[\"GatewayAsset\"],this.GATEWAY_TUNNEL_TYPES=[\"HTTPS\",\"HTTP\",\"TCP\"],this._fetchAssetsTask=new Task(this,{task:([],{signal:t})=>__awaiter(this,void 0,void 0,(function*(){return yield this._fetchAssets(!0,t)})),args:()=>[]})}connectedCallback(){super.connectedCallback()}render(){const t=!this.widgetConfig.gatewayId;return html`\n            <div>\n                <settings-panel displayName=\"gatewayTunnels.settings\" expanded=\"${!0}\">\n                    <div style=\"display: flex; flex-direction: column; gap: 8px;\">\n                        <div>\n                            ${this._fetchAssetsTask.render({pending:()=>html`\n                                    <or-mwc-input .type=\"${InputType.SELECT}\" compact style=\"width: 100%;\" disabled\n                                                  label=\"${i18next.t(\"gatewayTunnels.selectAsset\")}\"\n                                    ></or-mwc-input>\n                                `,complete:t=>{const e=t.map((t=>[t.id,t.name])),i=t.find((t=>t.id===this.widgetConfig.gatewayId)),n=i?[i.id,i.name]:void 0;return html`\n                                        <or-mwc-input .type=\"${InputType.SELECT}\" compact style=\"width: 100%;\"\n                                                      .options=\"${e}\" .value=\"${n}\"\n                                                      label=\"${i18next.t(\"gatewayTunnels.selectAsset\")}\"\n                                                      @or-mwc-input-changed=\"${t=>this._onAssetSelect(t)}\"\n                                        ></or-mwc-input>\n                                    `},error:()=>html`\n                                    <or-mwc-input .type=\"${InputType.TEXT}\" compact style=\"width: 100%;\" disabled\n                                                  label=\"${i18next.t(\"gatewayTunnels.selectAsset\")}\" .value=\"${i18next.t(\"errorOccurred\")}\"\n                                    ></or-mwc-input>\n                                `})}\n                        </div>\n                        <div>\n                            <or-mwc-input .type=\"${InputType.SELECT}\" compact style=\"width: 100%;\"\n                                          .disabled=\"${t}\" .options=\"${this.GATEWAY_TUNNEL_TYPES}\" .value=\"${this.widgetConfig.type}\"\n                                          label=\"${i18next.t(\"gatewayTunnels.protocol\")}\"\n                                          @or-mwc-input-changed=\"${t=>this._onTunnelTypeSelect(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                        <div>\n                            <or-mwc-input .type=\"${InputType.TEXT}\" style=\"width: 100%;\"\n                                          .disabled=\"${t}\" .value=\"${this.widgetConfig.target}\"\n                                          label=\"${i18next.t(\"gatewayTunnels.target\")}\"\n                                          @or-mwc-input-changed=\"${t=>this._onTunnelTargetSelect(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                        <div>\n                            <or-mwc-input .type=\"${InputType.NUMBER}\" style=\"width: 100%;\"\n                                          .disabled=\"${t}\" .value=\"${this.widgetConfig.targetPort}\"\n                                          label=\"${i18next.t(\"gatewayTunnels.targetPort\")}\"\n                                          @or-mwc-input-changed=\"${t=>this._onTunnelTargetPortSelect(t)}\"\n                            ></or-mwc-input>\n                        </div>\n                    </div>\n                </settings-panel>\n            </div>\n        `}_onAssetSelect(t){this.widgetConfig.gatewayId=t.detail.value,this.notifyConfigUpdate()}_onTunnelTypeSelect(t){this.widgetConfig.type=t.detail.value,this.notifyConfigUpdate()}_onTunnelTargetSelect(t){this.widgetConfig.target=t.detail.value,this.notifyConfigUpdate()}_onTunnelTargetPortSelect(t){this.widgetConfig.targetPort=t.detail.value,this.notifyConfigUpdate()}_fetchAssets(t=!0,e){return __awaiter(this,void 0,void 0,(function*(){const e={realm:{name:manager.displayRealm},select:{attributes:[\"tunnelingSupported\"]},types:this.GATEWAY_ASSET_TYPES,attributes:t?{items:[{name:{predicateType:\"string\",value:\"tunnelingSupported\"},value:{predicateType:\"boolean\",value:!0}},{name:{predicateType:\"string\",value:\"gatewayStatus\"},value:{predicateType:\"string\",value:\"CONNECTED\"}}]}:void 0};return(yield manager.rest.api.AssetResource.queryAssets(e)).data}))}};GatewaySettings=__decorate([customElement(\"gateway-settings\")],GatewaySettings);export{GatewaySettings};","var GatewayWidget_1,__decorate=this&&this.__decorate||function(t,e,n,o){var i,a=arguments.length,r=a<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(r=(a<3?i(r):a>3?i(e,n,r):i(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r},__awaiter=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,a){function r(t){try{l(o.next(t))}catch(t){a(t)}}function s(t){try{l(o.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}l((o=o.apply(t,e||[])).next())}))};import{customElement,state}from\"lit/decorators.js\";import{OrWidget}from\"../util/or-widget\";import{css,html}from\"lit\";import{GatewaySettings}from\"../settings/gateway-settings\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import manager from\"@openremote/core\";import{when}from\"lit/directives/when.js\";import{i18next}from\"@openremote/or-translate\";import{showSnackbar}from\"@openremote/or-mwc-components/or-mwc-snackbar\";const styling=css`\n    #gateway-widget-wrapper {\n        height: 100%;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        overflow: hidden;\n    }\n\n    #gateway-widget-container {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 8px;\n        max-height: 48px;\n        flex-wrap: wrap;\n        position: relative;\n    }\n`;function getDefaultWidgetConfig(){return{type:\"HTTPS\",target:\"localhost\",targetPort:443}}let GatewayWidget=GatewayWidget_1=class extends OrWidget{constructor(){super(...arguments),this._loading=!1,this._startedByUser=!1}static getManifest(){return{displayName:\"Gateway\",displayIcon:\"lan-connect\",minColumnWidth:1,minColumnHeight:1,getContentHtml:t=>new GatewayWidget_1(t),getSettingsHtml:t=>new GatewaySettings(t),getDefaultConfig:()=>getDefaultWidgetConfig()}}refreshContent(t){this.widgetConfig=JSON.parse(JSON.stringify(this.widgetConfig))}static get styles(){return[...super.styles,styling]}disconnectedCallback(){this._activeTunnel&&(this._startedByUser?this._stopTunnel(this._activeTunnel):console.warn(\"Keeping the active tunnel open, as it is not started through the widget.\")),super.disconnectedCallback()}willUpdate(t){t.has(\"_activeTunnel\")&&this._activeTunnel&&this._navigateToTunnel(this._activeTunnel)}render(){var t;const e=(null===(t=this.getEditMode)||void 0===t?void 0:t.call(this))||!this._isConfigComplete(this.widgetConfig);return html`\n            <div id=\"gateway-widget-wrapper\">\n                <div id=\"gateway-widget-container\">\n                    ${when(this._loading,(()=>html`\n                        <or-loading-indicator></or-loading-indicator>\n                    `),(()=>this._activeTunnel?html`\n                                \n                                <or-mwc-input .type=\"${InputType.BUTTON}\" icon=\"stop\" label=\"${i18next.t(\"gatewayTunnels.stop\")}\"\n                                              @or-mwc-input-changed=\"${t=>this._onStopTunnelClick(t)}\"\n                                ></or-mwc-input>\n                                \n                                ${when(\"TCP\"===this.widgetConfig.type,(()=>html`\n                                    <or-mwc-input .type=\"${InputType.BUTTON}\" icon=\"content-copy\" label=\"${i18next.t(\"gatewayTunnels.copyAddress\")}\" outlined .disabled=\"${e}\"\n                                                  @or-mwc-input-changed=\"${t=>this._onCopyTunnelAddressClick(t)}\"\n                                    ></or-mwc-input>\n                                `),(()=>html`\n                                    <or-mwc-input .type=\"${InputType.BUTTON}\" icon=\"open-in-new\" label=\"${i18next.t(\"gatewayTunnels.open\")}\" outlined .disabled=\"${e}\"\n                                                  @or-mwc-input-changed=\"${t=>this._onTunnelNavigateClick(t)}\"\n                                    ></or-mwc-input>\n                                `))}\n                                \n                            `:html`\n                                <or-mwc-input .type=\"${InputType.BUTTON}\" label=\"${i18next.t(\"gatewayTunnels.start\")}\" outlined .disabled=\"${e}\"\n                                              @or-mwc-input-changed=\"${t=>this._onStartTunnelClick(t)}\"\n                                ></or-mwc-input>\n                            `))}\n                </div>\n            </div>\n        `}_onCopyTunnelAddressClick(t){if(this._isConfigComplete(this.widgetConfig)){const t=this._getTunnelInfoByConfig(this.widgetConfig),e=this._getTunnelAddress(t);e?navigator.clipboard.writeText(e).finally((()=>{showSnackbar(void 0,i18next.t(\"gatewayTunnels.copySuccess\"))})):(console.warn(\"Could not copy tunnel address as it could not be found.\"),showSnackbar(void 0,i18next.t(\"errorOccurred\")))}else console.warn(\"Could not copy tunnel address as configuration is not complete.\"),showSnackbar(void 0,i18next.t(\"errorOccurred\"))}_onStartTunnelClick(t){this._tryStartTunnel(this.widgetConfig)}_onStopTunnelClick(t){this._tryStopTunnel(this.widgetConfig)}_onTunnelNavigateClick(t){this._isConfigComplete(this.widgetConfig)?this._navigateToTunnel(this._getTunnelInfoByConfig(this.widgetConfig)):console.warn(\"Could not navigate to tunnel as configuration is not complete.\")}_tryStartTunnel(t){if(this._isConfigComplete(t)){const e=this._getTunnelInfoByConfig(t);this._loading=!0,this._getActiveTunnel(e).then((t=>{t?(console.log(\"Found an active tunnel!\",t),this._activeTunnel=t,this._loading=!1):this._startTunnel(e).then((t=>{t?(console.log(\"Started a new tunnel!\",t),this._activeTunnel=t,this._startedByUser=!0):console.warn(\"No new tunnel!\")})).catch((t=>{console.error(t),showSnackbar(void 0,i18next.t(\"errorOccurred\"))})).finally((()=>{this._loading=!1}))})).catch((t=>{console.error(t),showSnackbar(void 0,i18next.t(\"errorOccurred\")),this._loading=!1}))}}_startTunnel(t){return __awaiter(this,void 0,void 0,(function*(){if(!(t.realm&&t.gatewayId&&t.target&&t.targetPort))throw new Error(\"Could not start tunnel, as some provided information was not set.\");return(yield manager.rest.api.GatewayServiceResource.startTunnel(t)).data}))}_getActiveTunnel(t){return __awaiter(this,void 0,void 0,(function*(){if(!(t.realm&&t.gatewayId&&t.target&&t.targetPort))throw new Error(\"Could not get active tunnel, as some provided information was not set.\");return(yield manager.rest.api.GatewayServiceResource.getActiveTunnelInfo(t.realm,t.gatewayId,t.target,t.targetPort)).data}))}_tryStopTunnel(t){const e=this._getTunnelInfoByConfig(t);this._loading=!0,this._stopTunnel(e).then((()=>{this._activeTunnel=void 0,this._startedByUser=!1})).catch((t=>{console.warn(t)})).finally((()=>{this._loading=!1}))}_stopTunnel(t){return __awaiter(this,void 0,void 0,(function*(){return(yield manager.rest.api.GatewayServiceResource.stopTunnel(t)).data}))}_navigateToTunnel(t){var e;t.realm&&t.gatewayId&&t.target&&t.targetPort||console.warn(\"Could not navigate to tunnel, as some provided information was not set.\");const n=this._getTunnelAddress(t);switch(t.type){case\"HTTPS\":case\"HTTP\":null===(e=window.open(n))||void 0===e||e.focus();break;default:console.error(\"Unknown error when navigating to tunnel.\")}}_getTunnelAddress(t){switch(t.type){case\"HTTPS\":case\"HTTP\":return\"//\"+t.id+\".\"+window.location.host;case\"TCP\":return t.id+\".\"+window.location.hostname+\":\"+t.assignedPort}}_isConfigComplete(t){return t.gatewayId?t.type?t.target?!!t.targetPort||(console.error(\"Could not start tunnel, since no gateway target port was configured.\"),!1):(console.error(\"Could not start tunnel, since no gateway target was configured.\"),!1):(console.error(\"Could not start tunnel, since no gateway type / protocol was configured.\"),!1):(console.error(\"Could not start tunnel, since no gateway asset was configured.\"),!1)}_getTunnelInfoByConfig(t){return{realm:manager.displayRealm,gatewayId:t.gatewayId,type:t.type,target:t.target,targetPort:t.targetPort}}};__decorate([state()],GatewayWidget.prototype,\"_loading\",void 0),__decorate([state()],GatewayWidget.prototype,\"_activeTunnel\",void 0),GatewayWidget=GatewayWidget_1=__decorate([customElement(\"gateway-widget\")],GatewayWidget);export{GatewayWidget};","var __decorate=this&&this.__decorate||function(e,t,i,s){var r,d=arguments.length,a=d<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(d<3?r(a):d>3?r(t,i,a):r(t,i))||a);return d>3&&a&&Object.defineProperty(t,i,a),a},__awaiter=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,d){function a(e){try{l(s.next(e))}catch(e){d(e)}}function o(e){try{l(s.throw(e))}catch(e){d(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};import{css,html,LitElement,unsafeCSS}from\"lit\";import{customElement,property,query,state}from\"lit/decorators.js\";import{when}from\"lit/directives/when.js\";import{styleMap}from\"lit/directives/style-map.js\";import\"./or-dashboard-tree\";import\"./or-dashboard-browser\";import\"./or-dashboard-preview\";import\"./or-dashboard-widgetsettings\";import\"./or-dashboard-boardsettings\";import\"./controls/dashboard-refresh-controls\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import\"@openremote/or-icon\";import{style}from\"./style\";import manager,{DefaultColor1,DefaultColor3,DefaultColor5,Util}from\"@openremote/core\";import\"@openremote/or-mwc-components/or-mwc-tabs\";import{showSnackbar}from\"@openremote/or-mwc-components/or-mwc-snackbar\";import{i18next}from\"@openremote/or-translate\";import{showOkCancelDialog}from\"@openremote/or-mwc-components/or-mwc-dialog\";import{DashboardKeyEmitter}from\"./or-dashboard-keyhandler\";import{ChartWidget}from\"./widgets/chart-widget\";import{GaugeWidget}from\"./widgets/gauge-widget\";import{intervalToMillis}from\"./controls/dashboard-refresh-controls\";import{ImageWidget}from\"./widgets/image-widget\";import{KpiWidget}from\"./widgets/kpi-widget\";import{MapWidget}from\"./widgets/map-widget\";import{AttributeInputWidget}from\"./widgets/attribute-input-widget\";import{TableWidget}from\"./widgets/table-widget\";import{GatewayWidget}from\"./widgets/gateway-widget\";const styling=css`\n    \n    @media only screen and (min-width: 641px){\n        #tree {\n            min-width: 300px !important;\n        }\n    }\n    @media only screen and (max-width: 641px) {\n        #tree {\n            flex: 1 !important;\n        }\n        #builder {\n            max-height: inherit !important;\n        }\n    }\n    \n    #tree {\n        flex: 0;\n        align-items: stretch;\n        z-index: 1;\n        box-shadow: rgb(0 0 0 / 21%) 0px 1px 3px 0px;\n    }\n    \n    /* Header related styling */\n    #header {\n        background: var(--or-app-color1, ${unsafeCSS(DefaultColor1)});\n    }\n    #header-wrapper {\n        padding: 14px 30px;\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        border-bottom: 1px solid ${unsafeCSS(DefaultColor5)};\n    }\n    #header-title {\n        font-size: 18px;\n    }\n    #header-title > or-icon {\n        margin-right: 10px;\n    }\n    #header-actions {\n        flex: 1 1 auto;\n        text-align: right;\n    }\n    #header-actions-content {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        float: right;\n    }\n\n    /* Header related styling */\n    @media screen and (max-width: 700px) {\n        #fullscreen-header-wrapper {\n            padding: 11px !important;\n        }\n    }\n    #fullscreen-header-wrapper {\n        min-height: 36px;\n        padding: 20px 30px 15px;\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n    }\n    #fullscreen-header-title {\n        font-size: 18px;\n        font-weight: bold;\n        color: var(--or-app-color3, ${unsafeCSS(DefaultColor3)});\n    }\n    #fullscreen-header-title > or-mwc-input {\n        margin-right: 4px;\n        --or-icon-fill: ${unsafeCSS(DefaultColor3)};\n    }\n    #fullscreen-header-actions {\n        flex: 1 1 auto;\n        text-align: right;\n    }\n    #fullscreen-header-actions-content {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        float: right;\n    }\n    \n    /* ----------------------------- */\n    /* Editor/builder related styling */\n    #builder {\n        flex: 1 0 auto;\n        height: 100%;\n    }\n    \n    /* ----------------------------- */\n    /* Sidebar related styling (drag and drop widgets / configuration) */\n    #sidebar {\n        vertical-align: top;\n        position: relative;\n        width: 300px;\n        background: white;\n        border-left: 1px solid ${unsafeCSS(DefaultColor5)};\n    }\n    #sidebar-widget-headeractions {\n        flex: 0;\n        display: flex;\n        flex-direction: row;\n        padding-right: 5px;\n    }\n    .settings-container {\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n    }\n    #browser {\n        flex-grow: 1;\n        align-items: stretch;\n        z-index: 1;\n        max-width: 300px;\n    }\n    \n    #save-btn { margin-left: 15px; }\n    #view-btn { margin-left: 18px; }\n    \n    .small-btn {\n        height: 36px;\n        margin-top: -12px;\n    }\n    \n    .hidescroll {\n        -ms-overflow-style: none; /* for Internet Explorer, Edge */\n        scrollbar-width: none; /* for Firefox */\n    }\n    .hidescroll::-webkit-scrollbar {\n        display: none; /* for Chrome, Safari, and Opera */\n    }\n`;export const MAX_BREAKPOINT=1e6;export function scalingPresetToString(e){return null!=e?i18next.t(\"dashboard.presets.\"+e.toLowerCase()):\"undefined\"}export function dashboardAccessToString(e){return i18next.t(\"dashboard.access.\"+e.toLowerCase())}export function sortScreenPresets(e,t=!1){return e.sort(((e,i)=>{if(null!=e.breakpoint&&null!=i.breakpoint){if(e.breakpoint>i.breakpoint)return t?1:-1;if(e.breakpoint<i.breakpoint)return t?1:-1}return 0}))}export function getActivePreset(e,t){let i;return sortScreenPresets(t,!0).forEach((t=>{null!=t.breakpoint&&e<=t.breakpoint&&(i=t)})),i}export const widgetTypes=new Map;export function registerWidgetTypes(){widgetTypes.set(\"linechart\",ChartWidget.getManifest()),widgetTypes.set(\"gauge\",GaugeWidget.getManifest()),widgetTypes.set(\"image\",ImageWidget.getManifest()),widgetTypes.set(\"kpi\",KpiWidget.getManifest()),widgetTypes.set(\"map\",MapWidget.getManifest()),widgetTypes.set(\"attributeinput\",AttributeInputWidget.getManifest()),widgetTypes.set(\"table\",TableWidget.getManifest()),widgetTypes.set(\"gateway\",GatewayWidget.getManifest())}let OrDashboardBuilder=class extends LitElement{static get styles(){return[styling,style]}constructor(){super(),this.editMode=!1,this.fullscreen=!0,this.realm=manager.displayRealm,this.readonly=!0,this.refreshInterval=\"OFF\",this.keyEmitter=new DashboardKeyEmitter,this.sidebarMenuIndex=0,this.showDashboardTree=!0,this.menuItems=[{icon:\"content-copy\",text:i18next.t(\"copy\")+\" URL\",value:\"copy\"},{icon:\"open-in-new\",text:i18next.t(\"dashboard.openInNewTab\"),value:\"tab\"}],this.tabItems=[{name:i18next.t(\"dashboard.widgets\")},{name:i18next.t(\"settings\")}],this.isInitializing=!0,this.isLoading=!0,this.hasChanged=!1,registerWidgetTypes(),this.updateComplete.then((()=>{this.loadAllDashboards(this.realm)}))}connectedCallback(){super.connectedCallback(),this.keyEmitter.addListener(\"delete\",(e=>{var t,i,s;if(this.selectedWidgetId){const e=null===(s=null===(i=null===(t=this.selectedDashboard)||void 0===t?void 0:t.template)||void 0===i?void 0:i.widgets)||void 0===s?void 0:s.find((e=>e.id==this.selectedWidgetId));e&&showOkCancelDialog(i18next.t(\"areYouSure\"),i18next.t(\"dashboard.deleteWidgetWarning\"),i18next.t(\"delete\")).then((t=>{t&&this.deleteWidget(e)}))}})),this.keyEmitter.addListener(\"deselect\",(e=>{this.deselectWidget()})),this.keyEmitter.addListener(\"save\",(e=>{this.saveDashboard()}))}disconnectedCallback(){super.disconnectedCallback(),this.keyEmitter.removeAllListeners()}willUpdate(e){var t,i,s;if(super.willUpdate(e),this.isLoading=null==this.dashboards,this.isInitializing=null==this.dashboards,1!==e.size||!e.has(\"selectedWidget\")){const e=Util.objectsEqual(this.selectedDashboard,this.initialDashboardJSON?JSON.parse(this.initialDashboardJSON):void 0),t=Util.objectsEqual(this.currentTemplate,this.initialTemplateJSON?JSON.parse(this.initialTemplateJSON):void 0);this.hasChanged=!e||!t}e.has(\"realm\")&&void 0!==e.get(\"realm\")&&this.realm&&this.loadAllDashboards(this.realm),e.has(\"selectedDashboard\")&&(this.deselectWidget(),this.currentTemplate=null===(t=this.selectedDashboard)||void 0===t?void 0:t.template,this.editMode||(this.refreshInterval=(null===(i=this.currentTemplate)||void 0===i?void 0:i.refreshInterval)||\"OFF\",e.set(\"refreshInterval\",this.refreshInterval)),this.dispatchEvent(new CustomEvent(\"selected\",{detail:this.selectedDashboard}))),e.has(\"editMode\")&&(this.deselectWidget(),this.refreshInterval=\"OFF\",this.showDashboardTree=!0,this.editMode?this.refreshInterval=\"OFF\":this.refreshInterval=(null===(s=this.currentTemplate)||void 0===s?void 0:s.refreshInterval)||\"OFF\",e.set(\"refreshInterval\",this.refreshInterval)),e.has(\"refreshInterval\")&&this.refreshInterval&&this.setRefreshTimer(intervalToMillis(this.refreshInterval))}setRefreshTimer(e){this.clearRefreshTimer(),void 0!==e&&(this.refreshTimer=setInterval((()=>{var e;this.deselectWidget(),null===(e=this.dashboardPreview)||void 0===e||e.refreshWidgets()}),e))}clearRefreshTimer(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=void 0)}loadAllDashboards(e){var t;return __awaiter(this,void 0,void 0,(function*(){yield manager.rest.api.DashboardResource.getAllRealmDashboards(e).then((e=>{this.dashboards=e.data})).catch((e=>{showSnackbar(void 0,\"errorOccurred\"),console.error(e)})),void 0!==this.selectedId&&(this.selectedDashboard=null===(t=this.dashboards)||void 0===t?void 0:t.find((e=>e.id==this.selectedId)))}))}updated(e){super.updated(e),e.has(\"currentTemplate\")&&null!=this.selectedDashboard&&(this.selectedDashboard.template=this.currentTemplate)}onWidgetCreation(e){const t=JSON.parse(JSON.stringify(this.currentTemplate));t.widgets||(t.widgets=[]),t.widgets.push(e),this.currentTemplate=t}deleteWidget(e){var t;if(null!=this.currentTemplate&&null!=this.currentTemplate.widgets){const i=this.currentTemplate;i.widgets=null===(t=i.widgets)||void 0===t?void 0:t.filter((t=>t.id!=e.id)),this.currentTemplate=i}this.selectedWidgetId===e.id&&this.deselectWidget()}selectWidget(e){var t,i;const s=null===(i=null===(t=this.currentTemplate)||void 0===t?void 0:t.widgets)||void 0===i?void 0:i.find((t=>{var i,s;return(null===(i=t.gridItem)||void 0===i?void 0:i.id)==(null===(s=e.gridItem)||void 0===s?void 0:s.id)}));null!=s?this.selectedWidgetId=s.id:console.error(\"The selected widget does not exist!\")}deselectWidget(){this.selectedWidgetId=void 0}selectDashboard(e){var t;if(null!=this.dashboards){if(this.selectedDashboard&&this.initialDashboardJSON){const e=this.dashboards.indexOf(this.selectedDashboard);e&&(this.dashboards[e]=JSON.parse(this.initialDashboardJSON))}this.selectedDashboard=e?this.dashboards.find((t=>t.id==e.id)):void 0,this.initialDashboardJSON=JSON.stringify(this.selectedDashboard),this.initialTemplateJSON=JSON.stringify(null===(t=this.selectedDashboard)||void 0===t?void 0:t.template)}}changeDashboardName(e){null!=this.selectedDashboard&&(this.selectedDashboard.displayName=e,this.requestUpdate(\"selectedDashboard\"))}openDashboardInInsights(){var e;if(null!=this.selectedDashboard){const t=window.location.origin+\"/insights/?realm=\"+manager.displayRealm+\"#/view/\"+this.selectedDashboard.id+\"/true/\";null===(e=window.open(t))||void 0===e||e.focus()}}shareUrl(e){var t;let i=window.location.href.replace(\"true\",\"false\");\"copy\"==e?navigator.clipboard.writeText(i):\"tab\"==e&&(null===(t=window.open(i,\"_blank\"))||void 0===t||t.focus())}saveDashboard(){null!=this.selectedDashboard&&!this._isReadonly()&&this._hasEditAccess()?(this.isLoading=!0,manager.rest.api.DashboardResource.update(this.selectedDashboard).then((()=>{var e;null!=this.dashboards&&null!=this.selectedDashboard&&(this.initialDashboardJSON=JSON.stringify(this.selectedDashboard),this.initialTemplateJSON=JSON.stringify(this.selectedDashboard.template),this.dashboards[null===(e=this.dashboards)||void 0===e?void 0:e.indexOf(this.selectedDashboard)]=this.selectedDashboard,this.currentTemplate=Object.assign({},this.selectedDashboard.template),showSnackbar(void 0,\"dashboard.saveSuccessful\"))})).catch((e=>{console.error(e),showSnackbar(void 0,\"errorOccurred\")})).finally((()=>{this.isLoading=!1}))):(console.error(\"The selected dashboard could not be found..\"),showSnackbar(void 0,\"errorOccurred\"))}_isReadonly(){return this.readonly||!manager.hasRole(\"write:insights\")}_hasEditAccess(){var e,t;return null!=this.userId&&(\"PRIVATE\"!=(null===(e=this.selectedDashboard)||void 0===e?void 0:e.editAccess)||(null===(t=this.selectedDashboard)||void 0===t?void 0:t.ownerId)==this.userId)}_hasViewAccess(){var e,t;return null!=this.userId&&(\"PRIVATE\"!=(null===(e=this.selectedDashboard)||void 0===e?void 0:e.viewAccess)||(null===(t=this.selectedDashboard)||void 0===t?void 0:t.ownerId)==this.userId)}render(){var e,t,i,s;window.matchMedia(\"(max-width: 600px)\").matches&&this.editMode&&(this.dispatchEvent(new CustomEvent(\"editToggle\",{detail:!1})),this.showDashboardTree=!0);const r={display:!this.editMode||!this._isReadonly()&&this._hasEditAccess()?void 0:\"none\",maxHeight:this.editMode?\"calc(100vh - 77px - 50px)\":\"inherit\"};return!this.isInitializing||null!=this.dashboards&&0==this.dashboards.length?html`\n            <div id=\"container\">\n                ${this.showDashboardTree?html`\n                    <or-dashboard-tree id=\"tree\" class=\"${this.selectedDashboard?\"hideMobile\":void 0}\"\n                                       .realm=\"${this.realm}\" .hasChanged=\"${this.hasChanged}\" .selected=\"${this.selectedDashboard}\" .dashboards=\"${this.dashboards}\" .showControls=\"${!0}\" .userId=\"${this.userId}\" .readonly=\"${this._isReadonly()}\"\n                                       @created=\"${e=>{this.dispatchEvent(new CustomEvent(\"editToggle\",{detail:!0}))}}\"\n                                       @updated=\"${e=>{this.dashboards=e.detail,this.selectedDashboard=void 0}}\"\n                                       @select=\"${e=>{this.selectDashboard(e.detail)}}\"\n                    ></or-dashboard-tree>\n                `:void 0}\n                <div class=\"${null==this.selectedDashboard?\"hideMobile\":void 0}\" style=\"flex: 1; display: flex; flex-direction: column;\">\n                    ${this.editMode?html`\n                        <div id=\"header\" class=\"hideMobile\">\n                            <div id=\"header-wrapper\">\n                                <div id=\"header-title\">\n                                    <or-icon icon=\"view-dashboard\"></or-icon>\n                                    ${null!=this.selectedDashboard?html`\n                                        <or-mwc-input .type=\"${InputType.TEXT}\" min=\"1\" max=\"1023\" comfortable required outlined .label=\"${i18next.t(\"name\")+\"*\"}\" \n                                                      ?readonly=\"${this._isReadonly()}\" .value=\"${this.selectedDashboard.displayName}\" \n                                                      .disabled=\"${this.isLoading}\" style=\"width: 300px;\" \n                                                      @or-mwc-input-changed=\"${e=>{this.changeDashboardName(e.detail.value)}}\"\n                                        ></or-mwc-input>\n                                    `:void 0}\n                                </div>\n                                <div id=\"header-actions\">\n                                    <div id=\"header-actions-content\">\n                                        ${when(this.selectedDashboard,(()=>html`\n                                            <or-mwc-input id=\"refresh-btn\" class=\"small-btn\" .disabled=\"${this.isLoading}\" type=\"${InputType.BUTTON}\" icon=\"refresh\"\n                                                          @or-mwc-input-changed=\"${()=>{var e;this.deselectWidget(),null===(e=this.dashboardPreview)||void 0===e||e.refreshPreview()}}\">\n                                            </or-mwc-input>\n                                            <or-mwc-input id=\"responsive-btn\" class=\"small-btn\" .disabled=\"${this.isLoading}\" type=\"${InputType.BUTTON}\" icon=\"responsive\"\n                                                          @or-mwc-input-changed=\"${()=>{this.dispatchEvent(new CustomEvent(\"fullscreenToggle\",{detail:!this.fullscreen}))}}\">\n                                            </or-mwc-input>\n                                            <or-mwc-input id=\"share-btn\" class=\"small-btn\" .disabled=\"${this.isLoading}\" type=\"${InputType.BUTTON}\" icon=\"open-in-new\"\n                                                          @or-mwc-input-changed=\"${()=>{this.openDashboardInInsights()}}\">\n                                            </or-mwc-input>\n                                            <or-mwc-input id=\"save-btn\" ?hidden=\"${this._isReadonly()||!this._hasEditAccess()}\" .disabled=\"${this.isLoading||!this.hasChanged}\" type=\"${InputType.BUTTON}\" raised label=\"save\"\n                                                          @or-mwc-input-changed=\"${()=>{this.saveDashboard()}}\">\n                                            </or-mwc-input>\n                                            <or-mwc-input id=\"view-btn\" ?hidden=\"${this._isReadonly()||!this._hasViewAccess()}\" type=\"${InputType.BUTTON}\" outlined icon=\"eye\" label=\"viewAsset\"\n                                                          @or-mwc-input-changed=\"${()=>{this.dispatchEvent(new CustomEvent(\"editToggle\",{detail:!1}))}}\">\n                                            </or-mwc-input>\n                                        `))}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    `:html`\n                        <div id=\"fullscreen-header\">\n                            <div id=\"fullscreen-header-wrapper\">\n                                <div id=\"fullscreen-header-title\" style=\"display: flex; align-items: center;\">\n                                    <or-icon class=\"showMobile\" style=\"margin-right: 10px;\" icon=\"chevron-left\" @click=\"${()=>{this.selectedDashboard=void 0}}\"></or-icon>\n                                    <or-icon class=\"hideMobile\" style=\"margin-right: 10px;\" icon=\"menu\" @click=\"${()=>{this.showDashboardTree=!this.showDashboardTree}}\"></or-icon>\n                                    <span>${null===(e=this.selectedDashboard)||void 0===e?void 0:e.displayName}</span>\n                                </div>\n                                <div id=\"fullscreen-header-actions\">\n                                    <div id=\"fullscreen-header-actions-content\">\n                                        ${when(this.selectedDashboard,(()=>html`\n                                            <or-mwc-input id=\"refresh-btn\" class=\"small-btn\" .disabled=\"${null==this.selectedDashboard}\" type=\"${InputType.BUTTON}\" icon=\"refresh\"\n                                                      @or-mwc-input-changed=\"${()=>{var e;this.deselectWidget(),null===(e=this.dashboardPreview)||void 0===e||e.refreshPreview()}}\"\n                                            ></or-mwc-input>\n                                            <dashboard-refresh-controls .interval=\"${this.refreshInterval}\" .readonly=\"${!1}\"\n                                                                        @interval-select=\"${e=>this.onIntervalSelect(e)}\"\n                                            ></dashboard-refresh-controls>\n                                            <or-mwc-input id=\"share-btn\" class=\"small-btn\" .disabled=\"${null==this.selectedDashboard}\" type=\"${InputType.BUTTON}\" icon=\"open-in-new\"\n                                                          @or-mwc-input-changed=\"${()=>{this.openDashboardInInsights()}}\"\n                                            ></or-mwc-input>\n                                            <or-mwc-input id=\"view-btn\" class=\"hideMobile\" ?hidden=\"${null==this.selectedDashboard||this._isReadonly()||!this._hasEditAccess()}\" type=\"${InputType.BUTTON}\" outlined icon=\"pencil\" label=\"editAsset\"\n                                                          @or-mwc-input-changed=\"${()=>{this.dispatchEvent(new CustomEvent(\"editToggle\",{detail:!0}))}}\">\n                                            </or-mwc-input>\n                                        `))}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    `}\n                    <div id=\"content\" style=\"flex: 1;\">\n                        <div id=\"container\">\n                            ${!this.editMode||!this._isReadonly()&&this._hasEditAccess()?void 0:html`\n                                <div style=\"display: flex; justify-content: center; align-items: center; height: 100%;\">\n                                    <span>${this._hasEditAccess()?i18next.t(\"errorOccurred\"):i18next.t(\"noDashboardWriteAccess\")}.</span>\n                                </div>\n                            `}\n                            <div id=\"builder\" style=\"${styleMap(r)}\">\n                                ${null!=this.selectedDashboard?html`\n                                    <or-dashboard-preview class=\"editor\" style=\"background: transparent;\"\n                                                          .realm=\"${this.realm}\" .template=\"${this.currentTemplate}\"\n                                                          .selectedWidget=\"${null===(s=null===(i=null===(t=this.selectedDashboard)||void 0===t?void 0:t.template)||void 0===i?void 0:i.widgets)||void 0===s?void 0:s.find((e=>e.id==this.selectedWidgetId))}\" .editMode=\"${this.editMode}\"\n                                                          .fullscreen=\"${this.fullscreen}\" .readonly=\"${this._isReadonly()}\"\n                                                          @selected=\"${e=>{this.selectWidget(e.detail)}}\"\n                                                          @deselected=\"${()=>{this.deselectWidget()}}\"\n                                                          @created=\"${e=>{this.onWidgetCreation(e.detail)}}\"\n                                                          @changed=\"${e=>{this.currentTemplate=e.detail.template}}\"\n                                    ></or-dashboard-preview>\n                                `:html`\n                                    <div style=\"display: flex; justify-content: center; align-items: center; height: 100%;\">\n                                        <span>${i18next.t(\"noDashboardSelected\")}</span>\n                                    </div>\n                                `}\n                            </div>\n                            ${when(null!=this.selectedDashboard&&this.editMode&&!this._isReadonly()&&this._hasEditAccess(),(()=>{var e,t,i,s;const r=null===(i=null===(t=null===(e=this.selectedDashboard)||void 0===e?void 0:e.template)||void 0===t?void 0:t.widgets)||void 0===i?void 0:i.find((e=>e.id==this.selectedWidgetId));return html`\n                                    <div id=\"sidebar\" class=\"hideMobile\">\n                                        ${null!=this.selectedWidgetId?html`\n                                            <div class=\"settings-container\">\n                                                <div id=\"menu-header\">\n                                                    <div id=\"title-container\">\n                                                        <span id=\"title\" title=\"${null==r?void 0:r.displayName}\">${null==r?void 0:r.displayName}</span>\n                                                    </div>\n                                                    <div id=\"sidebar-widget-headeractions\">\n                                                        <or-mwc-input type=\"${InputType.BUTTON}\" icon=\"delete\" @or-mwc-input-changed=\"${()=>{showOkCancelDialog(i18next.t(\"areYouSure\"),i18next.t(\"dashboard.deleteWidgetWarning\"),i18next.t(\"delete\")).then((e=>{e&&this.deleteWidget(r)}))}}\"></or-mwc-input>\n                                                        <or-mwc-input type=\"${InputType.BUTTON}\" icon=\"close\" @or-mwc-input-changed=\"${()=>{this.deselectWidget()}}\"></or-mwc-input>\n                                                    </div>\n                                                </div>\n                                                <div id=\"content\" class=\"hidescroll\" style=\"flex: 1; overflow: hidden auto;\">\n                                                    <div style=\"position: relative;\">\n                                                        <or-dashboard-widgetsettings style=\"position: absolute;\" .selectedWidget=\"${r}\" .realm=\"${this.realm}\"\n                                                                                     @delete=\"${e=>{this.deleteWidget(e.detail)}}\"\n                                                                                     @update=\"${e=>{var t,i;this.currentTemplate=Object.assign({},null===(t=this.selectedDashboard)||void 0===t?void 0:t.template),e.detail.force&&(this.deselectWidget(),null===(i=this.dashboardPreview)||void 0===i||i.refreshPreview())}}\"\n                                                        ></or-dashboard-widgetsettings>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        `:void 0}\n                                        <div class=\"settings-container\" style=\"${null!=this.selectedWidgetId?css`display: none`:null}\">\n                                            <div style=\"border-bottom: 1px solid ${unsafeCSS(DefaultColor5)};\">\n                                                <or-mwc-tabs .items=\"${this.tabItems}\" noScroll @activated=\"${e=>{this.sidebarMenuIndex=e.detail.index}}\" style=\"pointer-events: ${this.selectedDashboard?void 0:\"none\"}\"></or-mwc-tabs>\n                                            </div>\n                                            <div id=\"content\" class=\"hidescroll\" style=\"flex: 1; overflow: hidden auto;\">\n                                                <div style=\"position: relative;\">\n                                                    <or-dashboard-browser id=\"browser\" style=\"position: absolute; ${0!=this.sidebarMenuIndex?css`display: none`:null}\"></or-dashboard-browser>\n                                                    <or-dashboard-boardsettings style=\"position: absolute; ${1!=this.sidebarMenuIndex?css`display: none`:null}\" \n                                                                                .dashboard=\"${this.selectedDashboard}\" .showPerms=\"${(null===(s=this.selectedDashboard)||void 0===s?void 0:s.ownerId)==this.userId}\" \n                                                                                @update=\"${e=>{var t,i;this.currentTemplate=Object.assign({},null===(t=this.selectedDashboard)||void 0===t?void 0:t.template),e.detail.force&&(this.deselectWidget(),null===(i=this.dashboardPreview)||void 0===i||i.refreshPreview())}}\"\n                                                    ></or-dashboard-boardsettings>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                `}))}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `:html`\n            <div id=\"container\" style=\"justify-content: center; align-items: center;\">\n                ${this.isInitializing?html`\n                    <span>${i18next.t(\"loading\")}.</span>\n                `:html`\n                    <span>${i18next.t(\"errorOccurred\")}.</span>\n                `}\n            </div>\n        `}onIntervalSelect(e){this.refreshInterval=e.detail}};__decorate([property()],OrDashboardBuilder.prototype,\"config\",void 0),__decorate([property()],OrDashboardBuilder.prototype,\"editMode\",void 0),__decorate([property()],OrDashboardBuilder.prototype,\"fullscreen\",void 0),__decorate([property()],OrDashboardBuilder.prototype,\"selectedId\",void 0),__decorate([property()],OrDashboardBuilder.prototype,\"realm\",void 0),__decorate([property()],OrDashboardBuilder.prototype,\"userId\",void 0),__decorate([property()],OrDashboardBuilder.prototype,\"readonly\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"dashboards\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"currentTemplate\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"selectedDashboard\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"selectedWidgetId\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"initialDashboardJSON\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"initialTemplateJSON\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"refreshInterval\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"isInitializing\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"isLoading\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"hasChanged\",void 0),__decorate([query(\"or-dashboard-preview\")],OrDashboardBuilder.prototype,\"dashboardPreview\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"sidebarMenuIndex\",void 0),__decorate([state()],OrDashboardBuilder.prototype,\"showDashboardTree\",void 0),OrDashboardBuilder=__decorate([customElement(\"or-dashboard-builder\")],OrDashboardBuilder);export{OrDashboardBuilder};",null,"var __decorate=this&&this.__decorate||function(e,r,t,a){var s,o=arguments.length,d=o<3?r:null===a?a=Object.getOwnPropertyDescriptor(r,t):a;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)d=Reflect.decorate(e,r,t,a);else for(var i=e.length-1;i>=0;i--)(s=e[i])&&(d=(o<3?s(d):o>3?s(r,t,d):s(r,t))||d);return o>3&&d&&Object.defineProperty(r,t,d),d};import{css,html,LitElement,unsafeCSS}from\"lit\";import{customElement,property,query}from\"lit/decorators.js\";import{MDCDrawer}from\"@material/drawer\";import{classMap}from\"lit/directives/class-map.js\";const drawerStyle=require(\"@material/drawer/dist/mdc.drawer.css\");export class OrMwcDrawerChangedEvent extends CustomEvent{constructor(e){super(OrMwcDrawerChangedEvent.NAME,{detail:e,bubbles:!0,composed:!0})}}OrMwcDrawerChangedEvent.NAME=\"or-mwc-drawer-changed\";let OrMwcDrawer=class extends LitElement{constructor(){super(...arguments),this.dismissible=!1,this.rightSided=!1,this.transparent=!1,this.open=!1}static get styles(){return[css`${unsafeCSS(drawerStyle)}`,css`\n      .transparent{\n        background: none;\n      }`]}toggle(){this.open=!this.open}disconnectedCallback(){super.disconnectedCallback(),this.drawer&&(this.drawer.destroy(),this.drawer=void 0)}render(){const e=!this.dismissible,r={\"mdc-drawer--dismissible\":this.dismissible,\"mdc-drawer--modal\":e,transparent:this.transparent};return html`\n      <aside class=\"mdc-drawer ${classMap(r)}\" dir=\"${this.rightSided?\"rtl\":\"ltr\"}\">\n        ${this.header}\n        <div class=\"mdc-drawer__content\" dir=\"ltr\">\n          <slot></slot>\n        </div>\n      </aside>`}updated(){this.drawer.open!==this.open&&(this.drawer.open=this.open)}dispatchChangedEvent(e){this.dispatchEvent(new OrMwcDrawerChangedEvent(e))}firstUpdated(){this.drawer=MDCDrawer.attachTo(this.drawerElement),this.drawer.listen(\"MDCDrawer:opened\",(()=>{this.dispatchChangedEvent(!0)})),this.drawer.listen(\"MDCDrawer:closed\",(()=>{this.dispatchChangedEvent(!1)})),this.appContent&&this.appContent.classList.add(\"mdc-drawer-app-content\"),this.topBar&&this.topBar.classList.add(\"mdc-top-app-bar\")}};__decorate([property({attribute:!1})],OrMwcDrawer.prototype,\"header\",void 0),__decorate([property({type:Boolean})],OrMwcDrawer.prototype,\"dismissible\",void 0),__decorate([property({type:Boolean})],OrMwcDrawer.prototype,\"rightSided\",void 0),__decorate([property({type:Boolean})],OrMwcDrawer.prototype,\"transparent\",void 0),__decorate([property({type:Boolean})],OrMwcDrawer.prototype,\"open\",void 0),__decorate([property({attribute:!1})],OrMwcDrawer.prototype,\"appContent\",void 0),__decorate([property({attribute:!1})],OrMwcDrawer.prototype,\"topBar\",void 0),__decorate([query(\".mdc-drawer\")],OrMwcDrawer.prototype,\"drawerElement\",void 0),OrMwcDrawer=__decorate([customElement(\"or-mwc-drawer\")],OrMwcDrawer);export{OrMwcDrawer};","var OrRuleList_1,__decorate=this&&this.__decorate||function(e,t,s,i){var l,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(l=e[n])&&(o=(r<3?l(o):r>3?l(t,s,o):l(t,s))||o);return r>3&&o&&Object.defineProperty(t,s,o),o},__awaiter=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(l,r){function o(e){try{a(i.next(e))}catch(e){r(e)}}function n(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,n)}a((i=i.apply(e,t||[])).next())}))};import{css,html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import\"@openremote/or-translate\";import manager,{Util}from\"@openremote/core\";import\"@openremote/or-mwc-components/or-mwc-input\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{style as OrAssetTreeStyle}from\"@openremote/or-asset-tree\";import{OrRules,OrRulesAddEvent,OrRulesRequestAddEvent,OrRulesRequestDeleteEvent,OrRulesRequestSelectionEvent,OrRulesSelectionEvent,RuleViewInfoMap}from\"./index\";import\"@openremote/or-mwc-components/or-mwc-menu\";import{getContentWithMenuTemplate}from\"@openremote/or-mwc-components/or-mwc-menu\";import{translate}from\"@openremote/or-translate\";import i18next from\"i18next\";import{showErrorDialog,showOkCancelDialog}from\"@openremote/or-mwc-components/or-mwc-dialog\";const style=css`\n    :host {\n        flex-grow: 1;\n        font-size: var(--internal-or-rules-list-text-size);\n        \n        /*Override asset tree styles*/\n        --internal-or-asset-tree-header-height: var(--internal-or-rules-list-header-height);\n    }\n    \n    #wrapper {\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        width: 100%;\n    }\n\n    #wrapper[data-disabled] {\n        opacity: 0.3;\n        pointer-events: none;\n    }\n\n    .node-container {\n        align-items: center;\n        padding-left: 10px;\n    }\n    \n    .header-ruleset-type {\n        display: flex;\n        align-items: center;\n        height: var(--internal-or-asset-tree-header-height);\n        line-height: var(--internal-or-asset-tree-header-height);\n        color: var(--internal-or-rules-panel-color);\n        background-color: var(--internal-or-rules-header-background-color);\n    }\n    \n    #header-btns {\n        --or-mwc-input-color: var(--internal-or-rules-text-color);\n    }\n    \n    .header-ruleset-type p {\n        margin: 0 15px;\n    }\n\n    .node-status {\n        --or-icon-width: 18px; \n        margin-right: 8px;\n    }\n\n    .node-language{\n        padding-left: 10px;\n        opacity: 50%;\n    }\n\n    .iconfill-gray {\n        --or-icon-fill: var(--internal-or-rules-list-icon-color-ok);\n    }\n\n    .iconfill-red {\n        --or-icon-fill: var(--internal-or-rules-list-icon-color-error);\n    }\n`;let OrRuleList=OrRuleList_1=class extends(translate(i18next)(LitElement)){constructor(){super(...arguments),this.readonly=!1,this.disabled=!1,this.multiSelect=!0,this._showLoading=!0,this._globalRulesets=!1,this._selectedNodes=[],this._rulesetPromises=new Map,this._ready=!1}static get styles(){return[OrAssetTreeStyle,style]}refresh(){return __awaiter(this,void 0,void 0,(function*(){this._nodes=void 0}))}get _allowedLanguages(){const e=this.config&&this.config.controls&&this.config.controls.allowedLanguages?[...this.config.controls.allowedLanguages]:OrRuleList_1.DEFAULT_ALLOWED_LANGUAGES,t=e.indexOf(\"GROOVY\"),s=e.indexOf(\"FLOW\");return manager.isSuperUser()?t<0&&e.push(\"GROOVY\"):t>0&&e.splice(t,1),this._globalRulesets&&s>0&&e.splice(s,1),e}_updateLanguage(){const e=this._allowedLanguages;e&&0!==e.length?(!this.language||e.indexOf(this.language)<0)&&(this.language=e[0]):this.language=void 0}_onReady(){this._ready=!0,this._loadRulesets()}firstUpdated(e){super.firstUpdated(e),manager.ready&&this._onReady()}shouldUpdate(e){const t=super.shouldUpdate(e);if(this.sortBy||(this.sortBy=\"name\"),e.has(\"language\")&&this._updateLanguage(),e.has(\"_globalRulesets\")&&(this._updateLanguage(),this.refresh()),manager.ready){if(!this._nodes)return this._loadRulesets(),!0;if(e.has(\"selectedIds\")){let t=!0;const s=e.get(\"selectedIds\");this.selectedIds&&s&&this.selectedIds.length===s.length&&(t=!!this.selectedIds.find((e=>s.indexOf(e)<0))),t&&this._updateSelectedNodes()}e.has(\"sortBy\")&&OrRuleList_1._updateSort(this._nodes,this._getSortFunction())}return t}render(){this.language||this._updateLanguage();const e=this._allowedLanguages,t=[\"name\",\"createdOn\",\"status\"];e&&e.length>1&&t.push(\"lang\");let s=\"\";return this._isReadonly()||(s=e&&e.length>1?getContentWithMenuTemplate(html`<or-mwc-input type=\"${InputType.BUTTON}\" icon=\"plus\"></or-mwc-input>`,e.map((e=>({value:e,text:i18next.t(\"rulesLanguages.\"+e)}))),this.language,(e=>this._onAddClicked(e))):html`<or-mwc-input type=\"${InputType.BUTTON}\" icon=\"plus\" @or-mwc-input-changed=\"${()=>this._onAddClicked(this.language)}\"></or-mwc-input>`),html`\n            <div id=\"wrapper\" ?data-disabled=\"${this.disabled}\">\n                ${manager.isSuperUser()?html`\n                    <div class=\"header-ruleset-type\">\n                        <p>${i18next.t(\"realmRules\")}</p>\n                        \n                        <div style=\"flex: 1 1 0; display: flex;\">\n                            <or-mwc-input style=\"margin: auto;\" type=\"${InputType.SWITCH}\" @or-mwc-input-changed=\"${e=>this._globalRulesets=e.detail.value}\"></or-mwc-input>\n                        </div>\n\n                        <p>${i18next.t(\"globalRules\")}</p>\n                    </div>\n                `:\"\"}\n\n                <div id=\"header\">\n                    <div id=\"title-container\">\n                        <or-translate id=\"title\" value=\"rule_plural\"></or-translate>\n                    </div>\n        \n                    <div id=\"header-btns\">\n                        <or-mwc-input ?hidden=\"${this._isReadonly()||!this.selectedIds||0===this.selectedIds.length}\" type=\"${InputType.BUTTON}\" icon=\"content-copy\" @or-mwc-input-changed=\"${()=>this._onCopyClicked()}\"></or-mwc-input>\n                        <or-mwc-input ?hidden=\"${this._isReadonly()||!this.selectedIds||0===this.selectedIds.length}\" type=\"${InputType.BUTTON}\" icon=\"delete\" @or-mwc-input-changed=\"${()=>this._onDeleteClicked()}\"></or-mwc-input>\n                        ${s}\n                        <or-mwc-input hidden type=\"${InputType.BUTTON}\" icon=\"magnify\" @or-mwc-input-changed=\"${()=>this._onSearchClicked()}\"></or-mwc-input>\n                        \n                        ${getContentWithMenuTemplate(html`<or-mwc-input type=\"${InputType.BUTTON}\" icon=\"sort-variant\" ></or-mwc-input>`,t.map((e=>({value:e,text:i18next.t(e)}))),this.sortBy,(e=>this._onSortClicked(e)))}\n                    </div>\n                </div>\n        \n                ${!this._nodes||this._showLoading?html`\n                        <span id=\"loading\"><or-translate value=\"loading\"></or-translate></span>`:html`\n                        <div id=\"list-container\">\n                            <ol id=\"list\">\n                                ${this._nodes.map((e=>this._nodeTemplate(e)))}\n                            </ol>\n                        </div>\n                    `}\n        \n                <div id=\"footer\">\n                \n                </div>\n            </div>\n        `}_isReadonly(){return this.readonly||!manager.hasRole(\"write:rules\")}_nodeTemplate(e){let t=\"help\",s=\"iconfill-gray\",i=\"mdi-state-machine\",l=\"Unknown language\";switch(e.ruleset.status){case\"DEPLOYED\":t=\"\",s=\"iconfill-gray\";break;case\"READY\":t=\"check\",s=\"iconfill-gray\";break;case\"COMPILATION_ERROR\":case\"LOOP_ERROR\":case\"EXECUTION_ERROR\":t=\"alert-octagon\",s=\"iconfill-red\";break;case\"DISABLED\":t=\"minus-circle\",s=\"iconfill-gray\";break;case\"PAUSED\":t=\"calendar-arrow-right\",s=\"iconfill-gray\";break;case\"EXPIRED\":t=\"calendar-remove\",s=\"iconfill-gray\";break;case\"REMOVED\":t=\"close\",s=\"iconfill-gray\";break;default:t=\"stop\",s=\"iconfill-gray\"}switch(e.ruleset.lang){case\"JSON\":i=\"ray-start-arrow\",l=\"rulesLanguages.JSON\";break;case\"FLOW\":i=\"transit-connection-variant\",l=\"rulesLanguages.FLOW\";break;case\"GROOVY\":i=\"alpha-g-box-outline\",l=\"rulesLanguages.GROOVY\";break;case\"JAVASCRIPT\":i=\"language-javascript\",l=\"rulesLanguages.JAVASCRIPT\";break;default:i=\"mdi-state-machine\",l=\"Unknown language\"}return html`\n            <li ?data-selected=\"${e.selected}\" @click=\"${t=>this._onNodeClicked(t,e)}\">\n                <div class=\"node-container\">\n                    <or-icon style=\"--or-icon-width: 18px; margin-right: 8px;\" icon=\"${i}\" title=\"${i18next.t(l)}\"></or-icon>\n                    <span class=\"node-name\">${e.ruleset.name}</span>\n                    <or-icon class=\"node-status ${s}\" title=\"${i18next.t(\"rulesetStatus.\"+(e.ruleset.status?e.ruleset.status:\"NOSTATUS\"))}\" icon=\"${t}\"></or-icon>\n                </div>\n            </li>\n        `}static _getNodeStatusClasses(e){let t=e.enabled?\"bg-green\":\"bg-red\";if(e.enabled&&e.meta&&e.meta.validity){const s=e.meta.validity,i=(new Date).getTime();s.start&&(i<s.start?t=\"bg-blue\":s.end&&i>s.end?t=\"bg-grey\":s.recurrence)}return t}_updateSelectedNodes(){const e=[],t=[];this._nodes&&this._nodes.forEach((s=>{this.selectedIds&&this.selectedIds.indexOf(s.ruleset.id)>=0?(e.push(s.ruleset.id),t.push(s),s.selected=!0):s.selected=!1})),this.selectedIds=e;const s=this._selectedNodes;this._selectedNodes=t,this.dispatchEvent(new OrRulesSelectionEvent({oldNodes:s,newNodes:t}))}static _updateSort(e,t){e&&e.sort(t)}_onNodeClicked(e,t){if(e.defaultPrevented)return;e.preventDefault();let s=[];const i=this._selectedNodes.indexOf(t);let l=!0,r=!0;!this._isReadonly()&&this.multiSelect&&(!this.config||!this.config.controls||!this.config.controls.multiSelect)&&(e.ctrlKey||e.metaKey)&&(r=!1,i>=0&&this._selectedNodes&&this._selectedNodes.length>1&&(l=!1)),r?s=[t]:l?i<0&&(s=[...this._selectedNodes],s.push(t)):i>=0&&(s=[...this._selectedNodes],s.splice(i,1)),Util.dispatchCancellableEvent(this,new OrRulesRequestSelectionEvent({oldNodes:this._selectedNodes,newNodes:s})).then((e=>{e.allow&&(this.selectedIds=e.detail.newNodes.map((e=>e.ruleset.id)))}))}_onCopyClicked(){if(1!==this._selectedNodes.length)return;const e=this._selectedNodes[0],t=JSON.parse(JSON.stringify(e.ruleset));delete t.lastModified,delete t.createdOn,delete t.status,delete t.error,delete t.id,t.name=t.name+\" copy\",this.config&&this.config.rulesetCopyHandler&&!this.config.rulesetCopyHandler(t)||Util.dispatchCancellableEvent(this,new OrRulesRequestAddEvent({ruleset:t,sourceRuleset:e.ruleset})).then((e=>{e.allow&&this.dispatchEvent(new OrRulesAddEvent(e.detail))}))}_onAddClicked(e){const t=this._globalRulesets?\"global\":\"realm\",s=manager.isSuperUser()?manager.displayRealm:manager.config.realm,i={id:0,type:t,name:OrRules.DEFAULT_RULESET_NAME,lang:e,realm:s,rules:void 0};if(this.config&&this.config.rulesetAddHandler&&!this.config.rulesetAddHandler(i))return;this.config&&this.config.rulesetTemplates&&this.config.rulesetTemplates[e]?i.rules=this.config.rulesetTemplates[e]:i.rules=RuleViewInfoMap[e].viewRulesetTemplate,\"realm\"===t&&(i.realm=s);const l={ruleset:i,isCopy:!1};Util.dispatchCancellableEvent(this,new OrRulesRequestAddEvent(l)).then((e=>{e.allow&&this.dispatchEvent(new OrRulesAddEvent(e.detail))}))}_onDeleteClicked(){this._selectedNodes.length>0&&Util.dispatchCancellableEvent(this,new OrRulesRequestDeleteEvent(this._selectedNodes)).then((e=>{e.allow&&this._doDelete()}))}_doDelete(){if(!this._selectedNodes||0===this._selectedNodes.length)return;const e=this._selectedNodes.map((e=>e.ruleset)),t=e.map((e=>\"\\n- \"+e.name)),s=()=>__awaiter(this,void 0,void 0,(function*(){this.disabled=!0;let t=!1;for(const s of e)if(!this.config||!this.config.rulesetDeleteHandler||this.config.rulesetDeleteHandler(s))try{let e;switch(s.type){case\"asset\":e=yield manager.rest.api.RulesResource.deleteAssetRuleset(s.id);break;case\"realm\":e=yield manager.rest.api.RulesResource.deleteRealmRuleset(s.id);break;case\"global\":e=yield manager.rest.api.RulesResource.deleteGlobalRuleset(s.id)}204!==e.status&&(console.error(\"Delete ruleset returned unexpected status '\"+e.status+\"': \"+JSON.stringify(s,null,2)),t=!0)}catch(e){console.error(\"Failed to delete ruleset: \"+JSON.stringify(s,null,2),e),t=!0}t&&showErrorDialog(i18next.t(\"deleteAssetsFailed\")),this.disabled=!1,this.refresh()}));showOkCancelDialog(i18next.t(\"deleteRulesets\"),i18next.t(\"deleteRulesetsConfirm\",{ruleNames:t}),i18next.t(\"delete\")).then((e=>{e&&s()}))}_onSearchClicked(){}_onSortClicked(e){this.sortBy=e}_getSortFunction(){return\"createdOn\"===this.sortBy?Util.sortByNumber((e=>e.ruleset[this.sortBy])):Util.sortByString((e=>e.ruleset[this.sortBy]))}_getRealm(){return manager.isSuperUser()?manager.displayRealm:manager.getRealm()}_loadRulesets(){return __awaiter(this,void 0,void 0,(function*(){const e=this._getSortFunction();let t;if(this._globalRulesets)0!=this._rulesetPromises.size||this._rulesetPromises.has(\"global\")||this._rulesetPromises.set(\"global\",new Promise((e=>__awaiter(this,void 0,void 0,(function*(){const t=yield manager.rest.api.RulesResource.getGlobalRulesets({fullyPopulate:!0});e(t.data)}))))),t=yield this._rulesetPromises.get(\"global\"),this._rulesetPromises.delete(\"global\");else{const e=this._getRealm()||manager.displayRealm;0!=this._rulesetPromises.size||this._rulesetPromises.has(e)||this._rulesetPromises.set(e,new Promise((t=>__awaiter(this,void 0,void 0,(function*(){const s={fullyPopulate:!0,language:this._allowedLanguages},i=yield manager.rest.api.RulesResource.getRealmRulesets(e,s);t(i.data)}))))),t=yield this._rulesetPromises.get(e),this._rulesetPromises.delete(e)}t&&this._buildTreeNodes(t,e)}))}_buildTreeNodes(e,t){if(e&&0!==e.length){const s=e.map((e=>({ruleset:e})));s.sort(t),this._nodes=s}else this._nodes=[];this.selectedIds&&this.selectedIds.length>0&&this._updateSelectedNodes(),this._showLoading=!1}};OrRuleList.DEFAULT_ALLOWED_LANGUAGES=[\"JSON\",\"GROOVY\",\"JAVASCRIPT\",\"FLOW\"],__decorate([property({type:Object})],OrRuleList.prototype,\"config\",void 0),__decorate([property({type:Boolean})],OrRuleList.prototype,\"readonly\",void 0),__decorate([property({type:Boolean})],OrRuleList.prototype,\"disabled\",void 0),__decorate([property({type:Boolean})],OrRuleList.prototype,\"multiSelect\",void 0),__decorate([property({type:Array})],OrRuleList.prototype,\"selectedIds\",void 0),__decorate([property({type:String})],OrRuleList.prototype,\"sortBy\",void 0),__decorate([property({type:String})],OrRuleList.prototype,\"language\",void 0),__decorate([property({attribute:!1})],OrRuleList.prototype,\"_nodes\",void 0),__decorate([property({attribute:!1})],OrRuleList.prototype,\"_showLoading\",void 0),__decorate([property({type:Boolean})],OrRuleList.prototype,\"_globalRulesets\",void 0),OrRuleList=OrRuleList_1=__decorate([customElement(\"or-rule-list\")],OrRuleList);export{OrRuleList};","import{DefaultColor5}from\"@openremote/core\";import{css,unsafeCSS}from\"lit\";export const invalidStyle=css`\n    *:invalid {\n        border-bottom: 2px solid var(--internal-or-rules-invalid-color);\n    }\n`;export const buttonStyle=css`\n    .button-clear {\n        background: none;\n        color: ${unsafeCSS(DefaultColor5)};\n        --or-icon-fill: ${unsafeCSS(DefaultColor5)};\n        visibility: hidden;\n        display: inline-block;\n        border: none;\n        padding: 0;\n        cursor: pointer;\n    }\n\n    .button-clear:hover {\n        --or-icon-fill: var(--internal-or-rules-button-color);\n    }\n\n    .button-clear:focus {\n        outline: 0;\n    }\n\n    .button-clear.hidden {\n        visibility: hidden;\n    }\n\n    .plus-button {\n        --or-icon-fill: var(--internal-or-rules-button-color);\n    }\n    \n    .add-button {\n        display: inline-block;\n        font-weight: bold;\n        font-size: 15px;\n        line-height: 24px;\n    }\n\n    .add-buttons-container {\n        display: flex;\n        flex-direction: column;\n        margin-top: 10px;\n        margin-bottom: -10px;\n        padding-top: 5px;\n        border-top-width: 1px;\n        border-top-style: solid;\n        border-color: var(--internal-or-rules-line-color);\n    }\n\n    .add-buttons-container.hidden {\n        border: none;\n        margin: 0;\n        padding: 0;\n    }\n    \n    .add-buttons-container > button {\n        display: inline-flex;\n    }\n\n    .add-buttons-container > button > or-icon {\n        margin-right: 5px;\n    }\n`;","var __decorate=this&&this.__decorate||function(e,t,r,o){var a,i=arguments.length,l=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)l=Reflect.decorate(e,t,r,o);else for(var n=e.length-1;n>=0;n--)(a=e[n])&&(l=(i<3?a(l):i>3?a(t,r,l):a(t,r))||l);return i>3&&l&&Object.defineProperty(t,r,l),l};import{html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{getAssetTypeFromQuery}from\"../../index\";import\"@openremote/or-mwc-components/or-mwc-input\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import i18next from\"i18next\";import{OrRulesJsonRuleChangedEvent}from\"../or-rule-json-viewer\";import{translate}from\"@openremote/or-translate\";import{OrMwcDialogOpenedEvent}from\"@openremote/or-mwc-components/or-mwc-dialog\";import{OrMapClickedEvent}from\"@openremote/or-map\";import\"@openremote/or-map\";let OrRuleRadialModal=class extends(translate(i18next)(LitElement)){constructor(){super(),this.addEventListener(OrMwcDialogOpenedEvent.NAME,this.initRadialMap)}initRadialMap(){const e=this.shadowRoot.getElementById(\"radial-modal\");if(!e)return;const t=e.shadowRoot.querySelector(\".or-map\");if(t){t.addEventListener(OrMapClickedEvent.NAME,(t=>{const r=t.detail.lngLat,o=e.shadowRoot.querySelector(\".location-lat\"),a=e.shadowRoot.querySelector(\".location-lng\");o.value=r.lat,a.value=r.lng;const i=new Event(\"change\");o.dispatchEvent(i),a.dispatchEvent(i),this.setValuePredicateProperty(\"lat\",r.lat),this.setValuePredicateProperty(\"lng\",r.lng)}));const r=e.shadowRoot.querySelector(\".location-lat\"),o=e.shadowRoot.querySelector(\".location-lng\");if(o.value&&r.value){const e=[parseFloat(o.value),parseFloat(r.value)];t.flyTo(e,15)}else t.flyTo()}}getAttributeName(e){return e&&e.name?e.name.value:void 0}setValuePredicateProperty(e,t){this.attributePredicate&&this.attributePredicate.value&&(this.attributePredicate.value[e]=t,this.attributePredicate=Object.assign({},this.attributePredicate),this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate())}renderDialogHTML(e){const t=this.shadowRoot.getElementById(\"radial-modal\");t&&(t.content=html`\n                <div style=\"display:grid\">\n                    <or-map class=\"or-map\" type=\"VECTOR\" style=\"border: 1px solid #d5d5d5; height: 400px; min-width: 300px; margin-bottom: 20px;\">\n                        <or-map-marker active color=\"#FF0000\" icon=\"information\" lat=\"${e.lat}\" lng=\"${e.lng}\" radius=\"${e.radius}\"></or-map-marker>\n                    </or-map>\n                \n                    <div class=\"layout horizontal\">\n                        <input hidden class=\"location-lng\"  required placeholder=\" \" type=\"text\" .value=\"${e&&e.lng?e.lng:null}\" />\n                        <input hidden class=\"location-lat\" required placeholder=\" \" type=\"text\" .value=\"${e&&e.lat?e.lat:null}\" />\n                    </div>\n\n                    <label>${i18next.t(\"radiusMin\")}</label>\n                    <input @change=\"${e=>this.setValuePredicateProperty(\"radius\",parseInt(e.target.value))}\" style=\"max-width: calc(50% - 30px);\" required placeholder=\" \" min=\"100\" type=\"number\" .value=\"${e&&e.radius?e.radius:100}\" />\n                </div>`)}render(){if(!this.attributePredicate)return html``;if(!this.query)return html``;const e=this.attributePredicate.value;if(!this.assetDescriptor||!e)return html``;this.getAttributeName(this.attributePredicate),getAssetTypeFromQuery(this.query);const t=e||void 0,r=[{actionName:\"cancel\",content:html`<or-mwc-input class=\"button\" .type=\"${InputType.BUTTON}\" label=\"cancel\"></or-mwc-input>`,action:()=>{}},{actionName:\"ok\",default:!0,content:html`<or-mwc-input class=\"button\" .type=\"${InputType.BUTTON}\" label=\"ok\"></or-mwc-input>`,action:()=>{}}];return this.renderDialogHTML(t),html`\n            <or-mwc-input .type=\"${InputType.BUTTON}\" label=\"area\" @or-mwc-input-changed=\"${()=>{const e=this.shadowRoot.getElementById(\"radial-modal\");e&&(e.dismissAction=null,e.open(),this.renderDialogHTML(t))}}\"></or-mwc-input>\n            <or-mwc-dialog id=\"radial-modal\" heading=\"area\" .actions=\"${r}\"></or-mwc-dialog>\n        `}};__decorate([property({type:Object})],OrRuleRadialModal.prototype,\"assetDescriptor\",void 0),__decorate([property({type:Object})],OrRuleRadialModal.prototype,\"attributePredicate\",void 0),__decorate([property({type:Object})],OrRuleRadialModal.prototype,\"query\",void 0),OrRuleRadialModal=__decorate([customElement(\"or-rule-radial-modal\")],OrRuleRadialModal);export{OrRuleRadialModal};","var __decorate=this&&this.__decorate||function(e,t,r,s){var a,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var u=e.length-1;u>=0;u--)(a=e[u])&&(o=(i<3?a(o):i>3?a(t,r,o):a(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o},__awaiter=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(a,i){function o(e){try{n(s.next(e))}catch(e){i(e)}}function u(e){try{n(s.throw(e))}catch(e){i(e)}}function n(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,u)}n((s=s.apply(e,t||[])).next())}))};import{css,html,LitElement}from\"lit\";import{customElement,property,state}from\"lit/decorators.js\";import{AssetModelUtil}from\"@openremote/model\";import{AssetQueryOperator,getAssetIdsFromQuery,getAssetTypeFromQuery}from\"../index\";import\"@openremote/or-mwc-components/or-mwc-input\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import\"@openremote/or-attribute-input\";import{Util}from\"@openremote/core\";import i18next from\"i18next\";import{buttonStyle}from\"../style\";import{OrRulesJsonRuleChangedEvent}from\"./or-rule-json-viewer\";import{translate}from\"@openremote/or-translate\";import\"./modals/or-rule-radial-modal\";import{ifDefined}from\"lit/directives/if-defined.js\";import{when}from\"lit/directives/when.js\";const style=css`\n    \n    ${buttonStyle}\n    \n    :host {\n        display: block;\n    }\n    \n    .attribute-group {\n        flex-grow: 1;\n        display: flex;\n        align-items: start;\n        flex-direction: row;\n        flex-wrap: wrap;\n    }\n\n    .min-width {\n        min-width: 200px;\n    }\n    \n    .attribute-group > * {\n        margin: 10px 3px 6px 3px;\n    }\n    .attributes {\n        flex: 1 1 min-content;\n        display: flex;\n        flex-direction: column;\n        row-gap: 10px;\n    }\n    or-icon.small {\n        --or-icon-width: 14px;\n        --or-icon-height: 14px;\n    }\n    .attribute {\n        display: flex;\n        align-items: center;\n    }\n    .attribute > div {\n        display: flex;\n        flex-direction: row;\n        flex-wrap: wrap;\n        align-items: center;\n        gap: 6px;\n    }    \n    .attribute > div > * {\n        min-width: 200px;\n    }\n    .button-clear {\n        margin-left: auto;\n    }\n    .attribute:hover .button-clear {\n        visibility: visible;\n    }\n    \n    .invalidLabel {\n        display: flex;\n        align-items: center;\n        margin: 14px 3px auto 0;\n        height: 48px; /* Same as the icon size */\n    }\n`;let OrRuleAssetQuery=class extends(translate(i18next)(LitElement)){constructor(){super(),this._queryOperatorsMap={},this._queryOperatorsMap.GEO_JSONPoint=[AssetQueryOperator.EQUALS,AssetQueryOperator.NOT_EQUALS,AssetQueryOperator.WITHIN_RADIUS,AssetQueryOperator.OUTSIDE_RADIUS,AssetQueryOperator.WITHIN_RECTANGLE,AssetQueryOperator.OUTSIDE_RECTANGLE,AssetQueryOperator.VALUE_EMPTY,AssetQueryOperator.VALUE_NOT_EMPTY],this._queryOperatorsMap.string=[AssetQueryOperator.EQUALS,AssetQueryOperator.NOT_EQUALS,AssetQueryOperator.CONTAINS,AssetQueryOperator.NOT_CONTAINS,AssetQueryOperator.STARTS_WITH,AssetQueryOperator.NOT_STARTS_WITH,AssetQueryOperator.ENDS_WITH,AssetQueryOperator.NOT_ENDS_WITH,AssetQueryOperator.VALUE_EMPTY,AssetQueryOperator.VALUE_NOT_EMPTY],this._queryOperatorsMap.number=[AssetQueryOperator.EQUALS,AssetQueryOperator.NOT_EQUALS,AssetQueryOperator.GREATER_THAN,AssetQueryOperator.GREATER_EQUALS,AssetQueryOperator.LESS_THAN,AssetQueryOperator.LESS_EQUALS,AssetQueryOperator.BETWEEN,AssetQueryOperator.NOT_BETWEEN,AssetQueryOperator.VALUE_EMPTY,AssetQueryOperator.VALUE_NOT_EMPTY],this._queryOperatorsMap.boolean=[AssetQueryOperator.IS_TRUE,AssetQueryOperator.IS_FALSE,AssetQueryOperator.VALUE_EMPTY,AssetQueryOperator.VALUE_NOT_EMPTY],this._queryOperatorsMap.array=[AssetQueryOperator.CONTAINS,AssetQueryOperator.NOT_CONTAINS,AssetQueryOperator.INDEX_CONTAINS,AssetQueryOperator.NOT_INDEX_CONTAINS,AssetQueryOperator.LENGTH_EQUALS,AssetQueryOperator.NOT_LENGTH_EQUALS,AssetQueryOperator.LENGTH_LESS_THAN,AssetQueryOperator.LENGTH_GREATER_THAN,AssetQueryOperator.VALUE_EMPTY,AssetQueryOperator.VALUE_NOT_EMPTY],this._queryOperatorsMap.object=[AssetQueryOperator.CONTAINS_KEY,AssetQueryOperator.NOT_CONTAINS_KEY,AssetQueryOperator.VALUE_EMPTY,AssetQueryOperator.VALUE_NOT_EMPTY]}refresh(){this._assets=void 0}attributePredicateEditorTemplate(e,t,r){const s=e.assetDescriptor,a=this.getOperator(r),i=this.getAttributeName(r);let o=t&&t.attributes&&i?t.attributes[i]:void 0,u=[];const n=AssetModelUtil.getAttributeAndValueDescriptors(t?t.type:s.name,o||i,o);u=t&&t.attributes?Object.values(t.attributes).filter((e=>e.meta&&(e.meta.hasOwnProperty(\"ruleState\")?e.meta.ruleState:e.meta.hasOwnProperty(\"agentLink\")))).map((e=>{const r=AssetModelUtil.getAttributeAndValueDescriptors(t.type,e.name,e),s=Util.getAttributeLabel(e,r[0],t.type,!1);return[e.name,s]})):e&&e.attributeDescriptors?e.attributeDescriptors.map((e=>{const t=AssetModelUtil.getAttributeAndValueDescriptors(s.name,e),r=Util.getAttributeLabel(void 0,t?t[0]:void 0,s.name,!1);return[e.name,r]})):[],u.sort(Util.sortByString((e=>e[1])));const p=i?this.getOperators(s,n?n[0]:void 0,n?n[1]:void 0,o,i):[];return html`\n            <or-mwc-input type=\"${InputType.SELECT}\" @or-mwc-input-changed=\"${e=>this.setAttributeName(r,e.detail.value)}\" .readonly=\"${this.readonly||!1}\" .options=\"${u}\" .value=\"${i}\" .label=\"${i18next.t(\"attribute\")}\"></or-mwc-input>\n            ${i?html`<or-mwc-input type=\"${InputType.SELECT}\" @or-mwc-input-changed=\"${e=>this.setOperator(s,o,i,r,e.detail.value)}\" .readonly=\"${this.readonly||!1}\" .options=\"${p}\" .value=\"${a}\" .label=\"${i18next.t(\"operator\")}\"></or-mwc-input>`:\"\"}\n            ${r?this.attributePredicateValueEditorTemplate(s,t,r):\"\"}\n        `}attributePredicateValueEditorTemplate(e,t,r){var s,a,i,o,u,n,p;const l=r.value;if(!e||!l)return\"\";const y=this.getAttributeName(r),A=getAssetTypeFromQuery(this.query),d=t&&t.attributes&&y?t.attributes[y]:void 0,c=AssetModelUtil.getAttributeAndValueDescriptors(A,y,d),T=l?l.value:void 0;switch(l.predicateType){case\"string\":return html`<or-attribute-input @or-attribute-input-changed=\"${e=>this.setValuePredicateProperty(l,\"value\",e.detail.value)}\" .customProvider=\"${null===(s=this.config)||void 0===s?void 0:s.inputProvider}\" .label=\"${i18next.t(\"value\")}\" .assetType=\"${A}\" .attributeDescriptor=\"${c[0]}\" .attributeValueDescriptor=\"${c[1]}\" .value=\"${T}\" .readonly=\"${this.readonly||!1}\" .fullWidth=\"${!0}\"></or-attribute-input>`;case\"boolean\":return html``;case\"datetime\":case\"rect\":default:return html`<span>NOT IMPLEMENTED</span>`;case\"number\":if(\"BETWEEN\"===l.operator)return html`\n                        <or-attribute-input .inputType=\"${InputType.NUMBER}\" @or-attribute-input-changed=\"${e=>this.setValuePredicateProperty(l,\"value\",e.detail.value)}\" .customProvider=\"${null===(a=this.config)||void 0===a?void 0:a.inputProvider}\" .label=\"${i18next.t(\"between\")}\" .assetType=\"${A}\" .attributeDescriptor=\"${c[0]}\" .attributeValueDescriptor=\"${c[1]}\" .value=\"${T}\" .readonly=\"${this.readonly||!1}\" .fullWidth=\"${!0}\"></or-attribute-input>\n                        <span style=\"display: inline-flex; align-items: center;\">&</span>\n                        <or-attribute-input .inputType=\"${InputType.NUMBER}\" @or-attribute-input-changed=\"${e=>this.setValuePredicateProperty(l,\"rangeValue\",e.detail.value)}\" .customProvider=\"${null===(i=this.config)||void 0===i?void 0:i.inputProvider}\" .label=\"${i18next.t(\"and\")}\" .assetType=\"${A}\" .attributeDescriptor=\"${c[0]}\" .attributeValueDescriptor=\"${c[1]}\" .value=\"${l.rangeValue}\" .readonly=\"${this.readonly||!1}\" .fullWidth=\"${!0}\"></or-attribute-input>\n                    `;let t;return(null===(u=null===(o=c[0])||void 0===o?void 0:o.format)||void 0===u?void 0:u.asSlider)&&(t=InputType.NUMBER),html`<or-attribute-input .inputType=\"${ifDefined(t)}\" @or-attribute-input-changed=\"${e=>this.setValuePredicateProperty(l,\"value\",e.detail.value)}\" .customProvider=\"${null===(n=this.config)||void 0===n?void 0:n.inputProvider}\" .label=\"\" .assetType=\"${A}\" .attributeDescriptor=\"${c[0]}\" .attributeValueDescriptor=\"${c[1]}\" .value=\"${T}\" .readonly=\"${this.readonly||!1}\" .fullWidth=\"${!0}\"></or-attribute-input>`;case\"radial\":return html`<or-rule-radial-modal .query=\"${this.query}\" .assetDescriptor=\"${e}\" .attributePredicate=\"${r}\"></or-rule-radial-modal>`;case\"value-empty\":return\"\";case\"array\":return html`<or-attribute-input @or-attribute-input-changed=\"${e=>this.setValuePredicateProperty(l,\"value\",e.detail.value)}\" .customProvider=\"${null===(p=this.config)||void 0===p?void 0:p.inputProvider}\" .label=\"\" .assetType=\"${A}\" .attributeDescriptor=\"${c[0]}\" .attributeValueDescriptor=\"${c[1]}\" .value=\"${T}\" .readonly=\"${this.readonly||!1}\" .fullWidth=\"${!0}></or-attribute-input>`}}static get styles(){return style}shouldUpdate(e){return e.has(\"condition\")&&(this._assets=void 0),super.shouldUpdate(e)}get query(){return this.condition.assets}render(){const e=getAssetTypeFromQuery(this.query);if(!e)return html`<span class=\"invalidLabel\">${i18next.t(\"errorOccurred\")}</span>`;const t=this.assetInfos?this.assetInfos.find((t=>t.assetDescriptor.name===e)):void 0;if(!t)return html`<span class=\"invalidLabel\">${i18next.t(\"errorOccurred\")}</span>`;this._assets||this.loadAssets(e),this.query.attributes||(this.query.attributes={}),this.query.attributes.items&&0!==this.query.attributes.items.length||(this.query.attributes.items=[{}]);const r=!this.readonly&&this.query.attributes&&this.query.attributes.items&&this.query.attributes.items.length>1,s=getAssetIdsFromQuery(this.query),a=s&&s.length>0?s[0]:\"*\",i=[[\"*\",i18next.t(\"anyOfThisType\")]];let o;return html`\n            <div class=\"attribute-group\">\n            \n                <!-- Show SELECT input with 'loading' until the assets are retrieved -->\n                ${when(!this._assets,(()=>html`\n                    <or-mwc-input id=\"idSelect\" class=\"min-width\" type=\"${InputType.SELECT}\" .readonly=\"${!0}\" .label=\"${i18next.t(\"loading\")}\"></or-mwc-input>\n                `),(()=>{this._assets.length<=25?i.push(...this._assets.map((e=>[e.id,e.name]))):o=e=>__awaiter(this,void 0,void 0,(function*(){var t;if(e)return this._assets.filter((t=>{var r;return null===(r=t.name)||void 0===r?void 0:r.toLowerCase().includes(e.toLowerCase())})).map((e=>[e.id,e.name]));if(this._assets.length<=100)return i.push(...this._assets.map((e=>[e.id,e.name]))),i;{const e=null===(t=this._assets)||void 0===t?void 0:t.find((e=>e.id==a));return e&&null==i.find((([t,r])=>t==e.id))&&i.push([e.id,e.name]),i}}));const e=!(this.readonly||this.config&&this.config.controls&&!0===this.config.controls.hideWhenAddAttribute);return html`\n                        <or-mwc-input id=\"idSelect\" class=\"min-width filledSelect\" type=\"${InputType.SELECT}\" .readonly=\"${this.readonly||!1}\" .label=\"${i18next.t(\"asset\")}\" \n                                      .options=\"${i}\" .value=\"${a}\" .searchProvider=\"${o}\"\n                                      @or-mwc-input-changed=\"${e=>{this._assetId=e.detail.value,this.refresh()}}\"\n                        ></or-mwc-input>\n                        <div class=\"attributes\">\n                            ${this.query.attributes&&this.query.attributes.items?this.query.attributes.items.map(((e,s)=>html`\n                                    ${s>0?html`<or-icon class=\"small\" icon=\"ampersand\"></or-icon>`:\"\"}\n                                    <div class=\"attribute\">\n                                        <div>\n                                    ${this.attributePredicateEditorTemplate(t,\"*\"!==a?this._assets.find((e=>e.id===a)):void 0,e)}\n                                        </div>\n                                    ${r?html`\n                                        <button class=\"button-clear\" @click=\"${()=>this.removeAttributePredicate(this.query.attributes,e)}\"><or-icon icon=\"close-circle\"></or-icon></input>\n                                    </div>`:\"\"}\n                                `)):\"\"}\n                            ${e?html`\n                                <or-mwc-input class=\"plus-button\" type=\"${InputType.BUTTON}\" icon=\"plus\"\n                                              label=\"rulesEditorAddAttribute\" @or-mwc-input-changed=\"${e=>this.addAttributePredicate(this.query.attributes)}\"></or-mwc-input>\n                            `:\"\"}\n                        </div>\n                    `}))}\n            </div>\n        `}set _assetId(e){this.query.ids=e&&\"*\"!==e?[e]:void 0,this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}getAttributeName(e){return e&&e.name?e.name.value:void 0}setAttributeName(e,t){e.name||(e.name={predicateType:\"string\"}),e.name.match=\"EXACT\",e.name.value=t,e.value=void 0,this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}getOperatorMapValue(e,t,r,s,a){if(t&&r&&e[t+\":\"+r])return e[t+\":\"+r];if(a){if(e[a.name])return e[a.name];if(e[a.jsonType])return e[a.jsonType];if(a.arrayDimensions)return e.array}}getOperators(e,t,r,s,a){let i;return this.config&&this.config.controls&&this.config.controls.allowedAssetQueryOperators&&(i=this.getOperatorMapValue(this.config.controls.allowedAssetQueryOperators,getAssetTypeFromQuery(this.query),a,t,r)),i||(i=this.getOperatorMapValue(this._queryOperatorsMap,getAssetTypeFromQuery(this.query),a,t,r)),i?i.map((e=>[e,i18next.t(e)])):[]}getOperator(e){if(!e||!e.value)return;const t=e.value;switch(t.predicateType){case\"string\":switch(t.match){case\"EXACT\":return t.negate?AssetQueryOperator.NOT_EQUALS:AssetQueryOperator.EQUALS;case\"BEGIN\":return t.negate?AssetQueryOperator.NOT_STARTS_WITH:AssetQueryOperator.STARTS_WITH;case\"END\":return t.negate?AssetQueryOperator.NOT_ENDS_WITH:AssetQueryOperator.ENDS_WITH;case\"CONTAINS\":return t.negate?AssetQueryOperator.NOT_CONTAINS:AssetQueryOperator.CONTAINS}return;case\"boolean\":return t.value?AssetQueryOperator.IS_TRUE:AssetQueryOperator.IS_FALSE;case\"datetime\":case\"number\":switch(t.operator){case\"EQUALS\":return t.negate?AssetQueryOperator.NOT_EQUALS:AssetQueryOperator.EQUALS;case\"GREATER_THAN\":return t.negate?AssetQueryOperator.LESS_EQUALS:AssetQueryOperator.GREATER_THAN;case\"GREATER_EQUALS\":return t.negate?AssetQueryOperator.LESS_THAN:AssetQueryOperator.GREATER_EQUALS;case\"LESS_THAN\":return t.negate?AssetQueryOperator.GREATER_EQUALS:AssetQueryOperator.LESS_THAN;case\"LESS_EQUALS\":return t.negate?AssetQueryOperator.GREATER_THAN:AssetQueryOperator.LESS_EQUALS;case\"BETWEEN\":return t.negate?AssetQueryOperator.NOT_BETWEEN:AssetQueryOperator.BETWEEN}return;case\"radial\":return t.negated?AssetQueryOperator.OUTSIDE_RADIUS:AssetQueryOperator.WITHIN_RADIUS;case\"rect\":return t.negated?AssetQueryOperator.OUTSIDE_RECTANGLE:AssetQueryOperator.WITHIN_RECTANGLE;case\"array\":return t.value&&t.index?t.negated?AssetQueryOperator.NOT_INDEX_CONTAINS:AssetQueryOperator.INDEX_CONTAINS:t.lengthEquals?t.negated?AssetQueryOperator.NOT_LENGTH_EQUALS:AssetQueryOperator.LENGTH_EQUALS:t.lengthGreaterThan?t.negated?AssetQueryOperator.LENGTH_LESS_THAN:AssetQueryOperator.LENGTH_GREATER_THAN:t.lengthLessThan?t.negated?AssetQueryOperator.LENGTH_GREATER_THAN:AssetQueryOperator.LENGTH_LESS_THAN:t.negated?AssetQueryOperator.NOT_CONTAINS:AssetQueryOperator.CONTAINS;case\"value-empty\":return t.negate?AssetQueryOperator.VALUE_NOT_EMPTY:AssetQueryOperator.VALUE_EMPTY}}setOperator(e,t,r,s,a){if(!this.query||!this.query.attributes||!this.query.attributes.items||0===this.query.attributes.items.length)return;if(!a)return s.value=void 0,this.dispatchEvent(new OrRulesJsonRuleChangedEvent),void this.requestUpdate();const i=AssetModelUtil.getAttributeAndValueDescriptors(e.name,t||r),o=a;if(!i||!i[1]||!o)return s.value=void 0,this.dispatchEvent(new OrRulesJsonRuleChangedEvent),void this.requestUpdate();const u=i[1];let n;switch(o){case AssetQueryOperator.INDEX_CONTAINS:case AssetQueryOperator.NOT_INDEX_CONTAINS:case AssetQueryOperator.LENGTH_EQUALS:case AssetQueryOperator.NOT_LENGTH_EQUALS:case AssetQueryOperator.LENGTH_LESS_THAN:case AssetQueryOperator.LENGTH_GREATER_THAN:u.arrayDimensions&&(n={predicateType:\"array\",negated:o===AssetQueryOperator.NOT_INDEX_CONTAINS||o===AssetQueryOperator.NOT_LENGTH_EQUALS,index:o===AssetQueryOperator.INDEX_CONTAINS||o===AssetQueryOperator.NOT_INDEX_CONTAINS?0:void 0,lengthEquals:o===AssetQueryOperator.LENGTH_EQUALS||o===AssetQueryOperator.NOT_LENGTH_EQUALS?0:void 0,lengthGreaterThan:o===AssetQueryOperator.LENGTH_GREATER_THAN?0:void 0,lengthLessThan:o===AssetQueryOperator.LENGTH_GREATER_THAN?0:void 0});break;case AssetQueryOperator.WITHIN_RADIUS:case AssetQueryOperator.OUTSIDE_RADIUS:n={predicateType:\"radial\",negated:o===AssetQueryOperator.OUTSIDE_RADIUS,lat:0,lng:0,radius:50};break;case AssetQueryOperator.WITHIN_RECTANGLE:case AssetQueryOperator.OUTSIDE_RECTANGLE:n={predicateType:\"rect\",negated:o===AssetQueryOperator.OUTSIDE_RECTANGLE,latMin:-.1,lngMin:-.1,latMax:.1,lngMax:.1};break;case AssetQueryOperator.IS_TRUE:case AssetQueryOperator.IS_FALSE:if(\"boolean\"===u.jsonType){n={predicateType:\"boolean\",value:o===AssetQueryOperator.IS_TRUE};break}case AssetQueryOperator.STARTS_WITH:case AssetQueryOperator.NOT_STARTS_WITH:\"string\"===u.jsonType&&(n={predicateType:\"string\",negate:o===AssetQueryOperator.NOT_STARTS_WITH,match:\"BEGIN\"});break;case AssetQueryOperator.ENDS_WITH:case AssetQueryOperator.NOT_ENDS_WITH:\"string\"===u.jsonType&&(n={predicateType:\"string\",negate:o===AssetQueryOperator.NOT_ENDS_WITH,match:\"END\"});break;case AssetQueryOperator.NOT_BETWEEN:n=\"number\"===u.jsonType||\"bigint\"===u.jsonType?{predicateType:\"number\",operator:\"BETWEEN\",negate:!0}:{predicateType:\"datetime\",operator:\"BETWEEN\",negate:!0};break;case AssetQueryOperator.GREATER_THAN:case AssetQueryOperator.GREATER_EQUALS:case AssetQueryOperator.LESS_THAN:case AssetQueryOperator.LESS_EQUALS:case AssetQueryOperator.BETWEEN:const e=Util.getEnumKeyAsString(AssetQueryOperator,o);n=\"number\"===u.jsonType?{predicateType:\"number\",operator:e}:{predicateType:\"datetime\",operator:e};break;case AssetQueryOperator.EQUALS:case AssetQueryOperator.NOT_EQUALS:\"date\"===u.jsonType?n={predicateType:\"datetime\",negate:o===AssetQueryOperator.NOT_EQUALS,operator:\"EQUALS\"}:\"number\"===u.jsonType?n={predicateType:\"number\",negate:o===AssetQueryOperator.NOT_EQUALS,operator:\"EQUALS\"}:\"string\"===u.jsonType&&(n={predicateType:\"string\",negate:o===AssetQueryOperator.NOT_EQUALS,match:\"EXACT\"});break;case AssetQueryOperator.VALUE_EMPTY:n={predicateType:\"value-empty\"};break;case AssetQueryOperator.VALUE_NOT_EMPTY:n={predicateType:\"value-empty\",negate:!0};break;case AssetQueryOperator.CONTAINS:case AssetQueryOperator.NOT_CONTAINS:u.arrayDimensions?n={predicateType:\"array\",negated:o===AssetQueryOperator.NOT_CONTAINS}:\"string\"===u.jsonType&&(n={predicateType:\"string\",negate:o===AssetQueryOperator.NOT_CONTAINS,match:\"CONTAINS\"})}s.value=n,this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}get attributePredicate(){return this.query&&this.query.attributes&&this.query.attributes.items&&this.query.attributes.items.length>0?this.query.attributes.items[0]:void 0}setValuePredicateProperty(e,t,r){e&&(e[t]=r,this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate())}removeAttributePredicate(e,t){const r=e.items.indexOf(t);r>=0&&e.items.splice(r,1),this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}addAttributePredicate(e){e.items||(e.items=[]),e.items.push({}),this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}toggleAttributeGroup(e){\"OR\"===e.operator?e.operator=\"AND\":e.operator=\"OR\",this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}loadAssets(e){this.assetProvider(e).then((e=>{this._assets=e}))}};__decorate([property({type:Object,attribute:!1})],OrRuleAssetQuery.prototype,\"condition\",void 0),__decorate([property({type:Object})],OrRuleAssetQuery.prototype,\"config\",void 0),__decorate([property({type:Object})],OrRuleAssetQuery.prototype,\"assetInfos\",void 0),__decorate([property({type:Object})],OrRuleAssetQuery.prototype,\"assetProvider\",void 0),__decorate([state()],OrRuleAssetQuery.prototype,\"_assets\",void 0),OrRuleAssetQuery=__decorate([customElement(\"or-rule-asset-query\")],OrRuleAssetQuery);export{OrRuleAssetQuery};","var __decorate=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{css,html,LitElement}from\"lit\";import{customElement,property,state}from\"lit/decorators.js\";import moment from\"moment\";import{buttonStyle}from\"../style\";import{OrRulesJsonRuleChangedEvent}from\"./or-rule-json-viewer\";import{TimeTriggerType}from\"../index\";import{Util}from\"@openremote/core\";import{OrMwcDialogOpenedEvent}from\"@openremote/or-mwc-components/or-mwc-dialog\";import{OrMapClickedEvent}from\"@openremote/or-map\";import{i18next}from\"@openremote/or-translate\";const style=css`\n    \n    ${buttonStyle}\n    \n    :host {\n        display: block;\n    }\n    \n    .trigger-group {\n        flex-grow: 1;\n        display: flex;\n        align-items: center;\n        flex-direction: row;\n        flex-wrap: wrap;\n    }\n    .min-width {\n        min-width: 200px;\n    }\n    .width {\n        width: 200px;\n    }\n    \n    .trigger-group > * {\n        margin: 10px 3px 6px 3px;\n    }\n`;let OrRuleTriggerQuery=class extends LitElement{static get styles(){return style}constructor(){super(),this.readonly=!1,this.triggerOptions=[],Object.values(TimeTriggerType).forEach((t=>{this.triggerOptions.push({key:t,value:this.triggerToString(t)})})),this.getSunPositions().forEach((t=>{this.triggerOptions.push({key:t,value:this.triggerToString(t)})})),this.selectedTrigger=this.triggerOptions[0],this.addEventListener(OrMwcDialogOpenedEvent.NAME,this.initMap)}updated(t){t.has(\"condition\")&&(this.condition.cron?this.selectedTrigger={key:TimeTriggerType.TIME_OF_DAY,value:this.triggerToString(TimeTriggerType.TIME_OF_DAY)}:this.condition.sun&&(this.selectedTrigger={key:this.condition.sun.position,value:this.triggerToString(this.condition.sun.position)}))}initMap(){const t=this.shadowRoot.getElementById(\"map-modal\");if(!t)return;const e=t.shadowRoot.querySelector(\".or-map\");e&&e.addEventListener(OrMapClickedEvent.NAME,(e=>{const i=e.detail.lngLat;this.setLocation({type:\"Point\",coordinates:[i.lat,i.lng]});const o=t.shadowRoot.querySelector(\".location-lat\"),n=t.shadowRoot.querySelector(\".location-lng\");o.value=i.lat,n.value=i.lng}))}renderDialogHTML(t){const e=this.shadowRoot.getElementById(\"map-modal\");e&&(e.content=html`\n                <div style=\"display:grid\">\n                    <or-map class=\"or-map\" type=\"VECTOR\" style=\"border: 1px solid #d5d5d5; height: 400px; min-width: 300px; margin-bottom: 20px;\">\n                        ${t&&t.coordinates?html`\n                            <or-map-marker class=\"or-map-marker\" active color=\"#FF0000\" icon=\"white-balance-sunny\" lat=\"${t.coordinates[0]}\" lng=\"${t.coordinates[1]}\"></or-map-marker>\n                        `:void 0}\n                    </or-map>\n                    <div class=\"layout horizontal\">\n                        <input hidden class=\"location-lng\"  required placeholder=\" \" type=\"text\" .value=\"${t&&t.coordinates?t.coordinates[0]:null}\" />\n                        <input hidden class=\"location-lat\" required placeholder=\" \" type=\"text\" .value=\"${t&&t.coordinates?t.coordinates[1]:null}\" />\n                    </div>\n                </div>\n            `)}render(){var t,e;const i=[{actionName:\"close\",default:!0,content:html`<or-mwc-input class=\"button\" .type=\"${InputType.BUTTON}\" label=\"close\"></or-mwc-input>`,action:()=>{}}];return this.renderDialogHTML(null===(t=this.condition.sun)||void 0===t?void 0:t.location),html`\n            <div class=\"trigger-group\">\n                <or-mwc-input class=\"min-width\" type=\"${InputType.SELECT}\" .options=\"${this.triggerOptions.map((t=>t.value))}\" .value=\"${this.selectedTrigger.value}\" label=\"${i18next.t(\"triggerType\")}\"\n                              @or-mwc-input-changed=\"${t=>{this.setTrigger(this.triggerOptions.find((e=>e.value==t.detail.value)))}}\">\n                </or-mwc-input>\n                ${this.selectedTrigger?html`\n                    ${this.selectedTrigger.key==this.triggerOptions[0].key?html`\n                        <or-mwc-input class=\"min-width\" type=\"${InputType.TIME}\" .value=\"${this.condition.cron?moment(Util.cronStringToISOString(this.condition.cron,!0)).format(\"HH:mm\"):void 0}\" label=\"${i18next.t(\"timeOfDay\")}\"\n                                      @or-mwc-input-changed=\"${t=>{this.setTime(t.detail.value)}}\">\n                        </or-mwc-input>\n                    `:html`\n                        <or-mwc-input class=\"min-width width\" type=\"${InputType.NUMBER}\" .value=\"${null===(e=this.condition.sun)||void 0===e?void 0:e.offsetMins}\" label=\"${i18next.t(\"offsetInMinutes\")}\"\n                                      @or-mwc-input-changed=\"${t=>{this.setOffset(t.detail.value)}}\">\n                        </or-mwc-input>\n                        <or-mwc-input type=\"${InputType.BUTTON}\" class=\"min-width\" @or-mwc-input-changed=\"${()=>{var t;const e=this.shadowRoot.getElementById(\"map-modal\");e&&(e.dismissAction=null,e.open(),this.renderDialogHTML(null===(t=this.condition.sun)||void 0===t?void 0:t.location))}}\" label=\"location\"></or-mwc-input>\n                        <or-mwc-dialog id=\"map-modal\" heading=\"${i18next.t(\"pickLocation\")}\" .actions=\"${i}\"></or-mwc-dialog>\n                    `}\n                `:void 0}\n            </div>\n        `}setTrigger(t){t&&(t.key==TimeTriggerType.TIME_OF_DAY?this.condition.sun=void 0:this.getSunPositions().includes(t.key)&&(this.condition.cron=void 0,this.getSunPositions().includes(this.selectedTrigger.key)?this.condition.sun={position:t.key,offsetMins:this.condition.sun.offsetMins,location:this.condition.sun.location}:this.condition.sun={position:t.key,offsetMins:0}),this.selectedTrigger=t,this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate())}setTime(t){if(t){const e=t.split(\":\"),i=new Date;i.setHours(Number(e[0])),i.setMinutes(Number(e[1])),this.condition.cron=Util.formatCronString(void 0,void 0,void 0,i.getUTCHours().toString(),i.getUTCMinutes().toString()),this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}}setOffset(t){var e,i;this.condition.sun={position:null===(e=this.condition.sun)||void 0===e?void 0:e.position,location:null===(i=this.condition.sun)||void 0===i?void 0:i.location,offsetMins:t},this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}setLocation(t){var e,i;this.condition.sun={position:null===(e=this.condition.sun)||void 0===e?void 0:e.position,location:t,offsetMins:null===(i=this.condition.sun)||void 0===i?void 0:i.offsetMins},this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}getSunPositions(){return[\"TWILIGHT_MORNING_CIVIL\",\"SUNRISE\",\"SUNSET\",\"TWILIGHT_EVENING_CIVIL\"]}triggerToString(t){return t==TimeTriggerType.TIME_OF_DAY?i18next.t(\"timeOfDay\"):i18next.t(t.toLowerCase())}};__decorate([property({type:Object,attribute:!1})],OrRuleTriggerQuery.prototype,\"condition\",void 0),__decorate([property()],OrRuleTriggerQuery.prototype,\"readonly\",void 0),__decorate([state()],OrRuleTriggerQuery.prototype,\"selectedTrigger\",void 0),__decorate([state()],OrRuleTriggerQuery.prototype,\"triggerOptions\",void 0),OrRuleTriggerQuery=__decorate([customElement(\"or-rule-trigger-query\")],OrRuleTriggerQuery);export{OrRuleTriggerQuery};","var __decorate=this&&this.__decorate||function(e,t,o,r){var s,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(n=(i<3?s(n):i>3?s(t,o,n):s(t,o))||n);return i>3&&n&&Object.defineProperty(t,o,n),n};import{css,html,LitElement}from\"lit\";import{customElement,property,query}from\"lit/decorators.js\";import{AssetModelUtil}from\"@openremote/model\";import{getAssetTypeFromQuery}from\"../index\";import\"./or-rule-asset-query\";import\"./or-rule-trigger-query\";import\"@openremote/or-mwc-components/or-mwc-menu\";import{getContentWithMenuTemplate}from\"@openremote/or-mwc-components/or-mwc-menu\";import\"@openremote/or-icon\";import\"@openremote/or-translate\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{Util}from\"@openremote/core\";import{i18next,translate}from\"@openremote/or-translate\";import{OrRulesJsonRuleChangedEvent}from\"./or-rule-json-viewer\";const TIMER_COLOR=\"4b87ea\",DATE_TIME_COLOR=\"6AEAA4\";export function getWhenTypesMenu(e,t){let o=!0,r=!0,s=!0;e&&e.controls&&e.controls.allowedConditionTypes&&(o=e.controls.allowedConditionTypes.indexOf(\"assetQuery\")>=0,r=e.controls.allowedConditionTypes.indexOf(\"agentQuery\")>=0,s=e.controls.allowedConditionTypes.indexOf(\"time\")>=0);const i=[];if(t){if(o){const e=t.filter((e=>\"agent\"!==e.assetDescriptor.descriptorType)).map((e=>{const t=AssetModelUtil.getAssetDescriptorColour(e),o=AssetModelUtil.getAssetDescriptorIcon(e),r=t?{\"--or-icon-fill\":\"#\"+t}:void 0;return{text:Util.getAssetTypeLabel(e.assetDescriptor),value:e.assetDescriptor.name,icon:o||AssetModelUtil.getAssetDescriptorIcon(\"ThingAsset\"),styleMap:r}}));i.push(...e.sort(Util.sortByString((e=>e.text))))}if(o&&r&&i.push(null),r){const e=t.filter((e=>\"agent\"===e.assetDescriptor.descriptorType)).map((e=>{const t=AssetModelUtil.getAssetDescriptorColour(e),o=AssetModelUtil.getAssetDescriptorIcon(e),r=t?{\"--or-icon-fill\":\"#\"+t}:void 0;return{text:Util.getAssetTypeLabel(e.assetDescriptor),value:e.assetDescriptor.name,icon:o||AssetModelUtil.getAssetDescriptorIcon(\"ThingAsset\"),styleMap:r}}));i.push(...e.sort(Util.sortByString((e=>e.text))))}}return s&&(i.push(null),i.push({text:i18next.t(\"time\"),icon:\"timer\",value:\"time\",styleMap:{\"--or-icon-fill\":\"#4b87ea\"}})),i}export function updateRuleConditionType(e,t,o){if(t)if(\"time\"===t){e.assets=void 0;const t=new Date;e.cron=Util.formatCronString(void 0,void 0,void 0,t.getUTCHours().toString(),t.getUTCMinutes().toString())}else e.cron=void 0,o&&o.json&&o.json.whenAssetQuery?e.assets=JSON.parse(JSON.stringify(o.json.whenAssetQuery)):e.assets={},e.assets.types=[t];else e.assets=void 0,e.cron=void 0,e.sun=void 0}const style=css`\n    :host {\n        display: flex;\n        flex-direction: row;\n    }\n    \n    or-rule-asset-query {\n        flex-grow: 1;\n    }\n\n    #type {\n        white-space: nowrap;\n        text-transform: capitalize;\n        margin: 14px 3px auto 0;\n    }\n`;let OrRuleCondition=class extends(translate(i18next)(LitElement)){constructor(){super(...arguments),this.readonly=!1}static get styles(){return style}render(){const e=!this.config||!this.config.controls||!0!==this.config.controls.hideConditionTypeOptions,t=this.type;if(!t&&!e)return html`<span>INVALID CONFIG - NO TYPE SPECIFIED AND TYPE SELECTOR DISABLED</span>`;let o=\"\",r=\"\";if(e){let e,r=\"inherit\";if(t)if(\"time\"===t)e=\"timer\",r=\"4b87ea\";else{const o=AssetModelUtil.getAssetDescriptor(t);e=AssetModelUtil.getAssetDescriptorIcon(o)||e,r=AssetModelUtil.getAssetDescriptorColour(o)||r}o=this.readonly?html`\n                <div id=\"type\" style=\"--or-mwc-input-color: #${r}\">\n                    <or-mwc-input readonly type=\"${InputType.BUTTON}\" .icon=\"${e||\"\"}\"></or-mwc-input>\n                </div>\n                `:html`\n                <div id=\"type\" style=\"--or-mwc-input-color: #${r}\">\n                    ${getContentWithMenuTemplate(html`<or-mwc-input type=\"${InputType.BUTTON}\" .icon=\"${e||\"\"}\"></or-mwc-input>`,getWhenTypesMenu(this.config,this.assetInfos),t,(e=>this.type=e))}\n                </div>\n            `}return t&&(r=\"time\"===t?html`<or-rule-trigger-query id=\"asset-query\" .condition=\"${this.ruleCondition}\"></or-rule-trigger-query>`:html`<or-rule-asset-query id=\"asset-query\" .config=\"${this.config}\" .assetInfos=\"${this.assetInfos}\" .readonly=\"${this.readonly}\"\n                                                         .condition=\"${this.ruleCondition}\" .assetProvider=\"${this.assetProvider}\"\n                    ></or-rule-asset-query>`),html`\n            ${o}        \n            ${r}\n        `}get type(){return getAssetTypeFromQuery(this.ruleCondition.assets)||(this.ruleCondition.cron||this.ruleCondition.sun?\"time\":void 0)}set type(e){updateRuleConditionType(this.ruleCondition,e,this.config),this._assetQuery&&this._assetQuery.refresh(),this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}};__decorate([property({type:Object,attribute:!1})],OrRuleCondition.prototype,\"ruleCondition\",void 0),__decorate([property({type:Object})],OrRuleCondition.prototype,\"config\",void 0),__decorate([property({type:Object})],OrRuleCondition.prototype,\"assetInfos\",void 0),__decorate([property({type:Object})],OrRuleCondition.prototype,\"assetProvider\",void 0),__decorate([query(\"#asset-query\")],OrRuleCondition.prototype,\"_assetQuery\",void 0),OrRuleCondition=__decorate([customElement(\"or-rule-condition\")],OrRuleCondition);","var OrRuleWhen_1,ResetOption,__decorate=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};import{css,html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{OrRulesRuleUnsupportedEvent}from\"../index\";import{buttonStyle}from\"../style\";import\"./or-rule-condition\";import i18next from\"i18next\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{OrRulesJsonRuleChangedEvent}from\"./or-rule-json-viewer\";import{getWhenTypesMenu,updateRuleConditionType}from\"./or-rule-condition\";import{getContentWithMenuTemplate}from\"@openremote/or-mwc-components/or-mwc-menu\";import{translate}from\"@openremote/or-translate\";!function(e){e.NO_LONGER_MATCHES=\"noLongerMatches\",e.VALUE_CHANGES=\"valueChanges\"}(ResetOption||(ResetOption={}));const style=css`\n    \n    :host {\n        display: block;\n    }\n    \n    ${buttonStyle}\n    \n    .rule-group-items {\n        display: flex;\n        flex-direction: column;\n    }\n    \n    .rule-group .rule-group-items > div {\n        margin: 10px 0;\n    }\n    \n    .rule-condition {\n        display: flex;\n        padding-right: 5px;\n    }\n     \n    .rule-condition > * {\n        flex-grow: 0;\n    }\n    \n    .rule-condition > or-rule-condition {\n        flex-grow: 1;\n    }\n    \n    or-rule-condition {\n        margin-bottom: 10px;\n    }\n\n    .rule-group-item > or-icon {\n        padding-left: 17px;\n    }\n    \n    or-icon.small {\n        --or-icon-width: 14px;\n        --or-icon-height: 14px;\n    }\n    \n    or-panel {\n        margin: 10px 10px 20px 10px;\n        position: relative;\n    }\n    \n    or-panel > .remove-button {\n        position: absolute;\n        right: 0;\n        top: 0;\n        width: 24px;\n        height: 24px;\n        transform: translate(50%, -50%);\n    }\n\n    .rule-condition:hover .button-clear {\n        visibility: visible;\n    }\n\n    or-panel:hover .remove-button.button-clear {\n        visibility: visible;\n    }\n    \n    .add-button-wrapper {\n        display: flex;\n        align-items: center;\n        white-space: nowrap;\n    }\n    \n    .add-button-wrapper > * {\n        margin-right: 6px;\n    }\n    \n    .add-button-wrapper or-mwc-menu {\n        text-transform: capitalize;\n    }\n\n    strong {\n        margin: var(--internal-or-panel-heading-margin);\n        font-size: var(--internal-or-panel-heading-font-size);\n    }\n`;let OrRuleWhen=OrRuleWhen_1=class extends(translate(i18next)(LitElement)){static get styles(){return style}ruleGroupTemplate(e,t){if(!e)return html``;const o=!t,n=!(this.readonly||this.config&&this.config.controls&&!0===this.config.controls.hideWhenAddCondition),r=!this.readonly,i=!this.readonly;let s;s=o?(e,t,o,n,r)=>html`\n                    <or-panel .heading=\"${i18next.t(r?\"when\":\"orWhen\")}...\">\n                        ${i?html`\n                            <button class=\"button-clear remove-button\" @click=\"${()=>this.removeItem(t,o,n)}\">\n                                <or-icon icon=\"close-circle\"></or-icon>  \n                            </button>\n                        `:\"\"}\n                        ${e}\n                    </or-panel>`:(e,t,o,n,r)=>html`\n                    ${r?\"\":html`\n                        <or-icon class=\"small\" icon=\"ampersand\"></or-icon>\n                    `}\n                    ${e}\n                `;let l=\"\",p=\"\",u=\"\",a=!0;return e.groups&&e.groups.length>0&&(l=html`\n                ${e.groups.map(((t,o)=>{const n=html`\n                        <div class=\"rule-group-item\">\n                            ${this.ruleGroupTemplate(t,e)}\n                        </div>\n                    `;return s(n,t,e,!0,0==o)}))}\n            `,a=!1),e.items&&e.items.length>0&&(p=html`\n                ${e.items.map(((t,o)=>{const n=html`\n                        <div class=\"rule-group-item\">\n                            <div class=\"rule-condition\">\n                                <or-rule-condition .config=\"${this.config}\" .assetInfos=\"${this.assetInfos}\" .ruleCondition=\"${t}\" .readonly=\"${this.readonly}\" .assetProvider=\"${this.assetProvider}\"></or-rule-condition>\n                                ${i?html`\n                                    <button class=\"button-clear ${r?\"\":\"hidden\"}\" @click=\"${()=>this.removeItem(t,e,!1)}\"><or-icon icon=\"close-circle\"></or-icon></input>\n                                `:\"\"}\n                            </div>\n                        </div>\n                    `;return s(n,t,e,!0,a&&0===o)}))}\n            `,a=!1),!o&&n&&(u=html`\n                <span class=\"add-button-wrapper\">\n                    ${getContentWithMenuTemplate(html`<or-mwc-input class=\"plus-button\" type=\"${InputType.BUTTON}\" icon=\"plus\"\n                                           .label=\"${i18next.t(\"rulesEditorAddCondition\")}\"></or-mwc-input>`,getWhenTypesMenu(this.config,this.assetInfos),void 0,(t=>this.addCondition(e,t)))}\n                </span>\n            `),html`\n            ${l}\n            ${p}\n            ${u}\n        `}dateTimePredicateTemplate(){return html`<span>DATE TIME PREDICATE NOT IMPLEMENTED</span>`}shouldUpdate(e){return e.has(\"rule\")&&this.rule&&(this.rule.when?OrRuleWhen_1._isRuleWhenCompatible(this.rule.when)||(this.rule=void 0,this.dispatchEvent(new OrRulesRuleUnsupportedEvent)):this.rule.when={operator:\"OR\"}),super.shouldUpdate(e)}render(){if(!this.rule||!this.rule.when)return html``;const e=!(this.readonly||this.config&&this.config.controls&&!0===this.config.controls.hideWhenAddGroup);return html`\n            <div>\n                ${this.ruleGroupTemplate(this.rule.when)}\n            </div>\n            \n            ${e?html`\n                <or-panel>\n                    <strong>${i18next.t(this.rule.when.groups&&0!==this.rule.when.groups.length?\"orWhen\":\"when\")}...</strong>\n                    <span class=\"add-button-wrapper\">\n                        ${getContentWithMenuTemplate(html`<or-mwc-input class=\"plus-button\" type=\"${InputType.BUTTON}\" icon=\"plus\"></or-mwc-input>`,getWhenTypesMenu(this.config,this.assetInfos),void 0,(e=>this.addGroup(this.rule.when,e)))}\n                    </span>\n                </or-panel>\n            `:\"\"}\n        `}static _isRuleWhenCompatible(e){return\"OR\"!==e.operator?(console.warn(\"Incompatible rule: when operator not set to 'OR'\"),!1):e.items&&e.items.length>0?(console.warn(\"Incompatible rule: when items not supported\"),!1):!e.groups||!e.groups.find((e=>!this._isWhenGroupCompatible(e)))||(console.warn(\"Incompatible rule: when groups incompatible\"),!1)}static _isWhenGroupCompatible(e){return\"OR\"===e.operator?(console.warn(\"Incompatible rule: when group operator not set to 'AND'\"),!1):!(e.groups&&e.groups.length>0&&(console.warn(\"Incompatible rule: when group nested groups not supported\"),1))}addGroup(e,t){if(!this.rule||!this.rule.when||e!==this.rule.when)return;let o={operator:\"AND\"};return this.config&&this.config.json&&this.config.json.whenGroup&&(o=JSON.parse(JSON.stringify(this.config.json.whenGroup))),\"AND\"!==o.operator?(console.warn(\"JSON rules editor doesn't support top level logic group with type OR\"),void this.dispatchEvent(new OrRulesRuleUnsupportedEvent)):o.groups&&o.groups.length>0?(console.warn(\"JSON rules editor doesn't support multiple top level logic groups\"),void this.dispatchEvent(new OrRulesRuleUnsupportedEvent)):(o.groups=void 0,o.items&&0!==o.items.length||this.addCondition(o,t,!0),e.groups||(e.groups=[]),e.groups.push(o),this.dispatchEvent(new OrRulesJsonRuleChangedEvent),void this.requestUpdate())}removeItem(e,t,o){let n=!1;if(t){if(o){const o=t.groups.indexOf(e);t.groups.splice(o,1),n=o>=0}else{const o=t.items.indexOf(e);t.items.splice(o,1),n=o>=0}n&&(this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate())}}addCondition(e,t,o){if(!e)return;e.items||(e.items=[]);let n={};this.config&&this.config.json&&this.config.json.whenCondition?n=JSON.parse(JSON.stringify(this.config.json.whenCondition)):updateRuleConditionType(n,t||\"ThingAsset\",this.config),e.items.push(n),o||(this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate())}};__decorate([property({type:Object})],OrRuleWhen.prototype,\"rule\",void 0),__decorate([property({type:Boolean})],OrRuleWhen.prototype,\"readonly\",void 0),__decorate([property({type:Object})],OrRuleWhen.prototype,\"assetProvider\",void 0),__decorate([property({type:Object,attribute:!1})],OrRuleWhen.prototype,\"assetInfos\",void 0),OrRuleWhen=OrRuleWhen_1=__decorate([customElement(\"or-rule-when\")],OrRuleWhen);","var __decorate=this&&this.__decorate||function(t,e,i,s){var r,o=arguments.length,a=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var n=t.length-1;n>=0;n--)(r=t[n])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(r,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function n(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,n)}u((s=s.apply(t,e||[])).next())}))};import{css,html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{getAssetIdsFromQuery,getAssetTypeFromQuery}from\"../index\";import{AssetModelUtil}from\"@openremote/model\";import{Util}from\"@openremote/core\";import\"@openremote/or-attribute-input\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import i18next from\"i18next\";import{OrRulesJsonRuleChangedEvent}from\"./or-rule-json-viewer\";import{translate}from\"@openremote/or-translate\";import{ifDefined}from\"lit/directives/if-defined.js\";import{when}from\"lit/directives/when.js\";const style=css`\n    :host {\n        display: flex;\n        align-items: center;\n\n        flex-wrap: wrap;\n    }\n\n    :host > * {\n        margin: 0 3px 6px;\n    }\n\n    .min-width {\n        min-width: 200px;\n    }\n`;let OrRuleActionAttribute=class extends(translate(i18next)(LitElement)){static get styles(){return style}shouldUpdate(t){return t.has(\"action\")&&(this._assets=void 0),super.shouldUpdate(t)}refresh(){this._assets=void 0}_getAssetType(){if(!this.action.target)return;const t=this.action.target.assets?this.action.target.assets:this.action.target.matchedAssets?this.action.target.matchedAssets:void 0;return t?getAssetTypeFromQuery(t):void 0}render(){if(!this.action.target)return html``;const t=this._getAssetType();if(!t)return html``;const e=this.action.target.assets?this.action.target.assets:this.action.target.matchedAssets?this.action.target.matchedAssets:void 0,i=this.assetInfos?this.assetInfos.find((e=>e.assetDescriptor.name===t)):void 0;if(!i)return html``;this._assets||this.loadAssets(t);const s=getAssetIdsFromQuery(e),r=s&&s.length>0?s[0]:\"*\",o=[[\"*\",i18next.t(\"matched\")]];let a;return html`\n            \n            <!-- Show SELECT input with 'loading' until the assets are retrieved -->\n            ${when(!this._assets,(()=>html`\n                <or-mwc-input id=\"matchSelect\" class=\"min-width\" type=\"${InputType.SELECT}\" .readonly=\"${!0}\" .label=\"${i18next.t(\"loading\")}\"></or-mwc-input>\n            `),(()=>{var e,s,n;this._assets.length<=25?o.push(...this._assets.map((t=>[t.id,t.name]))):a=t=>__awaiter(this,void 0,void 0,(function*(){var e;if(t)return this._assets.filter((e=>{var i;return null===(i=e.name)||void 0===i?void 0:i.toLowerCase().includes(t.toLowerCase())})).map((t=>[t.id,t.name]));if(this._assets.length<=100)return o.push(...this._assets.map((t=>[t.id,t.name]))),o;{const t=null===(e=this._assets)||void 0===e?void 0:e.find((t=>t.id==r));return t&&null==o.find((([e,i])=>e==t.id))&&o.push([t.id,t.name]),o}}));const u=r&&\"*\"!==r?this._assets.find((t=>t.id===r)):void 0,l=AssetModelUtil.getAttributeAndValueDescriptors(t,this.action.attributeName,u&&u.attributes&&this.action.attributeName?u.attributes[this.action.attributeName]:void 0);let c,p=[];if(u&&u.attributes)p=Object.values(u.attributes).map((e=>{const i=Util.getAttributeLabel(e,l[0],t,!1);return[e.name,i]}));else if(i){const e=AssetModelUtil.getAssetTypeInfo(i);p=e&&e.attributeDescriptors?e.attributeDescriptors.map((e=>{const i=Util.getAttributeLabel(e,l[0],t,!1);return[e.name,i]})):[]}if(p.sort(Util.sortByString((t=>t[1]))),this.action.attributeName){const i=l[1]&&\"boolean\"===l[1].name?\"\":i18next.t(\"value\");let r;(null===(s=null===(e=l[0])||void 0===e?void 0:e.format)||void 0===s?void 0:s.asSlider)&&(r=InputType.NUMBER),c=html`<or-attribute-input ?compact=${l[1]&&\"GEO_JSONPoint\"===l[1].name} .inputType=\"${ifDefined(r)}\" @or-attribute-input-changed=\"${t=>this.setActionAttributeValue(t.detail.value)}\" .customProvider=\"${null===(n=this.config)||void 0===n?void 0:n.inputProvider}\" .label=\"${i}\" .assetType=\"${t}\" .attributeDescriptor=\"${l[0]}\" .attributeValueDescriptor=\"${l[1]}\" .value=\"${this.action.value}\" .readonly=\"${this.readonly||!1}\"></or-attribute-input>`}return html`\n                    <or-mwc-input id=\"matchSelect\" class=\"min-width\" .label=\"${i18next.t(\"asset\")}\" .type=\"${InputType.SELECT}\"\n                                  .options=\"${o}\" .searchProvider=\"${a}\" .value=\"${r}\" .readonly=\"${this.readonly||!1}\"\n                                  @or-mwc-input-changed=\"${t=>{this._assetId=t.detail.value,this.refresh()}}\"\n                    ></or-mwc-input>\n                    ${p.length>0?html`\n                        <or-mwc-input id=\"attributeSelect\" class=\"min-width\" .label=\"${i18next.t(\"attribute\")}\" .type=\"${InputType.SELECT}\" @or-mwc-input-changed=\"${t=>this.setActionAttributeName(t.detail.value)}\" .readonly=\"${this.readonly||!1}\" ?searchable=\"${p.length>=25}\" .options=\"${p}\" .value=\"${this.action.attributeName}\"></or-mwc-input>\n                        ${c}\n                    `:html`\n                        <or-translate value=\"No attributes with write permission\"></or-translate>\n                    `}\n                `}))}\n        `}set _assetId(t){const e=this._getAssetType();\"*\"===t?(this.action.target.assets=void 0,this.action.target={matchedAssets:{types:[e||\"\"]}}):(this.action.target.matchedAssets=void 0,this.action.target={assets:{ids:[t],types:[e||\"\"]}}),this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}setActionAttributeName(t){this.action.attributeName=t,this.action.value=void 0,this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}setActionAttributeValue(t){this.action.value=t,this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}loadAssets(t){this.assetProvider(t).then((t=>{this._assets=t}))}};__decorate([property({type:Object,attribute:!1})],OrRuleActionAttribute.prototype,\"action\",void 0),__decorate([property({type:Object,attribute:!1})],OrRuleActionAttribute.prototype,\"targetTypeMap\",void 0),__decorate([property({type:Object})],OrRuleActionAttribute.prototype,\"config\",void 0),__decorate([property({type:Object})],OrRuleActionAttribute.prototype,\"assetInfos\",void 0),__decorate([property({type:Object})],OrRuleActionAttribute.prototype,\"assetProvider\",void 0),__decorate([property({type:Array,attribute:!1})],OrRuleActionAttribute.prototype,\"_assets\",void 0),OrRuleActionAttribute=__decorate([customElement(\"or-rule-action-attribute\")],OrRuleActionAttribute);export{OrRuleActionAttribute};","var __decorate=this&&this.__decorate||function(t,o,e,i){var r,n=arguments.length,c=n<3?o:null===i?i=Object.getOwnPropertyDescriptor(o,e):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)c=Reflect.decorate(t,o,e,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(n<3?r(c):n>3?r(o,e,c):r(o,e))||c);return n>3&&c&&Object.defineProperty(o,e,c),c};import{html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import\"@openremote/or-mwc-components/or-mwc-input\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import i18next from\"i18next\";import{translate}from\"@openremote/or-translate\";import{OrMwcDialogOpenedEvent}from\"@openremote/or-mwc-components/or-mwc-dialog\";const checkValidity=(t,o)=>{if(t){const e=t.querySelectorAll(\"or-mwc-input\");Array.prototype.slice.call(e).every((t=>{if(t.shadowRoot){const o=t.shadowRoot.querySelector(\"input, textarea, select\");return!(!o||!o.checkValidity())||(t._mdcComponent.valid=!1,t._mdcComponent.helperTextContent=\"required\",!1)}return!1}))&&o.close()}};let OrRuleNotificationModal=class extends(translate(i18next)(LitElement)){constructor(){super(),this.title=\"message\",this.addEventListener(OrMwcDialogOpenedEvent.NAME,this.initDialog)}initDialog(){this.shadowRoot.getElementById(\"notification-modal\")}renderDialogHTML(t){const o=this.shadowRoot.getElementById(\"notification-modal\");if(!this.shadowRoot)return;const e=this.shadowRoot.querySelector(\".notification-form-slot\");if(o&&e){let t=document.createElement(\"div\");e.assignedNodes({flatten:!0}).forEach((o=>{o instanceof HTMLElement&&t.appendChild(o)})),o.content=html`${t}`,o.dismissAction=null,this.requestUpdate()}}firstUpdated(t){t.has(\"action\")&&this.renderDialogHTML(this.action)}checkForm(){const t=this.shadowRoot.host;if(this.shadowRoot){const o=this.shadowRoot.querySelector(\"or-rule-form-email-message\"),e=this.shadowRoot.querySelector(\"or-rule-form-push-notification\");if(e&&e.shadowRoot){const o=e.shadowRoot.querySelector(\"form\");return checkValidity(o,t)}if(o&&o.shadowRoot){const e=o.shadowRoot.querySelector(\"form\");return checkValidity(e,t)}}}render(){if(!this.action)return html``;const t=[{actionName:\"cancel\",content:html`<or-mwc-input class=\"button\" .type=\"${InputType.BUTTON}\" label=\"cancel\"></or-mwc-input>`,action:t=>{}},{actionName:\"\",content:html`<or-mwc-input class=\"button\" .type=\"${InputType.BUTTON}\" label=\"ok\" @or-mwc-input-changed=\"${this.checkForm}\"></or-mwc-input>`}];return html`\n            <or-mwc-input .type=\"${InputType.BUTTON}\" label=\"message\" @or-mwc-input-changed=\"${()=>{const t=this.shadowRoot.getElementById(\"notification-modal\");t&&t.open()}}\"></or-mwc-input>\n            <or-mwc-dialog id=\"notification-modal\" heading=\"${this.title}\" .actions=\"${t}\"></or-mwc-dialog>\n            <slot class=\"notification-form-slot\"></slot>\n        `}};__decorate([property({type:Object,attribute:!1})],OrRuleNotificationModal.prototype,\"action\",void 0),__decorate([property({type:String})],OrRuleNotificationModal.prototype,\"title\",void 0),__decorate([property({type:Object})],OrRuleNotificationModal.prototype,\"query\",void 0),OrRuleNotificationModal=__decorate([customElement(\"or-rule-notification-modal\")],OrRuleNotificationModal);export{OrRuleNotificationModal};","var __decorate=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};import{html,LitElement,css}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import\"@openremote/or-mwc-components/or-mwc-input\";import i18next from\"i18next\";import{translate}from\"@openremote/or-translate\";import\"@openremote/or-mwc-components/or-mwc-input\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{OrRulesJsonRuleChangedEvent}from\"../or-rule-json-viewer\";let OrRuleFormEmailMessage=class extends(translate(i18next)(LitElement)){static get styles(){return css`\n            or-mwc-input {\n                margin-bottom: 20px;\n                min-width: 420px;\n                width: 100%;\n            }\n        `}render(){const e=this.action.notification.message;return html`\n            <form style=\"display:grid\">\n                <or-mwc-input value=\"${e&&e.subject?e.subject:\"\"}\" @or-mwc-input-changed=\"${e=>this.setActionNotificationName(e.detail.value,\"subject\")}\" .label=\"${i18next.t(\"subject\")}\" type=\"${InputType.TEXT}\" required placeholder=\" \"></or-mwc-input>\n                <or-mwc-input value=\"${e&&e.html?e.html:\"\"}\" @or-mwc-input-changed=\"${e=>this.setActionNotificationName(e.detail.value,\"html\")}\" .label=\"${i18next.t(\"message\")}\" type=\"${InputType.TEXTAREA}\" required placeholder=\" \" ></or-mwc-input>\n            </form>\n        `}setActionNotificationName(e,t){if(t&&this.action.notification&&this.action.notification.message){const o=this.action.notification.message;o[t]=e,this.action.notification.message=Object.assign({},o)}this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}};__decorate([property({type:Object,attribute:!1})],OrRuleFormEmailMessage.prototype,\"action\",void 0),OrRuleFormEmailMessage=__decorate([customElement(\"or-rule-form-email-message\")],OrRuleFormEmailMessage);export{OrRuleFormEmailMessage};","var __decorate=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(r<3?n(a):r>3?n(e,i,a):n(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a};import{html,LitElement,css}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import\"@openremote/or-mwc-components/or-mwc-input\";import i18next from\"i18next\";import{translate}from\"@openremote/or-translate\";import\"@openremote/or-mwc-components/or-mwc-input\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{OrRulesJsonRuleChangedEvent}from\"../or-rule-json-viewer\";import set from\"lodash-es/set\";let OrRuleFormPushNotification=class extends(translate(i18next)(LitElement)){static get styles(){return css`\n            or-mwc-input {\n                margin-bottom: 20px;\n                min-width: 420px;\n                width: 100%;\n            }\n        `}updated(t){if(t.has(\"action\")){let t=this.action.notification.message;this.action.notification&&t&&!t.action&&(t={type:\"push\",action:{openInBrowser:!0}},this.action.notification.message=Object.assign(Object.assign({},this.action.notification.message),t))}}render(){const t=this.action.notification.message,e=t&&t.title?t.title:\"\",i=t&&t.body?t.body:\"\",o=t&&t.action?t.action:\"\",n=o&&o.url?o.url:\"\",r=t&&t.buttons?t.buttons:[];return html`\n            <form style=\"display:grid\">\n                <or-mwc-input value=\"${e}\" \n                    @or-mwc-input-changed=\"${t=>this.setActionNotificationName(t.detail.value,\"title\")}\" \n                    .label=\"${i18next.t(\"subject\")}\" \n                    type=\"${InputType.TEXT}\" \n                    required \n                    placeholder=\" \"></or-mwc-input>\n\n                <or-mwc-input value=\"${i}\" \n                    @or-mwc-input-changed=\"${t=>this.setActionNotificationName(t.detail.value,\"body\")}\" \n                    .label=\"${i18next.t(\"message\")}\" \n                    type=\"${InputType.TEXTAREA}\" \n                    required \n                    placeholder=\" \" ></or-mwc-input>\n                <or-mwc-input value=\"${n}\" \n                    @or-mwc-input-changed=\"${t=>this.setActionNotificationName(t.detail.value,\"action.url\")}\" \n                    .label=\"${i18next.t(\"openWebsiteUrl\")}\" \n                    type=\"${InputType.TEXT}\" \n                    required \n                    placeholder=\" \"></or-mwc-input>\n\n                <or-mwc-input .value=\"${!o||void 0===o.openInBrowser||o&&o.openInBrowser}\" \n                    @or-mwc-input-changed=\"${t=>this.setActionNotificationName(t.detail.value,\"action.openInBrowser\")}\" \n                    .label=\"${i18next.t(\"openInBrowser\")}\" \n                    type=\"${InputType.SWITCH}\" \n                    placeholder=\" \"></or-mwc-input>  \n                \n                <or-mwc-input value=\"${r&&r[0]&&r[0].title?r[0].title:\"\"}\" \n                    @or-mwc-input-changed=\"${t=>this.setActionNotificationName(t.detail.value,\"buttons.0.title\")}\" \n                    .label=\"${i18next.t(\"buttonTextConfirm\")}\" \n                    type=\"${InputType.TEXT}\" \n                    required \n                    placeholder=\" \"></or-mwc-input>\n                <or-mwc-input value=\"${r&&r[1]&&r[1].title?r[1].title:\"\"}\" \n                    @or-mwc-input-changed=\"${t=>this.setActionNotificationName(t.detail.value,\"buttons.1.title\")}\" \n                    .label=\"${i18next.t(\"buttonTextDecline\")}\" \n                    type=\"${InputType.TEXT}\" \n                    placeholder=\" \"></or-mwc-input>\n            </form>\n        `}setActionNotificationName(t,e){if(e&&this.action.notification&&this.action.notification.message){let i=this.action.notification.message;set(i,e,t),e.includes(\"action\")&&set(i,\"buttons.0.\"+e,t),this.action.notification.message=Object.assign({},i)}this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}};__decorate([property({type:Object,attribute:!1})],OrRuleFormPushNotification.prototype,\"action\",void 0),OrRuleFormPushNotification=__decorate([customElement(\"or-rule-form-push-notification\")],OrRuleFormPushNotification);export{OrRuleFormPushNotification};","var OrRuleActionNotification_1,__decorate=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var n=t.length-1;n>=0;n--)(s=t[n])&&(o=(a<3?s(o):a>3?s(e,i,o):s(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(s,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function n(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,n)}l((r=r.apply(t,e||[])).next())}))};import{css,html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{until}from\"lit/directives/until.js\";import{OrRulesRuleUnsupportedEvent}from\"../index\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{getTargetTypeMap,OrRulesJsonRuleChangedEvent}from\"./or-rule-json-viewer\";import\"./modals/or-rule-notification-modal\";import\"./forms/or-rule-form-email-message\";import\"./forms/or-rule-form-push-notification\";import\"./or-rule-action-attribute\";import{i18next}from\"@openremote/or-translate\";import manager,{Util}from\"@openremote/core\";const style=css`\n    :host {\n        display: flex;\n        align-items: center;\n    }\n\n    :host > * {\n        margin: 0 3px 6px;\n    }\n\n    .min-width {\n        min-width: 200px;\n    }\n`;let OrRuleActionNotification=OrRuleActionNotification_1=class extends LitElement{static get styles(){return style}static getActionTargetTemplate(t,e,i,r,s,a,o,n){let l=[[\"USER\",i18next.t(\"user_plural\")],[\"ASSET\",i18next.t(\"asset_plural\")],[\"REALM\",i18next.t(\"realm_plural\")],[\"CUSTOM\",i18next.t(\"custom\")]];if(s&&s.controls&&s.controls.allowedActionTargetTypes){let t;t=s.controls.allowedActionTargetTypes.actions?s.controls.allowedActionTargetTypes.actions[i]:s.controls.allowedActionTargetTypes.default,t&&(l=l.filter((e=>null==t?void 0:t.includes(e[0]))))}if(0===l.length)return void console.warn(\"Rule action config doesn't allow any action target types for this type of action\");let c,u=\"ASSET\";if(e.target&&(!e.target.users||e.target.conditionAssets||e.target.matchedAssets||e.target.assets?e.target.linkedUsers?u=\"USER\":void 0===e.target.custom||e.target.conditionAssets||e.target.matchedAssets||e.target.assets||(u=\"CUSTOM\"):u=\"USER\"),l.find((t=>t[0]===u))||(u=void 0),\"CUSTOM\"===u){const t=html`\n                <or-mwc-input class=\"min-width\" .type=\"${InputType.TEXT}\" @or-mwc-input-changed=\"${t=>n(u,t.detail.value)}\" ?readonly=\"${r}\" .value=\"${e.target.custom}\" ></or-mwc-input>            \n            `;c=Promise.resolve(t)}else{let i,s,o;if(\"USER\"===u){const t={realmPredicate:{name:manager.displayRealm},select:{basic:!0},serviceUsers:!1,attributes:[{name:{value:\"systemAccount\",predicateType:\"string\"},negated:!0}]};i=manager.rest.api.UserResource.query(t).then((t=>__awaiter(this,void 0,void 0,(function*(){const e=i18next.t(\"linked\");let i=(yield manager.rest.api.RealmResource.get(manager.displayRealm)).data.realmRoles.filter((t=>Util.realmRoleFilter(t))).map((t=>[\"linked-\"+t.name,e+\": \"+i18next.t(\"realmRole.\"+t.name,Util.camelCaseToSentenceCase(t.name.replace(\"_\",\" \").replace(\"-\",\" \")))])),r=t.data.map((t=>[t.id,t.username]));return[[\"linkedUsers\",e],...i,...r]})))),s=i18next.t(\"user_plural\");const r=e.target.users;if(e.target.linkedUsers)if(r&&r.realmRoles){if(r.realmRoles.length>1)return void console.warn(\"Rule action user target query is unsupported: \"+JSON.stringify(r,null,2));o=\"linked-\"+r.realmRoles[0].value}else o=\"linkedUsers\";else{if(!r)return void console.warn(\"Rule action user target query is unsupported: \"+JSON.stringify(r,null,2));if(r.ids&&r.ids.length>1||r.usernames||r.assets||r.limit||r.pathPredicate||r.realmPredicate)return void console.warn(\"Rule action user target query is unsupported: \"+JSON.stringify(r,null,2));r.ids&&1===r.ids.length&&(o=r.ids[0])}}else{const r=a?Object.assign({},a):{};if(r.orderBy={property:\"NAME\"},i=manager.rest.api.AssetResource.queryAssets(r).then((e=>{let i=e.data.map((t=>[t.id,t.name+\" (\"+t.id+\")\"]));const r=[[\"allMatched\",i18next.t(\"matched\")]];return t&&t.length>1&&t.forEach((t=>{r.find((e=>e[0]===t[0]))||r.push([t[0],i18next.t(\"matchedOfType\",{type:Util.getAssetTypeLabel(t[0])})])})),[...r,...i]})),s=i18next.t(\"asset_plural\"),e.target){if(e.target.conditionAssets)return void console.warn(\"Rule action asset target, conditionAssets is unsupported: \"+JSON.stringify(e.target,null,2));if(e.target.matchedAssets){if(e.target.matchedAssets.types&&e.target.matchedAssets.types.length>1)return void console.warn(\"Rule action asset target, matchedAssets query unsupported: \"+JSON.stringify(e.target,null,2));e.target.matchedAssets.types&&1===e.target.matchedAssets.types.length&&(o=e.target.matchedAssets.types[0])}else if(e.target.assets){if(e.target.assets.ids&&e.target.assets.ids.length>1)return void console.warn(\"Rule action asset target, assets query unsupported: \"+JSON.stringify(e.target,null,2));e.target.assets.ids&&1===e.target.assets.ids.length&&(o=e.target.assets.ids[0])}}else o=\"allMatched\"}c=i.then((t=>html`\n                    <or-mwc-input type=\"${InputType.SELECT}\" \n                        class=\"min-width\"\n                        .options=\"${t}\"\n                        .label=\"${s}\"\n                        .value=\"${o}\"\n                        @or-mwc-input-changed=\"${t=>n(u,t.detail.value)}\" \n                        ?readonly=\"${r}\"></or-mwc-input>\n                `))}return c=c.then((t=>html`\n                <or-mwc-input type=\"${InputType.SELECT}\" \n                    class=\"min-width\"\n                    .options=\"${l}\"\n                    .value=\"${u}\"\n                    .label=\"${i18next.t(\"recipients\")}\"\n                    @or-mwc-input-changed=\"${t=>o(t.detail.value)}\" \n                    ?readonly=\"${r}\"></or-mwc-input>\n                ${t}\n            `)),c}render(){if(!this.action.notification||!this.action.notification.message)return html``;const t=this.action.notification.message,e=t.type;let i;i=\"push\"===e?{types:[\"ConsoleAsset\"]}:{attributes:{items:[{name:{predicateType:\"string\",value:\"email\"},value:{predicateType:\"value-empty\",negate:!0}}]}};let r=OrRuleActionNotification_1.getActionTargetTemplate(getTargetTypeMap(this.rule),this.action,this.actionType,!!this.readonly,this.config,i,(t=>this._onTargetTypeChanged(t)),((t,e)=>this._onTargetChanged(t,e))),s=\"\";return r?(t&&(\"push\"===e&&(s=html`\n                    <or-rule-notification-modal title=\"push-notification\" .action=\"${this.action}\">\n                        <or-rule-form-push-notification .action=\"${this.action}\"></or-rule-form-push-notification>\n                    </or-rule-notification-modal>\n                `),\"email\"===e&&(s=html`\n                    <or-rule-notification-modal title=\"email\" .action=\"${this.action}\">\n                        <or-rule-form-email-message .action=\"${this.action}\"></or-rule-form-email-message>\n                    </or-rule-notification-modal>\n                `)),r=r.then((t=>html`\n                ${t}\n                ${s}\n            `)),html`${until(r,html``)}`):(this.dispatchEvent(new OrRulesRuleUnsupportedEvent),\"\")}_onTargetTypeChanged(t){\"ASSET\"===t?delete this.action.target:\"USER\"===t?this.action.target={users:{ids:[]}}:\"CUSTOM\"===t&&(this.action.target={custom:\"\"}),this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}_onTargetChanged(t,e){switch(t){case\"USER\":\"linkedUsers\"===e?this.action.target={linkedUsers:!0}:(null==e?void 0:e.startsWith(\"linked-\"))?this.action.target={users:{realmRoles:[{predicateType:\"string\",value:null==e?void 0:e.substring(7)}]},linkedUsers:!0}:e&&(this.action.target={users:{ids:[e]}});break;case\"CUSTOM\":this.action.target={custom:e};break;case\"ASSET\":e&&\"allMatched\"!==e?e.endsWith(\"Asset\")?this.action.target={matchedAssets:{types:[e]}}:this.action.target={assets:{ids:[e]}}:delete this.action.target}this.dispatchEvent(new OrRulesJsonRuleChangedEvent)}};__decorate([property({type:Object,attribute:!1})],OrRuleActionNotification.prototype,\"rule\",void 0),__decorate([property({type:Object,attribute:!1})],OrRuleActionNotification.prototype,\"action\",void 0),__decorate([property({type:String,attribute:!1})],OrRuleActionNotification.prototype,\"actionType\",void 0),__decorate([property({type:Object})],OrRuleActionNotification.prototype,\"assetInfos\",void 0),__decorate([property({type:Object})],OrRuleActionNotification.prototype,\"config\",void 0),OrRuleActionNotification=OrRuleActionNotification_1=__decorate([customElement(\"or-rule-action-notification\")],OrRuleActionNotification);export{OrRuleActionNotification};","var __decorate=this&&this.__decorate||function(e,t,o,r){var n,l=arguments.length,i=l<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(l<3?n(i):l>3?n(t,o,i):n(t,o))||i);return l>3&&i&&Object.defineProperty(t,o,i),i};import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{i18next}from\"@openremote/or-translate\";import{html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";let OrRuleWebhookModal=class extends LitElement{constructor(){super(),this.title=i18next.t(\"message\")}firstUpdated(e){e.has(\"action\")&&this.renderDialogHTML(this.action)}renderDialogHTML(e){const t=this.shadowRoot.getElementById(\"webhook-modal\");if(!this.shadowRoot)return;const o=this.shadowRoot.querySelector(\".webhook-form-slot\");if(t&&o){let e=document.createElement(\"div\");o.assignedNodes({flatten:!0}).forEach((t=>{t instanceof HTMLElement&&e.appendChild(t)})),t.content=html`${e}`,t.dismissAction=null,this.requestUpdate()}}closeForm(e){this.shadowRoot.host.close()}render(){if(!this.action)return html`${i18next.t(\"errorOccurred\")}`;const e=[{actionName:\"\",content:html`\n                    <or-mwc-input .type=\"${InputType.BUTTON}\" label=\"ok\"\n                                  @or-mwc-input-changed=\"${this.closeForm}\"></or-mwc-input>`}];return html`\n            <or-mwc-input type=\"${InputType.BUTTON}\" label=\"message\"\n                          @or-mwc-input-changed=\"${()=>{const e=this.shadowRoot.getElementById(\"webhook-modal\");e&&e.open()}}\"></or-mwc-input>\n            <or-mwc-dialog id=\"webhook-modal\" heading=\"${this.title}\" .actions=\"${e}\"></or-mwc-dialog>\n            <slot class=\"webhook-form-slot\"></slot>\n        `}};__decorate([property({type:Object})],OrRuleWebhookModal.prototype,\"action\",void 0),__decorate([property({type:String})],OrRuleWebhookModal.prototype,\"title\",void 0),OrRuleWebhookModal=__decorate([customElement(\"or-rule-webhook-modal\")],OrRuleWebhookModal);export{OrRuleWebhookModal};","var __decorate=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{i18next}from\"@openremote/or-translate\";import{css,html,LitElement}from\"lit\";import{customElement,property,state}from\"lit/decorators.js\";import{when}from\"lit/directives/when.js\";import{OrRulesJsonRuleChangedEvent}from\"../or-rule-json-viewer\";const styling=css`\n    .divider {\n        border-bottom: 1px solid rgba(0, 0, 0, 12%);\n    }\n`;let OrRuleFormWebhook=class extends LitElement{constructor(){super(...arguments),this.loading=!1,this.httpMethodOptions=[\"GET\",\"POST\",\"PUT\",\"DELETE\"],this.authMethodOptions=new Map([[\"username_password\",i18next.t(\"username\")+\" & \"+i18next.t(\"password\")],[\"client_credentials\",\"oauth Client Credentials Grant\"],[\"password\",\"oauth Password Grant\"]])}static get styles(){return[styling]}shouldUpdate(e){return e.has(\"webhook\")&&null==this.webhook.headers&&(this.webhook.headers={}),super.shouldUpdate(e)}getAuthMethod(e){return null!=e.oAuthGrant?this.authMethodOptions.get(e.oAuthGrant.grant_type):this.authMethodOptions.get(\"username_password\")}getOAuthGrant(e){return\"client_credentials\"==e||\"password\"==e?{grant_type:e}:void 0}reloadHeaders(){this.loading=!0,this.updateComplete.then((()=>this.loading=!1)),this.notifyWebhookUpdate(!1)}notifyWebhookUpdate(e=!0){e&&this.requestUpdate(\"webhook\"),this.dispatchEvent(new OrRulesJsonRuleChangedEvent)}render(){return when(!this.webhook,(()=>html`\n            ${i18next.t(\"errorOccurred\")}\n        `),(()=>html`\n            <form style=\"display: flex; flex-direction: column; min-width: 520px;\">\n                <!-- HTTP Method & URL -->\n                <div style=\"display: flex; flex-direction: row; align-items: center; gap: 5px; margin-bottom: 28px;\">\n                    <or-mwc-input style=\"flex: 0;\" type=\"${InputType.SELECT}\" .value=\"${this.webhook.httpMethod}\"\n                                  .options=\"${this.httpMethodOptions}\"\n                                  @or-mwc-input-changed=\"${e=>{this.webhook.httpMethod=e.detail.value,this.notifyWebhookUpdate()}}\"\n                    ></or-mwc-input>\n                    <or-mwc-input style=\"flex: 1;\" type=\"${InputType.URL}\" required label=\"${i18next.t(\"webUrl\")}\"\n                                  .value=\"${this.webhook.url}\" helperPersistent\n                                  @or-mwc-input-changed=\"${e=>{this.webhook.url=e.detail.value,this.notifyWebhookUpdate()}}\"></or-mwc-input>\n                </div>\n                <!-- Headers -->\n                <div style=\"display: flex; flex-direction: column; gap: 5px; margin-bottom: 28px;\">\n                    <span>Headers</span>\n                    ${when(this.loading,(()=>html`\n                        ${this.getHeadersTemplate(this.webhook.headers,!0)}\n                    `),(()=>html`\n                        ${this.getHeadersTemplate(this.webhook.headers,!1)}\n                    `))}\n                    <or-mwc-input type=\"${InputType.BUTTON}\" icon=\"plus\" label=\"addRequestHeader\"\n                                  @or-mwc-input-changed=\"${e=>{null!=(this.webhook.headers?this.webhook.headers[\"\"]:void 0)?this.webhook.headers[\"\"].push(\"\"):this.webhook.headers[\"\"]=[\"\"],this.reloadHeaders()}}\"></or-mwc-input>\n                </div>\n                <!-- Authorization -->\n                <div style=\"display: flex; flex-direction: column; gap: 10px; margin-bottom: ${this.webhook.oAuthGrant||this.webhook.usernamePassword?\"28px\":\"0\"};\">\n                    <or-mwc-input type=\"${InputType.SWITCH}\" fullwidth label=\"${i18next.t(\"requiresAuthorization\")}\"\n                                  .value=\"${this.webhook.oAuthGrant||this.webhook.usernamePassword}\"\n                                  @or-mwc-input-changed=\"${e=>{this.webhook.usernamePassword=e.detail.value?{username:\"admin\",password:\"secret\"}:void 0,this.notifyWebhookUpdate()}}\"></or-mwc-input>\n                    ${when(this.webhook.oAuthGrant||this.webhook.usernamePassword,(()=>{const e=Array.from(this.authMethodOptions.values());return html`\n                            <or-mwc-input type=\"${InputType.SELECT}\" label=\"${i18next.t(\"method\")}\"\n                                          .value=\"${this.getAuthMethod(this.webhook)}\"\n                                          .options=\"${e}\"\n                                          @or-mwc-input-changed=\"${e=>{const t=[...this.authMethodOptions.entries()].find((t=>t[1]==e.detail.value));this.webhook.oAuthGrant=this.getOAuthGrant(t[0]),this.notifyWebhookUpdate()}}\"></or-mwc-input>\n                            ${this.getAuthSettingsTemplate(this.webhook)}\n                        `}))}\n                </div>\n                <!-- Payload -->\n                <div style=\"display: flex; flex-direction: column; gap: 5px;\">\n                    ${when(\"GET\"!=this.webhook.httpMethod&&\"DELETE\"!=this.webhook.httpMethod,(()=>html`\n                        <or-mwc-input type=\"${InputType.SWITCH}\" fullwidth label=\"${i18next.t(\"includeBodyInRequest\")}\"\n                                      .value=\"${null!=this.webhook.payload}\"\n                                      @or-mwc-input-changed=\"${e=>{this.webhook.payload=e.detail.value?JSON.stringify({rule:\"%RULESET_NAME%\",assets:\"%TRIGGER_ASSETS%\"},null,4):void 0,this.notifyWebhookUpdate()}}\"\n                        ></or-mwc-input>\n                        ${when(null!=this.webhook.payload,(()=>html`\n                                <or-mwc-input type=\"${InputType.TEXTAREA}\" .value=\"${this.webhook.payload}\"\n                                              @or-mwc-input-changed=\"${e=>{this.webhook.payload=e.detail.value,this.notifyWebhookUpdate()}}\"></or-mwc-input>\n                            `))}\n                    `))}\n                </div>\n            </form>\n        `))}getHeadersTemplate(e,t){return Object.keys(this.webhook.headers).sort(((e,t)=>-e.localeCompare(t))).map(((e,o,i)=>{const n=this.webhook.headers[e];return n.map(((o,i)=>html`\n                    <div style=\"display: flex; gap: 5px;\">\n                        <or-mwc-input type=\"${InputType.TEXT}\" label=\"${i18next.t(\"header\")}\" value=\"${e}\"\n                                      style=\"flex: 1;\" .disabled=\"${t}\"\n                                      @or-mwc-input-changed=\"${t=>{n.length>0?n.splice(i,1):delete this.webhook.headers[e];const r=this.webhook.headers[t.detail.value];r&&r.length>0?r.push(o):this.webhook.headers[t.detail.value]=[o],this.reloadHeaders()}}\"\n                        ></or-mwc-input>\n                        <or-mwc-input type=\"${InputType.TEXT}\" label=\"${i18next.t(\"value\")}\" value=\"${o}\"\n                                      style=\"flex: 1;\" .disabled=\"${t}\"\n                                      @or-mwc-input-changed=\"${t=>{this.webhook.headers[e][i]=t.detail.value,this.notifyWebhookUpdate()}}\"\n                        ></or-mwc-input>\n                        <or-mwc-input type=\"${InputType.BUTTON}\" icon=\"delete\" .disabled=\"${t}\"\n                                      @or-mwc-input-changed=\"${()=>{n.splice(i,1),this.reloadHeaders()}}\"></or-mwc-input>\n                    </div>\n                `))}))}getAuthSettingsTemplate(e){var t,o;const i=e.oAuthGrant;return null==i?html`\n                <div style=\"display: flex; flex-direction: column; gap: 10px;\">\n                    <or-mwc-input type=\"${InputType.TEXT}\" label=\"${i18next.t(\"username\")}\"\n                                  .value=\"${null===(t=e.usernamePassword)||void 0===t?void 0:t.username}\"\n                                  @or-mwc-input-changed=\"${e=>{this.webhook.usernamePassword||(this.webhook.usernamePassword={}),this.webhook.usernamePassword.username=e.detail.value,this.notifyWebhookUpdate()}}\"></or-mwc-input>\n                    <or-mwc-input type=\"${InputType.TEXT}\" label=\"${i18next.t(\"password\")}\"\n                                  .value=\"${null===(o=this.webhook.usernamePassword)||void 0===o?void 0:o.password}\"\n                                  @or-mwc-input-changed=\"${e=>{this.webhook.usernamePassword||(this.webhook.usernamePassword={}),this.webhook.usernamePassword.password=e.detail.value,this.notifyWebhookUpdate()}}\"></or-mwc-input>\n                </div>\n            `:html`\n                <div style=\"display: flex; flex-direction: column; gap: 10px;\">\n                    <div style=\"display: flex; flex-direction: row; align-items: center; gap: 5px;\">\n                        <or-mwc-input style=\"flex: 1;\" type=\"${InputType.URL}\" required\n                                      label=\"${i18next.t(\"tokenUrl\")}\" .value=\"${i.tokenEndpointUri}\"\n                                      @or-mwc-input-changed=\"${e=>{i.tokenEndpointUri=e.detail.value,this.notifyWebhookUpdate()}}\"></or-mwc-input>\n                    </div>\n                    ${when(null!=i.grant_type,(()=>{switch(i.grant_type){case\"client_credentials\":{const e=i;return html`\n                                    <or-mwc-input type=\"${InputType.TEXT}\" label=\"${i18next.t(\"clientId\")}\"\n                                                  .value=\"${e.client_id}\"\n                                                  @or-mwc-input-changed=\"${t=>{e.client_id=t.detail.value,this.notifyWebhookUpdate()}}\"></or-mwc-input>\n                                    <or-mwc-input type=\"${InputType.PASSWORD}\" label=\"${i18next.t(\"clientSecret\")}\"\n                                                  .value=\"${e.client_secret}\"\n                                                  @or-mwc-input-changed=\"${t=>{e.client_secret=t.detail.value,this.notifyWebhookUpdate()}}\"></or-mwc-input>\n                                `}case\"password\":{const e=i;return html`\n                                    <or-mwc-input type=\"${InputType.TEXT}\" label=\"${i18next.t(\"username\")}\"\n                                                  .value=\"${e.username}\"\n                                                  @or-mwc-input-changed=\"${t=>{e.username=t.detail.value,this.notifyWebhookUpdate()}}\"></or-mwc-input>\n                                    <or-mwc-input type=\"${InputType.TEXT}\" label=\"${i18next.t(\"password\")}\"\n                                                  .value=\"${e.password}\"\n                                                  @or-mwc-input-changed=\"${t=>{e.password=t.detail.value,this.notifyWebhookUpdate()}}\"></or-mwc-input>\n                                `}default:return html`${i18next.t(\"errorOccurred\")}`}}))}\n                </div>\n            `}};__decorate([property({type:Object})],OrRuleFormWebhook.prototype,\"webhook\",void 0),__decorate([state()],OrRuleFormWebhook.prototype,\"loading\",void 0),OrRuleFormWebhook=__decorate([customElement(\"or-rule-form-webhook\")],OrRuleFormWebhook);export{OrRuleFormWebhook};","var __decorate=this&&this.__decorate||function(e,o,t,r){var i,l=arguments.length,c=l<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,t):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)c=Reflect.decorate(e,o,t,r);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(c=(l<3?i(c):l>3?i(o,t,c):i(o,t))||c);return l>3&&c&&Object.defineProperty(o,t,c),c};import{css,html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import\"./modals/or-rule-webhook-modal\";import\"./forms/or-rule-form-webhook\";const style=css`\n    :host {\n        height: 100%;\n        margin: 2px 3px auto 0;\n    }\n\n    :host > * {\n        margin: 0 3px 6px;\n    }\n\n    .min-width {\n        min-width: 200px;\n    }\n`;let OrRuleActionWebhook=class extends LitElement{static get styles(){return style}render(){return html`\n            <div style=\"display: flex; align-items: center; height: 100%;\">\n                <or-rule-webhook-modal .action=\"${this.action}\">\n                    <or-rule-form-webhook .webhook=\"${this.action.webhook}\"></or-rule-form-webhook>\n                </or-rule-webhook-modal>\n            </div>\n        `}};__decorate([property({type:Object,attribute:!1})],OrRuleActionWebhook.prototype,\"rule\",void 0),__decorate([property({type:Object,attribute:!1})],OrRuleActionWebhook.prototype,\"action\",void 0),OrRuleActionWebhook=__decorate([customElement(\"or-rule-action-webhook\")],OrRuleActionWebhook);export{OrRuleActionWebhook};","var __decorate=this&&this.__decorate||function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s};import{css,html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{buttonStyle}from\"../style\";import\"./or-rule-asset-query\";import{getAssetTypeFromQuery}from\"../index\";import{OrRulesJsonRuleChangedEvent}from\"./or-rule-json-viewer\";import{AssetModelUtil}from\"@openremote/model\";import i18next from\"i18next\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{getContentWithMenuTemplate}from\"@openremote/or-mwc-components/or-mwc-menu\";import{Util}from\"@openremote/core\";import\"./or-rule-action-attribute\";import\"./or-rule-action-notification\";import\"./or-rule-action-webhook\";import{translate}from\"@openremote/or-translate\";const NOTIFICATION_COLOR=\"4B87EA\",WAIT_COLOR=\"EACC54\";function getActionTypesMenu(e,t){let i=!0,o=!0,r=!0,n=!0,s=!0;e&&e.controls&&e.controls.allowedActionTypes&&(i=e.controls.allowedActionTypes.indexOf(\"attribute\")>=0,o=e.controls.allowedActionTypes.indexOf(\"wait\")>=0,r=e.controls.allowedActionTypes.indexOf(\"email\")>=0,n=e.controls.allowedActionTypes.indexOf(\"push\")>=0,s=e.controls.allowedActionTypes.indexOf(\"webhook\")>=0);const c=[];return i&&t&&c.push(...t.filter((e=>\"agent\"!==e.assetDescriptor.descriptorType)).map((e=>{const t=AssetModelUtil.getAssetDescriptorColour(e),i=AssetModelUtil.getAssetDescriptorIcon(e),o=t?{\"--or-icon-fill\":\"#\"+t}:void 0;return{text:Util.getAssetTypeLabel(e.assetDescriptor),value:e.assetDescriptor.name,icon:i||AssetModelUtil.getAssetDescriptorIcon(\"ThingAsset\"),styleMap:o}}))),c.sort(Util.sortByString((e=>null==e?void 0:e.value))),c.push(null),r&&c.push({text:i18next.t(\"email\"),icon:\"email\",value:\"email\",styleMap:{\"--or-icon-fill\":\"#4B87EA\"}}),n&&c.push({text:i18next.t(\"push-notification\"),icon:\"cellphone-message\",value:\"push\",styleMap:{\"--or-icon-fill\":\"#4B87EA\"}}),o&&c.push({text:i18next.t(\"wait\"),icon:\"timer\",value:\"wait\",styleMap:{\"--or-icon-fill\":\"#EACC54\"}}),s&&c.push({text:i18next.t(\"webhook\"),icon:\"webhook\",value:\"webhook\",styleMap:{\"--or-icon-fill\":\"#4B87EA\"}}),c}export var RecurrenceOption;function getRecurrenceMenu(e){return e&&e.controls&&e.controls.allowedRecurrenceOptions?e.controls.allowedRecurrenceOptions.map((e=>({text:i18next.t(e),value:e}))):Object.values(RecurrenceOption).map((e=>({text:i18next.t(e),value:e})))}!function(e){e.ALWAYS=\"always\",e.ONCE=\"once\",e.ONCE_PER_HOUR=\"oncePerHour\",e.ONCE_PER_DAY=\"oncePerDay\",e.ONCE_PER_WEEK=\"oncePerWeek\"}(RecurrenceOption||(RecurrenceOption={}));const style=css`\n\n    :host {\n        display: flex;\n        width: 100%;\n        flex-direction: column;\n    }\n        \n    ${buttonStyle}\n    \n    .rule-action {\n        display: flex;\n        margin: 10px 0;\n    }\n    \n    .rule-action-wrapper {\n        flex-grow: 1;\n        display: flex;\n        align-items: baseline;\n    }\n    \n    .rule-action > button {\n        flex-grow: 0;\n    }\n\n    .rule-action:hover .button-clear {\n        visibility: visible;\n    }\n\n    or-panel:hover .remove-button.button-clear {\n        visibility: visible;\n    }\n            \n    or-panel {\n        position: relative;\n        margin: 10px 10px 20px 10px;\n    }\n    \n    #type-selector {\n        margin-top: 10px;\n    }    \n        \n    .add-button-wrapper {\n        display: flex;\n        align-items: center;\n        white-space: nowrap;\n    }\n    \n    .add-button-wrapper > * {\n        margin-right: 6px;\n    }\n    \n    .add-button-wrapper or-mwc-menu {\n        text-transform: capitalize;\n    }\n    \n    #type {\n        white-space: nowrap;\n        margin: 4px 3px auto 0;\n        text-transform: capitalize;\n    }\n    \n    .rule-recurrence {\n        position: absolute;\n        top: 5px;\n        right: 0;\n    }\n   \n`;let OrRuleThenOtherwise=class extends(translate(i18next)(LitElement)){static get styles(){return style}get thenAllowAdd(){return!this.config||!this.config.controls||!0!==this.config.controls.hideThenAddAction}ruleRecurrenceTemplate(e,t){let i=\"\";const o=\"inherit\";let r=RecurrenceOption.ONCE;return e&&(void 0===e.mins||null===e.mins?r=RecurrenceOption.ONCE:0===e.mins?r=RecurrenceOption.ALWAYS:60===e.mins?r=RecurrenceOption.ONCE_PER_HOUR:1440===e.mins?r=RecurrenceOption.ONCE_PER_DAY:10080===e.mins&&(r=RecurrenceOption.ONCE_PER_WEEK)),i=t?html`\n                <div style=\"--or-mwc-input-color: ${o}; margin-right: 6px;\">\n                    <or-mwc-input .type=\"${InputType.BUTTON}\" label=\"${r}\"></or-mwc-input>\n                </div>\n            `:html`\n                <div style=\"--or-mwc-input-color: ${o}; margin-right: 6px;\">\n                    ${getContentWithMenuTemplate(html`<or-mwc-input .type=\"${InputType.BUTTON}\" label=\"${r}\"></or-mwc-input>`,getRecurrenceMenu(this.config),r,(e=>this.setRecurrenceOption(e)))}\n                </div>\n            `,html`\n            <div class=\"rule-recurrence\">\n                ${i}\n            </div>\n        `}ruleActionTemplate(e,t,i){const o=!this.config||!this.config.controls||!0!==this.config.controls.hideActionTypeOptions,r=this.getActionType(t);if(!r&&!o)return html`<span>INVALID CONFIG - NO TYPE SPECIFIED AND TYPE SELECTOR DISABLED</span>`;let n=\"\",s=\"\";const c=!this.readonly&&(this.thenAllowAdd||this.rule.then.length>1);if(o){let o,s=\"inherit\";if(t.action)switch(t.action){case\"wait\":o=\"timer\",s=\"EACC54\";break;case\"webhook\":o=\"webhook\",s=\"4B87EA\";break;case\"notification\":\"push\"===r?(o=\"cellphone-message\",s=\"4B87EA\"):(o=\"email\",s=\"4B87EA\");break;default:const e=AssetModelUtil.getAssetDescriptor(r);o=AssetModelUtil.getAssetDescriptorIcon(e),s=AssetModelUtil.getAssetDescriptorColour(e)||s}n=i?html`\n                    <div id=\"type\" style=\"--or-mwc-input-color: #${s}\">\n                        <or-mwc-input type=\"${InputType.BUTTON}\" .icon=\"${o||\"\"}\"></or-mwc-input>\n                    </div>\n                `:html`\n                    <div id=\"type\" style=\"--or-mwc-input-color: #${s}\">\n                        ${getContentWithMenuTemplate(html`<or-mwc-input type=\"${InputType.BUTTON}\" .icon=\"${o||\"\"}\"></or-mwc-input>`,getActionTypesMenu(this.config,this.assetInfos),t.action,(i=>this.setActionType(e,t,i)))}\n                    </div>\n                `}if(r)switch(r){case\"wait\":s=html`<span>WAIT NOT IMPLEMENTED</span>`;break;case\"push\":s=html`<or-rule-action-notification id=\"push-notification\" .rule=\"${this.rule}\" .action=\"${t}\" .actionType=\"${\"push\"}\" .config=\"${this.config}\" .assetInfos=\"${this.assetInfos}\" .readonly=\"${this.readonly}\"></or-rule-action-notification>`;break;case\"email\":s=html`<or-rule-action-notification id=\"email-notification\" .rule=\"${this.rule}\" .action=\"${t}\" .actionType=\"${\"email\"}\" .config=\"${this.config}\" .assetInfos=\"${this.assetInfos}\" .readonly=\"${this.readonly}\"></or-rule-action-notification>`;break;case\"webhook\":s=html`<or-rule-action-webhook .rule=\"${this.rule}\" .action=\"${t}\" .actionType=\"${\"webhook\"}\"></or-rule-action-webhook>`;break;default:s=html`<or-rule-action-attribute .action=\"${t}\" .targetTypeMap=\"${this.targetTypeMap}\" .config=\"${this.config}\" .assetInfos=\"${this.assetInfos}\" .assetProvider=\"${this.assetProvider}\" .readonly=\"${this.readonly}\"></or-rule-action-attribute>`}return html`\n            <div class=\"rule-action\">\n                <div class=\"rule-action-wrapper\">\n                    ${n}\n                    ${s}\n                </div>\n                    ${c?html`\n                        <button class=\"button-clear\" @click=\"${()=>this.removeAction(t)}\"><or-icon icon=\"close-circle\"></or-icon></input>\n                    `:\"\"}\n            </div>\n        `}render(){const e=!this.readonly&&(this.thenAllowAdd||this.rule.then.length>1);return html`\n            <div>\n                <or-panel .heading=\"${i18next.t(\"then\")}...\">\n                    ${this.ruleRecurrenceTemplate(this.rule.recurrence,this.readonly)}\n\n                    ${this.rule.then?this.rule.then.map((e=>this.ruleActionTemplate(this.rule.then,e,this.readonly))):\"\"}\n                    ${e?html`\n                        <span class=\"add-button-wrapper\">\n                            ${getContentWithMenuTemplate(html`<or-mwc-input class=\"plus-button\" type=\"${InputType.BUTTON}\" icon=\"plus\"\n                                                   .label=\"${i18next.t(\"rulesEditorAddAction\")}\"></or-mwc-input>`,getActionTypesMenu(this.config,this.assetInfos),void 0,(e=>this.addAction(e)))}\n                        </span>\n                    `:\"\"}\n                </or-panel>\n            </div>\n        `}getActionType(e){switch(e.action){case\"wait\":break;case\"webhook\":return e.action;case\"notification\":return e.notification&&e.notification.message&&e.notification.message.type?e.notification.message.type:e.action;case\"write-attribute\":case\"update-attribute\":if(!e.target)return;if(e.target.matchedAssets)return getAssetTypeFromQuery(e.target.matchedAssets);if(e.target.assets)return getAssetTypeFromQuery(e.target.assets)}}setRecurrenceOption(e){switch(e){case RecurrenceOption.ALWAYS:this.rule.recurrence={mins:0};break;case RecurrenceOption.ONCE_PER_HOUR:this.rule.recurrence={mins:60};break;case RecurrenceOption.ONCE_PER_DAY:this.rule.recurrence={mins:1440};break;case RecurrenceOption.ONCE_PER_WEEK:this.rule.recurrence={mins:10080};break;case RecurrenceOption.ONCE:default:delete this.rule.recurrence}this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}setActionType(e,t,i){switch(t.target=void 0,t.action){case\"wait\":t.millis=void 0;break;case\"webhook\":break;case\"write-attribute\":t.value=void 0,t.attributeName=void 0;break;case\"notification\":t.notification=void 0;break;case\"update-attribute\":t.value=void 0,t.attributeName=void 0,t.index=void 0,t.key=void 0,t.updateAction=void 0}\"wait\"===i?t.action=\"wait\":\"webhook\"==i?(t.action=\"webhook\",t.webhook={httpMethod:\"POST\",payload:JSON.stringify({rule:\"%RULESET_NAME%\",assets:\"%TRIGGER_ASSETS%\"},null,4)}):\"email\"===i?(t.action=\"notification\",t.notification={message:{type:\"email\",subject:\"%RULESET_NAME%\",html:\"%TRIGGER_ASSETS%\"}}):\"push\"===i?(t.action=\"notification\",t.notification={message:{type:\"push\",title:\"%RULESET_NAME%\",body:\"%TRIGGER_ASSETS%\"}}):(t.action=\"write-attribute\",t.target={matchedAssets:{types:[i]}});const o=e.indexOf(t);e[o]=Object.assign({},t),this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}removeAction(e){if(!this.rule||!this.rule.then||!e)return;const t=this.rule.then.indexOf(e);t>=0&&(this.rule.then.splice(t,1),this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate())}addAction(e,t){if(!this.rule)return;let i,o,r={action:\"write-attribute\"};const n=this.config&&this.config.json?this.config.json:void 0;t?(this.rule.otherwise||(this.rule.otherwise=[]),i=this.rule.otherwise,o=n&&n.otherwise?n.otherwise:void 0):(this.rule.then||(this.rule.then=[]),i=this.rule.then,o=n&&n.then?n.then:void 0),o&&(r=JSON.parse(JSON.stringify(o))),e&&this.setActionType(i,r,e),i.push(r),this.dispatchEvent(new OrRulesJsonRuleChangedEvent),this.requestUpdate()}};__decorate([property({type:Array,attribute:!1})],OrRuleThenOtherwise.prototype,\"targetTypeMap\",void 0),__decorate([property({type:Object,attribute:!1})],OrRuleThenOtherwise.prototype,\"rule\",void 0),__decorate([property({type:Boolean})],OrRuleThenOtherwise.prototype,\"readonly\",void 0),__decorate([property({type:Object,attribute:!1})],OrRuleThenOtherwise.prototype,\"assetInfos\",void 0),__decorate([property({type:Object})],OrRuleThenOtherwise.prototype,\"assetProvider\",void 0),OrRuleThenOtherwise=__decorate([customElement(\"or-rule-then-otherwise\")],OrRuleThenOtherwise);","var __decorate=this&&this.__decorate||function(e,t,s,r){var i,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,s,o):i(t,s))||o);return n>3&&o&&Object.defineProperty(t,s,o),o},__awaiter=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function o(e){try{u(r.next(e))}catch(e){n(e)}}function a(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((r=r.apply(e,t||[])).next())}))};import{css,html,LitElement}from\"lit\";import{customElement,property,state}from\"lit/decorators.js\";import{getAssetInfos,getAssetsByType,getAssetTypeFromQuery,OrRulesRuleChangedEvent,OrRulesRuleUnsupportedEvent}from\"../index\";import{Util}from\"@openremote/core\";import\"./or-rule-when\";import\"./or-rule-then-otherwise\";import\"@openremote/or-components/or-panel\";import i18next from\"i18next\";import{translate}from\"@openremote/or-translate\";export class OrRulesJsonRuleChangedEvent extends CustomEvent{constructor(){super(OrRulesJsonRuleChangedEvent.NAME,{bubbles:!0,composed:!0})}}function getTypeAndTagsFromGroup(e){if(!e)return[];let t=[];if(e.items)for(const s of e.items){const e=getAssetTypeFromQuery(s.assets);e&&t.push([e,s.tag])}if(e.groups)for(const s of e.groups)t=t.concat(getTypeAndTagsFromGroup(s));return t}OrRulesJsonRuleChangedEvent.NAME=\"or-rules-json-rule-changed\";export function getTargetTypeMap(e){return e.when?getTypeAndTagsFromGroup(e.when):[]}const style=css`\n    :host {\n        display: flex;\n        width: calc(100% - 20px);\n        padding: 0px 10px;\n        margin-top: -10px;\n    }\n    \n    :host > * {\n        flex: 1;\n    }\n\n    @media screen and (max-width: 1400px) {\n        :host > * {\n            flex-grow: 0;\n        }\n\n        :host {\n            flex-direction: column;\n        }\n    }\n`;let OrRuleJsonViewer=class extends(translate(i18next)(LitElement)){static get styles(){return style}constructor(){super(),this._loadedAssets=new Map,this._unsupported=!1,this._activeAssetPromises=new Map,this.addEventListener(OrRulesJsonRuleChangedEvent.NAME,this._onJsonRuleChanged)}connectedCallback(){super.connectedCallback(),this._unsupported&&this.dispatchEvent(new OrRulesRuleUnsupportedEvent)}set ruleset(e){if(this._ruleset!==e)if(this._unsupported=!1,this._ruleset=e,e.rules)try{const t=JSON.parse(e.rules);if(!t.rules||t.rules.length>1)return void(this.isConnected?this.dispatchEvent(new OrRulesRuleUnsupportedEvent):this._unsupported=!0);this._rule=t.rules[0],this.requestUpdate()}catch(e){console.error(\"Invalid JSON rules, failed to parse: \"+e),this.isConnected?this.dispatchEvent(new OrRulesRuleUnsupportedEvent):this._unsupported=!0}else this.config&&this.config.json&&this.config.json.rule?this._rule=JSON.parse(JSON.stringify(this.config.json.rule)):this._rule={recurrence:{mins:0}}}updated(e){e.has(\"config\")&&(this.loadAssetDescriptors(!1),this.loadAssetDescriptors(!0))}render(){if(!this._rule)return html``;const e=getTargetTypeMap(this._rule);return html`\n            <div class=\"section-container\">                                    \n                <or-rule-when .rule=\"${this._rule}\" .config=\"${this.config}\" .assetInfos=\"${this._whenAssetInfos}\" ?readonly=\"${this.readonly}\" \n                              .assetProvider=\"${e=>__awaiter(this,void 0,void 0,(function*(){return this.loadAssets(e)}))}\"\n                ></or-rule-when>\n            </div>\n        \n            <div class=\"section-container\">              \n                <or-rule-then-otherwise .rule=\"${this._rule}\" .config=\"${this.config}\" .targetTypeMap=\"${e}\" .assetInfos=\"${this._actionAssetInfos}\" ?readonly=\"${this.readonly}\" \n                                        .assetProvider=\"${e=>__awaiter(this,void 0,void 0,(function*(){return this.loadAssets(e)}))}\"\n                ></or-rule-then-otherwise>\n            </div>\n        `}loadAssets(e){return __awaiter(this,void 0,void 0,(function*(){if(this._activeAssetPromises.has(e))return(yield this._activeAssetPromises.get(e)).assets;{const t=getAssetsByType(e,\"realm\"==this._ruleset.type?this._ruleset.realm:void 0,this._loadedAssets);this._activeAssetPromises.set(e,t);const s=yield t;return this._activeAssetPromises.delete(e),s.assets}}))}loadAssetDescriptors(e){getAssetInfos(this.config,e).then((t=>{e?(this._actionAssetInfos=[...t],this.requestUpdate()):(this._whenAssetInfos=[...t],this.requestUpdate())}))}beforeSave(){if(!this._rule)return;this._rule.name=this._ruleset.name;const e={rules:[this._rule]};this._ruleset.rules=JSON.stringify(e)}validate(){const e=this._rule;return!!(e&&e.when&&e.then&&0!==e.then.length&&this._validateConditionGroup(e.when)&&this._validateRuleActions(e,e.then))}_onJsonRuleChanged(){const e=this.validate();this.dispatchEvent(new OrRulesRuleChangedEvent(e))}_validateConditionGroup(e){if(!(e.items&&0!==e.items.length||e.groups&&0!==e.groups.length))return!1;if(e.items)for(const t of e.items){if(!t.assets&&!t.cron&&!t.sun)return!1;if(t.cron&&!Util.cronStringToISOString(t.cron,!0))return!1;if(t.sun&&(!t.sun.position||!t.sun.location))return!1;if(t.assets&&!this._validateAssetQuery(t.assets,!0,!1))return!1}if(e.groups)for(const t of e.groups)if(!this._validateConditionGroup(t))return!1;return!0}_validateRuleActions(e,t){var s;if(!t)return!0;for(const r of t)switch(r.action){case\"wait\":if(!r.millis)return!1;break;case\"write-attribute\":if(!r.attributeName)return!1;if(!this._validateAssetTarget(e,r.target))return!1;break;case\"notification\":break;case\"webhook\":if(!(null===(s=r.webhook)||void 0===s?void 0:s.url)||!r.webhook.httpMethod)return!1;break;case\"update-attribute\":if(!r.attributeName)return!1;if(!r.updateAction)return!1;if(!this._validateAssetTarget(e,r.target))return!1;break;default:return!1}return!0}_validateAssetTarget(e,t){return!t||(t.assets?this._validateAssetQuery(t.assets,!1,!1):t.matchedAssets?this._validateAssetQuery(t.matchedAssets,!1,!0):!(t.conditionAssets&&getTypeAndTagsFromGroup(e.when).findIndex((e=>t.conditionAssets===e[1]))<0))}_validateAssetQuery(e,t,s){if(!e.types||0===e.types.length)return!1;if(t){if(!e.attributes||!e.attributes.items||0===e.attributes.items.length)return!1}else if(!(s||e.ids&&0!==e.ids.length))return!1;if(e.attributes&&e.attributes.items)for(const t of e.attributes.items){if(!t.name||!t.name.match||!t.name.value)return!1;if(!t.value||!this._validateValuePredicate(t.value))return!1}return!0}_validateValuePredicate(e){switch(e.predicateType){case\"string\":return void 0!==e.match&&void 0!==e.value;case\"boolean\":return void 0!==e.value;case\"datetime\":case\"number\":return void 0!==e.operator&&void 0!==e.value&&(\"BETWEEN\"!==e.operator||void 0!==e.rangeValue);case\"radial\":return void 0!==e.radius&&void 0!==e.lat&&void 0!==e.lng;case\"rect\":return void 0!==e.lngMax&&void 0!==e.latMax&&void 0!==e.lngMin&&void 0!==e.latMin;case\"array\":return e.index&&!e.value||e.value||e.lengthEquals||e.lengthLessThan||e.lengthGreaterThan;case\"value-empty\":return!0;default:return!1}}};__decorate([property({attribute:!1})],OrRuleJsonViewer.prototype,\"readonly\",void 0),__decorate([property({attribute:!1})],OrRuleJsonViewer.prototype,\"config\",void 0),__decorate([property({attribute:!1})],OrRuleJsonViewer.prototype,\"_ruleset\",void 0),__decorate([state()],OrRuleJsonViewer.prototype,\"_loadedAssets\",void 0),OrRuleJsonViewer=__decorate([customElement(\"or-rule-json-viewer\")],OrRuleJsonViewer);export{OrRuleJsonViewer};","var __decorate=this&&this.__decorate||function(e,t,r,o){var i,s=arguments.length,l=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)l=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(l=(s<3?i(l):s>3?i(t,r,l):i(t,r))||l);return s>3&&l&&Object.defineProperty(t,r,l),l};import{OrRulesRuleChangedEvent}from\"./index\";import{css,html,LitElement}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import\"ace-builds/src-noconflict/mode-javascript\";import\"ace-builds/src-noconflict/mode-json\";import\"ace-builds/src-noconflict/mode-groovy\";import\"ace-builds/webpack-resolver\";import\"@openremote/or-components/or-ace-editor\";import{createRef,ref}from\"lit/directives/ref.js\";const style=css`\n    :host {\n        display: flex;\n        width: 100%;\n        height: 100%;\n    }\n\n    #ace-editor {\n        position: relative;\n        height: 100%;\n        width: 100%;\n    }\n\n    @media screen and (max-width: 1400px) {\n        :host > * {\n            flex-grow: 0;\n        }\n\n        :host {\n            flex-direction: column;\n        }\n    }\n`;let OrRuleTextViewer=class extends LitElement{constructor(){super(...arguments),this._aceEditor=createRef()}static get styles(){return style}set ruleset(e){this._ruleset!==e&&(this._ruleset=e,e.rules?this._rules=e.rules:this._rules=this._createRules())}_createRules(){return\"\"}render(){return html`\n            <or-ace-editor ${ref(this._aceEditor)} @or-ace-editor-changed=\"${e=>this._onEditorChanged(e)}\" .mode=\"${this._getMode()}\" .value=\"${this._getRulesString()}\"></or-ace-editor>\n        `}_getMode(){switch(this._ruleset.lang){case\"JAVASCRIPT\":return\"ace/mode/javascript\";case\"GROOVY\":return\"ace/mode/groovy\";case\"JSON\":return\"ace/mode/json\"}}_getRulesString(){if(!this._rules)return\"\";switch(this._ruleset.lang){case\"JAVASCRIPT\":case\"GROOVY\":return this._rules;case\"JSON\":return JSON.stringify(JSON.parse(this._rules),null,2)}}_onEditorChanged(e){const t=e.detail.valid;this.dispatchEvent(new OrRulesRuleChangedEvent(t))}beforeSave(){this._aceEditor.value&&(this._ruleset.rules=this._aceEditor.value.getValue())}validate(){return!!this._aceEditor.value&&this._aceEditor.value.validate()}};__decorate([property({attribute:!1})],OrRuleTextViewer.prototype,\"readonly\",void 0),__decorate([property({attribute:!1})],OrRuleTextViewer.prototype,\"config\",void 0),__decorate([property({attribute:!1})],OrRuleTextViewer.prototype,\"_ruleset\",void 0),OrRuleTextViewer=__decorate([customElement(\"or-rule-text-viewer\")],OrRuleTextViewer);export{OrRuleTextViewer};","var __decorate=this&&this.__decorate||function(t,e,i,l){var a,r=arguments.length,o=r<3?e:null===l?l=Object.getOwnPropertyDescriptor(e,i):l;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,l);else for(var n=t.length-1;n>=0;n--)(a=t[n])&&(o=(r<3?a(o):r>3?a(e,i,o):a(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};import{css,html,LitElement}from\"lit\";import{customElement,property,query}from\"lit/decorators.js\";import{OrRulesRuleChangedEvent}from\"./index\";import\"@openremote/or-mwc-components/or-mwc-input\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import i18next from\"i18next\";import{translate}from\"@openremote/or-translate\";import{OrMwcDialog,showDialog}from\"@openremote/or-mwc-components/or-mwc-dialog\";import{RRule,Weekday}from\"rrule\";import moment from\"moment\";let OrRuleValidity=class extends(translate(i18next)(LitElement)){constructor(){super()}updated(t){super.updated(t),t.has(\"ruleset\")&&this.ruleset&&(this._validity=this.ruleset.meta?this.ruleset.meta.validity:void 0,this._validity&&this._validity.recurrence?this._rrule=RRule.fromString(this._validity.recurrence):this._rrule=void 0)}getWeekDay(t){switch(t){case\"MO\":return RRule.MO;case\"TU\":return RRule.TU;case\"WE\":return RRule.WE;case\"TH\":return RRule.TH;case\"FR\":return RRule.FR;case\"SA\":return RRule.SA;case\"SU\":return RRule.SU}}isAllDay(){return this._validity&&0===moment(this._validity.start).hours()&&0===moment(this._validity.start).minutes()&&23===moment(this._validity.end).hours()&&59===moment(this._validity.end).minutes()}setRRuleValue(t,e){let i=this._rrule?this._rrule.origOptions:void 0;const l=this._validity;switch(e){case\"all-day\":t?(l.start=moment(l.start).startOf(\"day\").toDate().getTime(),l.end=moment(l.end).endOf(\"day\").toDate().getTime()):(l.start=moment().toDate().getTime(),l.end=moment().add(1,\"hour\").toDate().getTime());break;case\"start\":const e=moment(t);e.isValid()&&(l.start=e.set({hour:0,minute:0,second:0,millisecond:0}).toDate().getTime(),\"validityRecurrence\"===this.getValidityType()&&(i.dtstart=e.toDate(),this._rrule=new RRule(i)));break;case\"end\":const a=moment(t);a.isValid()&&(l.end=a.set({hour:23,minute:59,second:0,millisecond:0}).toDate().getTime());break;case\"never-ends\":t?delete i.until:i.until=moment().add(1,\"year\").toDate(),\"validityRecurrence\"===this.getValidityType()&&(this._rrule=new RRule(i));break;case\"byweekday\":i.byweekday||(i.byweekday=[]),Array.isArray(i.byweekday)||(i.byweekday=[i.byweekday]);const r=t;i.byweekday=[],r.forEach((t=>{const e=this.getWeekDay(t);e&&i.byweekday.push(e)})),\"validityRecurrence\"===this.getValidityType()&&(this._rrule=new RRule(i));break;case\"until\":if(this._rrule.options.until){const e=moment(t);i.until=new Date(moment(i.until).set({year:e.year(),month:e.month(),date:e.date()}).format())}\"validityRecurrence\"===this.getValidityType()&&(this._rrule=new RRule(i));break;case\"dtstart-time\":const o=t.split(\":\");i?i.dtstart=moment(i.dtstart).set({hour:o[0],minute:o[1],second:0,millisecond:0}).toDate():i=new RRule({dtstart:moment(this._validity.start).set({hour:o[0],minute:o[1],second:0,millisecond:0}).toDate()}).origOptions,l.start=moment(i.dtstart).toDate().getTime(),\"validityRecurrence\"===this.getValidityType()&&(this._rrule=new RRule(i));break;case\"until-time\":const n=t.split(\":\");this._rrule&&this._rrule.options.until&&(i?i.until=moment(i.until).set({hour:n[0],minute:n[1],second:0,millisecond:0}).toDate():i=new RRule({until:moment(this._validity.end).set({hour:n[0],minute:n[1],second:0,millisecond:0}).toDate()}).origOptions),l.end=moment(l.end).set({hour:n[0],minute:n[1],second:0,millisecond:0}).toDate().getTime(),\"validityRecurrence\"===this.getValidityType()&&(this._rrule=new RRule(i))}this._validity=Object.assign({},l),this._dialog.requestUpdate()}timeLabel(){if(\"validityAlways\"===this.getValidityType())return i18next.t(\"validityAlways\");if(this._validity&&this._rrule){const t=this._validity,e=moment(t.end).diff(t.start,\"days\");let i=\"\";return this.isAllDay()?(e>0&&(i=\" \"+i18next.t(\"forDays\",{days:e})),this._rrule.toText()+i):(e>0&&(i=i18next.t(\"fromToDays\",{start:moment(t.start).format(\"HH:mm\"),end:moment(t.end).format(\"HH:mm\"),days:e})),0===e&&(i=i18next.t(\"fromTo\",{start:moment(t.start).format(\"HH:mm\"),end:moment(t.end).format(\"HH:mm\")})),this._rrule.toText()+\" \"+i)}if(this._validity){let t=\"DD-MM-YYYY\";return this.isAllDay()||(t=\"DD-MM-YYYY HH:mm\"),i18next.t(\"activeFromTo\",{start:moment(this._validity.start).format(t),end:moment(this._validity.end).format(t)})}}setValidityType(t){if(this.ruleset){switch(this.ruleset.meta||(this.ruleset.meta={}),t){case\"validityAlways\":delete this.ruleset.meta.validity,this._validity=void 0,this._rrule=void 0;break;case\"validityPeriod\":this._validity={start:moment().startOf(\"day\").toDate().getTime(),end:moment().endOf(\"day\").toDate().getTime()},this._rrule=void 0;break;case\"validityRecurrence\":this._validity||(this._validity={start:moment().startOf(\"day\").toDate().getTime(),end:moment().endOf(\"day\").toDate().getTime()}),this._rrule=new RRule({freq:RRule.DAILY,dtstart:new Date})}this._dialog.requestUpdate()}}getValidityType(){return this._validity?this._rrule?\"validityRecurrence\":\"validityPeriod\":\"validityAlways\"}render(){return this.ruleset?html`\n            <or-mwc-input outlined .type=\"${InputType.BUTTON}\" label=\"${this.timeLabel()}\" @or-mwc-input-changed=\"${()=>this.showDialog()}\"></or-mwc-input>\n        `:html``}showDialog(){this._dialog=showDialog((new OrMwcDialog).setHeading(i18next.t(\"scheduleRuleActivity\")).setStyles(html`\n                <style>\n                    .mdc-dialog__surface {\n                        overflow-x: visible !important;\n                        overflow-y: visible !important;\n                    }\n\n                    #dialog-content {\n                        overflow: visible;\n                    }\n\n                    @media only screen and (max-width: 1279px) {\n                        .mdc-dialog__surface {\n                            overflow-x: auto !important;\n                            overflow-y: auto !important;\n                        }\n\n                        #dialog-content {\n                            min-height: 230px;\n                            overflow: auto;\n                        }\n                    }\n                </style>`).setActions([{actionName:\"cancel\",content:html`<or-mwc-input class=\"button\" .type=\"${InputType.BUTTON}\" label=\"cancel\"></or-mwc-input>`,action:()=>{this._dialog=void 0}},{actionName:\"ok\",default:!0,content:html`<or-mwc-input class=\"button\" .type=\"${InputType.BUTTON}\" label=\"apply\"></or-mwc-input>`,action:()=>{this.ruleset&&this.ruleset.meta&&(\"validityAlways\"===this.getValidityType()?delete this.ruleset.meta.validity:(\"validityRecurrence\"===this.getValidityType()&&(this._validity.recurrence=this._rrule.toString().split(\"RRULE:\")[1]),this.ruleset.meta.validity=this._validity),this.dispatchEvent(new OrRulesRuleChangedEvent(!0)),this._dialog=void 0)}}]).setContent((()=>this.getDialogContent())).setDismissAction(null))}getDialogContent(){const t=[RRule.MO.toString(),RRule.TU.toString(),RRule.WE.toString(),RRule.TH.toString(),RRule.FR.toString(),RRule.SA.toString(),RRule.SU.toString()],e=this.getValidityType(),i=this._rrule&&this._rrule.options&&this._rrule.options.byweekday?this._rrule.options.byweekday.map((t=>new Weekday(t).toString())):[],l=this._validity;return html`\n            <div style=\"min-width: 635px; display:grid; flex-direction: row;\">\n                <div class=\"layout horizontal\">\n                    <or-mwc-input style=\"min-width: 280px;\" .value=\"${e}\" .type=\"${InputType.SELECT}\" .options=\"${[\"validityAlways\",\"validityPeriod\",\"validityRecurrence\"]}\" @or-mwc-input-changed=\"${t=>this.setValidityType(t.detail.value)}\" ></or-mwc-input>\n                </div>\n\n                ${!l||\"validityPeriod\"!==e&&\"validityRecurrence\"!==e?\"\":html`\n                    <label style=\"display:block; margin-top: 20px;\"><or-translate value=\"period\"></or-translate></label>\n                    <div style=\"display: flex; justify-content: space-between;\" class=\"layout horizontal\">\n                        <div> \n                            <or-mwc-input value=\"${moment(l.start).format(\"YYYY-MM-DD\")}\" .type=\"${InputType.DATE}\" @or-mwc-input-changed=\"${t=>this.setRRuleValue(t.detail.value,\"start\")}\" .label=\"${i18next.t(\"from\")}\"></or-mwc-input>\n                            <or-mwc-input .disabled=${this.isAllDay()} .value=\"${moment(l.start).format(\"HH:mm\")}\" .type=\"${InputType.TIME}\" @or-mwc-input-changed=\"${t=>this.setRRuleValue(t.detail.value,\"dtstart-time\")}\" .label=\"${i18next.t(\"from\")}\"></or-mwc-input>\n                        </div>\n                        <div>\n                            <or-mwc-input .value=\"${moment(l.end).format(\"YYYY-MM-DD\")}\"  .type=\"${InputType.DATE}\" @or-mwc-input-changed=\"${t=>this.setRRuleValue(t.detail.value,\"end\")}\" .label=\"${i18next.t(\"to\")}\"></or-mwc-input>\n                            <or-mwc-input .disabled=${this.isAllDay()} .value=\"${moment(l.end).format(\"HH:mm\")}\" .type=\"${InputType.TIME}\" @or-mwc-input-changed=\"${t=>this.setRRuleValue(t.detail.value,\"until-time\")}\" .label=\"${i18next.t(\"to\")}\"></or-mwc-input>\n                        </div>\n                    </div>  \n                    \n                    <div class=\"layout horizontal\">\n                        <or-mwc-input .value=${this.isAllDay()} @or-mwc-input-changed=\"${t=>this.setRRuleValue(t.detail.value,\"all-day\")}\"  .type=\"${InputType.CHECKBOX}\" .label=\"${i18next.t(\"allDay\")}\"></or-mwc-input>\n                    </div>\n                `}\n             \n                ${\"validityRecurrence\"===e?html`\n                    <label style=\"display: block; margin-top: 20px;\"><or-translate value=\"repeatOccurrenceEvery\"></or-translate></label>\n                    <div class=\"layout horizontal\">\n                        <or-mwc-input .value=\"${i}\" \n                                      .type=\"${InputType.CHECKBOX_LIST}\" \n                                      .options=\"${t}\" \n                                      .label=\"${i18next.t(\"daysOfTheWeek\")}\" \n                                      @or-mwc-input-changed=\"${t=>{this.setRRuleValue(t.detail.value,\"byweekday\")}}\" ></or-mwc-input>\n                    </div>\n\n                    <label style=\"display:block; margin-top: 20px;\"><or-translate value=\"repetitionEnds\"></or-translate></label>\n                    <div class=\"layout horizontal\">                        \n                        <or-mwc-input .value=\"${!this._rrule.options.until}\"  @or-mwc-input-changed=\"${t=>this.setRRuleValue(t.detail.value,\"never-ends\")}\"  .type=\"${InputType.CHECKBOX}\" .label=\"${i18next.t(\"never\")}\"></or-mwc-input>\n                    </div>\n                    <div class=\"layout horizontal\">\n                        <or-mwc-input ?disabled=\"${!this._rrule.options.until}\" .value=\"${this._rrule.options.until?moment(this._rrule.options.until).format(\"YYYY-MM-DD\"):moment().add(1,\"year\").format(\"YYYY-MM-DD\")}\"  .type=\"${InputType.DATE}\" @or-mwc-input-changed=\"${t=>this.setRRuleValue(t.detail.value,\"until\")}\" .label=\"${i18next.t(\"to\")}\"></or-mwc-input>\n                    </div>\n                `:\"\"}                \n            </div>`}};OrRuleValidity.styles=css`\n        :host {\n            margin-left: 20px;\n        }\n    `,__decorate([property({type:Object})],OrRuleValidity.prototype,\"ruleset\",void 0),__decorate([query(\"#radial-modal\")],OrRuleValidity.prototype,\"dialog\",void 0),__decorate([property()],OrRuleValidity.prototype,\"_validity\",void 0),__decorate([property()],OrRuleValidity.prototype,\"_rrule\",void 0),OrRuleValidity=__decorate([customElement(\"or-rule-validity\")],OrRuleValidity);export{OrRuleValidity};","var __decorate=this&&this.__decorate||function(e,t,r,o){var a,n=arguments.length,i=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i};import{LitElement,html,css}from\"lit\";import{customElement,property,query}from\"lit/decorators.js\";import{i18next,translate}from\"@openremote/or-translate\";let NodePanel=class extends(translate(i18next)(LitElement)){constructor(){super(...arguments),this.nodes=[]}static get styles(){return css`\n        .list{\n            overflow-x: hidden;\n            overflow-y: auto;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            height: 100%;\n            background: #F9F9F9;\n        }\n        .category{\n            display: flex;\n            width: 80%;\n            flex-direction: column;\n            align-items: center;\n            text-align: center;\n            padding: 15px 15px 0 15px;\n        }\n        .category span{\n            margin:0;\n            color: rgb(125,125,125);\n            padding: 0 0 15px 0 ;\n        }\n        .small-node-grid{\n            display: grid;\n            grid-template-columns: repeat(5, 1fr);\n            grid-template-rows: repeat(2, 1fr);\n            grid-gap: 6px;\n            justify-items: stretch;\n            align-items: stretch;\n            margin-bottom: 15px;\n            width: var(--nodepanel-width);\n        }\n        .input-node{ background-color: var(--input-color); }\n        .processor-node{ background-color: var(--processor-color); }\n        .output-node{ background-color: var(--output-color); }\n        .input-node:hover{ background-color: var(--input-color-h); }\n        .processor-node:hover{ background-color: var(--processor-color-h); }\n        .output-node:hover{ background-color: var(--output-color-h); }`}firstUpdated(){this.drawer&&(this.drawer.open=!0)}render(){return html`\n        <!-- <or-mwc-drawer rightsided dismissible transparent> -->\n            ${this.listTemplate}\n        <!-- </or-mwc-drawer> -->\n        `}nodeTemplate(e){return html`<node-menu-item class=\"node-item\" .node=\"${e}\" .workspace=\"${this.application.editorWorkspace}\"></node-menu-item>`}get listTemplate(){return html`\n        <div class=\"list\">\n            <div class=\"category\"> <span>${i18next.t(\"input\",\"Input\")}</span> \n                ${this.nodes.filter((e=>\"INPUT\"===e.type)).map((e=>this.nodeTemplate(e)))}\n            </div>\n\n            <div class=\"category\"><span>${i18next.t(\"processors\",\"Processors\")}</span> \n                <div class=\"small-node-grid\">\n                    ${this.nodes.filter((e=>\"PROCESSOR\"===e.type&&e.displayCharacter)).map((e=>this.nodeTemplate(e)))}\n                </div>\n                ${this.nodes.filter((e=>\"PROCESSOR\"===e.type&&!e.displayCharacter)).map((e=>this.nodeTemplate(e)))}\n            </div>\n\n            <div class=\"category\"> <span>${i18next.t(\"output\",\"Output\")}</span> \n                ${this.nodes.filter((e=>\"OUTPUT\"===e.type)).map((e=>this.nodeTemplate(e)))}\n            </div>\n        </div>\n        `}};__decorate([property({type:Array})],NodePanel.prototype,\"nodes\",void 0),__decorate([query(\"or-mwc-drawer\")],NodePanel.prototype,\"drawer\",void 0),__decorate([property({attribute:!1})],NodePanel.prototype,\"application\",void 0),NodePanel=__decorate([customElement(\"node-panel\")],NodePanel);export{NodePanel};","var ContextMenu_1,__decorate=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,n,s):i(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s};import{LitElement,html,css}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{translate,i18next}from\"@openremote/or-translate\";let ContextMenu=ContextMenu_1=class extends(translate(i18next)(LitElement)){constructor(){super(...arguments),this.entries=[],this.isOpen=!1,this.closeCallback=()=>{ContextMenu_1.close()}}static get opened(){return ContextMenu_1.main.isOpen}static get styles(){return css`\n        :host{\n            display: inline-block;\n            position: fixed;\n            background: white;\n            outline: 1px solid rgb(200,200,200);\n            box-shadow: rgba(0, 0, 0, 0.05) 0 2px 4px;\n            font-size: 13px;\n            z-index: 1000000;\n        }\n        .context-menu-button{\n            color: rgb(0,0,0);\n            display: grid;\n            align-items: center;\n            justify-items: start;\n            grid-template-rows: 32px;\n            grid-template-columns: 32px 220px;\n            grid-template-areas:\n                \"icon label\";\n        }\n        .context-menu-button:hover{\n            background: whitesmoke;\n        }\n        .label\n        {\n            grid-area: label;\n        }\n        or-icon{\n            justify-self: center;\n            grid-area: icon;\n            height: 16px;\n            width: 16px;\n        }\n        .muted{\n            pointer-events: none;\n            color: rgb(150,150,150);\n        }\n        .context-menu-separator{\n            --thickness: 1px;\n            border: 0;\n            height: var(--thickness);\n            border-bottom: solid var(--thickness);\n            border-color: rgb(234,234,234);\n            padding: 0;\n            margin: 5px 10px calc(5px - var(--thickness)) 10px;\n        }`}static open(t,e,n,o){ContextMenu_1.main.container=n,ContextMenu_1.main.style.top=e+\"px\",ContextMenu_1.main.style.left=t+\"px\",window.addEventListener(\"mousedown\",ContextMenu_1.main.closeCallback),window.addEventListener(\"blur\",ContextMenu_1.main.closeCallback),window.addEventListener(\"wheel\",ContextMenu_1.main.closeCallback),ContextMenu_1.main.entries=o,ContextMenu_1.main.isOpen=!0}static close(){window.removeEventListener(\"mousedown\",ContextMenu_1.main.closeCallback),window.removeEventListener(\"blur\",ContextMenu_1.main.closeCallback),window.removeEventListener(\"wheel\",ContextMenu_1.main.closeCallback),ContextMenu_1.main.isOpen=!1}firstUpdated(){ContextMenu_1.main=this}updated(){if(!this.container)return;const t=this.container.getBoundingClientRect(),e=this.getBoundingClientRect();e.top+e.height>t.bottom&&(this.style.top=e.top-e.height+\"px\"),e.left+e.width>t.right&&(this.style.left=t.right-e.width+\"px\")}render(){if(this.style.display=this.isOpen?\"unset\":\"none\",!this.isOpen)return html``;const t=this.entries.map((t=>{switch(t.type){case\"button\":return this.buttonTemplate(t);case\"separator\":return this.separatorTemplate()}}));return html`${t.length>0?t:html`<div class=\"context-menu-button muted\">...</div>`}`}buttonTemplate(t){return html`\n        <div class=\"context-menu-button ${t.disabled?\"muted\":\"\"}\" @mousedown=\"${e=>{1===e.buttons&&(ContextMenu_1.close(),t.action&&t.action(),e.stopImmediatePropagation(),e.stopPropagation())}}\">\n        ${t.icon?html`<or-icon icon=\"${t.icon}\"></or-icon>`:null}\n        <span class=\"label\">${t.label}</span></div>`}separatorTemplate(){return html`<div class=\"context-menu-separator\"></div>`}};__decorate([property({attribute:!1})],ContextMenu.prototype,\"isOpen\",void 0),ContextMenu=ContextMenu_1=__decorate([customElement(\"context-menu\")],ContextMenu);export{ContextMenu};","import{project}from\"../components/flow-editor\";export const nodeConverter={fromAttribute:o=>project.nodes.find((t=>t.id===o)),toAttribute:o=>o.id};","var __decorate=this&&this.__decorate||function(e,t,o,i){var n,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,o,r):n(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},__awaiter=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(n,s){function r(e){try{d(i.next(e))}catch(e){s(e)}}function a(e){try{d(i.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,a)}d((i=i.apply(e,t||[])).next())}))};import{html}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{IdentityDomLink}from\"../node-structure\";import{FlowNodeStyle}from\"../styles/flow-node-style\";import{i18next}from\"@openremote/or-translate\";import{nodeConverter}from\"../converters/node-converter\";import{SelectableElement}from\"./selectable-element\";import{project,newIds}from\"./flow-editor\";let FlowNode=class extends SelectableElement{constructor(){super(),this.frozen=!1,this.minimal=!1,this.isBeingDragged=!1,this.forceUpdate=()=>{this.requestUpdate()},this.setTranslate=()=>{const e=this.workspace.worldToOffset(this.node.position);this.style.transform=`translate(${e.x}px, ${e.y}px) scale(${this.workspace.camera.zoom})`,this.dispatchEvent(new CustomEvent(\"updated\"))},this.startDrag=e=>{this.frozen||1===e.buttons&&(project.createUndoSnapshot(),this.bringToFront(),window.addEventListener(\"mouseup\",this.stopDrag),window.addEventListener(\"mousemove\",this.onDrag),this.isBeingDragged=!0)},this.onDrag=e=>{this.node.position={x:this.node.position.x+e.movementX/this.workspace.camera.zoom,y:this.node.position.y+e.movementY/this.workspace.camera.zoom},this.setTranslate()},this.stopDrag=()=>{window.removeEventListener(\"mouseup\",this.stopDrag),window.removeEventListener(\"mousemove\",this.onDrag),this.isBeingDragged=!1,project.notifyChange()},this.linkIdentity=()=>{IdentityDomLink.map[this.node.id]=this}}static get styles(){return FlowNodeStyle}disconnectedCallback(){this.workspace.removeEventListener(\"pan\",this.setTranslate),this.workspace.removeEventListener(\"zoom\",this.setTranslate),project.removeListener(\"cleared\",this.forceUpdate),project.removeListener(\"connectionremoved\",this.linkIdentity),super.disconnectedCallback()}bringToFront(){this.frozen||(this.style.zIndex=\"\"+this.workspace.topNodeZindex++)}firstUpdated(){const e=Object.create(null,{firstUpdated:{get:()=>super.firstUpdated}});return __awaiter(this,void 0,void 0,(function*(){if(e.firstUpdated.call(this),this.linkIdentity(),this.workspace.addEventListener(\"pan\",this.setTranslate),this.workspace.addEventListener(\"zoom\",this.setTranslate),project.addListener(\"cleared\",this.forceUpdate),project.addListener(\"connectionremoved\",this.linkIdentity),this.minimal=0!==(this.node.displayCharacter||\"\").length,this.bringToFront(),newIds.has(this.node.id)){yield this.updateComplete,yield this.updateComplete;const e=this.getBoundingClientRect();this.node.position.x-=e.width/2/this.workspace.camera.zoom,this.node.position.y-=e.height/2/this.workspace.camera.zoom,this.setTranslate(),newIds.delete(this.node.id)}this.minimal&&this.addEventListener(\"mousedown\",this.startDrag)}))}updated(){return __awaiter(this,void 0,void 0,(function*(){this.linkIdentity(),this.dispatchEvent(new CustomEvent(\"updated\"))}))}render(){this.minimal?this.style.background=`var(--${this.node.type.toLowerCase()}-color)`:this.style.background=\"\",this.setTranslate(),this.style.boxShadow=this.selected?\"var(--highlight) 0 0 0 3px\":\"\";const e=this.minimal?html`<div class=\"title minimal\" ?singlechar=\"${1===this.node.displayCharacter.length}\">${i18next.t(this.node.displayCharacter)}</div>`:html`<div class=\"title ${this.node.type.toLowerCase()}\" @mousedown=\"${this.startDrag}\">${i18next.t(this.node.name)||\"invalid\"}</div>`,t=html`<div class=\"socket-side inputs\">${this.node.inputs.map((e=>html`<flow-node-socket ?renderlabel=\"${!this.minimal}\" .socket=\"${e}\" side=\"input\"></flow-node-socket>`))}</div>`,o=html`<div class=\"socket-side outputs\">${this.node.outputs.map((e=>html`<flow-node-socket ?renderlabel=\"${!this.minimal}\" .socket=\"${e}\" side=\"output\"></flow-node-socket>`))}</div>`,i=html`<div style=\"width: 10px\"></div>`;return html`\n        ${e}\n        ${this.node.inputs.length>0?t:i}\n        ${this.minimal?null:html`<div class=\"internal-container\">${this.node.internals.map((e=>html`<internal-picker style=\"pointer-events: ${this.frozen?\"none\":\"normal\"}\" @picked=\"${()=>__awaiter(this,void 0,void 0,(function*(){this.forceUpdate(),yield this.updateComplete,project.removeInvalidConnections()}))}\" .node=\"${this.node}\" .internalIndex=\"${this.node.internals.indexOf(e)}\"></internal-picker>`))}</div>`}\n        ${this.node.outputs.length>0?o:i}\n        ${this.frozen?html`<or-icon class=\"lock-icon ${this.node.type.toLowerCase()}\" icon=\"lock\"></or-icon>`:\"\"}\n        `}};__decorate([property({converter:nodeConverter})],FlowNode.prototype,\"node\",void 0),__decorate([property({attribute:!1})],FlowNode.prototype,\"workspace\",void 0),__decorate([property({type:Boolean,reflect:!0})],FlowNode.prototype,\"frozen\",void 0),__decorate([property({type:Boolean,reflect:!0})],FlowNode.prototype,\"minimal\",void 0),__decorate([property({attribute:!1})],FlowNode.prototype,\"isBeingDragged\",void 0),FlowNode=__decorate([customElement(\"flow-node\")],FlowNode);export{FlowNode};","import{FlowNode}from\"./flow-node\";import{ConnectionLine}from\"../flow-viewer\";import{integration,project,copyPasteManager,input,exporter,modal}from\"./flow-editor\";import i18next from\"i18next\";import{Utilities}from\"../utils\";import{CopyMachine}from\"../node-structure\";import{ContextMenu}from\"./context-menu\";import{html}from\"lit\";export const createContextMenuButtons=(e,t)=>{const o=input.selected.filter((e=>e instanceof FlowNode&&e.selected)),n=input.selected.filter((e=>e instanceof ConnectionLine&&e.selected)),a=o=>{let n=[{type:\"button\",label:\"\",icon:\"arrow-left\",action:()=>{e.dispatchEvent(new MouseEvent(\"contextmenu\",t))}}];return n=n.concat(integration.nodes.filter((e=>e.type===o)).map((o=>({type:\"button\",label:i18next.t(o.name,Utilities.humanLike(o.name)),action:()=>{const n=CopyMachine.copy(o);n.position=e.offsetToWorld({x:t.offsetX-e.offsetLeft,y:t.offsetY-e.offsetTop}),project.createUndoSnapshot(),project.addNode(n)}})))),n};let i=[{type:\"button\",label:i18next.t(\"input\",\"Input\"),icon:\"arrow-collapse-right\",action:()=>{ContextMenu.open(t.pageX,t.pageY,e,a(\"INPUT\"))}},{type:\"button\",label:i18next.t(\"processors\",\"Processors\"),icon:\"cog\",action:()=>{ContextMenu.open(t.pageX,t.pageY,e,a(\"PROCESSOR\"))}},{type:\"button\",label:i18next.t(\"output\",\"Ouput\"),icon:\"arrow-expand-right\",action:()=>{ContextMenu.open(t.pageX,t.pageY,e,a(\"OUTPUT\"))}}];return i=i.concat([{type:\"separator\"},{type:\"button\",icon:\"content-copy\",label:i18next.t(\"copy\",\"Copy\"),action:()=>{const o=e.offsetToWorld({x:t.offsetX,y:t.offsetY});copyPasteManager.copy(o.x,o.y)},disabled:0===o.length},{type:\"button\",icon:\"content-paste\",label:i18next.t(\"paste\",\"Paste\"),action:()=>{project.createUndoSnapshot();const o=e.offsetToWorld({x:t.offsetX,y:t.offsetY});project.notifyChange(),e.pasteAt(o.x,o.y)},disabled:copyPasteManager.isFull},{type:\"button\",icon:\"delete\",label:i18next.t(\"delete\",\"Delete\"),action:()=>{project.createUndoSnapshot(),o.forEach((e=>{e.frozen||project.removeNode(e.node)})),n.forEach((e=>project.removeConnection(e.connection))),project.notifyChange()},disabled:0===o.length&&0===n.length||0!==o.length&&o.every((e=>e.frozen))},{type:\"separator\"},{type:\"button\",icon:\"fit-to-page-outline\",label:i18next.t(\"fitViewToSelectedNodes\",\"Fit view to selected nodes\"),action:()=>e.fitCamera(o.map((e=>e.node))),disabled:0===o.length},{type:\"button\",icon:\"snowflake\",label:\"TOGGLE FROZEN [DEBUG FUNCTION]\",action:()=>o.forEach((e=>e.frozen=!e.frozen)),disabled:0===o.length},{type:\"separator\"},{type:\"button\",icon:\"export\",label:\"Export to JSON\",action:()=>{modal.anything(\"Export result\",html`\n                <div style=\"user-select: all;font-family: monospace; padding: 5px; overflow: auto; background: whitesmoke; max-width:50vw; max-height:50vh\">\n                ${exporter.flowToJson(project.toNodeCollection(\"Exported on \"+new Date,\"\"))}\n                </div>\n                `)}}]),i};","var __decorate=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},__awaiter=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))((function(n,r){function s(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};import{LitElement,html}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{repeat}from\"lit/directives/repeat.js\";import{IdentityDomLink}from\"../node-structure\";import{List}from\"linqts\";import{EditorWorkspaceStyle}from\"../styles/editor-workspace-style\";import{i18next,translate}from\"@openremote/or-translate\";import{ContextMenu}from\"./context-menu\";import{project,input,copyPasteManager}from\"./flow-editor\";import{createContextMenuButtons}from\"./workspace-contextmenu-options\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";let EditorWorkspace=class extends(translate(i18next)(LitElement)){get clientRect(){return this.cachedClientRect}static get styles(){return EditorWorkspaceStyle}get halfSize(){const t=this.cachedClientRect;return{x:t.width/2,y:t.height/2}}get isCameraInDefaultPosition(){return Math.abs(this.camera.x)<.05&&Math.abs(this.camera.y)<.05&&this.camera.zoom>.95&&this.camera.zoom<1.05}constructor(){super(),this.camera={x:0,y:0,zoom:1},this.topNodeZindex=1,this.scrollSensitivity=1.25,this.zoomLowerBound=.2,this.zoomUpperBound=10,this.connectionDragging=!1,this.connectionFrom={x:0,y:0},this.connectionTo={x:0,y:0},this.isPanning=!1,this.onMove=t=>{const e=window.devicePixelRatio;this.camera={x:this.camera.x+t.movementX/this.camera.zoom/e,y:this.camera.y+t.movementY/this.camera.zoom/e,zoom:this.camera.zoom},this.dispatchEvent(new CustomEvent(\"pan\"))},this.onZoom=t=>{if(this.connectionDragging)return;if(this.isPanning)return;const e=.9*this.scrollSensitivity,o=t.deltaY<0?this.camera.zoom*e:this.camera.zoom/e;o<this.zoomLowerBound||o>this.zoomUpperBound||(this.camera={x:this.camera.x,y:this.camera.y,zoom:o},this.dispatchEvent(new CustomEvent(\"zoom\")))},this.onEmptyConnectionRelease=t=>{project.isCurrentlyConnecting&&project.endConnectionDrag(t,null,!1)},this.stopPan=()=>{this.isPanning&&(window.removeEventListener(\"mousemove\",this.onMove),this.isPanning=!1)},project.addListener(\"nodeadded\",(t=>{this.requestUpdate()})),project.addListener(\"noderemoved\",(t=>{this.requestUpdate()})),project.addListener(\"cleared\",(()=>{this.requestUpdate()})),project.addListener(\"connectionstart\",((t,e)=>{if(1!==t.buttons)return;const o=IdentityDomLink.map[e.id].connectionPosition;this.connectionFrom=this.pageToOffset(o),this.addEventListener(\"mousemove\",project.connectionDragging),this.addEventListener(\"mouseup\",this.onEmptyConnectionRelease)})),project.addListener(\"connecting\",(t=>{this.connectionTo={x:t.pageX-this.clientRect.left,y:t.pageY-this.clientRect.top},this.connectionDragging=!0})),project.addListener(\"connectionend\",(()=>{this.connectionDragging=!1,this.removeEventListener(\"mousemove\",project.connectionDragging)})),project.addListener(\"fitview\",(()=>{this.fitCamera(project.nodes)})),window.addEventListener(\"resize\",(()=>{this.cachedClientRect=this.getBoundingClientRect(),this.dispatchEvent(new CustomEvent(\"pan\"))})),this.addEventListener(\"mousedown\",(t=>{this.startPan(t),1===t.buttons&&input.clearSelection()})),this.addEventListener(\"contextmenu\",(t=>{const e=createContextMenuButtons(this,t);ContextMenu.open(t.pageX,t.pageY,this,e),t.preventDefault()})),project.workspace=this,this.addEventListener(\"wheel\",this.onZoom,{passive:!0})}resetCamera(){this.camera={x:0,y:0,zoom:1},this.dispatchEvent(new CustomEvent(\"pan\")),this.dispatchEvent(new CustomEvent(\"zoom\"))}fitCamera(t,e=25){const o=new List;if(o.AddRange(t),0==o.Count())return;const i=o.OrderBy((t=>t.position.x)).First(),n=o.OrderBy((t=>t.position.y)).First(),r=o.OrderByDescending((t=>t.position.x+IdentityDomLink.map[t.id].scrollWidth)).First(),s=o.OrderByDescending((t=>t.position.y+IdentityDomLink.map[t.id].scrollHeight)).First(),a=IdentityDomLink.map[r.id].scrollWidth,c=IdentityDomLink.map[s.id].scrollHeight,p=i.position.x-e,d=r.position.x+e+a,h=s.position.y+e+c,m=n.position.y-e,l=d-p,u=h-m,y=this.clientRect,v=(p+d)/2,g=(h+m)/2,w=Math.min(y.width/l,y.height/u);this.camera={x:-v,y:-g,zoom:Math.min(Math.max(this.zoomLowerBound,w),this.zoomUpperBound)},this.dispatchEvent(new CustomEvent(\"pan\")),this.dispatchEvent(new CustomEvent(\"zoom\"))}offsetToWorld(t){const e=this.halfSize;return{x:(t.x-e.x)/this.camera.zoom-this.camera.x,y:(t.y-e.y)/this.camera.zoom-this.camera.y}}worldToOffset(t){const e=this.halfSize;return{x:(t.x+this.camera.x)*this.camera.zoom+e.x,y:(t.y+this.camera.y)*this.camera.zoom+e.y}}pageToOffset(t){const e=this.clientRect;return{x:t.x-e.left,y:t.y-e.top}}pasteAt(t,e){return __awaiter(this,void 0,void 0,(function*(){const o=copyPasteManager.getFromClipboard({x:t,y:e});o.nodes.forEach((t=>{project.addNode(t)})),yield this.updateComplete,o.connections.forEach((t=>{project.createConnection(t.from,t.to)}))}))}firstUpdated(){this.cachedClientRect=this.getBoundingClientRect(),this.application.nodePanel.drawer&&this.application.nodePanel.drawer.addEventListener(\"or-mwc-drawer-changed\",(t=>__awaiter(this,void 0,void 0,(function*(){this.style.width=t.detail?\"calc(100% - 255px)\":\"\",yield this.updateComplete,this.cachedClientRect=this.getBoundingClientRect(),this.dispatchEvent(new CustomEvent(\"pan\"))}))))}render(){return html`\n        ${repeat(project.nodes,(t=>t.id),(t=>html`<flow-node .node=\"${t}\" .workspace=\"${this}\"></flow-node>`))}\n        <connection-container .workspace=\"${this}\"></connection-container>\n        <svg>\n            <line style=\"display: \n            ${this.connectionDragging?null:\"none\"}; \n            stroke-dasharray: ${20*this.camera.zoom}, ${10*this.camera.zoom}; \n            stroke-opacity: 0.25; stroke-width: ${4*this.camera.zoom}px\" \n\n            x1=\"${this.connectionFrom.x}\" \n            y1=\"${this.connectionFrom.y}\" \n            x2=\"${this.connectionTo.x}\" \n            y2=\"${this.connectionTo.y}\"></line>\n        </svg>\n        <selection-box .workspace=\"${this}\"></selection-box>\n        <div class=\"view-options\" style=\"z-index: ${this.topNodeZindex+1}\">\n            ${this.isCameraInDefaultPosition?null:html`<or-mwc-input type=\"${InputType.BUTTON}\" icon=\"vector-square\" @or-mwc-input-changed=\"${this.resetCamera}\" label=\"${i18next.t(\"resetView\",\"Reset view\")}\"></or-mwc-input>`}\n            ${0!==project.nodes.length?html`<or-mwc-input type=\"button\" icon=\"fit-to-page-outline\" @or-mwc-input-changed=\"${()=>this.fitCamera(project.nodes)}\" label=\"${i18next.t(\"fitView\",\"Fit view\")}\"></or-mwc-input>`:null}\n        </div>\n        `}startPan(t){return!this.connectionDragging&&4===t.buttons&&(this.isPanning=!0,window.addEventListener(\"mousemove\",this.onMove),window.addEventListener(\"mouseup\",this.stopPan),void t.preventDefault())}};__decorate([property({attribute:!1})],EditorWorkspace.prototype,\"camera\",void 0),__decorate([property({attribute:!1})],EditorWorkspace.prototype,\"topNodeZindex\",void 0),__decorate([property({attribute:!1})],EditorWorkspace.prototype,\"scrollSensitivity\",void 0),__decorate([property({attribute:!1})],EditorWorkspace.prototype,\"zoomLowerBound\",void 0),__decorate([property({attribute:!1})],EditorWorkspace.prototype,\"zoomUpperBound\",void 0),__decorate([property({attribute:!1})],EditorWorkspace.prototype,\"application\",void 0),__decorate([property({attribute:!1})],EditorWorkspace.prototype,\"connectionDragging\",void 0),__decorate([property({attribute:!1})],EditorWorkspace.prototype,\"connectionFrom\",void 0),__decorate([property({attribute:!1})],EditorWorkspace.prototype,\"connectionTo\",void 0),EditorWorkspace=__decorate([customElement(\"editor-workspace\")],EditorWorkspace);export{EditorWorkspace};","var __decorate=this&&this.__decorate||function(e,t,o,r){var l,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var n=e.length-1;n>=0;n--)(l=e[n])&&(a=(i<3?l(a):i>3?l(t,o,a):l(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};import{LitElement,html,css}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{Utilities}from\"../utils\";import{i18next,translate}from\"@openremote/or-translate\";import{project,modal,exporter}from\"./flow-editor\";let TopBar=class extends(translate(i18next)(LitElement)){static get styles(){return css`\n        :host{\n            display: flex;\n            width: 100%;\n            justify-content: flex-start;\n            align-items: center;\n            box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 5px -5px;\n            line-height: var(--topbar-height);\n            z-index: 150;\n        }\n        .button{\n            padding: 0 25px 0 25px;\n            cursor: pointer;\n        }\n        .button:hover{\n            background: #fafafa;\n        }\n        .button:active{\n            background: whitesmoke;\n        }\n        .debug.button{\n            background: yellow;\n        }\n        .title{\n            margin: 0 15px 0 15px;\n            text-transform: uppercase;\n            font-weight: bold;\n        }\n        .right{ \n            margin-left: auto;\n        }`}firstUpdated(){project.addListener(\"unsavedstateset\",(()=>{this.requestUpdate()}))}render(){return html`\n        <span class=\"title\">${i18next.t(\"flowEditor\")}</span>\n        <a class=\"button\" @click=\"${()=>{project.unsavedState?modal.confirmation((()=>{project.clear(!0)}),\"New project\"):project.clear(!0)}}\">New</a>\n        <a class=\"button\" @click=\"${this.save}\">${i18next.t(\"save\")} <i>${Utilities.ellipsis(project.existingFlowRuleName)}</i>${project.unsavedState&&-1!==project.existingFlowRuleId?\"*\":\"\"}</a>\n        ${-1===project.existingFlowRuleId?null:html`<a @click=\"${this.showSaveAsDialog}\" class=\"button\">Save as...</a>`}\n        <a class=\"button\" @click=\"${this.showRuleBrowser}\">Open</a>\n        <a class=\"button right\" @click=\"${()=>{this.application.nodePanel.drawer.toggle()}}\"><or-icon icon=\"menu\"></or-icon></a>\n        `}save(){-1===project.existingFlowRuleId?this.showSaveAsDialog():exporter.exportAsExisting(project.existingFlowRuleId,project.toNodeCollection(project.existingFlowRuleName,project.existingFlowRuleDesc))}showRuleBrowser(){modal.element.content=html`<rule-browser @ruleloaded=\"${()=>modal.element.close()}\"></rule-browser>`,modal.element.header=\"Select a Flow rule\",modal.element.open()}showSaveAsDialog(){let e=\"\",t=\"\";modal.element.content=html`\n            <div style=\"display: flex; flex-direction: column; width: auto; justify-content: space-between; align-items: stretch;\">\n            <or-mwc-input style=\"margin-bottom: 16px; width:100%;\" required type=\"text\" label=\"${i18next.t(\"name\",\"Name\")}\"\n            @or-mwc-input-changed=\"${t=>{e=t.detail.value}}\"\n            ></or-mwc-input>\n            <or-mwc-input style=\"margin-bottom: 16px; width:100%;\" fullwidth type=\"textarea\" label=\"${i18next.t(\"description\",\"Description\")}\"\n            @or-mwc-input-changed=\"${e=>{t=e.detail.value}}\"\n            ></or-mwc-input>\n            <div>\n                <or-mwc-input style=\"text-align: left; margin-right: 10px\" type=\"${InputType.BUTTON}\" label=\"${i18next.t(\"cancel\",\"Cancel\")}\" @or-mwc-input-changed=\"${modal.element.close}\"></or-mwc-input>\n                <or-mwc-input style=\"text-align: right\" type=\"${InputType.BUTTON}\" unelevated label=\"${i18next.t(\"save\",\"Save\")}\" @or-mwc-input-changed=\"${()=>{e&&(exporter.exportAsNew(project.toNodeCollection(e,t)),modal.element.close())}}\"></or-mwc-input>\n            </div>\n            </div>\n        `,modal.element.header=\"Save project\",modal.element.open()}};__decorate([property({attribute:!1})],TopBar.prototype,\"application\",void 0),TopBar=__decorate([customElement(\"top-bar\")],TopBar);export{TopBar};","var __decorate=this&&this.__decorate||function(e,t,i,o){var s,r=arguments.length,n=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(r<3?s(n):r>3?s(t,i,n):s(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n};import{LitElement,html,css}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{Utilities}from\"../utils\";import{i18next,translate}from\"@openremote/or-translate\";import{newIds,project}from\"./flow-editor\";import{CopyMachine}from\"../node-structure\";let NodeMenuItem=class extends(translate(i18next)(LitElement)){constructor(){super(),this.isDragging=!1,this.x=0,this.y=0,this.xOffset=0,this.yOffset=0,this.startDrag=e=>{this.xOffset=e.offsetX,this.yOffset=e.offsetY,this.x=e.clientX,this.y=e.clientY,this.isDragging=!0,window.addEventListener(\"mouseup\",this.stopDrag),window.addEventListener(\"mousemove\",this.onMove)},this.onMove=e=>{this.x=e.clientX,this.y=e.clientY},this.stopDrag=e=>{if(window.removeEventListener(\"mouseup\",this.stopDrag),window.removeEventListener(\"mousemove\",this.onMove),this.isDragging=!1,Utilities.isPointInsideBox(e.offsetX,e.offsetY,{x:this.workspace.clientRect.left,y:this.workspace.clientRect.top,width:this.workspace.clientRect.width,height:this.workspace.clientRect.height})){const t=CopyMachine.copy(this.node);newIds.add(t.id),t.position=this.workspace.offsetToWorld({x:e.offsetX-this.workspace.clientRect.left,y:e.offsetY-this.workspace.clientRect.top}),project.createUndoSnapshot(),project.addNode(t),project.notifyChange()}},this.addEventListener(\"mousedown\",this.startDrag)}static get styles(){return css`\n        :host, .node-drag-item{\n            padding: 4px;\n            margin: 0 0 15px 0;\n            display: inline-block;\n            text-align: center;\n            color: white;\n            border-radius: var(--roundness);\n            box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 5px -5px;\n\n            width: calc(var(--nodepanel-width) - 4px * 2);\n            height: 22px;\n            line-height: 22px;\n            cursor:grab;\n            transition: box-shadow 150ms;\n        }\n        :host(.small), .small{\n            width: 26px;\n            height: 26px;\n            line-height: 26px;\n            margin: 0;\n        }\n        .node-drag-item{\n            z-index: 5000;\n            position: fixed;\n            background: inherit;\n            box-shadow: rgba(0, 0, 0, 0.2) 0 2px 15px;\n            filter: opacity(90%);\n            pointer-events: none;\n        }\n        `}render(){switch(this.node.type){case\"INPUT\":this.classList.add(\"input-node\");break;case\"PROCESSOR\":this.classList.add(\"processor-node\");break;case\"OUTPUT\":this.classList.add(\"output-node\")}return this.node.displayCharacter&&this.classList.add(\"small\"),this.title=i18next.t(this.node.name,Utilities.humanLike(this.node.name)),html`\n        <div class=\"label\">${this.flowNodeName}</div>\n        ${this.isDragging?this.dragNodeTemplate:null}\n        `}get dragNodeTemplate(){return html`<div class=\"node-drag-item ${this.node.displayCharacter?\"small\":null}\" style=\"top: ${this.y-this.yOffset}px; left: ${this.x-this.xOffset}px\"><div class=\"label\">${this.flowNodeName}</div></div>`}get flowNodeName(){return i18next.t(this.node.displayCharacter||this.node.name,this.node.displayCharacter||Utilities.humanLike(this.node.name||\"invalid node name\"))}};__decorate([property({attribute:!1})],NodeMenuItem.prototype,\"node\",void 0),__decorate([property({attribute:!1})],NodeMenuItem.prototype,\"isDragging\",void 0),__decorate([property({attribute:!1})],NodeMenuItem.prototype,\"x\",void 0),__decorate([property({attribute:!1})],NodeMenuItem.prototype,\"y\",void 0),__decorate([property({attribute:!1})],NodeMenuItem.prototype,\"workspace\",void 0),NodeMenuItem=__decorate([customElement(\"node-menu-item\")],NodeMenuItem);export{NodeMenuItem};","var __decorate=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var d=e.length-1;d>=0;d--)(r=e[d])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};import{LitElement,html,css}from\"lit\";import{customElement,property,query}from\"lit/decorators.js\";import{IdentityDomLink}from\"../node-structure\";import{Utilities}from\"../utils\";import{i18next,translate}from\"@openremote/or-translate\";import{project}from\"./flow-editor\";let FlowNodeSocket=class extends(translate(i18next)(LitElement)){constructor(){super(...arguments),this.renderLabel=!1,this.identityDeleted=!1,this.forceUpdate=()=>this.requestUpdate()}get connectionPosition(){return Utilities.getCenter(this.circleElem.getBoundingClientRect())}static get styles(){return css`\n        :host{\n            width: auto;\n            height: var(--socket-size);\n            margin: 2px;\n            display: inline-block;\n        }\n        .socket{\n            background: none;\n            height: var(--socket-size);\n            width: var(--socket-size);\n            border-radius: 100%;\n            display: inline-flex;\n            justify-content: center;\n            align-items: center;\n        }\n        .socket:hover{\n            background: var(--highlight);\n        }\n        .label{\n            display:inline-block;\n            vertical-align: top;\n            color: rgba(0,0,0,.5);\n            text-transform: lowercase;\n        }\n        .circle{\n            box-sizing: border-box;\n            background: grey;\n            width: var(--socket-display-size);\n            height: var(--socket-display-size);\n            border-radius: 100%;\n            pointer-events: none;\n            border: 1px solid rgb(80,80,80);\n        }`}get socketTypeString(){return this.socket.type.toString().toLowerCase()}disconnectedCallback(){this.identityDeleted=delete IdentityDomLink.map[this.socket.id],project.removeListener(\"connectioncreated\",this.forceUpdate),project.removeListener(\"connectionremoved\",this.forceUpdate),project.removeListener(\"nodeadded\",this.forceUpdate),project.removeListener(\"noderemoved\",this.forceUpdate),project.removeListener(\"cleared\",this.forceUpdate),IdentityDomLink.map[this.socket.nodeId].removeEventListener(\"updated\",this.forceUpdate)}firstUpdated(){this.title=Utilities.humanLike(this.socketTypeString),this.linkIdentity(),project.addListener(\"connectioncreated\",this.forceUpdate),project.addListener(\"connectionremoved\",this.forceUpdate),project.addListener(\"nodeadded\",this.forceUpdate),project.addListener(\"noderemoved\",this.forceUpdate),project.addListener(\"cleared\",this.forceUpdate),IdentityDomLink.map[this.socket.nodeId].addEventListener(\"updated\",this.forceUpdate);const e=\"input\"===this.side;this.addEventListener(\"mousedown\",(t=>{this.linkIdentity(),1===t.buttons&&(project.isCurrentlyConnecting||(project.startConnectionDrag(t,this.socket,e),t.stopPropagation(),t.stopImmediatePropagation()))})),this.addEventListener(\"mouseup\",(t=>{project.createUndoSnapshot(),this.linkIdentity(),project.endConnectionDrag(t,this.socket,e),project.notifyChange(),1===t.buttons&&(t.stopPropagation(),t.stopImmediatePropagation())}))}updated(){this.linkIdentity()}render(){const e=`var(--${this.socketTypeString})`,t=html`<div class=\"socket\">\n            <div class=\"circle\" id=\"circle\" style=\"background: ${e}\"></div>\n            </div>`;if(!this.renderLabel)return t;const o=html`<div class=\"label\">${i18next.t(this.socket.name)}</div>`;return\"input\"===this.side?html`${t}${o}`:html`${o}${t}`}linkIdentity(){this.identityDeleted||(IdentityDomLink.map[this.socket.id]=this)}};__decorate([property({type:Object})],FlowNodeSocket.prototype,\"socket\",void 0),__decorate([property({type:String})],FlowNodeSocket.prototype,\"side\",void 0),__decorate([property({type:Boolean})],FlowNodeSocket.prototype,\"renderLabel\",void 0),__decorate([query(\"#circle\")],FlowNodeSocket.prototype,\"circleElem\",void 0),FlowNodeSocket=__decorate([customElement(\"flow-node-socket\")],FlowNodeSocket);export{FlowNodeSocket};","var __decorate=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(s<3?i(r):s>3?i(t,o,r):i(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r};import{html,css}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{IdentityDomLink,IdentityAssigner,NodeUtilities}from\"../node-structure\";import{ResizeObserver}from\"resize-observer\";import{SelectableElement}from\"./selectable-element\";import{project}from\"./flow-editor\";let ConnectionLine=class extends SelectableElement{constructor(){super(),this.fancyLine=!0,this.curveIntensity=1,this.nodeChanged=()=>{this.requestUpdate()},this.polylineId=IdentityAssigner.generateIdentity()}disconnectedCallback(){super.disconnectedCallback(),this.resizeObserver.disconnect(),project.removeListener(\"connectionremoved\",this.nodeChanged)}firstUpdated(){super.firstUpdated();const e=this.shadowRoot.getElementById(this.polylineId);e&&this.setHandle(e)}render(){if(this.isInvalid){const e=NodeUtilities.getSocketFromID(this.connection.from,project.nodes),t=NodeUtilities.getSocketFromID(this.connection.to,project.nodes);if(this.fromNodeElement=IdentityDomLink.map[e.nodeId],this.toNodeElement=IdentityDomLink.map[t.nodeId],this.fromElement=IdentityDomLink.map[e.id],this.toElement=IdentityDomLink.map[t.id],this.isInvalid)return console.warn(this.fromNodeElement),console.warn(this.toNodeElement),console.warn(this.fromElement),console.warn(this.toElement),console.warn(\"Attempt to render invalid connection\"),html``;this.fromNodeElement.addEventListener(\"updated\",this.nodeChanged),this.toNodeElement.addEventListener(\"updated\",this.nodeChanged),this.resizeObserver=new ResizeObserver(this.nodeChanged),this.resizeObserver.observe(this.fromNodeElement),this.resizeObserver.observe(this.toNodeElement)}const e=this.workspace.clientRect,t=this.fromElement.connectionPosition,o=this.toElement.connectionPosition;if(this.fancyLine){const n=t.x-e.left,i=t.y-e.top,s=o.x-e.left,r=o.y-e.top,l=this.curveIntensity*(Math.abs(n-s)/2);return html`<svg style=\"stroke-width: ${this.workspace.camera.zoom*(this.selected?5:3)}px;\">\n                <path id=\"${this.polylineId}\" \n                d=\"M ${n} ${i} C ${n+l} ${i}, ${s-l} ${r}, ${s} ${r}\"\n                selected=\"${this.selected}\"\n                />\n            </svg>`}return html`<svg style=\"stroke-width: ${this.workspace.camera.zoom*(this.selected?5:3)}px;\"><polyline id=\"${this.polylineId}\"\n        selected=\"${this.selected}\"\n        points=\"\n        ${t.x-e.left}, ${t.y-e.top} \n        ${o.x-e.left}, ${o.y-e.top}\"\n        ></polyline>\n        </svg>`}static get styles(){return css`\n            svg{\n                fill: none;  \n                overflow: visible;\n                position: absolute;\n                pointer-events: none;\n                stroke-linejoin: round;\n            }\n            path, line{\n                position: absolute;\n                pointer-events: all;\n            }\n            path:hover, line:hover, path[selected = true], line[selected = true]{\n                stroke: var(--highlight);\n            }\n            text{\n                fill: red;\n                stroke: none;\n            }`}get isInvalid(){return!(this.fromNodeElement&&this.toNodeElement&&this.fromElement&&this.toElement)}};__decorate([property({attribute:!1})],ConnectionLine.prototype,\"connection\",void 0),__decorate([property({attribute:!1})],ConnectionLine.prototype,\"workspace\",void 0),__decorate([property({type:String})],ConnectionLine.prototype,\"polylineId\",void 0),ConnectionLine=__decorate([customElement(\"connection-line\")],ConnectionLine);export{ConnectionLine};","var __decorate=this&&this.__decorate||function(t,e,i,o){var s,n=arguments.length,c=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)c=Reflect.decorate(t,e,i,o);else for(var h=t.length-1;h>=0;h--)(s=t[h])&&(c=(n<3?s(c):n>3?s(e,i,c):s(e,i))||c);return n>3&&c&&Object.defineProperty(e,i,c),c};import{LitElement,html,css}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{Utilities}from\"../utils\";import{input}from\"./flow-editor\";let SelectionBox=class extends LitElement{constructor(){super(...arguments),this.distanceTreshold=20,this.isSelecting=!1,this.selectionStartPosition={x:0,y:0},this.selectionBox={x:0,y:0,width:0,height:0},this.workspaceMouseDown=t=>{1===t.buttons&&(this.selectionBox.x=t.offsetX,this.selectionBox.y=t.offsetY,this.selectionStartPosition.x=this.selectionBox.x,this.selectionStartPosition.y=this.selectionBox.y,window.addEventListener(\"mousemove\",this.mouseMove))},this.mouseMove=t=>{const e=t.pageX-this.workspace.clientRect.left-this.selectionStartPosition.x,i=t.pageY-this.workspace.clientRect.top-this.selectionStartPosition.y;e<0?(this.selectionBox.x=t.pageX-this.workspace.clientRect.left,this.selectionBox.width=Math.abs(this.selectionBox.x-this.selectionStartPosition.x)):(this.selectionBox.x=this.selectionStartPosition.x,this.selectionBox.width=Math.abs(e)),i<0?(this.selectionBox.y=t.pageY-this.workspace.clientRect.top,this.selectionBox.height=Math.abs(this.selectionBox.y-this.selectionStartPosition.y)):(this.selectionBox.y=this.selectionStartPosition.y,this.selectionBox.height=Math.abs(i)),this.selectionBox.width+this.selectionBox.height>this.distanceTreshold&&(this.isSelecting=!0),this.requestUpdate()},this.workspaceMouseUp=()=>{window.removeEventListener(\"mousemove\",this.mouseMove),this.isSelecting&&(this.selectInBounds(),this.isSelecting=!1)}}static get styles(){return css`\n        svg{\n            fill: none;  \n            overflow: visible;\n            position: absolute;\n            pointer-events: all;\n            stroke-linejoin: round;\n            transition: stroke-width 120ms;\n            z-index: 1000;\n            width: 100vw;\n            height: 100vh;\n        }\n        rect{\n            fill: var(--highlight-faded);\n            outline: solid 1px var(--highlight);\n        }`}firstUpdated(){this.workspace.addEventListener(\"mousedown\",this.workspaceMouseDown),window.addEventListener(\"mouseup\",this.workspaceMouseUp)}render(){return this.isSelecting?html`<svg><rect x=\"${this.selectionBox.x}px\" y=\"${this.selectionBox.y}px\" width=\"${this.selectionBox.width}px\" height=\"${this.selectionBox.height}px\"></rect></svg>`:html``}selectInBounds(){input.clearSelection();const t={x:this.selectionBox.x+this.workspace.clientRect.left,y:this.selectionBox.y+this.workspace.clientRect.top,width:this.selectionBox.width,height:this.selectionBox.height};for(const e of input.selectables){const i=e.handle.getBoundingClientRect();Utilities.isBoxInsideBox({x:i.left,y:i.top,width:i.width,height:i.height},t)&&input.select(e,!0)}}};__decorate([property({attribute:!1})],SelectionBox.prototype,\"workspace\",void 0),__decorate([property({attribute:!1})],SelectionBox.prototype,\"isSelecting\",void 0),__decorate([property({attribute:!1})],SelectionBox.prototype,\"selectionStartPosition\",void 0),__decorate([property({attribute:!1})],SelectionBox.prototype,\"selectionBox\",void 0),SelectionBox=__decorate([customElement(\"selection-box\")],SelectionBox);export{SelectionBox};","var __decorate=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o},__awaiter=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{a(s.next(e))}catch(e){n(e)}}function l(e){try{a(s.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,l)}a((s=s.apply(e,t||[])).next())}))};import{LitElement,html,css}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{AssetModelUtil}from\"@openremote/model\";import{nodeConverter}from\"../converters/node-converter\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import rest from\"@openremote/rest\";import\"@openremote/or-asset-tree\";import{ResizeObserver}from\"resize-observer\";import{project}from\"./flow-editor\";import{NodeUtilities}from\"../node-structure\";import{translate,i18next}from\"@openremote/or-translate\";import{PickerStyle}from\"../styles/picker-styles\";import{Util}from\"@openremote/core\";import{OrAttributePicker,OrAttributePickerPickedEvent}from\"@openremote/or-attribute-picker\";import{showDialog}from\"@openremote/or-mwc-components/or-mwc-dialog\";import{getAssetDescriptorIconTemplate}from\"@openremote/or-icon\";let InternalPicker=class extends(translate(i18next)(LitElement)){constructor(){super()}get internal(){return this.node.internals[this.internalIndex]}static get styles(){return[css`\n            :host{\n                padding: 0;\n                margin: 0;\n                display: flex;\n                flex-direction: column;\n                --or-app-color4: var(--or-mwc-input-color);\n            }`,PickerStyle,css`.attribute-label-white {\n                background: #ffffff;\n            }\n            .selected-asset-container {\n                display: flex;\n                align-items: center;\n            }\n            .selected-asset-container:hover {\n                cursor: pointer;\n                background-color: #F9F9F9;\n            }\n            .selected-asset-label {\n                padding: 5px;\n                display: flex;\n                flex-direction: column;\n                line-height: 16px;\n                justify-content: flex-start;\n                font-size: 14px;\n                text-align: left;\n            }\n            .selected-asset-label .asset {\n                color: rgb(76, 76, 76);\n            }\n            .selected-asset-label .asset-attribute {\n                color: grey;\n            }\n            .selected-asset-icon {\n                display: flex;\n                justify-content: center;\n                padding: 0px 5px 0px 5px;\n                --or-icon-width: 20px;\n            }`]}firstUpdated(){this.addEventListener(\"contextmenu\",(e=>e.stopPropagation())),this.addEventListener(\"mousedown\",(e=>(project.createUndoSnapshot(),project.notifyChange()))),this.resizeObserver=new ResizeObserver(((e,t)=>{const r=e[0].contentRect;this.node.size={x:r.width-20,y:r.height-20}})),this.resizeObserver.observe(this)}render(){switch(this.internal.picker.type){case\"ASSET_ATTRIBUTE\":return this.internal.value&&!this.selectedAsset&&this.setSelectedAssetFromInternalValue(),this.assetAttributeInput;case\"COLOR\":return this.colorInput;case\"DOUBLE_DROPDOWN\":return this.doubleDropdownInput;case\"CHECKBOX\":return this.checkBoxInput;case\"DROPDOWN\":return this.dropdownInput;case\"MULTILINE\":return this.multilineInput;case\"NUMBER\":return this.numberInput;case\"TEXT\":return this.textInput;default:return html`unimplemented picker`}}setSocketTypeDynamically(e){return __awaiter(this,void 0,void 0,(function*(){const t=(yield rest.api.AssetResource.queryAssets({ids:[e.assetId],select:{attributes:[e.attributeName]}})).data,r=this.node.outputs[0]||this.node.inputs[0];if(r.type=\"ANY\",null!=t&&null!=t[0]&&null!=t[0].attributes)try{const s=t[0].attributes[e.attributeName],i=AssetModelUtil.getValueDescriptors().find((e=>e.name===s.type));r.type=NodeUtilities.convertValueTypeToSocketType(i)}catch(e){console.error(e)}}))}setSelectedAssetFromInternalValue(){return __awaiter(this,void 0,void 0,(function*(){const e=yield rest.api.AssetResource.queryAssets({ids:[this.internal.value.assetId]});0!==e.data.length?this.selectedAsset=e.data[0]:console.warn(`Asset with id ${this.internal.value.assetId} is missing`)}))}get assetAttributeInput(){var e,t,r,s;const i=()=>{let e=[],t=[],r=this.node.internals[this.internalIndex].value;r&&(e=[{id:r.assetId,name:r.attributeName}]),this.selectedAsset&&this.selectedAsset.id&&(t=[this.selectedAsset.id]),showDialog((new OrAttributePicker).setShowOnlyRuleStateAttrs(!0).setShowOnlyDatapointAttrs(!1).setMultiSelect(!1).setSelectedAttributes(e)).setSelectedAssets(t).addEventListener(OrAttributePickerPickedEvent.NAME,(e=>__awaiter(this,void 0,void 0,(function*(){const t={assetId:e.detail[0].id,attributeName:e.detail[0].name};yield this.setSocketTypeDynamically(t),this.setValue(t),yield this.setSelectedAssetFromInternalValue()}))))};let n=\"?\";if(this.selectedAsset&&this.selectedAsset.attributes&&(null===(t=null===(e=this.internal)||void 0===e?void 0:e.value)||void 0===t?void 0:t.attributeName)){const e=null===(s=null===(r=this.internal)||void 0===r?void 0:r.value)||void 0===s?void 0:s.attributeName,t=AssetModelUtil.getAttributeDescriptor(e,this.selectedAsset.type);let i=this.selectedAsset.attributes[e];i&&(n=Util.getAttributeLabel(i,t,this.selectedAsset.type,!0))}const o=this.selectedAsset?AssetModelUtil.getAssetDescriptor(this.selectedAsset.type):void 0,l=getAssetDescriptorIconTemplate(o);return html`<div>\n            ${this.selectedAsset?html`<div class=\"attribute-label attribute-label-white selected-asset-container\" @click=\"${()=>i()}\">\n                        <div class=\"selected-asset-icon\">${l}</div>\n                        <div class=\"selected-asset-label\">\n                            <div class=\"asset\">${this.selectedAsset.name}</div>\n                            <div class=\"asset-attribute\">${n}</div>\n                        </div>\n                    </div>`:html`<or-mwc-input class=\"attribute-label-white\" .type=\"${InputType.BUTTON}\" label=\"attribute\" icon=\"plus\" @or-mwc-input-changed=\"${()=>i()}\"></or-mwc-input>`}\n        </div>`}get colorInput(){return html`<or-mwc-input type=\"color\"></or-mwc-input>`}get doubleDropdownInput(){return html`unimplemented`}get dropdownInput(){return html`<writable-dropdown @input=\"${e=>this.setValue(e.target.value)}\" .value=\"${this.internal.value}\" .options=\"${this.internal.picker.options}\">\n        </writable-dropdown>`}get checkBoxInput(){return html`<input type=\"checkbox\" ?checked=\"${this.internal.value||!1}\" @input=\"${e=>this.setValue(e.target.checked)}\"/>`}get multilineInput(){const e=this.node.size?`width:${this.node.size.x}px; height:${this.node.size.y}px`:\"\";return html`<textarea @wheel=\"${e=>{if(e.target.clientHeight<e.target.scrollHeight)return e.stopPropagation()}}\" style=\"${e}\" @input=\"${e=>this.setValue(e.target.value)}\" placeholder=\"${this.internal.name}\">${this.internal.value||\"\"}</textarea>`}get numberInput(){return html`<input @wheel=\"${e=>{if(e.target===this.shadowRoot.activeElement)return e.stopPropagation()}}\" @input=\"${e=>this.setValue(parseFloat(e.target.value))}\" value=\"${this.internal.value||0}\" type=\"number\" placeholder=\"${this.internal.name}\"/>`}get textInput(){return html`<input @input=\"${e=>this.setValue(e.target.value)}\" value=\"${this.internal.value||\"\"}\" type=\"text\" placeholder=\"${this.internal.name}\"/>`}setValue(e){this.node.internals[this.internalIndex].value=e,this.onPicked()}onPicked(){return __awaiter(this,void 0,void 0,(function*(){yield this.updateComplete,this.dispatchEvent(new CustomEvent(\"picked\"))}))}};__decorate([property({converter:nodeConverter,reflect:!0})],InternalPicker.prototype,\"node\",void 0),__decorate([property({type:Number,reflect:!0})],InternalPicker.prototype,\"internalIndex\",void 0),__decorate([property({type:Object})],InternalPicker.prototype,\"selectedAsset\",void 0),InternalPicker=__decorate([customElement(\"internal-picker\")],InternalPicker);export{InternalPicker};","var __decorate=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,p=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)p=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(p=(n<3?r(p):n>3?r(e,o,p):r(e,o))||p);return n>3&&p&&Object.defineProperty(e,o,p),p};import{LitElement,css,html}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{modal}from\"./flow-editor\";import{translate,i18next}from\"@openremote/or-translate\";let PopupModal=class extends(translate(i18next)(LitElement)){constructor(){super(),this.closeButton=!0,this.isOpen=!1}close(){this.isOpen=!1}open(){this.isOpen=!0}static get styles(){return css`\n        :host{\n            position: absolute;\n            left: 0;\n            right: 0;\n            top: 0;\n            bottom: 0;\n\n            display: flex;\n            justify-content: center;\n            align-items: center;\n\n            background: rgba(0, 0, 0, 0.2);\n            z-index: 10000;\n\n            --topbar-height: 42px;\n            --closebutton-padding: 12px;\n            --modal-padding: 10px;\n        }\n        :host(:not([isopen])){\n            display: none;\n        }\n        .modal{\n            min-width: 300px;\n            min-height: 64px;\n            width: auto;\n            height: auto;\n            display: inline-block;\n            background: white;\n            border-radius: var(--roundness);\n            position: relative;\n            padding: var(--modal-padding);\n        }\n        .close-button{\n            position: absolute;\n            top: 0;\n            right: 0;\n            width: calc(var(--topbar-height) - var(--closebutton-padding) * 2);\n            height: calc(var(--topbar-height) - var(--closebutton-padding) * 2);\n            padding: var(--closebutton-padding);\n            cursor: pointer;\n        }\n        .title{\n            margin: 0;\n            height: calc(var(--topbar-height) - var(--modal-padding));\n            width: 100%;\n            text-transform: uppercase;\n            font-weight: bold;\n        }`}firstUpdated(){modal.element=this,this.addEventListener(\"mousedown\",this.close),window.addEventListener(\"keyup\",(t=>{\"Escape\"===t.key&&this.close()}))}render(){return this.isOpen?(this.style.display=\"\",html`\n        <div class=\"modal\" @mousedown=\"${t=>{t.stopPropagation()}}\">\n            <div class=\"title\">${this.header}</div>\n            ${this.content}\n            ${this.closeButton?html`<or-icon class=\"close-button\" icon=\"window-close\" @click=\"${this.close}\"></or-icon>`:null}\n        </div>\n        `):(this.style.display=\"none\",html``)}};__decorate([property({type:Boolean})],PopupModal.prototype,\"closeButton\",void 0),__decorate([property({type:String})],PopupModal.prototype,\"header\",void 0),__decorate([property({attribute:!1})],PopupModal.prototype,\"content\",void 0),__decorate([property({type:Boolean,reflect:!0})],PopupModal.prototype,\"isOpen\",void 0),PopupModal=__decorate([customElement(\"popup-modal\")],PopupModal);export{PopupModal};","var __decorate=this&&this.__decorate||function(t,e,o,i){var r,s=arguments.length,n=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(s<3?r(n):s>3?r(e,o,n):r(e,o))||n);return s>3&&n&&Object.defineProperty(e,o,n),n},__awaiter=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))((function(r,s){function n(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(n,a)}l((i=i.apply(t,e||[])).next())}))};import{LitElement,css,html}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import rest from\"@openremote/rest\";import{i18next,translate}from\"@openremote/or-translate\";import{Utilities}from\"../utils\";import{Status}from\"../models/status\";import{exporter,project,modal}from\"./flow-editor\";let RuleBrowser=class extends(translate(i18next)(LitElement)){constructor(){super(...arguments),this.status=Status.Idle,this.retrievedRules=[],this.loadRule=t=>__awaiter(this,void 0,void 0,(function*(){let e;this.status=Status.Loading;try{e=yield rest.api.RulesResource.getGlobalRuleset(t.id)}catch(e){return modal.notification(\"Failure\",\"Something went wrong loading \"+t.name),void(this.status=Status.Failure)}const o=e.data,i=exporter.jsonToFlow(o.rules);project.fromNodeCollection(i),project.setCurrentProject(t.id,t.name,i.description),this.dispatchEvent(new CustomEvent(\"ruleloaded\"))})),this.getButton=t=>html`<div class=\"list-button\" @click=\"${()=>{this.loadRule(t)}}\">${Utilities.ellipsis(t.name,50)} \n        ${t.error?html`<or-icon title=\"${Utilities.humanLike(t.status)}\" icon=\"alert-outline\"></or-icon>`:null}\n        ${t.enabled?null:html`<or-icon title=\"${i18next.t(\"disabled\")}\" icon=\"sleep\"></or-icon>`}\n        </div>`}static get styles(){return css`\n        .list-button {\n            cursor: pointer;\n            padding: 8px 0 8px 8px;\n        }\n        .list-button:hover {\n            background: whitesmoke;\n        }\n        .list-button:active {\n            background: none;\n        }\n        or-icon{\n            width: 18px;\n            vertical-align: text-top;\n        }\n        or-icon[icon=loading]{\n            animation: spin 600ms infinite linear;\n        }\n        @keyframes spin{\n            0%{\n                transform: rotateZ(0deg);\n            }\n            100%{\n                transform: rotateZ(360deg);\n            }\n        }`}firstUpdated(){return __awaiter(this,void 0,void 0,(function*(){this.status=Status.Loading;try{const t=yield rest.api.RulesResource.getGlobalRulesets();this.retrievedRules=t.data,this.status=Status.Success}catch(t){this.status=Status.Failure}}))}render(){let t=html``;switch(this.status){case Status.Loading:t=html`<span style=\"text-align: center;\"><or-icon icon=\"loading\"></or-icon></span>`;break;case Status.Success:t=html`${0===this.retrievedRules.length?html`<span>No rules to display</span>`:this.retrievedRules.map((t=>this.getButton(t)))}`;break;case Status.Failure:t=html`<span>Failed to load rules</span>`}return html`\n        <div style=\"display: flex; flex-direction: column; width: auto; align-items: stretch;\">\n        ${t}\n        </div>`}};__decorate([property({type:Number})],RuleBrowser.prototype,\"status\",void 0),RuleBrowser=__decorate([customElement(\"rule-browser\")],RuleBrowser);export{RuleBrowser};","var __decorate=this&&this.__decorate||function(e,t,o,r){var l,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(l=e[s])&&(n=(i<3?l(n):i>3?l(t,o,n):l(t,o))||n);return i>3&&n&&Object.defineProperty(t,o,n),n};import{LitElement,html}from\"lit\";import{customElement,property,query}from\"lit/decorators.js\";import{PickerStyle}from\"../styles/picker-styles\";let WritableDropdown=class extends LitElement{constructor(){super(...arguments),this.options=[]}static get styles(){return PickerStyle}firstUpdated(){this.options.length>0&&!this.value&&(this.value=this.options[0].value),this.selectElement.value=this.value}shouldUpdate(e){return this.selectElement&&e.has(\"value\")&&(this.selectElement.value=this.value),super.shouldUpdate(e)}render(){return html`\n        <select id=\"select-element\" @change=${e=>this.dispatchEvent(new Event(\"onchange\",e))} @input=${e=>{this.dispatchEvent(new InputEvent(\"oninput\",e)),this.value=this.selectElement.value}}>\n            ${this.options.map((e=>html`<option value=\"${e.value}\">${e.name}</option>`))}\n        </select>\n        `}};__decorate([property({type:Object,reflect:!0})],WritableDropdown.prototype,\"value\",void 0),__decorate([property({type:Array})],WritableDropdown.prototype,\"options\",void 0),__decorate([query(\"#select-element\")],WritableDropdown.prototype,\"selectElement\",void 0),WritableDropdown=__decorate([customElement(\"writable-dropdown\")],WritableDropdown);export{WritableDropdown};","var __decorate=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,a=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(n<3?i(a):n>3?i(e,o,a):i(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a};import{LitElement,html,css}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{i18next,translate}from\"@openremote/or-translate\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";let ConfirmationDialog=class extends(translate(i18next)(LitElement)){constructor(){super(...arguments),this.agreeText=i18next.t(\"ok\"),this.disagreeText=i18next.t(\"cancel\"),this.question=i18next.t(\"areYouSure\",\"Are you sure?\")}static get styles(){return css`\n        .question{\n            width: 100%;\n            padding: 15px 5px 25px 5px;\n            text-align: center;\n        }\n        .container{\n            display: flex;\n            flex-direction: row;\n            justify-content: space-between;\n            justify-content: space-evenly;\n            justify-content: space-around;\n        }`}render(){return html`\n        <div class=\"question\">${this.question}</div>\n        <div class=\"container\">\n            <or-mwc-input type=\"${InputType.BUTTON}\" unElevated label=\"${this.agreeText}\"\n                @or-mwc-input-changed=\"${()=>{this.dispatchEvent(new CustomEvent(\"agreed\"))}}\">\n            </or-mwc-input>\n\n            <or-mwc-input type=\"button\" label=\"${this.disagreeText}\"\n                @or-mwc-input-changed=\"${()=>{this.dispatchEvent(new CustomEvent(\"disagreed\"))}}\">\n            </or-mwc-input>\n        </div>\n        `}};__decorate([property({type:String})],ConfirmationDialog.prototype,\"agreeText\",void 0),__decorate([property({type:String})],ConfirmationDialog.prototype,\"disagreeText\",void 0),__decorate([property({type:String})],ConfirmationDialog.prototype,\"question\",void 0),ConfirmationDialog=__decorate([customElement(\"confirmation-dialog\")],ConfirmationDialog);export{ConfirmationDialog};","var __decorate=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};import{LitElement,html,css}from\"lit\";import{customElement,property}from\"lit/decorators.js\";import{i18next,translate}from\"@openremote/or-translate\";let NotificationDialog=class extends(translate(i18next)(LitElement)){constructor(){super(...arguments),this.buttonText=i18next.t(\"ok\"),this.message=\" \"}static get styles(){return css`\n        .message{\n            width: 100%;\n            padding: 15px 5px 25px 5px;\n            text-align: center;\n            max-width: 50vw;\n            overflow: auto;\n            user-select: text;\n        }\n        .container{\n            display: flex;\n            flex-direction: row;\n            justify-content: space-between;\n            justify-content: space-evenly;\n            justify-content: space-around;\n        }`}render(){return html`\n        <div class=\"message\">${this.message}</div>\n        <div class=\"container\">\n            <or-mwc-input type=\"button\" unElevated label=\"${this.buttonText}\"\n                @click=\"${()=>{this.dispatchEvent(new CustomEvent(\"closed\"))}}\">\n            </or-mwc-input>\n        </div>\n        `}};__decorate([property({type:String})],NotificationDialog.prototype,\"buttonText\",void 0),__decorate([property({type:String})],NotificationDialog.prototype,\"message\",void 0),NotificationDialog=__decorate([customElement(\"notification-dialog\")],NotificationDialog);export{NotificationDialog};","import{html}from\"lit\";import{i18next}from\"@openremote/or-translate\";export class ModalService{confirmation(e,t=i18next.t(\"flowEditor\",\"Flow editor\"),i=i18next.t(\"areYouSure\",\"Are you sure?\")){this.element.content=html`<confirmation-dialog \n        .question = \"${i}\"\n        @agreed=\"${()=>{e&&e(),this.element.close()}}\"\n        @disagreed=\"${this.element.close}\"\n        ></confirmation-dialog>`,this.element.header=t,this.element.open()}notification(e,t,i=i18next.t(\"ok\",\"OK\")){this.element.content=html`<notification-dialog \n        .message = \"${t}\"\n        @closed = \"${this.element.close}\"\n        ></notification-dialog>`,this.element.header=e,this.element.open()}anything(e,t){this.element.content=t,this.element.header=e,this.element.open()}}","var __decorate=this&&this.__decorate||function(e,t,o,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a},__awaiter=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,s){function a(e){try{p(r.next(e))}catch(e){s(e)}}function n(e){try{p(r.throw(e))}catch(e){s(e)}}function p(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,n)}p((r=r.apply(e,t||[])).next())}))};import{LitElement,html,css}from\"lit\";import{customElement,property,query}from\"lit/decorators.js\";import{Integration}from\"../services/integration\";import{CopyPasteManager}from\"../services/copy-paste-manager\";import{Project}from\"../services/project\";import{Input}from\"../services/input\";import{ModalService}from\"../services/modal\";import{Exporter}from\"../services/exporter\";import{Shortcuts}from\"../services/shortcuts\";import{OrRulesRuleChangedEvent}from\"../..\";import{translate,i18next}from\"@openremote/or-translate\";import{NodeUtilities}from\"../node-structure\";export const integration=new Integration;export const copyPasteManager=new CopyPasteManager;export const project=new Project;export const input=new Input;export const modal=new ModalService;export const exporter=new Exporter;export const shortcuts=new Shortcuts;export const newIds=new Set;let FlowEditor=class extends(translate(i18next)(LitElement)){constructor(){super(),this.showTopbar=!1}validate(){return NodeUtilities.validate(exporter.jsonToFlow(this._ruleset.rules||\"{}\"))}beforeSave(){this.readonly||this.serialiseRule()}set ruleset(e){if(this._ruleset!==e)if(this._ruleset=e,e.rules){const t=exporter.jsonToFlow(e.rules);project.fromNodeCollection(t),project.setCurrentProject(e.id,e.name,t.description)}else project.clear(!0)}static get styles(){return[css`\n            :host{\n                user-select: none;\n                display: grid;\n                grid-template-columns: 1fr auto;\n                grid-template-rows: 100%;\n                grid-template-areas: \n                \"workspace node-panel\";\n\n                width: 100%;\n                height: 100%;\n                \n                --or-app-color4: rgb(76,76,76);\n\n                --socket-size: 24px;\n                --socket-display-size: 14px;\n                \n                --topbar-height: 50px;\n                --nodepanel-width: 195px;\n                --roundness: 3px;\n                \n                --highlight-faded: hsla(102, 100%, 31%, 0.2);\n                --highlight: hsla(102, 100%, 31%, 0.5);\n                --highlight-opaque: hsla(102, 100%, 31%);\n                \n                --any: rgb(162, 0, 255);\n                --number: rgb(165, 228, 50);\n                --boolean: rgb(0, 102, 255);\n                --string: rgb(45, 180, 221);\n                --color: rgb(255, 228, 78);\n                \n                --input-color: hsl(222, 60%, 46%);\n                --processor-color: hsl(102, 58%, 39%);\n                --output-color: hsl(282, 60%, 47%);\n                \n                --input-color-h: hsl(222, 58%, 54%);\n                --processor-color-h: hsl(102, 48%, 49%);\n                --output-color-h: hsl(282, 58%, 54%);\n            }`]}firstUpdated(){return __awaiter(this,void 0,void 0,(function*(){yield integration.refreshNodes(),this.requestUpdate(),yield this.updateComplete,project.emit(\"fitview\"),project.addListener(\"changed\",(()=>{this.serialiseRule(),this.dispatchEvent(new OrRulesRuleChangedEvent(this.validate()))}))}))}render(){return this.showTopbar&&(this.style.gridTemplateRows=\"var(--topbar-height) 1fr\",this.style.gridTemplateAreas='\"topbar topbar\" \"workspace node-panel\";'),html`\n        ${this.showTopbar?html`<top-bar .application=\"${this}\" style=\"grid-area: topbar\"></top-bar>`:\"\"}\n        <node-panel .application=\"${this}\" style=\"grid-area: node-panel\" .nodes= \"${integration.nodes}\"></node-panel>\n        <editor-workspace .application=\"${this}\" id=\"workspace\" style=\"grid-area: workspace\"></editor-workspace>\n        <context-menu></context-menu>\n        <popup-modal id=\"popup-modal\"></popup-modal>\n        `}serialiseRule(){this._ruleset.rules=exporter.flowToJson(project.toNodeCollection(this._ruleset.name,project.existingFlowRuleDesc))}};__decorate([query(\"node-panel\")],FlowEditor.prototype,\"nodePanel\",void 0),__decorate([query(\"top-bar\")],FlowEditor.prototype,\"topBar\",void 0),__decorate([query(\"editor-workspace\")],FlowEditor.prototype,\"editorWorkspace\",void 0),__decorate([property({type:Boolean})],FlowEditor.prototype,\"showTopbar\",void 0),__decorate([property({attribute:!1})],FlowEditor.prototype,\"readonly\",void 0),__decorate([property({attribute:!1})],FlowEditor.prototype,\"_ruleset\",void 0),FlowEditor=__decorate([customElement(\"flow-editor\")],FlowEditor);export{FlowEditor};","var __decorate=this&&this.__decorate||function(e,t,r,i){var s,l=arguments.length,a=l<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(l<3?s(a):l>3?s(t,r,a):s(t,r))||a);return l>3&&a&&Object.defineProperty(t,r,a),a},__awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(s,l){function a(e){try{n(i.next(e))}catch(e){l(e)}}function o(e){try{n(i.throw(e))}catch(e){l(e)}}function n(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}n((i=i.apply(e,t||[])).next())}))};import{css,html,LitElement}from\"lit\";import{customElement,property,query}from\"lit/decorators.js\";import{OrRulesRequestSaveEvent,OrRulesRuleChangedEvent,OrRulesRuleUnsupportedEvent,OrRulesSaveEvent,RuleViewInfoMap}from\"./index\";import manager,{Util}from\"@openremote/core\";import\"./json-viewer/or-rule-json-viewer\";import\"./or-rule-text-viewer\";import\"./or-rule-validity\";import\"./flow-viewer/components/flow-editor\";import\"@openremote/or-mwc-components/or-mwc-input\";import{translate}from\"@openremote/or-translate\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import i18next from\"i18next\";import{showErrorDialog}from\"@openremote/or-mwc-components/or-mwc-dialog\";import{project}from\"./flow-viewer/components/flow-editor\";export const style=css`\n\n    :host {\n        display: block;\n        height: 100%;\n        width: 100%;\n        overflow-y: auto;\n    }\n\n    .wrapper {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        height: 100%;\n    }\n\n    #main-wrapper.saving {\n        opacity: 0.5;\n        pointer-events: none;\n    }\n    \n    #rule-name {\n        max-width: 400px;\n        flex: 1 1 0;\n        display: flex;\n    }\n    \n    #rule-header {\n        display: flex;\n        align-items: center;\n        width: 100%;\n        box-sizing: border-box;\n        min-height: var(--internal-or-rules-header-height);\n        height: var(--internal-or-rules-header-height);\n        z-index: 7;\n        padding: 15px 20px;\n        --or-icon-fill: var(--internal-or-rules-panel-color);\n    }\n    \n    #rule-header-controls {\n        margin-left: auto;\n        display: flex;\n        align-items: center;\n    }\n\n    #rule-status {\n        flex: 1;\n        text-align: center;\n    }\n    \n    #rule-id {\n        min-width: 70px;\n        margin-right: 10px;\n    }\n    \n    #rule-header-controls > * {\n        margin: 0 10px;\n    }\n    \n    #active-wrapper {\n        display: flex;\n        align-items: center;\n    }\n    \n    #rule-view {\n        flex-grow: 1;\n        background-color: var(--internal-or-rules-background-color);\n    }\n`;let OrRuleViewer=class extends(translate(i18next)(LitElement)){static get styles(){return[style]}constructor(){super(),this.readonly=!1,this.disabled=!1,this.modified=!1,this._ruleValid=!1,this._supported=!0,this._focusName=!1,this.addEventListener(OrRulesRuleChangedEvent.NAME,this._onRuleChanged),this.addEventListener(OrRulesRuleUnsupportedEvent.NAME,this._onRuleUnsupported)}get valid(){return this.ruleset&&this.view&&this._ruleValid&&this.ruleset.name&&this.ruleset.name.length>=3&&this.ruleset.name.length<255}shouldUpdate(e){return e.has(\"ruleset\")&&(this._supported=!0,this.modified=!1,this._ruleValid=!1,this.ruleset&&(this._focusName=!0,this.modified=!this.ruleset.id)),super.shouldUpdate(e)}render(){if(!this.ruleset)return html`<div class=\"wrapper\" style=\"justify-content: center\"><or-translate value=\"noRuleSelected\"></or-translate></div>`;let e=RuleViewInfoMap[this.ruleset.lang].viewTemplateProvider(this.ruleset,this.config,this.readonly);return html`\n            <div id=\"main-wrapper\" class=\"wrapper\">            \n                <div id=\"rule-header\">\n                    <h3 id=\"rule-id\">${this.ruleset.id?\"ID: \"+this.ruleset.id:\"\"}</h3>\n                    <or-mwc-input id=\"rule-name\" outlined .type=\"${InputType.TEXT}\" .label=\"${i18next.t(\"ruleName\")}\" ?focused=\"${this._focusName}\" .value=\"${this.ruleset?this.ruleset.name:null}\" ?disabled=\"${this._isReadonly()}\" required minlength=\"3\" maxlength=\"255\" @or-mwc-input-changed=\"${e=>this._changeName(e.detail.value)}\"></or-mwc-input>\n                    <or-rule-validity id=\"rule-header-validity\" .ruleset=\"${this.ruleset}\"></or-rule-validity>\n                    ${this.ruleset.status?html`<span id=\"rule-status\" title=\"${this.ruleset.error}\">${i18next.t(\"status\")+\": \"+this.ruleset.status}</span>`:\"\"}\n                    <div id=\"rule-header-controls\">\n                        <span id=\"active-wrapper\">\n                            <or-translate value=\"enabled\"></or-translate>\n                            <or-mwc-input .type=\"${InputType.SWITCH}\" .value=\"${this.ruleset&&this.ruleset.enabled}\" ?disabled=\"${!this.ruleset.id}\" @or-mwc-input-changed=\"${this._toggleEnabled}\"></or-mwc-input>\n                        </span>\n           \n                        <or-mwc-input .type=\"${InputType.BUTTON}\" id=\"save-btn\" label=\"save\" raised ?disabled=\"${this._cannotSave()}\" @or-mwc-input-changed=\"${this._onSaveClicked}\"></or-mwc-input>\n                    </div>                        \n                </div>\n\n                ${e}\n            </div>\n        `}updated(e){e.has(\"ruleset\")&&this.ruleset&&this.view&&(this._ruleValid=this.view.validate())}_isReadonly(){return this.readonly||!manager.hasRole(\"write:rules\")}_cannotSave(){return this._isReadonly()||!this.ruleset||!this.modified||!this.valid}_changeName(e){this.ruleset&&this.ruleset.name!==e&&(this.ruleset.name=e,this.modified=!0,this.requestUpdate())}_onRuleChanged(e){this.modified=!0,this._ruleValid=e.detail}_onSaveClicked(){this.ruleset&&this.view&&(project.emit(\"fitview\"),this.config&&this.config.rulesetSaveHandler&&!this.config.rulesetSaveHandler(this.ruleset)||Util.dispatchCancellableEvent(this,new OrRulesRequestSaveEvent(this.ruleset)).then((e=>{e.allow&&this._doSave()})))}_doSave(){return __awaiter(this,void 0,void 0,(function*(){const e=this.ruleset;if(!e||!this.view)return;let t=!1;const r=!e.id;let i;this.saveBtnElem.disabled=!0,this.wrapperElem.classList.add(\"saving\"),this.view.beforeSave();try{switch(e.type){case\"asset\":i=r?yield manager.rest.api.RulesResource.createAssetRuleset(e):yield manager.rest.api.RulesResource.updateAssetRuleset(e.id,e);break;case\"realm\":i=r?yield manager.rest.api.RulesResource.createRealmRuleset(e):yield manager.rest.api.RulesResource.updateRealmRuleset(e.id,e);break;case\"global\":i=r?yield manager.rest.api.RulesResource.createGlobalRuleset(e):yield manager.rest.api.RulesResource.updateGlobalRuleset(e.id,e)}if(i.status!==(r?200:204))return t=!0,void showErrorDialog(\"Create ruleset returned unexpected status: \"+i.status);i.data&&(e.id=i.data)}catch(e){t=!0,console.error(\"Failed to save ruleset\",e)}this.wrapperElem.classList.remove(\"saving\"),this.saveBtnElem.disabled=!1,t&&showErrorDialog(i18next.t(\"saveRulesetFailed\")),this.dispatchEvent(new OrRulesSaveEvent({ruleset:e,isNew:r,success:!t}))}))}_onRuleUnsupported(){this._supported=!1}_toggleEnabled(){this.ruleset&&(this.ruleset.enabled=!this.ruleset.enabled,this.modified=!0,this.requestUpdate())}};__decorate([property({type:Object})],OrRuleViewer.prototype,\"ruleset\",void 0),__decorate([property({type:Boolean})],OrRuleViewer.prototype,\"readonly\",void 0),__decorate([property({type:Boolean})],OrRuleViewer.prototype,\"disabled\",void 0),__decorate([property({type:Object})],OrRuleViewer.prototype,\"config\",void 0),__decorate([property({attribute:!1})],OrRuleViewer.prototype,\"modified\",void 0),__decorate([property({attribute:!1})],OrRuleViewer.prototype,\"_ruleValid\",void 0),__decorate([property({attribute:!1})],OrRuleViewer.prototype,\"_supported\",void 0),__decorate([query(\"#rule-view\")],OrRuleViewer.prototype,\"view\",void 0),__decorate([query(\"#main-wrapper\")],OrRuleViewer.prototype,\"wrapperElem\",void 0),__decorate([query(\"#save-btn\")],OrRuleViewer.prototype,\"saveBtnElem\",void 0),OrRuleViewer=__decorate([customElement(\"or-rule-viewer\")],OrRuleViewer);export{OrRuleViewer};","var __decorate=this&&this.__decorate||function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},__awaiter=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(o,n){function i(e){try{a(s.next(e))}catch(e){n(e)}}function l(e){try{a(s.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,l)}a((s=s.apply(e,t||[])).next())}))};import{css,html,LitElement,unsafeCSS}from\"lit\";import{customElement,property,query}from\"lit/decorators.js\";import manager,{DefaultBoxShadow,DefaultColor1,DefaultColor2,DefaultColor3,DefaultColor4,DefaultColor5,DefaultColor6,Util}from\"@openremote/core\";import i18next from\"i18next\";import\"@openremote/or-icon\";import{AssetModelUtil}from\"@openremote/model\";import\"@openremote/or-translate\";import\"@openremote/or-mwc-components/or-mwc-drawer\";import{translate}from\"@openremote/or-translate\";import\"./or-rule-list\";import\"./or-rule-viewer\";import\"./flow-viewer/flow-viewer\";import{showOkCancelDialog}from\"@openremote/or-mwc-components/or-mwc-dialog\";export{buttonStyle}from\"./style\";export var TimeTriggerType;!function(e){e.TIME_OF_DAY=\"TIME_OF_DAY\"}(TimeTriggerType||(TimeTriggerType={}));export var AssetQueryOperator;!function(e){e.VALUE_EMPTY=\"empty\",e.VALUE_NOT_EMPTY=\"notEmpty\",e.EQUALS=\"equals\",e.NOT_EQUALS=\"notEquals\",e.GREATER_THAN=\"greaterThan\",e.GREATER_EQUALS=\"greaterEquals\",e.LESS_THAN=\"lessThan\",e.LESS_EQUALS=\"lessEquals\",e.BETWEEN=\"between\",e.NOT_BETWEEN=\"notBetween\",e.CONTAINS=\"contains\",e.NOT_CONTAINS=\"notContains\",e.STARTS_WITH=\"startsWith\",e.NOT_STARTS_WITH=\"notStartsWith\",e.ENDS_WITH=\"endsWith\",e.NOT_ENDS_WITH=\"notEndsWith\",e.CONTAINS_KEY=\"containsKey\",e.NOT_CONTAINS_KEY=\"notContainsKey\",e.INDEX_CONTAINS=\"indexContains\",e.NOT_INDEX_CONTAINS=\"notIndexContains\",e.LENGTH_EQUALS=\"lengthEquals\",e.NOT_LENGTH_EQUALS=\"notLengthEquals\",e.LENGTH_GREATER_THAN=\"lengthGreaterThan\",e.LENGTH_LESS_THAN=\"lengthLessThan\",e.IS_TRUE=\"true\",e.IS_FALSE=\"false\",e.WITHIN_RADIUS=\"withinRadius\",e.OUTSIDE_RADIUS=\"outsideRadius\",e.WITHIN_RECTANGLE=\"withinRectangle\",e.OUTSIDE_RECTANGLE=\"outsideRectangle\"}(AssetQueryOperator||(AssetQueryOperator={}));export const RuleViewInfoMap={JSON:{viewTemplateProvider:(e,t,r)=>html`<or-rule-json-viewer id=\"rule-view\" .ruleset=\"${e}\" .config=\"${t}\" .readonly=\"${r}\"></or-rule-json-viewer>`},FLOW:{viewTemplateProvider:(e,t,r)=>html`<flow-editor id=\"rule-view\" .ruleset=\"${e}\" .readonly=\"${r}\"></flow-editor>`},GROOVY:{viewTemplateProvider:(e,t,r)=>html`\n            <or-rule-text-viewer id=\"rule-view\" .ruleset=\"${e}\" .config=\"${t}\" .readonly=\"${r}\"></or-rule-text-viewer>\n        `,viewRulesetTemplate:'package demo.rules\\n\\nimport org.openremote.manager.rules.RulesBuilder\\nimport org.openremote.model.notification.*\\nimport org.openremote.model.attribute.AttributeInfo\\nimport org.openremote.model.asset.Asset\\nimport org.openremote.model.asset.impl.*\\nimport org.openremote.model.query.*\\nimport org.openremote.model.query.filter.*\\nimport org.openremote.model.rules.Assets\\nimport org.openremote.model.rules.Notifications\\nimport org.openremote.model.rules.Users\\n\\nimport java.util.logging.Logger\\nimport java.util.stream.Collectors\\n\\nLogger LOG = binding.LOG\\nRulesBuilder rules = binding.rules\\nNotifications notifications = binding.notifications\\nUsers users = binding.users\\nAssets assets = binding.assets\\n\\n/*\\n* A groovy rule is made up of a when closure (LHS) which must return a boolean indicating whether the then closure (RHS)\\n* should be executed. The rule engine will periodically evaluate the when closure and if it evaluates to true then the\\n* rule then closure will execute.\\n*\\n* NOTE: DO NOT MODIFY THE FACTS IN THE WHEN CLOSURE THIS SHOULD BE DONE IN THE THEN CLOSURE\\n*\\n* To avoid an infinite rule loop the when closure should not continually return true for subsequent executions\\n* so either the then closure should perform an action that prevents the when closure from matching on subsequent\\n* evaluations, or custom facts should be used, some ideas:\\n*\\n* - Change the value of an attribute being matched in the when closure (which will prevent it matching on subsequent evaluations)\\n* - Insert a custom fact on first match and test this fact in the when closure to determine when the rule should match again (for\\n*   example if a rule should match whenever the asset state changes the asset state timestamp can be used)\\n*/\\n\\nrules.add()\\n        .name(\"Example rule\")\\n        .when({\\n    facts ->\\n\\n        // Find first matching asset state using an asset query\\n\\n        facts.matchFirstAssetState(\\n\\n                // Find asset state by asset type and attribute name\\n                new AssetQuery().types(ThingAsset).attributeNames(\"someAttribute\")\\n\\n                // Find asset state by asset ID and attribute name\\n                //new AssetQuery().ids(\"7CaBoyiDhtdf2kn1Xso1w5\").attributeNames(\"someAttribute\")\\n\\n                // Find asset state by asset type, attribute name and value string predicate\\n                //new AssetQuery().types(ThingAsset).attributes(\\n                //        new AttributePredicate()\\n                //                .name(\"someAttribute\")\\n                //                .value(new StringPredicate()\\n                //                            .value(\"someValue\")\\n                //                            .match(AssetQuery.Match.EXACT)\\n                //                            .caseSensitive(true)))\\n\\n                // Find asset state by asset type and location attribute predicate\\n                //new AssetQuery().types(ThingAsset).attributes(\\n                //        new AttributePredicate()\\n                //                .name(Asset.LOCATION)\\n                //                .value(new RadialGeofencePredicate()\\n                //                            .radius(100)\\n                //                            .lat(50.0)\\n                //                            .lng(0.0)))\\n\\n        ).map { assetState ->\\n\\n            // Use logging to help with debugging if needed            //LOG.info(\"ATTRIBUTE FOUND\")\\n\\n            // Check if this rule really should fire this time\\n            Optional<Long> lastFireTimestamp = facts.getOptional(\"someAttribute\")\\n            if (lastFireTimestamp.isPresent() && assetState.getTimestamp() <= lastFireTimestamp.get()) {\\n                return false\\n            }\\n\\n            // OK to fire if we reach here\\n\\n            // Compute and bind any facts required for the then closure\\n            facts.bind(\"assetState\", assetState)\\n            true\\n        }.orElseGet {\\n            // Asset state didn\\'t match so clear out any custom facts to allow the rule to fire next time the when closure matches\\n            facts.remove(\"someAttribute\")\\n            false\\n        }\\n\\n})\\n        .then({\\n    facts ->\\n\\n        // Extract any binded facts\\n        AttributeInfo assetState = facts.bound(\"assetState\")\\n\\n        // Insert the custom fact to prevent rule loop\\n        facts.put(\"someAttribute\", assetState.getTimestamp())\\n\\n        // Write to attributes\\n        def otherAttributeValue = null\\n        if (assetState.getValue().orElse{null} == \"Value 1\") {\\n            otherAttributeValue = \"Converted Value 1\"\\n        } else if (assetState.getValue().orElse{null} == \"Value 2\") {\\n            otherAttributeValue = \"Converted Value 2\"\\n        } else {\\n            otherAttributeValue = \"Unknown\"\\n        }\\n        assets.dispatch(assetState.id, \"otherAttribute\", otherAttributeValue)\\n\\n        // Generate notifications (useful for rules that check if an attribute is out of range)\\n        //notifications.send(new Notification()\\n        //        .setName(\"Attribute alert\")\\n        //        .setMessage(new EmailNotificationMessage()\\n        //                .setTo(\"no-reply@openremote.io\")\\n        //                .setSubject(\"Attribute out of range: Attribute=${assetState.name} Asset ID=${assetState.id}\")\\n        //                .setText(\"Some text body\")\\n        //                .setHtml(\"<p>Or some HTML body</p>\")\\n        //        )\\n        //)\\n})'},JAVASCRIPT:{viewTemplateProvider:(e,t,r)=>html`\n            <or-rule-text-viewer id=\"rule-view\" .ruleset=\"${e}\" .config=\"${t}\" .readonly=\"${r}\"></or-rule-text-viewer>\n        `,viewRulesetTemplate:'rules = [ // An array of rules, add more objects to add more rules\\n    {\\n        name: \"Set bar to foo on someAttribute\",\\n        description: \"An example rule that sets \\'bar\\' on someAttribute when it is \\'foo\\'\",\\n        when: function(facts) {\\n            return facts.matchAssetState(\\n                new AssetQuery().types(AssetType.THING).attributeValue(\"someAttribute\", \"foo\")\\n            ).map(function(thing) {\\n                facts.bind(\"assetId\", thing.id);\\n                return true;\\n            }).orElse(false);\\n        },\\n        then: function(facts) {\\n            facts.updateAssetState(\\n                facts.bound(\"assetId\"), \"someAttribute\", \"bar\"\\n            );\\n        }\\n    }\\n]'}};function getAssetDescriptorFromSection(e,t,r){if(!t||!t.descriptors)return;const s=r?t.descriptors.action:t.descriptors.when,o=t.descriptors.all;return(s&&s.assets?s.assets[e]?s.assets[e]:s.assets[\"*\"]:void 0)||(o&&o.assets?o.assets[e]?o.assets[e]:o.assets[\"*\"]:void 0)}export function getAssetTypeFromQuery(e){return e&&e.types&&e.types.length>0&&e.types[0]?e.types[0]:void 0}export function getAssetIdsFromQuery(e){return e&&e.ids?[...e.ids]:void 0}export const getAssetTypes=()=>__awaiter(void 0,void 0,void 0,(function*(){return AssetModelUtil.getAssetTypeInfos().map((e=>e.assetDescriptor.name))}));export function getAssetInfos(e,t){const r=AssetModelUtil.getAssetDescriptors();return getAssetTypes().then((s=>{let o=s||[],n=[];if(!e||!e.descriptors)return r.map((e=>AssetModelUtil.getAssetTypeInfo(e)));const i=t?e.descriptors.action:e.descriptors.when;return(i&&i.includeAssets||e.descriptors.all&&e.descriptors.all.includeAssets)&&(o=[],i&&i.includeAssets&&(o=[...i.includeAssets]),e.descriptors.all&&e.descriptors.all.includeAssets&&(o=[...e.descriptors.all.includeAssets])),i&&i.excludeAssets&&(n=[...i.excludeAssets]),e.descriptors.all&&e.descriptors.all.excludeAssets&&(n=n.concat(e.descriptors.all.excludeAssets)),r.filter((e=>!(o.length>0&&o.indexOf(e.name)<0)&&n.indexOf(e.name)<0)).map((r=>{let s=AssetModelUtil.getAssetTypeInfo(r);const o=getAssetDescriptorFromSection(r.name,e,t);if(!o)return s;const n={assetDescriptor:s.assetDescriptor?Object.assign({},s.assetDescriptor):{descriptorType:\"asset\"},attributeDescriptors:s.attributeDescriptors?[...s.attributeDescriptors]:[],metaItemDescriptors:s.metaItemDescriptors?[...s.metaItemDescriptors]:[],valueDescriptors:s.valueDescriptors?[...s.valueDescriptors]:[]};if(o.icon&&(n.assetDescriptor.icon=o.icon),o.color&&(n.assetDescriptor.colour=o.color),n.attributeDescriptors){const t=void 0!==o.includeAttributes?o.includeAttributes:void 0,r=void 0!==o.excludeAttributes?o.excludeAttributes:void 0;(t||r)&&(n.attributeDescriptors=n.attributeDescriptors.filter((e=>(!t||t.some((t=>Util.stringMatch(t,e.name))))&&(!r||!r.some((t=>Util.stringMatch(t,e.name))))))),o.attributeDescriptors&&n.attributeDescriptors.map((t=>{let r=o.attributeDescriptors[t.name];r||(r=i&&i.attributeDescriptors?i.attributeDescriptors[t.name]:void 0),r||(r=e.descriptors.all&&e.descriptors.all.attributeDescriptors?e.descriptors.all.attributeDescriptors[t.name]:void 0),r&&(r.type&&(t.type=r.type),r.format&&(t.format=r.format),r.units&&(t.units=r.units),r.constraints&&(t.constraints=t.constraints?[...r.constraints,...t.constraints]:r.constraints))}))}return n}))}))}export function getAssetsByType(e,t,r){return __awaiter(this,void 0,void 0,(function*(){if(null==r?void 0:r.has(e))return{assets:null==r?void 0:r.get(e),loadedAssets:r};{r||(r=new Map);const s={types:[e],orderBy:{property:\"NAME\"}};null!=t&&(s.realm={name:t});const o=yield manager.rest.api.AssetResource.queryAssets(s);return r.set(e,o.data),{assets:o.data,loadedAssets:r}}}))}export class OrRulesRuleChangedEvent extends CustomEvent{constructor(e){super(OrRulesRuleChangedEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}OrRulesRuleChangedEvent.NAME=\"or-rules-rule-changed\";export class OrRulesRuleUnsupportedEvent extends CustomEvent{constructor(){super(OrRulesRuleUnsupportedEvent.NAME,{bubbles:!0,composed:!0})}}OrRulesRuleUnsupportedEvent.NAME=\"or-rules-rule-unsupported\";export class OrRulesRequestSelectionEvent extends CustomEvent{constructor(e){super(OrRulesRequestSelectionEvent.NAME,{bubbles:!0,composed:!0,detail:{detail:e,allow:!0}})}}OrRulesRequestSelectionEvent.NAME=\"or-rules-request-selection\";export class OrRulesSelectionEvent extends CustomEvent{constructor(e){super(OrRulesSelectionEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}OrRulesSelectionEvent.NAME=\"or-rules-selection\";export class OrRulesRequestAddEvent extends CustomEvent{constructor(e){super(OrRulesRequestAddEvent.NAME,{bubbles:!0,composed:!0,detail:{detail:e,allow:!0}})}}OrRulesRequestAddEvent.NAME=\"or-rules-request-add\";export class OrRulesAddEvent extends CustomEvent{constructor(e){super(OrRulesAddEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}OrRulesAddEvent.NAME=\"or-rules-add\";export class OrRulesRequestDeleteEvent extends CustomEvent{constructor(e){super(OrRulesRequestDeleteEvent.NAME,{bubbles:!0,composed:!0,detail:{detail:e,allow:!0}})}}OrRulesRequestDeleteEvent.NAME=\"or-rules-request-delete\";export class OrRulesRequestSaveEvent extends CustomEvent{constructor(e){super(OrRulesRequestSaveEvent.NAME,{bubbles:!0,composed:!0,detail:{allow:!0,detail:e}})}}OrRulesRequestSaveEvent.NAME=\"or-rules-request-save\";export class OrRulesSaveEvent extends CustomEvent{constructor(e){super(OrRulesSaveEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}OrRulesSaveEvent.NAME=\"or-rules-save\";export class OrRulesDeleteEvent extends CustomEvent{constructor(e){super(OrRulesDeleteEvent.NAME,{bubbles:!0,composed:!0,detail:e})}}OrRulesDeleteEvent.NAME=\"or-rules-delete\";export const style=css`\n\n    :host {\n        display: flex;\n        height: 100%;\n        width: 100%;\n        \n        --internal-or-rules-background-color: var(--or-rules-background-color, var(--or-app-color2, ${unsafeCSS(DefaultColor2)}));\n        --internal-or-rules-text-color: var(--or-rules-text-color, inherit);\n        --internal-or-rules-button-color: var(--or-rules-button-color, var(--or-app-color4, ${unsafeCSS(DefaultColor4)}));\n        --internal-or-rules-invalid-color: var(--or-rules-invalid-color, var(--or-app-color6, ${unsafeCSS(DefaultColor6)}));        \n        --internal-or-rules-panel-color: var(--or-rules-panel-color, var(--or-app-color1, ${unsafeCSS(DefaultColor1)}));\n        --internal-or-rules-line-color: var(--or-rules-line-color, var(--or-app-color5, ${unsafeCSS(DefaultColor5)}));\n        \n        --internal-or-rules-list-selected-color: var(--or-rules-list-selected-color, var(--or-app-color2, ${unsafeCSS(DefaultColor2)}));\n        --internal-or-rules-list-text-color: var(--or-rules-list-text-color, var(--or-app-color3, ${unsafeCSS(DefaultColor3)}));\n        --internal-or-rules-list-text-size: var(--or-rules-list-text-size, 15px);\n        --internal-or-rules-list-header-height: var(--or-rules-list-header-height, 48px);\n\n        --internal-or-rules-list-icon-color-error: var(--or-rules-list-icon-color-error, var(--or-app-color6, ${unsafeCSS(DefaultColor6)}));\n        --internal-or-rules-list-icon-color-ok: var(--or-rules-list-icon-color-ok, var(--or-app-color5, ${unsafeCSS(DefaultColor5)}));\n\n        --internal-or-rules-list-button-size: var(--or-rules-list-button-size, 24px);\n        \n        --internal-or-rules-header-background-color: var(--or-rules-header-background-color, var(--or-app-color3, ${unsafeCSS(DefaultColor3)}));\n        --internal-or-rules-header-height: var(--or-rules-header-height, unset);\n        \n        --or-panel-background-color: var(--internal-or-rules-panel-color);\n    }\n\n    or-rule-list {\n        min-width: 300px;\n        width: 300px;\n        z-index: 2;\n        display: flex;\n        flex-direction: column;\n        background-color: var(--internal-or-rules-panel-color);\n        color: var(--internal-or-rules-list-text-color);\n        box-shadow: ${unsafeCSS(DefaultBoxShadow)};\n    }\n    \n    or-rule-viewer {\n        z-index: 1;    \n    }\n`;let OrRules=class extends(translate(i18next)(LitElement)){static get styles(){return[style]}constructor(){super(),this.addEventListener(OrRulesRequestSelectionEvent.NAME,this._onRuleSelectionRequested),this.addEventListener(OrRulesSelectionEvent.NAME,this._onRuleSelectionChanged),this.addEventListener(OrRulesAddEvent.NAME,this._onRuleAdd),this.addEventListener(OrRulesSaveEvent.NAME,this._onRuleSave)}render(){return html`\n            <or-rule-list id=\"rule-list\" .config=\"${this.config}\" .language=\"${this.language}\" .selectedIds=\"${this.selectedIds}\"></or-rule-list>\n            <or-rule-viewer id=\"rule-viewer\" .config=\"${this.config}\" .readonly=\"${this.isReadonly()}\"></or-rule-viewer>\n        `}refresh(){this._viewer.ruleset=void 0,this._rulesList.refresh()}isReadonly(){return this.readonly||!manager.hasRole(\"write:rules\")}_confirmContinue(e){this._viewer.modified?showOkCancelDialog(i18next.t(\"loseChanges\"),i18next.t(\"confirmContinueRulesetModified\"),i18next.t(\"discard\")).then((t=>{t&&e()})):e()}_onRuleSelectionRequested(e){this._viewer.modified&&(e.detail.allow=!1,this._confirmContinue((()=>{const t=e.detail.detail.newNodes;Util.objectsEqual(t,e.detail.detail.oldNodes)?this._viewer.ruleset=Object.assign({},t[0].ruleset):(this.selectedIds=t.map((e=>e.ruleset.id)),this._viewer.ruleset=1===t.length?t[0].ruleset:void 0)})))}_onRuleSelectionChanged(e){const t=e.detail.newNodes;this.selectedIds=t.map((e=>e.ruleset.id)),this._viewer.ruleset=1===t.length?Object.assign({},t[0].ruleset):void 0}_onRuleAdd(e){this._viewer.ruleset=e.detail.ruleset}_onRuleSave(e){return __awaiter(this,void 0,void 0,(function*(){yield this._rulesList.refresh(),e.detail.success&&e.detail.isNew&&(this.selectedIds=[e.detail.ruleset.id])}))}};OrRules.DEFAULT_RULESET_NAME=\"\",__decorate([property({type:Boolean})],OrRules.prototype,\"readonly\",void 0),__decorate([property({type:Object})],OrRules.prototype,\"config\",void 0),__decorate([property({type:String})],OrRules.prototype,\"realm\",void 0),__decorate([property({type:String})],OrRules.prototype,\"language\",void 0),__decorate([property({type:Array})],OrRules.prototype,\"selectedIds\",void 0),__decorate([property({attribute:!1})],OrRules.prototype,\"_isValidRule\",void 0),__decorate([query(\"#rule-list\")],OrRules.prototype,\"_rulesList\",void 0),__decorate([query(\"#rule-viewer\")],OrRules.prototype,\"_viewer\",void 0),OrRules=__decorate([customElement(\"or-rules\")],OrRules);export{OrRules};",null,null,null,null,"var __decorate=this&&this.__decorate||function(e,r,o,t){var a,i=arguments.length,n=i<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,o):t;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)n=Reflect.decorate(e,r,o,t);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(n=(i<3?a(n):i>3?a(r,o,n):a(r,o))||n);return i>3&&n&&Object.defineProperty(r,o,n),n};import{css,html,LitElement,unsafeCSS}from\"lit\";import{customElement,property,query,state}from\"lit/decorators.js\";import manager,{DefaultBoxShadowBottom,DefaultColor1,DefaultColor2,DefaultColor3,DefaultColor4,DefaultColor5,DefaultHeaderHeight,Util,DEFAULT_LANGUAGES}from\"@openremote/core\";import\"@openremote/or-mwc-components/or-mwc-dialog\";import\"@openremote/or-icon\";import{getContentWithMenuTemplate}from\"@openremote/or-mwc-components/or-mwc-menu\";import{router,updateRealm}from\"./index\";export{DEFAULT_LANGUAGES};function getHeaderMenuItems(e){return e.filter(hasRequiredRole).map((e=>({text:e.text,value:e.value?e.value:\"\",icon:e.icon,href:e.href})))}function hasRequiredRole(e){return!e.roles||(Array.isArray(e.roles)?e.roles.some((e=>manager.hasRole(e))):Util.isFunction(e.roles)?e.roles():Object.entries(e.roles).some((([e,r])=>r.some((r=>manager.hasRole(r,e))))))}function getCurrentMenuItemRef(e){return window.location.hash.substr(2).split(\"/\")[0]||e}let OrHeader=class extends LitElement{constructor(){super(...arguments),this._drawerOpened=!1}static get styles(){return css`\n        \n            :host {\n                --internal-or-header-color: var(--or-header-color, var(--or-app-color1, ${unsafeCSS(DefaultColor1)}));    \n                --internal-or-header-selected-color: var(--or-header-selected-color, var(--or-app-color4, ${unsafeCSS(DefaultColor4)}));    \n                --internal-or-header-text-color: var(--or-header-text-color, var(--or-app-color3, inherit));\n                --internal-or-header-height: var(--or-header-height, ${unsafeCSS(DefaultHeaderHeight)});\n                --internal-or-header-logo-margin: var(--or-header-logo-margin, 0 40px 0 0);\n                --internal-or-header-logo-height: var(--or-header-logo-height, var(--internal-or-header-height, ${unsafeCSS(DefaultHeaderHeight)}));\n                --internal-or-header-item-size: var(--or-header-item-size, calc(${unsafeCSS(DefaultHeaderHeight)} - 20px));\n                --internal-or-header-drawer-color: var(--or-header-drawer-color, var(--or-app-color2, ${unsafeCSS(DefaultColor2)}));\n                --internal-or-header-drawer-text-color: var(--or-header-drawer-text-color, var(--or-app-color3, ${unsafeCSS(DefaultColor3)}));\n                --internal-or-header-drawer-item-size: var(--or-header-drawer-item-size, 30px);\n                --internal-or-header-drawer-separator-color: var(--or-header-drawer-separator-color, var(--or-app-color5, ${unsafeCSS(DefaultColor5)}));\n                \n                display: block;\n                z-index: 4;\n            }\n              \n            #toolbar-top {\n                display: flex;\n                padding: 0;\n            }\n            \n            #logo-mobile {\n                margin: 8px;\n                height: calc(var(--internal-or-header-logo-height) - 16px);\n                display: block;\n            }\n    \n            #logo {\n                display: none;\n            }\n                                            \n            #header {\n                opacity: 1;\n                width: 100%;\n                height: var(--internal-or-header-height);\n                text-align: center;\n                background-color: var(--internal-or-header-color);\n                color: var(--internal-or-header-text-color);\n                --or-icon-fill: var(--internal-or-header-text-color);\n                --or-icon-height: calc(var(--internal-or-header-item-size) - 12px);\n                --or-icon-width: calc(var(--internal-or-header-item-size) - 12px);\n                z-index: 9999999;\n            }\n    \n            .shadow {\n                -webkit-box-shadow: ${unsafeCSS(DefaultBoxShadowBottom)};\n                -moz-box-shadow: ${unsafeCSS(DefaultBoxShadowBottom)};\n                box-shadow: ${unsafeCSS(DefaultBoxShadowBottom)};\n            }\n                    \n            #drawer {\n                width: 100%;\n                position: absolute;\n                top: var(--internal-or-header-height);\n                max-height: 0;\n                height: calc(100% - var(--internal-or-header-height));\n                transition: max-height 0.25s ease-out;\n                background: var(--internal-or-header-drawer-color);\n                color: var(--internal-or-header-drawer-text-color);\n                --or-icon-fill: var(--internal-or-header-drawer-text-color);\n                --or-icon-height: calc(var(--internal-or-header-drawer-item-size) - 10px);\n                --or-icon-width: calc(var(--internal-or-header-drawer-item-size) - 10px);\n                overflow: auto;\n            }\n            \n            #drawer[opened] {\n                max-height: 10000px;\n                transition: max-height 0.75s ease-in;\n            }\n                            \n            #drawer > div {\n                box-sizing: border-box;\n                width: 100%;\n                height: 100%;\n                padding: 10px 0px;\n                position: relative;\n            }\n              \n            .menu-btn {\n                background: none;\n                border: none;\n                cursor: pointer;\n                padding: 0 16px;\n                height: 100%;\n            }\n            \n            #menu-btn-mobile {\n                display: flex;\n                margin-left: auto;\n                --or-icon-height: calc(var(--internal-or-header-item-size) - 8px);\n                --or-icon-width: calc(var(--internal-or-header-item-size) - 8px);\n            }\n\n            #menu-btn-mobile #realm-picker > span{\n                max-width: 70px;\n                text-overflow: ellipsis;\n                overflow: hidden;\n                white-space: nowrap;\n            }\n    \n            #menu-btn-desktop {\n                display: none;\n            }\n            \n            #desktop-right {\n                margin-left: auto;\n                padding-right: 10px;\n                display: none;\n            }\n    \n            .mobile-bottom-border {\n                border-top: 1px solid var(--internal-or-header-drawer-separator-color);\n                margin-top: 16px;\n                padding-top: 8px;\n            }\n          \n            .menu-item {\n                opacity: 0.7;\n                cursor: pointer;\n                text-decoration: none !important;         \n                color: inherit;       \n                padding: 0 20px;\n                font-size: 14px;       \n            }        \n            \n            .menu-item:hover,\n            .menu-item[selected] {\n                opacity: 1;\n            }                \n            #desktop-left .menu-item or-icon {\n                margin-right: 10px;\n            }\n            #desktop-left .menu-item  {\n                display: none;\n                line-height: calc(var(--internal-or-header-height) - 4px);\n            }\n            \n            #desktop-right .menu-item  {\n                line-height: var(--internal-or-header-height);\n            }\n            \n            #drawer .menu-item  {\n                display: block;\n                line-height: var(--internal-or-header-drawer-item-size);\n                margin: 6px 0;\n                padding: 8px 16px;\n            }\n            \n            #drawer .menu-item  or-icon {\n                margin: 0 10px;\n            }\n\n            #desktop-left .menu-item[selected] {\n                display: inline-block;\n                line-height: var(--internal-or-header-height);\n            }\n    \n            or-mwc-menu {\n                margin-right: 10px;\n                display: block;\n            }\n            \n            .or-language-container {\n                display: flex;\n                height: 50px;\n                align-items: center;\n            }\n          \n            #realm-picker {\n                position: relative;\n                display: flex;\n                height: 50px;\n                align-items: center;\n                cursor: pointer;\n                margin-left: 10px;\n            }\n            \n            #realm-picker > span {\n                margin-right: 2px;\n            }\n          \n            /* Wide layout: when the viewport width is bigger than 768px, layout\n            changes to a wide layout. */\n            @media (min-width: 768px) {\n                #menu-btn-desktop {\n                    display: block;\n                }          \n    \n                #menu-btn-mobile {\n                    display: none;\n                }\n    \n                #drawer {\n                    display: none;\n                }\n                \n                #desktop-right {\n                    display: flex;\n                }\n                \n                #desktop-left .menu-item {\n                    display: inline-block;\n                }\n                \n                #desktop-left .menu-item or-icon {\n                    display: none;\n                }\n    \n                #desktop-left .menu-item[selected] {                \n                    border-bottom: 4px solid var(--internal-or-header-selected-color);\n                    line-height: calc(var(--internal-or-header-height) - 4px);\n                }\n\n                #logo {\n                    margin: var(--internal-or-header-logo-margin);\n                    height: var(--internal-or-header-logo-height);\n                    display: block;\n                }\n    \n                #logo-mobile {\n                    display: none;\n                }\n                \n                #desktop-left ::slotted(*) {\n                    display: inline-block;\n                }\n    \n                #desktop-left ::slotted(*[selected]) {                \n                    border-bottom: 4px solid var(--internal-or-header-selected-color);\n                    line-height: calc(var(--internal-or-header-height) - 4px);\n                }\n            }\n            \n            @media (min-width: 1024px) {\n               \n    \n                #desktop-left .menu-item or-icon{\n                    display: inline-block;\n                }\n            }\n    `}_onRealmSelect(e){this.store.dispatch(updateRealm(e))}shouldUpdate(e){return e.has(\"config\")&&(this.activeMenu=getCurrentMenuItemRef(this.config&&this.config.mainMenu&&this.config.mainMenu.length>0?this.config.mainMenu[0].href:void 0)),super.shouldUpdate(e)}render(){if(!this.config)return html``;const e=this.config.mainMenu,r=this.config.secondaryMenu;return html`\n           <!-- Header -->\n            <div id=\"header\" class=\"shadow\">\n                <div id=\"toolbar-top\">\n                    <div><img id=\"logo\" src=\"${this.logo}\" /><img id=\"logo-mobile\" src=\"${this.logoMobile}\" /></div>\n\n                    <!-- This gets hidden on a small screen-->\n                    <nav id=\"toolbar-list\">\n                        <div id=\"desktop-left\">\n                            ${e?e.filter(hasRequiredRole).map((e=>html`\n                                    <a class=\"menu-item\" @click=\"${r=>this._onHeaderItemSelect(e)}\" ?selected=\"${this.activeMenu===e.href}\"><or-icon icon=\"${e.icon}\"></or-icon><or-translate value=\"${e.text}\"></or-translate></a>\n                                `)):\"\"}\n                        </div>\n                    </nav>\n                    <div id=\"desktop-right\">\n                        ${this._getRealmMenu((e=>this._onRealmSelect(e)))}\n                        ${r?getContentWithMenuTemplate(html`\n                            <button id=\"menu-btn-desktop\" class=\"menu-btn\" title=\"Menu\"><or-icon icon=\"dots-vertical\"></or-icon></button>\n                        `,getHeaderMenuItems(r),void 0,(e=>this._onSecondaryMenuSelect(e))):\"\"}\n                    </div>\n                    <div id=\"menu-btn-mobile\">\n                        ${this._getRealmMenu((e=>this._onRealmSelect(e)))}\n                        <button id=\"menu-btn\" class=\"menu-btn\" title=\"Menu\" @click=\"${this._toggleDrawer}\"><or-icon icon=\"${this._drawerOpened?\"close\":\"menu\"}\"></or-icon></button>\n                    </div>\n                </div>\n            </div>\n            <div id=\"drawer\" ?opened=\"${this._drawerOpened}\" @click=\"${this._closeDrawer}\">\n                <div>                    \n                    <div id=\"mobile-top\">\n                        <nav id=\"drawer-list\">\n                            ${e?e.filter((e=>!e.hideMobile&&hasRequiredRole(e))).map((e=>html`\n                                    <a class=\"menu-item\" @click=\"${r=>this._onHeaderItemSelect(e)}\" ?selected=\"${this.activeMenu===e.href}\"><or-icon icon=\"${e.icon}\"></or-icon><or-translate value=\"${e.text}\"></or-translate></a>\n                                `)):\"\"}\n                        </nav>\n                    </div>\n                    \n                    ${r?html`\n                        <div id=\"mobile-bottom\" class=\"${e.length>0?\"mobile-bottom-border\":\"\"}\">\n                            ${r.filter((e=>!e.hideMobile&&hasRequiredRole(e))).map((e=>html`\n                                    <a class=\"menu-item\" @click=\"${r=>this._onHeaderItemSelect(e)}\" ?selected=\"${this.activeMenu===e.href}\"><or-icon icon=\"${e.icon}\"></or-icon><or-translate value=\"${e.text}\"></or-translate></a>\n                                `))}\n                        </div>`:\"\"}\n                </div>\n            </div>\n        `}_getRealmMenu(e){const r=this.realms.find((e=>e.name===this.realm));let o=html`\n            <div id=\"realm-picker\">\n                ${this.realms.length>1?html`\n                    <span>${r?r.displayName:\"\"}</span>\n                    <or-icon icon=\"chevron-down\"></or-icon>\n                `:\"\"}\n            </div>\n        `;if(manager.isSuperUser()){const t=this.realms.map((e=>({text:e.displayName,value:e.name})));o=html`\n                ${getContentWithMenuTemplate(o,t,r?r.name:void 0,(r=>e(r)))}\n            `}return o}_onSecondaryMenuSelect(e){const r=this.config.secondaryMenu.find((r=>r.value===e));r&&this._onHeaderItemSelect(r)}_onHeaderItemSelect(e){e.action?e.action():e.href&&(e.absolute?window.location.href=e.href:router.navigate(e.href))}_closeDrawer(){this._drawerOpened=!1}_toggleDrawer(){this._drawerOpened=!this._drawerOpened}};__decorate([property({type:Array})],OrHeader.prototype,\"realms\",void 0),__decorate([property({type:String})],OrHeader.prototype,\"realm\",void 0),__decorate([property({type:Object})],OrHeader.prototype,\"store\",void 0),__decorate([property({type:String})],OrHeader.prototype,\"logo\",void 0),__decorate([property({type:String})],OrHeader.prototype,\"logoMobile\",void 0),__decorate([property({type:Object})],OrHeader.prototype,\"config\",void 0),__decorate([query(\"div[id=mobile-bottom]\")],OrHeader.prototype,\"_mobileBottomDiv\",void 0),__decorate([property()],OrHeader.prototype,\"activeMenu\",void 0),__decorate([state()],OrHeader.prototype,\"_drawerOpened\",void 0),OrHeader=__decorate([customElement(\"or-header\")],OrHeader);export{OrHeader};","var __decorate=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var f=e.length-1;f>=0;f--)(o=e[f])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},__await=this&&this.__await||function(e){return this instanceof __await?(this.v=e,this):new __await(e)},__asyncGenerator=this&&this.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError(\"Symbol.asyncIterator is not defined.\");var i,o=n.apply(e,t||[]),r=[];return i={},a(\"next\"),a(\"throw\"),a(\"return\",(function(e){return function(t){return Promise.resolve(t).then(e,l)}})),i[Symbol.asyncIterator]=function(){return this},i;function a(e,t){o[e]&&(i[e]=function(t){return new Promise((function(n,i){r.push([e,t,n,i])>1||f(e,t)}))},t&&(i[e]=t(i[e])))}function f(e,t){try{(n=o[e](t)).value instanceof __await?Promise.resolve(n.value.v).then(c,l):s(r[0][2],n)}catch(e){s(r[0][3],e)}var n}function c(e){f(\"next\",e)}function l(e){f(\"throw\",e)}function s(e,t){e(t),r.shift(),r.length&&f(r[0][0],r[0][1])}};import{Page}from\"./types\";import{css,html}from\"lit\";import{customElement}from\"lit/decorators.js\";const styling=css`\n    #offline-wrapper {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        height: 100%;\n        width: 100%;\n        flex-direction: column;\n        gap: 32px;\n        padding: 0 32px;\n    }\n\n    #offline-icon {\n        font-size: 64px;\n    }\n\n    #offline-text-container {\n        display: flex;\n        align-items: center;\n        flex-direction: column;\n        gap: 16px;\n    }\n\n    #offline-title {\n        font-size: 24px;\n        font-weight: bold;\n    }\n    \n    #reconnecting-text:after {\n        display: inline-block;\n        animation: dotty steps(2,end) 2s infinite;\n        content: '';\n    }\n\n    @keyframes dotty {\n        0%   { content: ''; }\n        25%  { content: '.'; }\n        50%  { content: '..'; }\n        75%  { content: '...'; }\n        100% { content: ''; }\n    }\n`;function countDown(e){return __asyncGenerator(this,arguments,(function*(){for(;e>0;)yield yield __await(e--),yield __await(new Promise((e=>setTimeout(e,1e3))))}))}export function pageOfflineProvider(e){return{name:\"offline\",routes:[\"offline\"],pageCreator:()=>new PageOffline(e)}}let PageOffline=class extends Page{static get styles(){return[styling]}stateChanged(e){}render(){return html`\n            <div id=\"offline-wrapper\">\n                <or-icon id=\"offline-icon\" icon=\"web-off\"></or-icon>\n                <div id=\"offline-text-container\">\n                    <span id=\"offline-title\"\"><or-translate value=\"youAreOffline\"></or-translate></span>\n                    <span id=\"offline-subtitle\"><or-translate value=\"checkConnection\"></or-translate></span>\n                </div>\n                <div>\n                    <span><or-translate id=\"reconnecting-text\" value=\"reconnecting\"></or-translate></span>\n                </div>\n            </div>\n        `}get name(){return\"offline\"}};PageOffline=__decorate([customElement(\"page-offline\")],PageOffline);export{PageOffline};","var __decorate=this&&this.__decorate||function(e,t,i,o){var n,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,i,a):n(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},__awaiter=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(n,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};import{css,html,LitElement,unsafeCSS}from\"lit\";import{customElement,property,query,state}from\"lit/decorators.js\";import{router}from\"./types\";import\"@openremote/or-translate\";import\"@openremote/or-mwc-components/or-mwc-menu\";import\"@openremote/or-mwc-components/or-mwc-snackbar\";import\"./or-header\";import\"@openremote/or-icon\";import{updateMetadata}from\"pwa-helpers/metadata\";import i18next from\"i18next\";import manager,{DefaultColor2,DefaultColor3,DefaultColor4,normaliseConfig,ORError,OREvent,Util}from\"@openremote/core\";import{DEFAULT_LANGUAGES}from\"./or-header\";import{OrMwcDialog,showDialog,showErrorDialog}from\"@openremote/or-mwc-components/or-mwc-dialog\";import{OrMwcSnackbar}from\"@openremote/or-mwc-components/or-mwc-snackbar\";import{setOffline,setVisibility,updatePage,updateRealm}from\"./app\";import{InputType}from\"@openremote/or-mwc-components/or-mwc-input\";import{pageOfflineProvider}from\"./page-offline\";export const DefaultLogo=require(\"../images/logo.svg\");export const DefaultMobileLogo=require(\"../images/logo-mobile.svg\");export const DefaultFavIcon=require(\"../images/favicon.ico\");export*from\"./app\";export*from\"./or-header\";export*from\"./types\";export{DEFAULT_LANGUAGES};export function getDefaultManagerConfig(){return normaliseConfig(DEFAULT_MANAGER_CONFIG)}const DEFAULT_MANAGER_CONFIG={managerUrl:MANAGER_URL,keycloakUrl:KEYCLOAK_URL,auth:\"KEYCLOAK\",autoLogin:!0,realm:void 0,consoleAutoEnable:!0,loadTranslations:[\"or\"]};let OrApp=class extends LitElement{static get styles(){return[css`\n            :host {\n                --or-app-color2: ${unsafeCSS(DefaultColor2)};\n                --or-app-color3: ${unsafeCSS(DefaultColor3)};\n                --or-app-color4: ${unsafeCSS(DefaultColor4)};\n                --or-console-primary-color: #4D9D2A;\n                color: ${unsafeCSS(DefaultColor3)};\n                fill: ${unsafeCSS(DefaultColor3)};\n                font-size: 14px;\n\n                height: 100vh;\n                display: flex;\n                flex: 1;\n                flex-direction: column;\n            }\n                \n            .main-content {\n                display: flex;\n                flex: 1;\n                box-sizing: border-box;\n                background-color: var(--or-app-color2);\n                overflow: auto;\n            }\n            \n            .no-scroll {\n                overflow: hidden;\n            }\n\n            main > * {\n                display: flex;\n                flex: 1;\n                position: relative;\n            }\n    \n            .desktop-hidden {\n                display: none !important;\n            }\n            \n            @media only screen and (max-width: 780px) {\n                .desktop-hidden {\n                    display: inline-block !important;\n                }\n            }\n            \n            /* HEADER STYLES */\n            or-header a > or-icon {\n                margin-right: 10px;\n            }\n        `]}constructor(e){super(),this.OFFLINE_PAGE_ID=\"offline-page\",this._initialised=!1,this._offline=!1,this._showOfflineFallback=!1,this._store=e,OrMwcDialog.DialogHostElement=this,OrMwcSnackbar.DialogHostElement=this}getState(){return this._store.getState()}onVisibilityChange(e){\"visible\"===document.visibilityState?this._onEvent(OREvent.CONSOLE_VISIBLE):this._onEvent(OREvent.CONSOLE_HIDDEN)}connectedCallback(){super.connectedCallback(),this._storeUnsubscribe=this._store.subscribe((()=>this.stateChanged(this.getState()))),this._onVisibilityBind=this.onVisibilityChange.bind(this),document.addEventListener(\"visibilitychange\",this._onVisibilityBind),this.stateChanged(this.getState())}disconnectedCallback(){this._storeUnsubscribe(),this._onVisibilityBind&&document.removeEventListener(\"visibilityChange\",this._onVisibilityBind),this._onEventBind&&manager.removeListener(this._onEventBind),super.disconnectedCallback()}firstUpdated(e){super.firstUpdated(e);const t=this.managerConfig?Object.assign(Object.assign({},DEFAULT_MANAGER_CONFIG),this.managerConfig):DEFAULT_MANAGER_CONFIG;t.realm||(t.realm=Util.getQueryParameter(\"realm\")),t.defaultLanguage||(t.defaultLanguage=Util.getBrowserLanguage()),t.skipFallbackToBasicAuth=!0,t.basicLoginProvider=(e,t)=>this.doBasicLogin(e,t),console.info(\"Initialising the manager\"),manager.init(t).then((e=>__awaiter(this,void 0,void 0,(function*(){if(e||manager.error!==ORError.AUTH_FAILED||t.auth&&\"KEYCLOAK\"!==t.auth||(this.doAppConfigInit(),t.auth=\"BASIC\",e=yield manager.init(t)),e){if(this.doAppConfigInit(),!this.appConfig)return showErrorDialog(\"appError.noConfig\",document.body),void console.error(\"No AppConfig supplied\");if(!this._config)return showErrorDialog(\"appError.noConfig\",document.body),void console.error(\"No default AppConfig or realm specific config provided so cannot render\");if(!this._store)return showErrorDialog(\"appError.noReduxStore\",document.body),void console.error(\"No Redux store supplied\");if(!this.appConfig.pages||0===Object.keys(this.appConfig.pages).length)return showErrorDialog(\"appError.noPages\",document.body),void console.error(\"No page providers\");const e=yield manager.rest.api.RealmResource.getAccessible();let t;this._realms=e.data,manager.isSuperUser()&&(t=window.sessionStorage.getItem(\"realm\"),t&&!this._realms.some((e=>e.name===t))&&(t=void 0)),this._store.dispatch(updateRealm(t||manager.getRealm()||\"master\")),this._initialised=!0,this._onEventBind=this._onEvent.bind(this),manager.addListener(this._onEventBind);const i=e=>{this._activeMenu=e};router.hooks({before(e,t){i(t?t.url.split(\"/\")[0]:void 0),e()}}),this.appConfig.pages.forEach(((e,t)=>{e.routes&&e.routes.forEach((t=>{router.on(t,(t=>{this._store.dispatch(updatePage({page:e.name,params:t.data}))}))}))})),this.appConfig.pages.length>0&&router.notFound((()=>{this._store.dispatch(updatePage(this.appConfig.pages[0].name))})),router.resolve()}else showErrorDialog(manager.isError?\"managerError.\"+manager.error:\"\")}))))}updated(e){var t,i;if(super.updated(e),this._initialised&&(e.has(\"_page\")||e.has(\"_offline\")||e.has(\"_showOfflineFallback\"))){if(this._mainElem){const o=this.appConfig.pages.find((e=>e.name===this._page)),n=this._showOfflineFallback&&!(null==o?void 0:o.allowOffline),r=this._mainElem.querySelector(\"#\"+this.OFFLINE_PAGE_ID);if(e.has(\"_page\")&&o&&(this._mainElem.firstElementChild?this._loadPage(o,(e=>{n&&(e.style.setProperty(\"display\",\"none\"),e.setAttribute(\"loadedDuringOffline\",\"true\"))})):this._loadPage(o)),r&&!n){this._mainElem.removeChild(r);const e=this._mainElem.firstElementChild;null==e||e.style.removeProperty(\"display\"),(null==e?void 0:e.onRefresh)&&e.onRefresh()}else if(!r&&n){const e=(null===(t=this.appConfig)||void 0===t?void 0:t.offlinePage)?this.appConfig.offlinePage.pageCreator():pageOfflineProvider(this._store).pageCreator();null===(i=this._mainElem.firstElementChild)||void 0===i||i.style.setProperty(\"display\",\"none\"),e.id=this.OFFLINE_PAGE_ID,this._mainElem.appendChild(e)}}this.updateWindowTitle()}}shouldUpdate(e){if(e.has(\"_realm\")&&(this._config=this._getConfig(),this._realm?(manager.displayRealm=this._realm,window.sessionStorage.setItem(\"realm\",this._realm)):window.sessionStorage.removeItem(\"realm\")),e.has(\"_config\")&&this._config){this._config.logo||(this._config.logo=DefaultLogo),this._config.logoMobile||(this._config.logoMobile=DefaultMobileLogo);const e=this._config&&this._config.favicon?this._config.favicon:DefaultFavIcon;let t=document.querySelector(\"link[rel~='icon']\");t||(t=document.createElement(\"link\"),t.rel=\"icon\",document.getElementsByTagName(\"head\")[0].appendChild(t)),t.href=e}return this.updateWindowTitle(),super.shouldUpdate(e)}render(){if(!this._initialised)return html`<or-mwc-dialog id=\"app-modal\"></or-mwc-dialog>`;let e;if(manager.consoleAppConfig){const t=manager.consoleAppConfig,i=t.primaryColor,o=t.secondaryColor;e=html`<style>:host {--or-console-primary-color:${i};--or-console-secondary-color:${o};}</style>`}return html`\n            ${this._config.styles?\"string\"==typeof this._config.styles?html`<style>${this._config.styles}</style>`:this._config.styles.strings:\"\"}\n            ${e}\n            ${this._config.header?html`\n                <or-header .activeMenu=\"${this._activeMenu}\" .store=\"${this._store}\" .realm=\"${this._realm}\" .realms=\"${this._realms}\" .logo=\"${this._config.logo}\" .logoMobile=\"${this._config.logoMobile}\" .config=\"${this._config.header}\"></or-header>\n            `:\"\"}\n            \n            <!-- Main content -->\n            <main role=\"main\" class=\"main-content d-none\"></main>\n            \n            <slot></slot>\n        `}stateChanged(e){this._realm=e.app.realm,this._page=e.app.page,this._offline=e.app.offline}_onEvent(e){var t;e===OREvent.OFFLINE?this._offline||this._store.dispatch(setOffline(!0)):e===OREvent.ONLINE?this._offline&&(this._showOfflineFallback=!1,this._completeOfflineFallbackTimer(),this._store.dispatch(setOffline(!1))):e===OREvent.RECONNECT_FAILED?this._startOfflineFallbackTimer():e===OREvent.CONSOLE_VISIBLE?(this._store.dispatch(setVisibility(!0)),(null===(t=manager.console)||void 0===t?void 0:t.isMobile)&&this._offline&&this._startOfflineFallbackTimer(!0),manager.reconnect(!0)):e===OREvent.CONSOLE_HIDDEN&&this._store.dispatch(setVisibility(!1))}_startOfflineFallbackTimer(e=!1){var t;if(e)this._completeOfflineFallbackTimer(!0);else if(this._offlineFallbackDeferred||this._showOfflineFallback)return;const i=new Util.Deferred;let o=!1;i.promise.then((()=>{this._showOfflineFallback=this._offline})).finally((()=>{o=!0})),setTimeout((()=>{o||i.resolve()}),(null===(t=this.appConfig)||void 0===t?void 0:t.offlineTimeout)||1e4),this._offlineFallbackDeferred=i}_completeOfflineFallbackTimer(e=!1){var t,i;e?null===(t=this._offlineFallbackDeferred)||void 0===t||t.reject():null===(i=this._offlineFallbackDeferred)||void 0===i||i.resolve(),this._offlineFallbackDeferred=void 0}logout(){manager.logout()}setLanguage(e){manager.language=e}showLanguageModal(){showDialog((new OrMwcDialog).setHeading(\"language\").setDismissAction(null).setStyles(html`<style>.selected { color: ${unsafeCSS(DefaultColor4)} }</style>`).setActions(Object.entries(this.appConfig.languages||DEFAULT_LANGUAGES).map((([e,t])=>({content:html`<span class=\"${e===manager.language?\"selected\":\"\"}\">${i18next.t(t)}</span>`,actionName:e,action:()=>{manager.language=e}})))))}doAppConfigInit(){this.appConfig=this.appConfig||(this.appConfigProvider?this.appConfigProvider(manager):void 0),this.appConfig&&(this._config||(this._config=this._getConfig()))}doBasicLogin(e,t){const i=new Util.Deferred;let o=e,n=t;const r=html`\n            #login-logo {\n                width: 24px;\n                height: 24px;\n            }\n            \n            #login_wrapper > or-mwc-input {\n                margin: 10px 0;\n                width: 100%;\n            }\n        `;return showDialog((new OrMwcDialog).setStyles(html`<style>${r}</style>`).setHeading(html`<img id=\"login-logo\" src=\"${this._config.logoMobile||this._config.logo}\" /></or-icon><or-translate value=\"login\"></or-translate>`).setContent(html`\n                <div id=\"login_wrapper\">\n                    <or-mwc-input .label=\"${i18next.t(\"user\")}\" .type=\"${InputType.TEXT}\" min=\"1\" required .value=\"${e}\" @or-mwc-input-changed=\"${e=>o=e.detail.value}\"></or-mwc-input>            \n                    <or-mwc-input .label=\"${i18next.t(\"password\")}\" .type=\"${InputType.PASSWORD}\" min=\"1\" required .value=\"${t}\" @or-mwc-input-changed=\"${e=>n=e.detail.value}\"></or-mwc-input>           \n                </div>\n            `).setActions([{actionName:\"submit\",default:!0,action:()=>{i.resolve({cancel:!1,username:o,password:n})},content:html`<or-mwc-input .type=${InputType.BUTTON} .label=\"${i18next.t(\"submit\")}\" raised></or-mwc-input>`}]),document.body),i.promise}_loadPage(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=this._mainElem.firstElementChild,o=e.pageCreator();return yield null==t?void 0:t(o),i?this._mainElem.replaceChild(o,i):this._mainElem.appendChild(o),o}))}_unloadPage(e){var t;return __awaiter(this,void 0,void 0,(function*(){this._mainElem||console.error(\"Could not unload page; the main element could not be found.\"),e||(e=null===(t=this._mainElem)||void 0===t?void 0:t.firstElementChild)?this._mainElem.removeChild(e):console.warn(\"Tried to unload the current page, but no child element was found.\")}))}updateWindowTitle(){if(!this._initialised)return;const e=this._config.appTitle||\"\";let t=i18next.isInitialized?i18next.t(e):e;const i=this._mainElem?this._mainElem.firstElementChild:void 0;i&&(t+=i18next.isInitialized?\" - \"+i18next.t(i.name):\" - \"+i.name),updateMetadata({title:t,description:t})}_getConfig(){const e=this.appConfig.realms?this.appConfig.realms.default:{};let t=this.appConfig.realms?this.appConfig.realms[this._realm||\"\"]:void 0;return t=Util.mergeObjects(e,t,!1),this.appConfig&&this.appConfig.superUserHeader&&manager.isSuperUser()&&(t.header=this.appConfig.superUserHeader),t}};__decorate([property({type:Object})],OrApp.prototype,\"appConfig\",void 0),__decorate([property({type:Object})],OrApp.prototype,\"managerConfig\",void 0),__decorate([query(\"main\")],OrApp.prototype,\"_mainElem\",void 0),__decorate([state()],OrApp.prototype,\"_initialised\",void 0),__decorate([state()],OrApp.prototype,\"_page\",void 0),__decorate([state()],OrApp.prototype,\"_config\",void 0),__decorate([state()],OrApp.prototype,\"_realm\",void 0),__decorate([state()],OrApp.prototype,\"_offline\",void 0),__decorate([state()],OrApp.prototype,\"_showOfflineFallback\",void 0),__decorate([state()],OrApp.prototype,\"_activeMenu\",void 0),OrApp=__decorate([customElement(\"or-app\")],OrApp);export{OrApp};","var __decorate=this&&this.__decorate||function(t,e,i,s){var a,o=arguments.length,r=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var n=t.length-1;n>=0;n--)(a=t[n])&&(r=(o<3?a(r):o>3?a(e,i,r):a(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(a,o){function r(t){try{l(s.next(t))}catch(t){o(t)}}function n(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,n)}l((s=s.apply(t,e||[])).next())}))};import{css,html,LitElement}from\"lit\";import{customElement,property,query,state}from\"lit/decorators.js\";import{AssetModelUtil}from\"@openremote/model\";import{Gauge}from\"gaugeJS\";import manager,{Util}from\"@openremote/core\";import{i18next}from\"@openremote/or-translate\";import{debounce}from\"lodash\";import{getAssetDescriptorIconTemplate}from\"@openremote/or-icon\";const styling=css`\n    :host {\n        display: flex;\n        align-items: center;\n        flex-direction: column;\n    }\n\n    #chart-wrapper {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n    }\n    #chart-container {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n\n    #chart {\n        width: 100%;\n    }\n\n    .chart-description {\n        margin: 0 20px;\n        font-size: 16px;\n        z-index: 3;\n    }\n    .mainvalue-wrapper {\n        width: 100%;\n        display: flex;\n        flex: 0 0 60px;\n        align-items: center;\n        justify-content: center;\n    }\n    .main-number {\n        color: var(--internal-or-asset-viewer-title-text-color);\n        font-size: 42px;\n    }\n\n    .main-number-icon {\n        font-size: 24px;\n        margin-right: 10px;\n        display: flex;\n    }\n\n    .main-number-unit {\n        font-size: 42px;\n        color: var(--internal-or-asset-viewer-title-text-color);\n        font-weight: 200;\n        margin-left: 5px;\n    }\n\n    .main-number.xs, .main-number-unit.xs {\n        font-size: 18px;\n    }\n    .main-number.s, .main-number-unit.s {\n        font-size: 24px;\n    }\n    .main-number.m, .main-number-unit.m {\n        font-size: 30px;\n    }\n    .main-number.l, .main-number-unit.l {\n        font-size: 36px;\n    }\n    .main-number.xl, .main-number-unit.xl {\n        font-size: 42px;\n    }\n    .main-number.unknown, .main-number-unit.unknown {\n        font-size: unset;\n    }\n`;let OrGauge=class extends LitElement{static get styles(){return[styling]}constructor(){super(),this.decimals=0,this.loading=!1,this.config||(this.config=this.getDefaultConfig()),this.updateComplete.then((()=>{this.resizeObserver=new ResizeObserver(debounce((t=>{const e=t[0].contentRect;this.gaugeSize={width:e.width,height:e.height},this.updateComplete.then((()=>{this.setupGauge()}))}),200)),this.resizeObserver.observe(this._wrapperElem)}))}willUpdate(t){if(t.has(\"assetAttribute\")&&this.assetAttribute){const t=this.assetAttribute[1],e=AssetModelUtil.getAttributeDescriptor(t.name,this.asset.type);this.unit=Util.resolveUnits(Util.getAttributeUnits(t,e,this.asset.type)),this.value=null!=t.value?t.value:NaN}}updated(t){var e,i,s,a;t.has(\"value\")&&(null===(e=this.gauge)||void 0===e||e.set(null!=this.value?this.value:NaN)),t.has(\"attrRef\")&&(this.attrRef?this.loadData(this.attrRef):t.get(\"attrRef\")&&(this.assetAttribute=void 0,this.value=void 0)),t.has(\"min\")&&this.gauge&&(console.log(\"Setting min value\"),this.gauge.setMinValue(this.min||0),this.gauge.set(null!=this.value?this.value:NaN)),t.has(\"max\")&&this.gauge&&(this.gauge.maxValue=this.max||0,this.gauge.set(null!=this.value?this.value:NaN)),t.has(\"thresholds\")&&this.thresholds&&(this.config.options.staticZones=[],console.log(typeof this.thresholds),this.thresholds.sort(((t,e)=>t[0]<e[0]?-1:1)).forEach(((t,e)=>{var i,s,a;const o=t[0],r=this.thresholds[e+1]?this.thresholds[e+1][0]:this.max,n={strokeStyle:t[1],min:this.min&&o&&this.min>o?this.min:this.max&&o&&this.max<o?this.max:o,max:this.max&&r&&this.max<r?this.max:this.min&&r&&this.min>r?this.min:r};null===(a=null===(s=null===(i=this.config)||void 0===i?void 0:i.options)||void 0===s?void 0:s.staticZones)||void 0===a||a.push(n)})),this.min&&(null===(s=null===(i=this.config)||void 0===i?void 0:i.options)||void 0===s?void 0:s.staticZones)&&(this.config.options.staticZones[0].min=this.min),this.gauge&&this.gauge.setOptions(null===(a=this.config)||void 0===a?void 0:a.options))}setupGauge(){var t;console.log(\"setupGauge()\",this.config,this.value),this.gauge=new Gauge(this._gaugeElem),this.gauge.setOptions(null===(t=this.config)||void 0===t?void 0:t.options),this.gauge.maxValue=this.max?this.max:100,this.gauge.setMinValue(this.min?this.min:0),this.gauge.animationSpeed=1,this.gauge.set(null!=this.value?this.value:NaN),null==this.value&&this.attrRef&&this.loadData(this.attrRef)}getGaugeWidth(t,e=!0){if(!t)return\"unset\";const i=t.width,s=1.5*(e?t.height-this._detailsElem.clientHeight:t.height);return Math.min(i,s)+\"px\"}shouldShowLabel(t){return t.width>70&&t.height>100}getLabelSize(t){return t<120?\"s\":t<240?\"m\":t<320?\"l\":\"xl\"}render(){const t=!this.gaugeSize||this.shouldShowLabel(this.gaugeSize),e=t&&this.gaugeSize?this.getLabelSize(this.gaugeSize.width):\"unknown\",i=this.getGaugeWidth(this.gaugeSize,t);return html`\n            <div style=\"position: relative; height: 100%; width: 100%;\">\n                <div id=\"chart-wrapper\" style=\"display: ${this.loading?\"none\":\"flex\"};\">\n                    <div id=\"chart-container\" style=\"flex: 0 0 0; width: ${i};\">\n                        <canvas id=\"chart\"></canvas>\n                    </div>\n                    <div id=\"details-container\">\n                        ${t?html`\n                            <div class=\"mainvalue-wrapper\">\n                                <span class=\"main-number-icon\">${this.asset?getAssetDescriptorIconTemplate(AssetModelUtil.getAssetDescriptor(this.asset.type)):\"\"}</span>\n                                <span class=\"main-number ${e}\">${this.value}</span>\n                                <span class=\"main-number-unit ${e}\">${this.unit?this.unit:\"\"}</span>\n                            </div>\n                        `:void 0}\n                    </div>\n                </div>\n            </div>\n            ${this.loading?html`\n                <span>${i18next.t(\"loading\")}</span>\n            `:void 0}\n        `}loadData(t){return __awaiter(this,void 0,void 0,(function*(){const e=(yield manager.rest.api.AssetResource.queryAssets({ids:[t.id]})).data,i=[t].map((t=>{const i=e.findIndex((e=>e.id===t.id)),s=i>=0?e[i]:void 0;return s&&s.attributes?[i,s.attributes[t.name]]:void 0})).filter((t=>!!t));this.asset=e[0],this.assetAttribute=i[0]}))}getDefaultConfig(){return{attributeRef:void 0,options:{angle:0,lineWidth:.4,radiusScale:1,pointer:{length:.5,strokeWidth:.035,color:\"#000000\"},staticZones:[],limitMax:!0,limitMin:!0,colorStart:\"#000000\",colorStop:\"#707070\",strokeColor:\"#ABCDEF\",generateGradient:!1,highDpiSupport:!0}}}};__decorate([property({type:Object})],OrGauge.prototype,\"attrRef\",void 0),__decorate([property({type:Object})],OrGauge.prototype,\"asset\",void 0),__decorate([property({type:Object})],OrGauge.prototype,\"assetAttribute\",void 0),__decorate([property({type:Number})],OrGauge.prototype,\"value\",void 0),__decorate([property()],OrGauge.prototype,\"decimals\",void 0),__decorate([property()],OrGauge.prototype,\"unit\",void 0),__decorate([property()],OrGauge.prototype,\"min\",void 0),__decorate([property()],OrGauge.prototype,\"max\",void 0),__decorate([property({type:Array})],OrGauge.prototype,\"thresholds\",void 0),__decorate([property()],OrGauge.prototype,\"config\",void 0),__decorate([property({type:String})],OrGauge.prototype,\"realm\",void 0),__decorate([state()],OrGauge.prototype,\"loading\",void 0),__decorate([query(\"#chart\")],OrGauge.prototype,\"_gaugeElem\",void 0),__decorate([query(\"#chart-wrapper\")],OrGauge.prototype,\"_wrapperElem\",void 0),__decorate([query(\"#details-container\")],OrGauge.prototype,\"_detailsElem\",void 0),OrGauge=__decorate([customElement(\"or-gauge\")],OrGauge);export{OrGauge};"],"names":[],"sourceRoot":""}